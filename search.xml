<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title>vue2-给组件绑定原生事件</title>
    <url>/2019/03/24/190324.html</url>
    <content><![CDATA[<h1 id="Vue2-给组件绑定原生事件"><a href="#Vue2-给组件绑定原生事件" class="headerlink" title="Vue2-给组件绑定原生事件"></a>Vue2-给组件绑定原生事件</h1><h4 id="在组件上设置点击事件"><a href="#在组件上设置点击事件" class="headerlink" title="在组件上设置点击事件"></a>在组件上设置点击事件</h4><pre class="language-js" data-language="js"><code class="language-js"><span class="token operator">&lt;</span>div id<span class="token operator">=</span><span class="token string">"app"</span>  <span class="token operator">></span>
       <span class="token operator">&lt;</span>child @click<span class="token operator">=</span><span class="token string">"handleClick"</span><span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>child<span class="token operator">></span>
   <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span>

   <span class="token operator">&lt;</span>script<span class="token operator">></span>
     
       Vue<span class="token punctuation">.</span><span class="token function">component</span><span class="token punctuation">(</span><span class="token string">'child'</span><span class="token punctuation">,</span><span class="token punctuation">&#123;</span>
           <span class="token literal-property property">template</span><span class="token operator">:</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">&lt;div>Child&lt;/div></span><span class="token template-punctuation string">`</span></span>
       <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
       <span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
           <span class="token literal-property property">el</span><span class="token operator">:</span><span class="token string">'#app'</span><span class="token punctuation">,</span>
           <span class="token literal-property property">methods</span><span class="token operator">:</span><span class="token punctuation">&#123;</span>
               <span class="token function">handleClick</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
                   <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">'click'</span><span class="token punctuation">)</span>
               <span class="token punctuation">&#125;</span>
           <span class="token punctuation">&#125;</span>
       <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>

   <span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">></span></code></pre>

<p>显然在Root组件中不能被触发，因为这时候 组件<code>child</code>上的<code>click</code>相当于自定义的一个事件，这时候需要通过<code>this.$emit</code>去触发自定义事件</p>
<pre class="language-js" data-language="js"><code class="language-js"><span class="token operator">&lt;</span>div id<span class="token operator">=</span><span class="token string">"app"</span>  <span class="token operator">></span>
    <span class="token operator">&lt;</span>child  @click<span class="token operator">=</span><span class="token string">"handleClick"</span><span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>child<span class="token operator">></span>
<span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span>

<span class="token operator">&lt;</span>script<span class="token operator">></span>
  
    Vue<span class="token punctuation">.</span><span class="token function">component</span><span class="token punctuation">(</span><span class="token string">'child'</span><span class="token punctuation">,</span><span class="token punctuation">&#123;</span>
        <span class="token literal-property property">template</span><span class="token operator">:</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">&lt;div  @click="handleClick">Child&lt;/div></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
        <span class="token literal-property property">methods</span><span class="token operator">:</span><span class="token punctuation">&#123;</span>
            <span class="token function">handleClick</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
                <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$emit</span><span class="token punctuation">(</span><span class="token string">'click'</span><span class="token punctuation">)</span>
            <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
        <span class="token literal-property property">el</span><span class="token operator">:</span><span class="token string">'#app'</span><span class="token punctuation">,</span>
        <span class="token literal-property property">methods</span><span class="token operator">:</span><span class="token punctuation">&#123;</span>
            <span class="token function">handleClick</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
                <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">'click'</span><span class="token punctuation">)</span>
            <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>

<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">></span></code></pre>

<blockquote>
<p>这时候就实现了点击事件，但是究其根本，这还是自定义事件，太过麻烦。</p>
</blockquote>
<h4 id="给组件绑定原生事件"><a href="#给组件绑定原生事件" class="headerlink" title="给组件绑定原生事件"></a>给组件绑定原生事件</h4><blockquote>
<p>非常简单：只要在事件绑定后面加上<code>.native</code> 的修饰符就可以了</p>
</blockquote>
<pre class="language-js" data-language="js"><code class="language-js"><span class="token operator">&lt;</span>div id<span class="token operator">=</span><span class="token string">"app"</span>  <span class="token operator">></span>
       <span class="token operator">&lt;</span>child  @click<span class="token punctuation">.</span>native<span class="token operator">=</span><span class="token string">"handleClick"</span><span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>child<span class="token operator">></span>
<span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span>

<span class="token operator">&lt;</span>script<span class="token operator">></span>
       Vue<span class="token punctuation">.</span><span class="token function">component</span><span class="token punctuation">(</span><span class="token string">'child'</span><span class="token punctuation">,</span><span class="token punctuation">&#123;</span>
           <span class="token literal-property property">template</span><span class="token operator">:</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">&lt;div >Child&lt;/div></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
       <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
       <span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
           <span class="token literal-property property">el</span><span class="token operator">:</span><span class="token string">'#app'</span><span class="token punctuation">,</span>
           <span class="token literal-property property">methods</span><span class="token operator">:</span><span class="token punctuation">&#123;</span>
               <span class="token function">handleClick</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
                   <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">'click'</span><span class="token punctuation">)</span>
               <span class="token punctuation">&#125;</span>
           <span class="token punctuation">&#125;</span>
       <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">></span></code></pre>

]]></content>
      <categories>
        <category>Vue.js</category>
      </categories>
      <tags>
        <tag>前端</tag>
        <tag>Vue</tag>
      </tags>
  </entry>
  <entry>
    <title>Vue 使用 formData 方式向后台发送数据</title>
    <url>/2019/04/13/90413.html</url>
    <content><![CDATA[<h1 id="Vue-使用-formData-方式向后台发送数据"><a href="#Vue-使用-formData-方式向后台发送数据" class="headerlink" title="Vue 使用 formData 方式向后台发送数据"></a>Vue 使用 formData 方式向后台发送数据</h1><h3 id="1-基本使用方式"><a href="#1-基本使用方式" class="headerlink" title="1. 基本使用方式"></a>1. 基本使用方式</h3><p><strong>template</strong></p>
<pre class="language-html" data-language="html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>file<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>file<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>file<span class="token punctuation">"</span></span> <span class="token attr-name">accept</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>image/png,image/gif,image/jpeg<span class="token punctuation">"</span></span> <span class="token attr-name">@change</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>update<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span></code></pre>

<p><strong>JavaScript</strong></p>
<pre class="language-js" data-language="js"><code class="language-js"><span class="token function">update</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">let</span> file <span class="token operator">=</span> e<span class="token punctuation">.</span>target<span class="token punctuation">.</span>files<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
    <span class="token comment">// console.log(file)</span>
    <span class="token keyword">let</span> param <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FormData</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// 创建form对象</span>
    param<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">'file'</span><span class="token punctuation">,</span> file<span class="token punctuation">,</span> file<span class="token punctuation">.</span>name<span class="token punctuation">)</span> <span class="token comment">// 通过append向form对象添加数据</span>
    param<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">'id'</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$store<span class="token punctuation">.</span>state<span class="token punctuation">.</span>userId<span class="token punctuation">)</span> <span class="token comment">// 添加form表单中其他数据</span>
      <span class="token comment">// withCredentials: true 使得后台可以接收表单数据  跨域请求</span>
    <span class="token keyword">const</span> instance <span class="token operator">=</span> axios<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
        <span class="token literal-property property">withCredentials</span><span class="token operator">:</span> <span class="token boolean">true</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
    <span class="token comment">// url为后台接口</span>
    instance<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">'url'</span><span class="token punctuation">,</span> param<span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>succ<span class="token punctuation">)</span> <span class="token comment">// 成功返回信息 调用函数  函数需自己定义，此处后面省略</span>
        <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>serverError<span class="token punctuation">)</span> <span class="token comment">// 服务器错误 调用对应函数  函数需自己定义，此处后面省略</span>
<span class="token punctuation">&#125;</span></code></pre>

<h3 id="2-美化-input-file-按钮-（拓展）"><a href="#2-美化-input-file-按钮-（拓展）" class="headerlink" title="2. 美化 input file 按钮 （拓展）"></a>2. 美化 input file 按钮 （拓展）</h3><blockquote>
<p>思路：</p>
</blockquote>
<ol>
<li>简单粗暴地隐藏：opacity: 0;</li>
<li>在 <code>&lt;input class=&quot;file&quot;&gt; </code>元素节点的位置上创建一个好看的元素节点,比如<code>img</code></li>
<li>将 <code>&lt;input class=&quot;file&quot;&gt; </code>元素的z轴变高，使得其覆盖<code>&lt;img/&gt;</code> :z-index: 5;</li>
<li>因为 <code>&lt;input class=&quot;file&quot;&gt; </code>是透明的，那么我们就只看见它同xy上的好看的<code>&lt;img /&gt;</code></li>
<li>点击这个好看的<code>&lt;img /&gt;</code> 其实是点击了它上层的表单</li>
</ol>
<p>以上思路可以实现点击用户头像，<strong>通过表单上传更换头像</strong></p>
]]></content>
      <categories>
        <category>Vue.js</category>
      </categories>
      <tags>
        <tag>formdata</tag>
        <tag>axios</tag>
        <tag>vue</tag>
      </tags>
  </entry>
  <entry>
    <title>学习 ES6 基础</title>
    <url>/2019/04/16/90416.html</url>
    <content><![CDATA[<h1 id="学习-ES6-基础"><a href="#学习-ES6-基础" class="headerlink" title="学习 ES6 基础"></a>学习 ES6 基础</h1><h2 id="一、块级作用域"><a href="#一、块级作用域" class="headerlink" title="一、块级作用域"></a>一、块级作用域</h2><h3 id="1-var"><a href="#1-var" class="headerlink" title="1. var"></a>1. var</h3><p>首先看看ES5中得变量声明方式</p>
<pre class="language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token number">2</span>
<span class="token punctuation">&#125;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span> <span class="token comment">// 2</span></code></pre>

<p>以上代码等同于</p>
<pre class="language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">var</span> a
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    a <span class="token operator">=</span> <span class="token number">2</span>
<span class="token punctuation">&#125;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span></code></pre>

<blockquote>
<p>以上可知 ：</p>
<ol>
<li>在块内部定义变量 变量提升，到函数最顶部</li>
<li>通过var声明的变量，无论在何处声明，均为<strong>全局作用域</strong></li>
</ol>
</blockquote>
<h3 id="2-let-和-const"><a href="#2-let-和-const" class="headerlink" title="2.let 和 const"></a>2.let 和 const</h3><p>再来看看<code>ES6</code>中的<code>let</code>和<code>const</code></p>
<h3 id="let"><a href="#let" class="headerlink" title="let"></a><code>let</code></h3><pre class="language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">let</span> b <span class="token operator">=</span> <span class="token number">2</span>
<span class="token punctuation">&#125;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span> <span class="token comment">// b is not defined</span></code></pre>

<blockquote>
<p>此时在{} 外部访问b 将会报错，因为 let 的作用域仅为 <code>&#123; &#125; </code>的内部，及<strong>块级作用域</strong></p>
</blockquote>
<h3 id="const"><a href="#const" class="headerlink" title="const"></a><code>const</code></h3><pre class="language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">const</span> c <span class="token operator">=</span> <span class="token number">2</span>
<span class="token punctuation">&#125;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span> <span class="token comment">// c is not defined</span></code></pre>

<blockquote>
<p>从上面可知 const 也是也仅为块级作用域</p>
<p><strong>const的作用域与let作用域相同：只在声明所在的块级作用域内有效</strong></p>
</blockquote>
<p>让我们看看const 更多的特性：</p>
<p><strong>const 表示常量：</strong></p>
<pre class="language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> d <span class="token operator">=</span> <span class="token number">2</span>
d <span class="token operator">=</span> <span class="token number">3</span> <span class="token comment">// Assignment to constant variable.</span></code></pre>

<blockquote>
<p>此时，当 d 为 <strong>基本数据类型</strong>的时候，改变其值，将会报错！！！</p>
</blockquote>
<p><strong>但是它的常量仅仅表示的是地址常量 对象的成员可以改变值</strong></p>
<p>看看下面的例子：</p>
<pre class="language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> people <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'张三'</span><span class="token punctuation">,</span> <span class="token literal-property property">age</span><span class="token operator">:</span> <span class="token number">23</span><span class="token punctuation">&#125;</span>
people<span class="token punctuation">.</span>age <span class="token operator">=</span> <span class="token number">25</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>people<span class="token punctuation">)</span> <span class="token comment">// &#123;name: "张三", age: 25&#125;</span></code></pre>

<p>看看此时 <strong>people</strong>已经被改变了</p>
<p><strong>why?</strong></p>
<blockquote>
<p>对象是复杂的数据类型 它的地址保存在 栈里面， 值保存在堆里面</p>
<p>cosnt仅仅是保证这个地址不改变，至于地址对应的数据，是可以进行改变的</p>
<p>基本类型值在内存中占据固定大小的空间 因此被保存在栈内存中。比如 const a = 1 ; 这时候其直接保存在栈里面</p>
</blockquote>
<h2 id="二、字符串"><a href="#二、字符串" class="headerlink" title="二、字符串"></a>二、字符串</h2><h3 id="1-字符串拼接"><a href="#1-字符串拼接" class="headerlink" title="1. 字符串拼接"></a>1. 字符串拼接</h3><h4 id="ES5中字符串拼接"><a href="#ES5中字符串拼接" class="headerlink" title="ES5中字符串拼接"></a>ES5中字符串拼接</h4><pre class="language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// ES5 </span>
<span class="token keyword">var</span> name <span class="token operator">=</span> <span class="token string">'Hunter'</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'hello '</span> <span class="token operator">+</span> name<span class="token punctuation">)</span></code></pre>

<h4 id="ES6中字符串拼接"><a href="#ES6中字符串拼接" class="headerlink" title="ES6中字符串拼接"></a>ES6中字符串拼接</h4><pre class="language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// ES6</span>
<span class="token keyword">let</span> name <span class="token operator">=</span> <span class="token string">'Hunter'</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">hello </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>name<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span> <span class="token comment">// hello Hunter</span></code></pre>

<p><strong>注意</strong>：用 <code>$&#123;&#125;</code>来拼接字符串，注意此时要使用 ``` `（反单引号）; 如下所示： 单引号将无法将其转义</p>
<pre class="language-javascript" data-language="javascript"><code class="language-javascript">console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'hello $&#123;name&#125;'</span><span class="token punctuation">)</span> <span class="token comment">// hello $&#123;name&#125;</span></code></pre>

<h4 id="ES6的字符串换行"><a href="#ES6的字符串换行" class="headerlink" title="ES6的字符串换行"></a>ES6的字符串换行</h4><pre class="language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// ES5</span>
    <span class="token keyword">var</span> template <span class="token operator">=</span> <span class="token string">"&lt;div> \
                        &lt;span>hello world&lt;/span> \
                    &lt;/div>"</span>
<span class="token comment">// ES6</span>
    <span class="token keyword">let</span> template2 <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">&lt;div> 
                        &lt;span>hello world&lt;/span>
                    &lt;/div></span><span class="token template-punctuation string">`</span></span></code></pre>

<blockquote>
<p>ES5中需要用反斜杠来进行多行字符串拼接，ES6直接使用 ``` `(反单引号）</p>
</blockquote>
<h3 id="2-字符串方法"><a href="#2-字符串方法" class="headerlink" title="2. 字符串方法"></a>2. 字符串方法</h3><h4 id="padStart-和-padEnd"><a href="#padStart-和-padEnd" class="headerlink" title="padStart() 和 padEnd()"></a>padStart() 和 padEnd()</h4><blockquote>
<p>ES6 引入了字符串补全长度的功能，如果某个字符串不够指定长度，会在头部或者尾部补全。</p>
<p><code>padStart()</code> 用于<strong>头部补全</strong>；</p>
<p><code>padEnd()</code> 用于<strong>尾部补全</strong>。</p>
</blockquote>
<p>如下一个例子：<a href="https://link.segmentfault.com/?enc=s/4vgLhRUyDoiV6EE9xmDg==.5gVHrKgFETCAcBlABIaC7y5JThUkPAsvADpfs5X6kXzoKxzVYMPeX+/Cv8BC0+go">例子来源</a></p>
<pre class="language-javascript" data-language="javascript"><code class="language-javascript"><span class="token function">setInterval</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
       <span class="token keyword">const</span> now <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
       <span class="token keyword">const</span> hours <span class="token operator">=</span> now<span class="token punctuation">.</span><span class="token function">getHours</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
       <span class="token keyword">const</span> minutes <span class="token operator">=</span> now<span class="token punctuation">.</span><span class="token function">getMinutes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
       <span class="token keyword">const</span> seconds <span class="token operator">=</span> now<span class="token punctuation">.</span><span class="token function">getSeconds</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
       console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>hours<span class="token punctuation">.</span><span class="token function">padStart</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string">:</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>minutes<span class="token punctuation">.</span><span class="token function">padStart</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string">:</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>seconds<span class="token punctuation">.</span><span class="token function">padStart</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
   <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span></code></pre>

<blockquote>
<p>先不管箭头函数</p>
</blockquote>
<p>看看其中的<code>hours.padStart(2,0)</code> , 表示当小时不够两位数时，在前面补0，如<code>8</code>，补充成 <code>08</code></p>
<p>后面遇到更多的字符串函数会补充</p>
<h2 id="三、变量的解构赋值"><a href="#三、变量的解构赋值" class="headerlink" title="三、变量的解构赋值"></a>三、变量的解构赋值</h2><pre class="language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// ES5</span>
<span class="token keyword">let</span> a <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> b <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> c <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span></code></pre>

<h3 id="1-ES6数组解构赋值"><a href="#1-ES6数组解构赋值" class="headerlink" title="1.ES6数组解构赋值"></a>1.ES6数组解构赋值</h3><pre class="language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">let</span> <span class="token punctuation">[</span>a<span class="token punctuation">,</span>b<span class="token punctuation">,</span>c<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>a<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string"> </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>b<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string"> </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>c<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span> <span class="token comment">// 1 2 3</span></code></pre>

<h4 id="默认值"><a href="#默认值" class="headerlink" title="默认值"></a>默认值</h4><pre class="language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">let</span> <span class="token punctuation">[</span>d <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">,</span> e<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token keyword">undefined</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>d<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string"> </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>e<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span> <span class="token comment">// 2 3</span></code></pre>

<blockquote>
<p>当赋值为<code>undefined</code>时取默认值 当赋值为其他的有效值或者<code>null</code>时 取所赋值的值</p>
</blockquote>
<pre class="language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">let</span> <span class="token punctuation">[</span>f <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">,</span> g <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>f<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string"> </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>g<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span> <span class="token comment">// null 4</span></code></pre>

<h3 id="2-对象解构赋值"><a href="#2-对象解构赋值" class="headerlink" title="2.对象解构赋值"></a>2.对象解构赋值</h3><blockquote>
<p>数组按照顺序解构 对象按照key值进行解构</p>
</blockquote>
<pre class="language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">let</span> <span class="token punctuation">&#123;</span>foo<span class="token punctuation">,</span> bar<span class="token punctuation">&#125;</span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token literal-property property">foo</span><span class="token operator">:</span> <span class="token string">'hi'</span><span class="token punctuation">,</span> <span class="token literal-property property">bar</span><span class="token operator">:</span> <span class="token string">'hello'</span><span class="token punctuation">&#125;</span> <span class="token comment">//可以调换位置</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>foo<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string"> </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>bar<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span> <span class="token operator">*</span><span class="token comment">// hi hello</span></code></pre>

<blockquote>
<p>注意：先定义再解构需要在解构语句那块加上圆括号</p>
</blockquote>
<pre class="language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">let</span> soso<span class="token punctuation">;</span>
<span class="token comment">// &#123; soso &#125; = &#123; soso: "hi"&#125;; // 错误</span>
<span class="token punctuation">(</span><span class="token punctuation">&#123;</span> soso <span class="token punctuation">&#125;</span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span> <span class="token literal-property property">soso</span><span class="token operator">:</span> <span class="token string">"hi"</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//得加上圆括号 ()</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>soso<span class="token punctuation">)</span> <span class="token comment">// hi</span></code></pre>

<h3 id="3-字符串的解构赋值"><a href="#3-字符串的解构赋值" class="headerlink" title="3.字符串的解构赋值"></a>3.字符串的解构赋值</h3><pre class="language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> <span class="token punctuation">[</span>h<span class="token punctuation">,</span>i<span class="token punctuation">,</span>j<span class="token punctuation">,</span>k<span class="token punctuation">,</span>l<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">'hello'</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>h<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string"> </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>i<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string"> </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>j<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string"> </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>k<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string"> </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>l<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span></code></pre>

]]></content>
      <categories>
        <category>ECMAScript</category>
      </categories>
      <tags>
        <tag>es6</tag>
        <tag>javascript</tag>
      </tags>
  </entry>
  <entry>
    <title>浅谈正则表达式中的分组和引用</title>
    <url>/2019/05/01/90501.html</url>
    <content><![CDATA[<h1 id="浅谈正则表达式中的分组和引用"><a href="#浅谈正则表达式中的分组和引用" class="headerlink" title="浅谈正则表达式中的分组和引用"></a>浅谈正则表达式中的分组和引用</h1><p>由正则表达式如何匹配相同字符出发，讲讲正则表达式中的选择、分组和引用。</p>
<h2 id="问题"><a href="#问题" class="headerlink" title="问题"></a>问题</h2><p>在外刊君读者群中看到有人提出这样的一个需求：</p>
<blockquote>
<p>把字符串切成连续相同字符的正则怎么写？比如<code>abbcccdddd</code>切成<code>a,bb,ccc,dddd</code></p>
</blockquote>
<p>之前我对正则表达式也是略有研究，想尝试一下。其实我对正则表达式的学习基本完全来源于犀牛书的第10章，真正看懂这一章，我觉得操作正则表达式应该不在话下。</p>
<h2 id="我的答案"><a href="#我的答案" class="headerlink" title="我的答案"></a>我的答案</h2><p>先给出我的答案吧：</p>
<pre class="language-js" data-language="js"><code class="language-js"><span class="token string">'abbccddd'</span><span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">(\w)\1*</span><span class="token regex-delimiter">/</span><span class="token regex-flags">g</span></span><span class="token punctuation">)</span> <span class="token comment">// ["a", "bb", "cc", "ddd"]</span></code></pre>

<h2 id="说明"><a href="#说明" class="headerlink" title="说明"></a>说明</h2><p>拿到这个问题，首先要匹配字符<code>[a-zA-Z0-9]</code>，这里直接使用<code>\w</code>。然后是全局匹配，在最后加上<code>g</code>。难点在于怎么判断重复。</p>
<p>翻看了犀牛书后，又读了一遍分组和引用的部分。使用小括号<code>()</code>将字符作为一个最小单元，同时小括号还能记忆这个组合相匹配的字符串。再使用反斜杠<code>\</code>引用前面分组的表达式，数字1表示第一个小括号。这时完成了2个字符重复的要求。最后再使用<code>*</code>来匹配出现0次或n次。这个正则表达式就写完了。</p>
<p>下面详细说说分组和引用。</p>
<p><strong>正则表达式的选择、分组和引用字符表</strong></p>
<table>
<thead>
<tr>
<th>|</th>
<th>选择，匹配的是该符号左边的子表达式或右边的子表达式</th>
</tr>
</thead>
<tbody><tr>
<td>(…)</td>
<td>组合，将几个项组合为一个单元，这个单元可通过<code>*</code> <code>+</code> <code>?</code> `</td>
</tr>
<tr>
<td>(?:…)</td>
<td>只组合，把项组合到一个段元，但不记忆与该组相匹配的字符</td>
</tr>
<tr>
<td>\n</td>
<td>和第n个分组第一次匹配的字符相匹配，组是圆括号中的子表达式（也有可能是嵌套的），组索引是从左到右的左括号数，<code>(?:</code>形式的分组不编码</td>
</tr>
</tbody></table>
]]></content>
      <categories>
        <category>Regular</category>
      </categories>
      <tags>
        <tag>JavaScript</tag>
        <tag>正则</tag>
      </tags>
  </entry>
  <entry>
    <title>JavaScript 中的闭包</title>
    <url>/2019/05/17/90517.html</url>
    <content><![CDATA[<h1 id="JavaScript-中的闭包"><a href="#JavaScript-中的闭包" class="headerlink" title="JavaScript 中的闭包"></a>JavaScript 中的闭包</h1><h2 id="闭包的例子"><a href="#闭包的例子" class="headerlink" title="闭包的例子"></a>闭包的例子</h2><pre class="language-js" data-language="js"><code class="language-js"><span class="token keyword">function</span> <span class="token function">outer</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">var</span> localVal <span class="token operator">=</span> <span class="token number">30</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> localVal<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">outer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//30</span>

<span class="token keyword">function</span> <span class="token function">outer2</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">var</span> localVal <span class="token operator">=</span> <span class="token number">30</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> localVal<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">var</span> func <span class="token operator">=</span> <span class="token function">outer2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//30</span></code></pre>

<p>对于第一个普通的函数，在执行过之后，它的局部变量就可以被释放。</p>
<p>对于第二个函数，<code>localVal</code> 是不能被释放的。因为调用 <code>outer2()</code> 后，返回的是匿名函数，匿名函数可以访问外部的 <code>outer2()</code> 中的局部变量，并返回了这个局部变量 localVal。当 <code>outer2()</code> 赋值给 <code>func</code> 后，再次调用 <code>func()</code>，仍能访问到局部变量 <code>localVal</code>。这种情况就是闭包。</p>
<hr>
<h2 id="应用"><a href="#应用" class="headerlink" title="应用"></a>应用</h2><p><strong>所谓闭包就是：子函数可以使用父函数中的局部变量。</strong></p>
<pre class="language-js" data-language="js"><code class="language-js"><span class="token operator">!</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">var</span> localData <span class="token operator">=</span> <span class="token string">"localData here"</span><span class="token punctuation">;</span>
    document<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'click'</span><span class="token punctuation">,</span>
        <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>localData<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//这里访问外部数据</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token operator">!</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">var</span> localData <span class="token operator">=</span> <span class="token string">"localData here"</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> url <span class="token operator">=</span> <span class="token string">"http://www.baidu.com/"</span><span class="token punctuation">;</span>
    $<span class="token punctuation">.</span><span class="token function">ajax</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
        <span class="token literal-property property">url</span><span class="token operator">:</span> url<span class="token punctuation">,</span>
        <span class="token function-variable function">success</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token comment">// do sth...</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>localData<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//这里访问外部数据</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre>

<hr>
<h2 id="常见错误之循环闭包"><a href="#常见错误之循环闭包" class="headerlink" title="常见错误之循环闭包"></a>常见错误之循环闭包</h2><p>比如我们想循环绑定点击事件</p>
<pre class="language-js" data-language="js"><code class="language-js">document<span class="token punctuation">.</span>body<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> <span class="token string">"&lt;div id=div1>aaa&lt;/div>&lt;div id=div2>bbb&lt;/div>&lt;div id=div3>ccc&lt;/div>"</span><span class="token punctuation">;</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">4</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'div'</span> <span class="token operator">+</span> i<span class="token punctuation">)</span><span class="token punctuation">.</span>
    <span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'click'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token function">alert</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// all are 4!</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span></code></pre>

<p>上面的代码，我们点击任何一个 div，弹出的都是 4</p>
<p>这是因为，for 循环中的 i 是一个全局变量。这里内函数的点击事件，访问到的是循环后的 i 值，所以是 4</p>
<pre class="language-js" data-language="js"><code class="language-js">document<span class="token punctuation">.</span>body<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> <span class="token string">"&lt;div id=div1>aaa&lt;/div>&lt;div id=div2>bbb&lt;/div>&lt;div id=div3>ccc&lt;/div>"</span><span class="token punctuation">;</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">4</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token operator">!</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">i</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'div'</span> <span class="token operator">+</span> i<span class="token punctuation">)</span><span class="token punctuation">.</span>
        <span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'click'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token function">alert</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 1, 2, 3</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span></code></pre>

<p>这里使用了立即执行函数，并给匿名函数赋值 i，这样点击事件每一次就会访问到相应的 i。</p>
<hr>
<h2 id="封装"><a href="#封装" class="headerlink" title="封装"></a>封装</h2><pre class="language-js" data-language="js"><code class="language-js"><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">var</span> _userId <span class="token operator">=</span> <span class="token number">9527</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> _typeId <span class="token operator">=</span> <span class="token string">"item"</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> exp <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span>

    <span class="token keyword">function</span> <span class="token function">converter</span><span class="token punctuation">(</span><span class="token parameter">userId</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> <span class="token operator">+</span>userId<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    exp<span class="token punctuation">.</span><span class="token function-variable function">getUserId</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> <span class="token function">converter</span><span class="token punctuation">(</span>_userId<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>

    exp<span class="token punctuation">.</span><span class="token function-variable function">getTypeId</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> _typeId<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>

    window<span class="token punctuation">.</span>a <span class="token operator">=</span> exp<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a<span class="token punctuation">.</span><span class="token function">getUserId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//9527</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a<span class="token punctuation">.</span><span class="token function">getTypeId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//item</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a<span class="token punctuation">.</span>_userId<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//undefined</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a<span class="token punctuation">.</span>_typeId<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//undefined</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>converter<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//Uncaught ReferenceError: converter is not defined</span></code></pre>

<p>上面的代码通过闭包实现了一个封装。</p>
<hr>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><blockquote>
<ul>
<li>在计算机科学中，闭包（也称词法闭包或函数闭包）是指一个函数或函数的引用，与一个引用环境绑定在一起。这个引用环境是一个存储该函数每个非局部变量（也叫自由变量）的表。</li>
<li>闭包，不同于一般的函数，它允许一个函数在立即词法作用域外调用时，仍可访问非本地变量。</li>
</ul>
<p>from 维基百科</p>
</blockquote>
<ul>
<li>闭包的优点<ul>
<li>灵活和方便</li>
<li>封装</li>
</ul>
</li>
<li>缺点<ul>
<li>空间浪费</li>
<li>内存泄露</li>
<li>性能消耗</li>
</ul>
</li>
</ul>
]]></content>
      <categories>
        <category>JavaScript</category>
      </categories>
      <tags>
        <tag>JavaScript</tag>
        <tag>闭包</tag>
      </tags>
  </entry>
  <entry>
    <title>在低版本 IE 中点击空 block 元素的问题</title>
    <url>/2019/05/13/90513.html</url>
    <content><![CDATA[<h1 id="在低版本-IE-中点击空-block-元素的问题"><a href="#在低版本-IE-中点击空-block-元素的问题" class="headerlink" title="在低版本 IE 中点击空 block 元素的问题"></a>在低版本 IE 中点击空 block 元素的问题</h1><h2 id="问题描述"><a href="#问题描述" class="headerlink" title="问题描述"></a>问题描述</h2><p>当我们点击一个空的、没有任何内容的 div 或者其他块级元素时。在 IE11 以下，是没有反应的。</p>
<h2 id="使用场景"><a href="#使用场景" class="headerlink" title="使用场景"></a>使用场景</h2><p>这类问题使用场景还是很普遍的。比如 UI 给了一张大图，要点击图上的某一块位置的时候。可以用一个空的 div 定位到相应的位置，然后对它进行绑定事件。</p>
<hr>
<h2 id="解决办法"><a href="#解决办法" class="headerlink" title="解决办法"></a>解决办法</h2><p>解决方法很简单，即给这个块级元素填充任意颜色，然后将其透明度设置为0。代码如下：</p>
<pre class="language-css" data-language="css"><code class="language-css"><span class="token property">background-color</span><span class="token punctuation">:</span> #fff<span class="token punctuation">;</span>
<span class="token property">opacity</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span>
<span class="token property">filter</span><span class="token punctuation">:</span><span class="token function">alpha</span><span class="token punctuation">(</span>opacity=0<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>]]></content>
      <categories>
        <category>HTML</category>
      </categories>
      <tags>
        <tag>CSS</tag>
        <tag>IE</tag>
        <tag>兼容性</tag>
      </tags>
  </entry>
  <entry>
    <title>JavaScript 中的 this 指向</title>
    <url>/2019/06/12/90612.html</url>
    <content><![CDATA[<h1 id="JavaScript-中的-this-指向"><a href="#JavaScript-中的-this-指向" class="headerlink" title="JavaScript 中的 this 指向"></a>JavaScript 中的 this 指向</h1><h2 id="全局的-this"><a href="#全局的-this" class="headerlink" title="全局的 this"></a>全局的 this</h2><p>全局 this 一般指向全局对象，浏览器中的全局对象就是 <code>window</code>。</p>
<p>例如：</p>
<pre class="language-js" data-language="js"><code class="language-js">console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>document <span class="token operator">===</span> document<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//true</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span> <span class="token operator">===</span> window<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//true</span>

<span class="token keyword">this</span><span class="token punctuation">.</span>a <span class="token operator">=</span> <span class="token number">91</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>window<span class="token punctuation">.</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//91</span></code></pre>

<h2 id="一般函数的-this"><a href="#一般函数的-this" class="headerlink" title="一般函数的 this"></a>一般函数的 this</h2><pre class="language-js" data-language="js"><code class="language-js"><span class="token keyword">function</span> <span class="token function">f1</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">f1</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">===</span> window<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//true, global object</span></code></pre>

<p>可以看到一般函数的 this 也指向 window，在 nodeJS 中为 global object</p>
<pre class="language-js" data-language="js"><code class="language-js"><span class="token keyword">function</span> <span class="token function">f2</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token string">"use strict"</span><span class="token punctuation">;</span><span class="token comment">//使用严格模式</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">f1</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token keyword">undefined</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//true</span></code></pre>

<p>严格模式中，函数的 this 为 undefined</p>
<h2 id="作为对象方法的函数的-this"><a href="#作为对象方法的函数的-this" class="headerlink" title="作为对象方法的函数的 this"></a>作为对象方法的函数的 this</h2><pre class="language-js" data-language="js"><code class="language-js"><span class="token keyword">var</span> o <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
    <span class="token literal-property property">prop</span><span class="token operator">:</span> <span class="token number">37</span><span class="token punctuation">,</span>
    <span class="token function-variable function">f</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>prop<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>o<span class="token punctuation">.</span><span class="token function">f</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 37</span></code></pre>

<p>上述代码通过字面量创建对象 o。</p>
<p>f 为对象 o 的方法。这个方法的 this 指向这个对象，在这里即对象 o。</p>
<pre class="language-js" data-language="js"><code class="language-js"><span class="token keyword">var</span> o <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
    <span class="token literal-property property">prop</span><span class="token operator">:</span> <span class="token number">37</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">independent</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>prop<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
o<span class="token punctuation">.</span>f <span class="token operator">=</span> independent<span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>o<span class="token punctuation">.</span><span class="token function">f</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 37</span></code></pre>

<p>上面的代码，创建了对象 o，但是没有给对象 o，添加方法。而是通过 <code>o.f = independent</code> 临时添加了方法属性。这样这个方法中的 this 同样也指向这个对象 o。</p>
<h2 id="对象原型链上的-this"><a href="#对象原型链上的-this" class="headerlink" title="对象原型链上的 this"></a>对象原型链上的 this</h2><pre class="language-js" data-language="js"><code class="language-js"><span class="token keyword">var</span> o <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
    <span class="token function-variable function">f</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>a <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>b<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> p <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>o<span class="token punctuation">)</span><span class="token punctuation">;</span>
p<span class="token punctuation">.</span>a <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
p<span class="token punctuation">.</span>b <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>p<span class="token punctuation">.</span><span class="token function">f</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//3</span></code></pre>

<p>通过 <code>var p = Object.create(o)</code> 创建的对象，p 是基于原型 o 创建出的对象。</p>
<p>p 的原型是 o，调用 f() 的时候是调用了 o 上的方法 f()，这里面的 this 是可以指向当前对象的，即对象 p。</p>
<h2 id="get-set-方法与-this"><a href="#get-set-方法与-this" class="headerlink" title="get/set 方法与 this"></a>get/set 方法与 this</h2><pre class="language-js" data-language="js"><code class="language-js"><span class="token keyword">function</span> <span class="token function">modulus</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">return</span> Math<span class="token punctuation">.</span><span class="token function">sqrt</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>re <span class="token operator">*</span> <span class="token keyword">this</span><span class="token punctuation">.</span>re <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>im <span class="token operator">*</span> <span class="token keyword">this</span><span class="token punctuation">.</span>im<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span class="token keyword">var</span> o <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
    <span class="token literal-property property">re</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
    <span class="token literal-property property">im</span><span class="token operator">:</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span>
    <span class="token keyword">get</span> <span class="token function">phase</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> Math<span class="token punctuation">.</span><span class="token function">atan2</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>im<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>re<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
Object<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span>o<span class="token punctuation">,</span> <span class="token string">'modulus'</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span>
    <span class="token literal-property property">get</span><span class="token operator">:</span> modulus<span class="token punctuation">,</span>
    <span class="token literal-property property">enumerable</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token literal-property property">configurable</span><span class="token operator">:</span> <span class="token boolean">true</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>o<span class="token punctuation">.</span>phase<span class="token punctuation">,</span> o<span class="token punctuation">.</span>modulus<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// -0.78 1.4142</span></code></pre>

<p>get/set 方法中的 this 也会指向 get/set 方法所在的对象的。</p>
<h2 id="构造器中的-this"><a href="#构造器中的-this" class="headerlink" title="构造器中的 this"></a>构造器中的 this</h2><pre class="language-js" data-language="js"><code class="language-js"><span class="token keyword">function</span> <span class="token function">MyClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>a <span class="token operator">=</span> <span class="token number">25</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span class="token keyword">var</span> o <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MyClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>o<span class="token punctuation">.</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//25</span></code></pre>

<p>new MyClass() 的时候，MyClass()中的 this 会指向一个空对象，这个对象的原型会指向 MyClass.prototype。MyClass()没有返回值或者返回为基本类型时，默认将 this 返回。</p>
<pre class="language-js" data-language="js"><code class="language-js"><span class="token keyword">function</span> <span class="token constant">C2</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>a <span class="token operator">=</span> <span class="token number">26</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token punctuation">&#123;</span>
        <span class="token literal-property property">a</span><span class="token operator">:</span> <span class="token number">24</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

o <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">C2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>o<span class="token punctuation">.</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//24</span></code></pre>

<p>因为返回了对象，将这个对象作为返回值</p>
<h2 id="call-apply-方法与-this"><a href="#call-apply-方法与-this" class="headerlink" title="call/apply 方法与 this"></a>call/apply 方法与 this</h2><pre class="language-js" data-language="js"><code class="language-js"><span class="token keyword">function</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token parameter">c<span class="token punctuation">,</span> d</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>a <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>b <span class="token operator">+</span> c <span class="token operator">+</span> d<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span class="token keyword">var</span> o <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
    <span class="token literal-property property">a</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
    <span class="token literal-property property">b</span><span class="token operator">:</span> <span class="token number">3</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
<span class="token function">add</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>o<span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 1 + 3 + 5 + 7 = 16</span>
<span class="token function">add</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>o<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 1 + 3 + 10 + 20 = 34</span>
<span class="token keyword">function</span> <span class="token function">bar</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token class-name">Object</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span class="token function">bar</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// "[object Number]"</span></code></pre>

<h2 id="bind-方法与-this"><a href="#bind-方法与-this" class="headerlink" title="bind 方法与 this"></a>bind 方法与 this</h2><pre class="language-js" data-language="js"><code class="language-js"><span class="token keyword">function</span> <span class="token function">f</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>a<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span class="token keyword">var</span> g <span class="token operator">=</span> <span class="token function">f</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
    <span class="token literal-property property">a</span><span class="token operator">:</span> <span class="token string">"test"</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">g</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// test</span>
<span class="token keyword">var</span> o <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
    <span class="token literal-property property">a</span><span class="token operator">:</span> <span class="token number">37</span><span class="token punctuation">,</span>
    <span class="token literal-property property">f</span><span class="token operator">:</span> f<span class="token punctuation">,</span>
    <span class="token literal-property property">g</span><span class="token operator">:</span> g
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>o<span class="token punctuation">.</span><span class="token function">f</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> o<span class="token punctuation">.</span><span class="token function">g</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 37, test</span></code></pre>

<p>绑定之后再调用时，仍然会按绑定时的内容走，所以 o.g() 结果是 test</p>
]]></content>
      <categories>
        <category>JavaScript</category>
      </categories>
      <tags>
        <tag>JavaScript</tag>
        <tag>this</tag>
      </tags>
  </entry>
  <entry>
    <title>JavaScript 函数继承的几种方法</title>
    <url>/2019/06/27/90627.html</url>
    <content><![CDATA[<h3 id="一、原型链继承"><a href="#一、原型链继承" class="headerlink" title="一、原型链继承"></a>一、原型链继承</h3><blockquote>
<p>将父类的实例作为子类的原型</p>
</blockquote>
<pre class="language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">Parent</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
   <span class="token keyword">this</span><span class="token punctuation">.</span>isShow <span class="token operator">=</span> <span class="token boolean">true</span>
   <span class="token keyword">this</span><span class="token punctuation">.</span>info <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
       <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">"钢铁侠"</span><span class="token punctuation">,</span>
       <span class="token literal-property property">age</span><span class="token operator">:</span> <span class="token number">55</span><span class="token punctuation">,</span>
   <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token class-name">Parent</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">getInfo</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
   console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>info<span class="token punctuation">)</span><span class="token punctuation">;</span>
   console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>isShow<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// true</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">function</span> <span class="token function">Child</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
<span class="token class-name">Child</span><span class="token punctuation">.</span>prototype <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Parent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> Child1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Child</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
Child1<span class="token punctuation">.</span>info<span class="token punctuation">.</span>gender <span class="token operator">=</span> <span class="token string">"男"</span><span class="token punctuation">;</span>
Child1<span class="token punctuation">.</span><span class="token function">getInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// &#123;name: "钢铁侠", age: 55, gender: "男"&#125;</span>

<span class="token keyword">let</span> child2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Child</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
child2<span class="token punctuation">.</span><span class="token function">getInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// &#123;name: "钢铁侠", age: 55, gender: "男"&#125;</span>
child2<span class="token punctuation">.</span>isShow <span class="token operator">=</span> <span class="token boolean">false</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>child2<span class="token punctuation">.</span>isShow<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// false</span>
复制代码</code></pre>

<p><strong>优点：</strong></p>
<blockquote>
<p>1、父类方法可以复用</p>
</blockquote>
<p><strong>缺点：</strong></p>
<blockquote>
<ol>
<li>父类的所有<code>引用属性</code>（info）会被所有子类共享，更改一个子类的引用属性，其他子类也会受影响</li>
<li>子类型实例不能给父类型构造函数传参</li>
</ol>
</blockquote>
<h3 id="二、盗用构造函数继承-构造函数继承"><a href="#二、盗用构造函数继承-构造函数继承" class="headerlink" title="二、盗用构造函数继承(构造函数继承)"></a>二、盗用构造函数继承(构造函数继承)</h3><blockquote>
<p>在子类构造函数中调用父类构造函数，可以在子类构造函数中使用<code>call()</code>和<code>apply()</code>方法</p>
</blockquote>
<pre class="language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">Parent</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>info <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
    <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">"钢铁侠"</span><span class="token punctuation">,</span>
    <span class="token literal-property property">age</span><span class="token operator">:</span> <span class="token number">19</span><span class="token punctuation">,</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">function</span> <span class="token function">Child</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token function">Parent</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">let</span> child1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Child</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
child1<span class="token punctuation">.</span>info<span class="token punctuation">.</span>gender <span class="token operator">=</span> <span class="token string">"男"</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>child1<span class="token punctuation">.</span>info<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// &#123;name: "钢铁侠", age: 19, gender: "男"&#125;;</span>

<span class="token keyword">let</span> child2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Child</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>child2<span class="token punctuation">.</span>info<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// &#123;name: "钢铁侠", age: 19&#125;</span>
复制代码</code></pre>

<p>​     通过使用<code>call()</code>或<code>apply()</code>方法，<code>Parent</code>构造函数在为<code>Child</code>的实例创建的新对象的上下文执行了，就相当于新的<code>Child</code>实例对象上运行了<code>Parent()</code>函数中的所有初始化代码，结果就是每个实例都有自己的<code>info</code>属性。</p>
<p>​    <strong>1、传递参数</strong></p>
<p>​    相比于原型链继承，盗用构造函数的一个优点在于可以在子类构造函数中像父类构造函数传递参数。</p>
<pre class="language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">Parent</span><span class="token punctuation">(</span><span class="token parameter">name</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>info <span class="token operator">=</span> <span class="token punctuation">&#123;</span> <span class="token literal-property property">name</span><span class="token operator">:</span> name <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span class="token keyword">function</span> <span class="token function">Child</span><span class="token punctuation">(</span><span class="token parameter">name</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token comment">//继承自Parent，并传参</span>
    <span class="token function">Parent</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> name<span class="token punctuation">)</span><span class="token punctuation">;</span>
    
     <span class="token comment">//实例属性</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>age <span class="token operator">=</span> <span class="token number">18</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">let</span> child1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Child</span><span class="token punctuation">(</span><span class="token string">"yhd"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>child1<span class="token punctuation">.</span>info<span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// "钢铁侠"</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>child1<span class="token punctuation">.</span>age<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 18</span>

<span class="token keyword">let</span> child2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Child</span><span class="token punctuation">(</span><span class="token string">"美国队长"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>child2<span class="token punctuation">.</span>info<span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// "美国队长"</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>child2<span class="token punctuation">.</span>age<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 18</span>
复制代码</code></pre>

<p>​    在上面例子中，<code>Parent</code>构造函数接收一个<code>name</code>参数，并将他赋值给一个属性，在<code>Child</code>构造函数中调用<code>Parent</code>构造函数时传入这个参数， 实际上会在<code>Child</code>实例上定义<code>name</code>属性。为确保<code>Parent</code>构造函数不会覆盖<code>Child</code>定义的属性，可以在调用父类构造函数之后再给子类实例添加额外的属性</p>
<p><strong>优点:</strong></p>
<blockquote>
<ol>
<li>可以在子类构造函数中向父类传参数</li>
<li>父类的引用属性不会被共享</li>
</ol>
</blockquote>
<p><strong>缺点：</strong></p>
<blockquote>
<ol>
<li>子类不能访问父类原型上定义的方法（即不能访问Parent.prototype上定义的方法），因此所有方法属性都写在构造函数中，每次创建实例都会初始化</li>
</ol>
</blockquote>
<hr>
<h3 id="三、组合继承"><a href="#三、组合继承" class="headerlink" title="三、组合继承"></a>三、组合继承</h3><blockquote>
<p>组合继承综合了<code>原型链继承</code>和<code>盗用构造函数继承(构造函数继承)</code>，将两者的优点结合了起来，</p>
<p>基本的思路就是使用原型链继承原型上的属性和方法，而通过构造函数继承实例属性，这样既可以把方法定义在原型上以实现重用，又可以让每个实例都有自己的属性</p>
</blockquote>
<pre class="language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">Parent</span><span class="token punctuation">(</span><span class="token parameter">name</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
   <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name
   <span class="token keyword">this</span><span class="token punctuation">.</span>colors <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">"red"</span><span class="token punctuation">,</span> <span class="token string">"blue"</span><span class="token punctuation">,</span> <span class="token string">"yellow"</span><span class="token punctuation">]</span>
<span class="token punctuation">&#125;</span>
<span class="token class-name">Parent</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">sayName</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
   console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">function</span> <span class="token function">Child</span><span class="token punctuation">(</span><span class="token parameter">name<span class="token punctuation">,</span> age</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
   <span class="token comment">// 继承父类属性</span>
   <span class="token function">Parent</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> name<span class="token punctuation">)</span>
   <span class="token keyword">this</span><span class="token punctuation">.</span>age <span class="token operator">=</span> age<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span class="token comment">// 继承父类方法</span>
<span class="token class-name">Child</span><span class="token punctuation">.</span>prototype <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Parent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token class-name">Child</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">sayAge</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
   console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>age<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">let</span> child1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Child</span><span class="token punctuation">(</span><span class="token string">"yhd"</span><span class="token punctuation">,</span> <span class="token number">19</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
child1<span class="token punctuation">.</span>colors<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token string">"pink"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>child1<span class="token punctuation">.</span>colors<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ["red", "blue", "yellow", "pink"]</span>
child1<span class="token punctuation">.</span><span class="token function">sayAge</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 19</span>
child1<span class="token punctuation">.</span><span class="token function">sayName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// "钢铁侠"</span>

<span class="token keyword">let</span> child2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Child</span><span class="token punctuation">(</span><span class="token string">"美国队长"</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>child2<span class="token punctuation">.</span>colors<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// ["red", "blue", "yellow"]</span>
child2<span class="token punctuation">.</span><span class="token function">sayAge</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 30</span>
child2<span class="token punctuation">.</span><span class="token function">sayName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// "美国队长"</span>

复制代码</code></pre>

<p>​    上面例子中，<code>Parent构造函数</code>定义了<code>name，colors</code>两个属性，接着又在他的原型上添加了个<code>sayName()</code>方法。<code>Child构造函数</code>内部调用了<code>Parent构造函数</code>，同时传入了<code>name</code>参数，同时<code>Child.prototype</code>也被赋值为<code>Parent实例</code>，然后又在他的原型上添加了个<code>sayAge()</code>方法。这样就可以创建 <code>child1，child2两个实例</code>，让这两个实例都有自己的属性，包括<code>colors</code>，同时还共享了父类的<code>sayName</code>方法</p>
<p>​     <strong>优点：</strong></p>
<blockquote>
<ol>
<li>父类的方法可以复用</li>
<li>可以在Child构造函数中向Parent构造函数中传参</li>
<li>父类构造函数中的引用属性不会被共享</li>
</ol>
</blockquote>
<hr>
<h3 id="四、原型式继承"><a href="#四、原型式继承" class="headerlink" title="四、原型式继承"></a>四、原型式继承</h3><blockquote>
<p>对参数对象的一种浅复制</p>
</blockquote>
<pre class="language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">objectCopy</span><span class="token punctuation">(</span><span class="token parameter">obj</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">function</span> <span class="token function">Fun</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
  <span class="token class-name">Fun</span><span class="token punctuation">.</span>prototype <span class="token operator">=</span> obj<span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Fun</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">let</span> person <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
  <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">"钢铁侠"</span><span class="token punctuation">,</span>
  <span class="token literal-property property">age</span><span class="token operator">:</span> <span class="token number">18</span><span class="token punctuation">,</span>
  <span class="token literal-property property">friends</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"jack"</span><span class="token punctuation">,</span> <span class="token string">"tom"</span><span class="token punctuation">,</span> <span class="token string">"rose"</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token function-variable function">sayName</span><span class="token operator">:</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">let</span> person1 <span class="token operator">=</span> <span class="token function">objectCopy</span><span class="token punctuation">(</span>person<span class="token punctuation">)</span><span class="token punctuation">;</span>
person1<span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">"美国队长"</span><span class="token punctuation">;</span>
person1<span class="token punctuation">.</span>friends<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token string">"lily"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
person1<span class="token punctuation">.</span><span class="token function">sayName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// wxb</span>

<span class="token keyword">let</span> person2 <span class="token operator">=</span> <span class="token function">objectCopy</span><span class="token punctuation">(</span>person<span class="token punctuation">)</span><span class="token punctuation">;</span>
person2<span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">"gsr"</span><span class="token punctuation">;</span>
person2<span class="token punctuation">.</span>friends<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token string">"kobe"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
person2<span class="token punctuation">.</span><span class="token function">sayName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// "gsr"</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>person<span class="token punctuation">.</span>friends<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ["jack", "tom", "rose", "lily", "kobe"]</span>
复制代码</code></pre>

<p><strong>优点：</strong></p>
<blockquote>
<ol>
<li>父类方法可复用</li>
</ol>
</blockquote>
<p><strong>缺点：</strong></p>
<blockquote>
<ol>
<li>父类的引用会被所有子类所共享</li>
<li>子类实例不能向父类传参</li>
</ol>
</blockquote>
<blockquote>
<p>ES5的Object.create()方法在只有第一个参数时，与这里的objectCopy()方法效果相同</p>
</blockquote>
<hr>
<h3 id="五、寄生式继承"><a href="#五、寄生式继承" class="headerlink" title="五、寄生式继承"></a>五、寄生式继承</h3><blockquote>
<p>使用原型式继承对一个目标对象进行浅复制，增强这个浅复制的能力</p>
</blockquote>
<pre class="language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">objectCopy</span><span class="token punctuation">(</span><span class="token parameter">obj</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">function</span> <span class="token function">Fun</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
  <span class="token class-name">Fun</span><span class="token punctuation">.</span>prototype <span class="token operator">=</span> obj<span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Fun</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">function</span> <span class="token function">createAnother</span><span class="token punctuation">(</span><span class="token parameter">original</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">let</span> clone <span class="token operator">=</span> <span class="token function">objectCopy</span><span class="token punctuation">(</span>original<span class="token punctuation">)</span><span class="token punctuation">;</span>
  clone<span class="token punctuation">.</span><span class="token function-variable function">getName</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> clone<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">let</span> person <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
     <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">"钢铁侠"</span><span class="token punctuation">,</span>
     <span class="token literal-property property">friends</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"rose"</span><span class="token punctuation">,</span> <span class="token string">"tom"</span><span class="token punctuation">,</span> <span class="token string">"jack"</span><span class="token punctuation">]</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">let</span> person1 <span class="token operator">=</span> <span class="token function">createAnother</span><span class="token punctuation">(</span>person<span class="token punctuation">)</span><span class="token punctuation">;</span>
person1<span class="token punctuation">.</span>friends<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token string">"lily"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>person1<span class="token punctuation">.</span>friends<span class="token punctuation">)</span><span class="token punctuation">;</span>
person1<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 钢铁侠</span>

<span class="token keyword">let</span> person2 <span class="token operator">=</span> <span class="token function">createAnother</span><span class="token punctuation">(</span>person<span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>person2<span class="token punctuation">.</span>friends<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ["rose", "tom", "jack", "lily"]</span>
复制代码</code></pre>

<hr>
<h3 id="六、寄生式组合继承"><a href="#六、寄生式组合继承" class="headerlink" title="六、寄生式组合继承"></a>六、寄生式组合继承</h3><pre class="language-none"><code class="language-none">function objectCopy(obj) &#123;
  function Fun() &#123; &#125;;
  Fun.prototype &#x3D; obj;
  return new Fun();
&#125;

function inheritPrototype(child, parent) &#123;
  let prototype &#x3D; objectCopy(parent.prototype); &#x2F;&#x2F; 创建对象
  prototype.constructor &#x3D; child; &#x2F;&#x2F; 增强对象
  Child.prototype &#x3D; prototype; &#x2F;&#x2F; 赋值对象
&#125;

function Parent(name) &#123;
  this.name &#x3D; name;
  this.friends &#x3D; [&quot;rose&quot;, &quot;lily&quot;, &quot;tom&quot;]
&#125;

Parent.prototype.sayName &#x3D; function () &#123;
  console.log(this.name);
&#125;

function Child(name, age) &#123;
  Parent.call(this, name);
  this.age &#x3D; age;
&#125;

inheritPrototype(Child, Parent);
Child.prototype.sayAge &#x3D; function () &#123;
  console.log(this.age);
&#125;

let child1 &#x3D; new Child(&quot;钢铁侠&quot;, 23);
child1.sayAge(); &#x2F;&#x2F; 23
child1.sayName(); &#x2F;&#x2F; 钢铁侠
child1.friends.push(&quot;jack&quot;);
console.log(child1.friends); &#x2F;&#x2F; [&quot;rose&quot;, &quot;lily&quot;, &quot;tom&quot;, &quot;jack&quot;]

let child2 &#x3D; new Child(&quot;hai&quot;, 22)
child2.sayAge(); &#x2F;&#x2F; 22
child2.sayName(); &#x2F;&#x2F; hai
console.log(child2.friends); &#x2F;&#x2F; [&quot;rose&quot;, &quot;lily&quot;, &quot;tom&quot;]
复制代码</code></pre>

<p><strong>优点：</strong></p>
<blockquote>
<ol>
<li>只调用一次父类构造函数</li>
<li>Child可以向Parent传参</li>
<li>父类方法可以复用</li>
<li>父类的引用属性不会被共享</li>
</ol>
</blockquote>
<blockquote>
<p>寄生式组合继承可以算是引用类型继承的最佳模式</p>
</blockquote>
]]></content>
      <categories>
        <category>JavaScript</category>
      </categories>
      <tags>
        <tag>JS继承</tag>
      </tags>
  </entry>
  <entry>
    <title>手淘rem的适配方案详解</title>
    <url>/2019/06/18/90618.html</url>
    <content><![CDATA[<h1 id="手淘rem的适配方案详解"><a href="#手淘rem的适配方案详解" class="headerlink" title="手淘rem的适配方案详解"></a>手淘rem的适配方案详解</h1><h2 id="什么是rem？"><a href="#什么是rem？" class="headerlink" title="什么是rem？"></a>什么是rem？</h2><p>CSS3新增的一个相对单位rem（root em，根em）。rem是相对于根节点（或者是html节点）。如果根节点设置了font-size:10px;那么font-size:1.5rem;字体大小等于15px。</p>
<p>想想看，因为rem是一个相对单位，那么只要根节点的font-size属性随着屏幕自适应，那么下面通过rem设置的单位便可以达到自适应的目的！<br>当我们拿到设计稿的时候，主要会将视觉稿分成100份（主要为了以后能更好的兼容vh和vw），而每一份被称为一个单位a。同时1rem单位被认定为10a。就相当于1rem可以定为宽度为屏幕的10%。那么针对一个750px宽的设计稿，我们可以算出：</p>
<pre class="language-js" data-language="js"><code class="language-js">1a   <span class="token operator">=</span> <span class="token number">7</span><span class="token punctuation">.</span>5px
1rem <span class="token operator">=</span> 75px </code></pre>

<p>那么这个设计稿也就被分成了10rem份。此时淘宝开源库<code>lib-flexible</code>会为根节点的html和body元素设置一个<code>data-dpr</code>和<code>font-size</code>两个属性。其中dpr在IOS内会根据不同型号的机器动态的计算生成，大多数机型的<code>data-dpr=2</code>但是对于安卓来说，由于其机型特别复杂多样，dpr会全部设置成1。<br><code>font-size = 1rem</code>，对于一个750的设计稿来说，<code>font-size=75px</code>，而这个就是rem的基准值。这样一来，对于视觉稿上的元素尺寸换算，只需要原始的px值除以rem基准值即可。例如此例视觉稿中的图片，其尺寸是176px * 176px,转换成为2.346667rem * 2.346667rem。</p>
<h3 id="lib-flexible-原理"><a href="#lib-flexible-原理" class="headerlink" title="lib-flexible 原理"></a>lib-flexible 原理</h3><h4 id="1-计算页面的dpr"><a href="#1-计算页面的dpr" class="headerlink" title="1. 计算页面的dpr"></a>1. 计算页面的dpr</h4><pre class="language-js" data-language="js"><code class="language-js"><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>dpr <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>scale<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">var</span> isAndroid <span class="token operator">=</span> win<span class="token punctuation">.</span>navigator<span class="token punctuation">.</span>appVersion<span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">android</span><span class="token regex-delimiter">/</span><span class="token regex-flags">gi</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> isIPhone <span class="token operator">=</span> win<span class="token punctuation">.</span>navigator<span class="token punctuation">.</span>appVersion<span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">iphone</span><span class="token regex-delimiter">/</span><span class="token regex-flags">gi</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> devicePixelRatio <span class="token operator">=</span> win<span class="token punctuation">.</span>devicePixelRatio<span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>isIPhone<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token comment">// iOS下，3和3以上的屏，用3倍的方案，2用2倍方案，其余的用1倍方案</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>devicePixelRatio <span class="token operator">>=</span> <span class="token number">3</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span><span class="token operator">!</span>dpr <span class="token operator">||</span> dpr <span class="token operator">>=</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                
            dpr <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>devicePixelRatio <span class="token operator">>=</span> <span class="token number">2</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span><span class="token operator">!</span>dpr <span class="token operator">||</span> dpr <span class="token operator">>=</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
            dpr <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
            dpr <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
        <span class="token comment">// 其他设备下，仍旧使用1倍的方案</span>
        dpr <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    scale <span class="token operator">=</span> <span class="token number">1</span> <span class="token operator">/</span> dpr<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span></code></pre>

<h4 id="2-改写页面meta标签"><a href="#2-改写页面meta标签" class="headerlink" title="2. 改写页面meta标签"></a>2. 改写页面meta标签</h4><p><code>flexible</code>实际上就是能过JS来动态改写<code>meta</code>标签，代码类似这样：</p>
<pre class="language-js" data-language="js"><code class="language-js"><span class="token keyword">var</span> metaEl <span class="token operator">=</span> doc<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'meta'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> scale <span class="token operator">=</span> <span class="token number">1</span> <span class="token operator">/</span> dpr<span class="token punctuation">;</span>
metaEl<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">'name'</span><span class="token punctuation">,</span> <span class="token string">'viewport'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
metaEl<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">'content'</span><span class="token punctuation">,</span> <span class="token string">'initial-scale='</span> <span class="token operator">+</span> scale <span class="token operator">+</span> <span class="token string">', maximum-scale='</span> <span class="token operator">+</span> scale <span class="token operator">+</span> <span class="token string">', minimum-scale='</span> <span class="token operator">+</span> scale <span class="token operator">+</span> <span class="token string">', user-scalable=no'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>docEl<span class="token punctuation">.</span>firstElementChild<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    document<span class="token punctuation">.</span>documentElement<span class="token punctuation">.</span>firstElementChild<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>metaEl<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">var</span> wrap <span class="token operator">=</span> doc<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'div'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    wrap<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>metaEl<span class="token punctuation">)</span><span class="token punctuation">;</span>
    documen<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>wrap<span class="token punctuation">.</span>innerHTML<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span></code></pre>

<h3 id="如何转换rem"><a href="#如何转换rem" class="headerlink" title="如何转换rem"></a>如何转换rem</h3><p>对于使用webpack的来说，其实也是有一个postcss插件的<code>px2rem</code>，可以很轻松的配置相关属性，转换成相对于的rem单位。比如我们的<code>.postcssrc</code> 配置如下：</p>
<pre class="language-js" data-language="js"><code class="language-js">module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
  <span class="token string-property property">"plugins"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
    <span class="token string-property property">"postcss-px2rem"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
      <span class="token literal-property property">baseDpr</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
      <span class="token literal-property property">remUnit</span><span class="token operator">:</span> <span class="token number">37.5</span><span class="token punctuation">,</span>
      <span class="token literal-property property">onePxComment</span><span class="token operator">:</span> <span class="token string">'1px'</span><span class="token punctuation">,</span>
      <span class="token literal-property property">forcePxComment</span><span class="token operator">:</span> <span class="token string">'!px'</span><span class="token punctuation">,</span>
      <span class="token literal-property property">keepComment</span><span class="token operator">:</span> <span class="token string">'!no'</span><span class="token punctuation">,</span>
      <span class="token literal-property property">forcePxProperty</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'font-size'</span><span class="token punctuation">]</span> <span class="token comment">// font-size强制使用px单位</span>
    <span class="token punctuation">&#125;</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span></code></pre>

<h4 id="1-文本字号不建议使用rem"><a href="#1-文本字号不建议使用rem" class="headerlink" title="1. 文本字号不建议使用rem"></a>1. 文本字号不建议使用rem</h4><p>前面大家都见证了如何使用rem来完成H5适配。那么文本又将如何处理适配。是不是也通过rem来做自动适配。</p>
<p>显然，我们在iPhone3G和iPhone4的Retina屏下面，希望看到的文本字号是相同的。也就是说，我们不希望文本在Retina屏幕下变小，另外，我们希望在大屏手机上看到更多文本，以及，现在绝大多数的字体文件都自带一些点阵尺寸，通常是16px和24px，所以我们不希望出现13px和15px这样的奇葩尺寸。</p>
<p>如此一来，就决定了在制作H5的页面中，rem并不适合用到段落文本上。所以在Flexible整个适配方案中，考虑文本还是使用px作为单位。只不过使用<code>[data-dpr]</code>属性来区分不同dpr下的文本字号大小。</p>
<p>配置完成之后，在实际使用时，你只要像下面这样使用：</p>
<pre class="language-js" data-language="js"><code class="language-js"><span class="token punctuation">.</span>selector <span class="token punctuation">&#123;</span>
    <span class="token literal-property property">width</span><span class="token operator">:</span> 150px<span class="token punctuation">;</span>
    <span class="token literal-property property">height</span><span class="token operator">:</span> 150px<span class="token punctuation">;</span> 
    font<span class="token operator">-</span>size<span class="token operator">:</span> 12px<span class="token punctuation">;</span> 
    <span class="token literal-property property">border</span><span class="token operator">:</span> 1px solid #ddd<span class="token punctuation">;</span> 
<span class="token punctuation">&#125;</span></code></pre>

<p>px2rem处理之后将会变成：</p>
<pre class="language-js" data-language="js"><code class="language-js"><span class="token punctuation">.</span>selector <span class="token punctuation">&#123;</span>
    <span class="token literal-property property">width</span><span class="token operator">:</span> 2rem<span class="token punctuation">;</span>
   <span class="token literal-property property">height</span><span class="token operator">:</span> 2rem<span class="token punctuation">;</span>
    <span class="token literal-property property">border</span><span class="token operator">:</span> 1px solid #ddd<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span class="token punctuation">[</span>data<span class="token operator">-</span>dpr<span class="token operator">=</span><span class="token string">"1"</span><span class="token punctuation">]</span> <span class="token punctuation">.</span>selector <span class="token punctuation">&#123;</span>
    font<span class="token operator">-</span>size<span class="token operator">:</span> 12px<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span class="token punctuation">[</span>data<span class="token operator">-</span>dpr<span class="token operator">=</span><span class="token string">"2"</span><span class="token punctuation">]</span> <span class="token punctuation">.</span>selector <span class="token punctuation">&#123;</span>
    font<span class="token operator">-</span>size<span class="token operator">:</span> 28px<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span class="token punctuation">[</span>data<span class="token operator">-</span>dpr<span class="token operator">=</span><span class="token string">"3"</span><span class="token punctuation">]</span> <span class="token punctuation">.</span>selector <span class="token punctuation">&#123;</span>
    font<span class="token operator">-</span>size<span class="token operator">:</span> 42px<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span></code></pre>

<p>因为不同的dpr，屏幕会缩成不同比例，所以这里的字号会根据dpr进行相应的放大。举个例子，如果<code>data-dpr = 2</code> 那么页面的viewport会被缩小，所以字号需要相应的乘以比例进行放大。</p>
]]></content>
      <categories>
        <category>CSS</category>
      </categories>
      <tags>
        <tag>适配</tag>
        <tag>rem</tag>
      </tags>
  </entry>
  <entry>
    <title>VScode文件顶部加入作者信息、日期和函数注释设置</title>
    <url>/2019/06/28/190628.html</url>
    <content><![CDATA[<h1 id="VScode文件顶部加入作者信息、日期和函数注释设置"><a href="#VScode文件顶部加入作者信息、日期和函数注释设置" class="headerlink" title="VScode文件顶部加入作者信息、日期和函数注释设置"></a>VScode文件顶部加入作者信息、日期和函数注释设置</h1><h3 id="1-vscode安装插件KoroFileHeader"><a href="#1-vscode安装插件KoroFileHeader" class="headerlink" title="1.vscode安装插件KoroFileHeader"></a>1.vscode安装插件KoroFileHeader</h3><h3 id="2-左上角选择文件–首选项—设置—输入”fileheader”—点击”在setting-json中编辑”"><a href="#2-左上角选择文件–首选项—设置—输入”fileheader”—点击”在setting-json中编辑”" class="headerlink" title="2.左上角选择文件–首选项—设置—输入”fileheader”—点击”在setting.json中编辑”"></a>2.左上角选择文件–首选项—设置—输入”fileheader”—点击”在setting.json中编辑”</h3><h3 id="3-”fileheader-configObj”同级输入"><a href="#3-”fileheader-configObj”同级输入" class="headerlink" title="3.”fileheader.configObj”同级输入"></a>3.”fileheader.configObj”同级输入</h3><pre class="language-js" data-language="js"><code class="language-js"><span class="token comment">// 文件头部注释</span>
  <span class="token string-property property">"fileheader.customMade"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
    <span class="token string-property property">"Descripttion"</span><span class="token operator">:</span> <span class="token string">"说明"</span><span class="token punctuation">,</span>
    <span class="token string-property property">"version"</span><span class="token operator">:</span> <span class="token string">"V1.0"</span><span class="token punctuation">,</span>
    <span class="token string-property property">"Author"</span><span class="token operator">:</span> <span class="token string">"SL"</span><span class="token punctuation">,</span>
    <span class="token string-property property">"Date"</span><span class="token operator">:</span> <span class="token string">"Do not edit"</span><span class="token punctuation">,</span>
    <span class="token string-property property">"LastEditors"</span><span class="token operator">:</span> <span class="token string">"SL"</span><span class="token punctuation">,</span>
    <span class="token string-property property">"LastEditTime"</span><span class="token operator">:</span> <span class="token string">"Do not Edit"</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
  <span class="token comment">//函数注释</span>
  <span class="token string-property property">"fileheader.cursorMode"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
    <span class="token string-property property">"name"</span><span class="token operator">:</span> <span class="token string">""</span><span class="token punctuation">,</span>
    <span class="token string-property property">"msg"</span><span class="token operator">:</span> <span class="token string">""</span><span class="token punctuation">,</span>
    <span class="token string-property property">"param"</span><span class="token operator">:</span> <span class="token string">""</span><span class="token punctuation">,</span>
    <span class="token string-property property">"return"</span><span class="token operator">:</span> <span class="token string">""</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span></code></pre>

<h3 id="4-快捷键使用"><a href="#4-快捷键使用" class="headerlink" title="4.快捷键使用"></a>4.快捷键使用</h3><p>快捷键：ctrl + alt + i 生成头部注释</p>
<p>快捷键：ctrl + alt + t 生成函数注释</p>
<h3 id="5-自动添加注释"><a href="#5-自动添加注释" class="headerlink" title="5.自动添加注释"></a>5.自动添加注释</h3><p>“autoAdd”: true, //自动生成注释，老是忘记的同学可以设置</p>
]]></content>
      <categories>
        <category>VScode</category>
      </categories>
      <tags>
        <tag>插件</tag>
      </tags>
  </entry>
  <entry>
    <title>Git 克隆非 master 分支的代码</title>
    <url>/2020/02/14/140.html</url>
    <content><![CDATA[<h1 id="Git-克隆非-master-分支的代码"><a href="#Git-克隆非-master-分支的代码" class="headerlink" title="Git 克隆非 master 分支的代码"></a>Git 克隆非 master 分支的代码</h1><h2 id="问题描述"><a href="#问题描述" class="headerlink" title="问题描述"></a>问题描述</h2><p>我们每次使用命令</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token function">git</span> clone git@gitlab.xxx.com:xxxxx.git</code></pre>

<p>默认 clone 的是这个仓库的 master 分支。如果最新的代码不在 master 分支上，该如何拿到呢？如下图所示，最新的代码可能在<code>daily/1.4.1</code>分支上，我们希望拿到这个分支上的代码。</p>
<h2 id="解决方法"><a href="#解决方法" class="headerlink" title="解决方法"></a>解决方法</h2><p><strong>直接使用命令</strong></p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token function">git</span> branch -r <span class="token comment">#查看远程分支</span></code></pre>

<p>或</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token function">git</span> branch -a <span class="token comment">#查看所有分支</span></code></pre>

<p>会显示</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">origin/HEAD -<span class="token operator">></span> origin/master
origin/daily/1.2.2
origin/daily/1.3.0
origin/daily/1.4.1
origin/develop
origin/feature/daily-1.0.0
origin/master</code></pre>

<p>然后直接</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token function">git</span> checkout origin/daily/1.4.1</code></pre>

<p>就好了。。。</p>
<h2 id="原来的解决方案"><a href="#原来的解决方案" class="headerlink" title="原来的解决方案"></a>原来的解决方案</h2><p><strong>其实我原来写的这个方法更多的是：设置已有的本地分支跟踪一个刚刚拉取下来的远程分支，或者想要修改正在跟踪的上游分支。</strong></p>
<p>我们在本地先建立一个分支，建议名称和远程的想要同步的分支名称一样。</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token function">git</span> branch daily/1.4.1</code></pre>

<p>在切换到这个本地分支</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token function">git</span> checkout daily/1.4.1
<span class="token comment"># Switched to branch 'daily/1.4.1'</span></code></pre>

<p>接下来就可以去建立上游分支的关联了，但是这个命令比较长，不好记，我们可以直接先<code>pull</code>一下，git 会提示我们相应的操作和命令。</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token function">git</span> pull
There is no tracking information <span class="token keyword">for</span> the current branch.
Please specify <span class="token function">which</span> branch you want to merge with.
See git-pull<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">for</span> details.

    <span class="token function">git</span> pull <span class="token operator">&lt;</span>remote<span class="token operator">></span> <span class="token operator">&lt;</span>branch<span class="token operator">></span>

If you wish to <span class="token builtin class-name">set</span> tracking information <span class="token keyword">for</span> this branch you can <span class="token keyword">do</span> so with:

    <span class="token function">git</span> branch --set-upstream-to<span class="token operator">=</span>origin/<span class="token operator">&lt;</span>branch<span class="token operator">></span> daily/1.4.1</code></pre>

<p>我们看到最后一行，执行这个命令，即可完成与上游分支的关联。</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token function">git</span> branch --set-upstream-to<span class="token operator">=</span>origin/daily/1.4.1 daily/1.4.1
<span class="token comment"># Branch daily/1.4.1 set up to track remote branch daily/1.4.1 from origin.</span></code></pre>

<p>然后再<code>pull</code>一下就好了！</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token function">git</span> pull</code></pre>]]></content>
      <categories>
        <category>GitHub</category>
      </categories>
      <tags>
        <tag>Git</tag>
        <tag>GitHub分支</tag>
      </tags>
  </entry>
  <entry>
    <title>Markdown 介绍与入门</title>
    <url>/2020/01/15/77.html</url>
    <content><![CDATA[<h1 id="Markdown介绍与入门"><a href="#Markdown介绍与入门" class="headerlink" title="Markdown介绍与入门"></a>Markdown介绍与入门</h1><h2 id="介绍"><a href="#介绍" class="headerlink" title="介绍"></a>介绍</h2><p>Markdown是一种轻量级的标记语言，使用普通的文本编辑器，通过简单的标记语法，就可以实现漂亮的排版，被越来越多的写作爱好者、程序员所使用。Markdown自成格式，不依赖任何编辑器，且易于传播，其语法十分简单，通过几分钟的简单学习，就可以实现基本的排版，然后专注于码字。</p>
<p>Markdown现在十分流行，经常访问 <code>github</code> 的朋友一定会发现，几乎所有的开源代码里，都有一个<code>README.md </code>文件，这个 <code>md</code> 文件，就是使用Markdown标记语言编写的。</p>
<h2 id="常用语法"><a href="#常用语法" class="headerlink" title="常用语法"></a>常用语法</h2><p><strong>1.标题</strong><br>　　标题是每篇文章都需要也是最常用的格式，在 Markdown 中，如果一段文字被定义为标题，只要在这段文字前加 # 号即可。Markdown总共支持六级标题，一级标题1个#，二级标题2个#，依此类推。<br>如下图，左边是编辑区界面，右边是预览界面，仅需在文字前加上几个#号（注意：markdown语法，一般要在标记符号后加一个空格）。</p>
<p><strong>2.列表</strong><br>列表分为有序列表和无序列表。列表可通过缩进实现嵌套的列表。</p>
<p>有序列表：在文字前加上 1. 2. 3.即可变为有序列表。<br>无序列表：在文字前加上一个- 或者*或者+。<br>如下图：</p>
<p><strong>注意：</strong></p>
<p>无序列表或有序列表标记和后面的文字之间要有一个空格隔开。<br>有序列表标记不是按照你写的数字进行显示的，而是根据当前有序列表标记所在位置显示的。<br>无序列表的项目符号是按照实心圆、空心圆、实心方格的层级关系递进的。<br>3.引用<br>如果你需要引用一小处别处的句子，就需要用上引用的格式。引用的标记符号是&gt;。<br>如下图：</p>
<p>引用也可以嵌套多级，两个&gt;可以实现二级引用，三个&gt;可以实现三级引用。<br>如下图：</p>
<p>4.插入图片和链接<br>链接与图片的语法很像。</p>
<p>插入图片： <img src="">，在[]中写替代文字（假如因为某些原因图片加载不成功，就显示这些文字，可以为空），（）中写图片地址，可以是本地地址，也可以是网络地址，通常使用网络地址。<br>插入链接：<a href=""></a>，同上。<br>如下图：</p>
<p>5.粗体与斜体<br>使用<code>**或者_表示粗体，*或者</code>表示斜体。<br>如下图：</p>
<p>注意：前后的 * 或 _ 与要 加粗或倾斜 的字体之间不能有空格。</p>
<p>6.分割线<br>使用—或**<em>或</em> * *可以实现分割线。<br>如下图：</p>
<p>7.行内代码和代码块<br>行内代码：将小段文字或代码，放在一个<code>符号对中，就是行内代码的标记规则。 代码块， 使用“</code>表示代码块。<br>如下图：</p>
<p>注意：`这个符号，在键盘上ESC键下面，切换到英文输入法即可打出。</p>
<p>8.表格<br>相比前面几项标记，表格真是太复杂了T_T。</p>
<p>——: 为右对齐。<br>:—— 为左对齐。<br>:——: 为居中对齐。<br>——- 为使用默认居中对齐。<br>如下图：</p>
<p>但是如果你使用一些Markdown编辑器，通常可以用过鼠标操作插入表格，很简单。</p>
<h2 id="次常用语法"><a href="#次常用语法" class="headerlink" title="次常用语法"></a>次常用语法</h2><ol>
<li><p>目录<br> 使用 [TOC] 可以自动生成目录，前提是你是按照标准Markdown语法写的。<br> 注意：[TOC] 标记可能只能放在一级标题的前面，视不同的编译器而定。</p>
</li>
<li><p>反斜杠<br> 使用 \ 表示反斜杠。在你不想显示Markdown标记时可以使用反斜杠。<br> 如：当你输入<em>电子科技大学</em>的时候，默认会以斜体的形式呈现，你若本就想显示出<em>，就在</em>前面加上反斜杠\吧。</p>
</li>
<li><p>空格<br> Markdown语法会忽略首行开头的空格，如果要体现出首行开头空两个的效果，可以使用 全角符号下的空格 ，windows下使用 shift+空格 切换。</p>
</li>
</ol>
<p>4.删除线<br>使用~~表示删除线</p>
<p>这是一条删除线</p>
<p>这是一条删除线</p>
<p>注：有的编译器可能不支持（比如我正在使用的Markdown Pad2）。</p>
<p>5.其他不常用的语法<br>小编用到的语法也很少，平时使用的就几个常用标记。其他语法如标签分类(Tags)、注脚、页内跳转等等，很少用到，各位同学需要的时候再自己百度吧。</p>
<h2 id="高级语法"><a href="#高级语法" class="headerlink" title="高级语法"></a>高级语法</h2><p><strong>1.Latex公式</strong><br>Markdown语法支持插入大名鼎鼎的Latex，这简直就是神器啊。在Markdown中插入Latex公式需要编译器支持，用法也有很多，这里就不能介绍了，用到的朋友自行百度吧。</p>
<p><strong>2.流程图</strong><br>Markdown还支持插入流程图，用法较为复杂。这里也不能做详细介绍了。</p>
<h2 id="编辑器推荐"><a href="#编辑器推荐" class="headerlink" title="编辑器推荐"></a>编辑器推荐</h2><p><strong>在线Markdown编辑器</strong><br>    <strong>dillinger ：</strong>漂亮强大，支持 <code>md</code>, <code>html</code>, <code>pdf</code> 文件导出。支持 <code>dropbox</code>, <code>onedrive</code>，<code>google drive</code>, <code>github</code>. 来自国外，可能不够稳定。</p>
<p><code>MaHua ：</code>小众软件推荐，界面有些简陋。</p>
<p><strong>简书 ：</strong>一个很不错的博客平台，每几秒钟便会自动存入一个备份。可以直接从本地拖入照片生成链接，一直在不断优化。作为一个博客平台，需要注册账号后方能进行写作。<br>还有很多….</p>
<p><strong>桌面Markdown编辑器</strong><br><code>Typora</code> ：美观、强大。推荐使用。支持Win、Linux、MAC。<br><code>MarkdownPad</code>：功能强大、界面丑陋。Windows平台，使用人数较多。<br><code>HarooPad</code>: 简洁、跨平台。</p>
<p>Markdown简单、强大，强烈推荐！</p>
]]></content>
      <categories>
        <category>Coding</category>
      </categories>
      <tags>
        <tag>markdown</tag>
      </tags>
  </entry>
  <entry>
    <title>markdown 表情大全</title>
    <url>/2020/01/20/80.html</url>
    <content><![CDATA[<h1 id="markdown-表情大全"><a href="#markdown-表情大全" class="headerlink" title="markdown 表情大全"></a>markdown 表情大全</h1><h2 id="markdown表情"><a href="#markdown表情" class="headerlink" title="markdown表情"></a>markdown表情</h2><p>该文是搜集的网络资源整理，为了写博客需要用到一些有趣的表情，特此记录<br>将对应emoji表情的符号码复制后输入你的markdown文本即可显示emoji表情。<br>如​<code>:blush:​</code>，显示为😊</p>
<h3 id="人物"><a href="#人物" class="headerlink" title="人物"></a>人物</h3><table>
<thead>
<tr>
<th align="center">syntax</th>
<th align="center">preview</th>
<th align="center">syntax</th>
<th align="center">preview</th>
<th align="center">syntax</th>
<th align="center">preview</th>
</tr>
</thead>
<tbody><tr>
<td align="center"><code>:bowtie:</code></td>
<td align="center">:bowtie:</td>
<td align="center"><code>:smile:</code></td>
<td align="center">:smile:</td>
<td align="center"><code>:laughing:</code></td>
<td align="center">:laughing:</td>
</tr>
<tr>
<td align="center"><code>:blush:</code></td>
<td align="center">😊</td>
<td align="center"><code>:smiley:</code></td>
<td align="center">😃</td>
<td align="center"><code>:relaxed:</code></td>
<td align="center">☺️</td>
</tr>
<tr>
<td align="center"><code>:smirk:</code></td>
<td align="center">😏</td>
<td align="center"><code>:heart_eyes:</code></td>
<td align="center">😍</td>
<td align="center"><code>:kissing_heart:</code></td>
<td align="center">😘</td>
</tr>
<tr>
<td align="center"><code>:kissing_closed_eyes:</code></td>
<td align="center">😚</td>
<td align="center"><code>:flushed:</code></td>
<td align="center">😳</td>
<td align="center"><code>:relieved:</code></td>
<td align="center">😌</td>
</tr>
<tr>
<td align="center"><code>:satisfied:</code></td>
<td align="center">😆</td>
<td align="center"><code>:grin:</code></td>
<td align="center">😁</td>
<td align="center"><code>:wink:</code></td>
<td align="center">😉</td>
</tr>
<tr>
<td align="center"><code>:stuck_out_tongue_winking_eye:</code></td>
<td align="center">😜</td>
<td align="center"><code>:stuck_out_tongue_closed_eyes:</code></td>
<td align="center">😝</td>
<td align="center"><code>:grinning:</code></td>
<td align="center">😀</td>
</tr>
<tr>
<td align="center"><code>:kissing:</code></td>
<td align="center">😗</td>
<td align="center"><code>:kissing_smiling_eyes:</code></td>
<td align="center">😙</td>
<td align="center"><code>:stuck_out_tongue:</code></td>
<td align="center">😛</td>
</tr>
<tr>
<td align="center"><code>:sleeping:</code></td>
<td align="center">😴</td>
<td align="center"><code>:worried:</code></td>
<td align="center">😟</td>
<td align="center"><code>:frowning:</code></td>
<td align="center">😦</td>
</tr>
<tr>
<td align="center"><code>:anguished:</code></td>
<td align="center">😧</td>
<td align="center"><code>:open_mouth:</code></td>
<td align="center">😮</td>
<td align="center"><code>:grimacing:</code></td>
<td align="center">😬</td>
</tr>
<tr>
<td align="center"><code>:confused:</code></td>
<td align="center">😕</td>
<td align="center"><code>:hushed:</code></td>
<td align="center">😯</td>
<td align="center"><code>:expressionless:</code></td>
<td align="center">😑</td>
</tr>
<tr>
<td align="center"><code>:unamused:</code></td>
<td align="center">😒</td>
<td align="center"><code>:sweat_smile:</code></td>
<td align="center">😅</td>
<td align="center"><code>:sweat:</code></td>
<td align="center">😓</td>
</tr>
<tr>
<td align="center"><code>:disappointed_relieved:</code></td>
<td align="center">😥</td>
<td align="center"><code>:weary:</code></td>
<td align="center">😩</td>
<td align="center"><code>:pensive:</code></td>
<td align="center">😔</td>
</tr>
<tr>
<td align="center"><code>:disappointed:</code></td>
<td align="center">😞</td>
<td align="center"><code>:confounded:</code></td>
<td align="center">😖</td>
<td align="center"><code>:fearful:</code></td>
<td align="center">😨</td>
</tr>
<tr>
<td align="center"><code>:cold_sweat:</code></td>
<td align="center">😰</td>
<td align="center"><code>:persevere:</code></td>
<td align="center">😣</td>
<td align="center"><code>:cry:</code></td>
<td align="center">😢</td>
</tr>
<tr>
<td align="center"><code>:sob:</code></td>
<td align="center">😭</td>
<td align="center"><code>:joy:</code></td>
<td align="center">😂</td>
<td align="center"><code>:astonished:</code></td>
<td align="center">😲</td>
</tr>
<tr>
<td align="center"><code>:scream:</code></td>
<td align="center">😱</td>
<td align="center"><code>:neckbeard:</code></td>
<td align="center">:neckbeard:</td>
<td align="center"><code>:tired_face:</code></td>
<td align="center">😫</td>
</tr>
<tr>
<td align="center"><code>:angry:</code></td>
<td align="center">😠</td>
<td align="center"><code>:rage:</code></td>
<td align="center">😡</td>
<td align="center"><code>:triumph:</code></td>
<td align="center">😤</td>
</tr>
<tr>
<td align="center"><code>:sleepy:</code></td>
<td align="center">😪</td>
<td align="center"><code>:yum:</code></td>
<td align="center">😋</td>
<td align="center"><code>:mask:</code></td>
<td align="center">😷</td>
</tr>
<tr>
<td align="center"><code>:sunglasses:</code></td>
<td align="center">😎</td>
<td align="center"><code>:dizzy_face:</code></td>
<td align="center">😵</td>
<td align="center"><code>:imp:</code></td>
<td align="center">👿</td>
</tr>
<tr>
<td align="center"><code>:smiling_imp:</code></td>
<td align="center">😈</td>
<td align="center"><code>:neutral_face:</code></td>
<td align="center">😐</td>
<td align="center"><code>:no_mouth:</code></td>
<td align="center">😶</td>
</tr>
<tr>
<td align="center"><code>:innocent:</code></td>
<td align="center">😇</td>
<td align="center"><code>:alien:</code></td>
<td align="center">👽</td>
<td align="center"><code>:yellow_heart:</code></td>
<td align="center">💛</td>
</tr>
<tr>
<td align="center"><code>:blue_heart:</code></td>
<td align="center">💙</td>
<td align="center"><code>:purple_heart:</code></td>
<td align="center">💜</td>
<td align="center"><code>:heart:</code></td>
<td align="center">❤️</td>
</tr>
<tr>
<td align="center"><code>:green_heart:</code></td>
<td align="center">💚</td>
<td align="center"><code>:broken_heart:</code></td>
<td align="center">💔</td>
<td align="center"><code>:heartbeat:</code></td>
<td align="center">💓</td>
</tr>
<tr>
<td align="center"><code>:heartpulse:</code></td>
<td align="center">💗</td>
<td align="center"><code>:two_hearts:</code></td>
<td align="center">💕</td>
<td align="center"><code>:revolving_hearts:</code></td>
<td align="center">💞</td>
</tr>
<tr>
<td align="center"><code>:cupid:</code></td>
<td align="center">💘</td>
<td align="center"><code>:sparkling_heart:</code></td>
<td align="center">💖</td>
<td align="center"><code>:sparkles:</code></td>
<td align="center">✨</td>
</tr>
<tr>
<td align="center"><code>:star:</code></td>
<td align="center">⭐</td>
<td align="center"><code>:star2:</code></td>
<td align="center">🌟</td>
<td align="center"><code>:dizzy:</code></td>
<td align="center">💫</td>
</tr>
<tr>
<td align="center"><code>:boom:</code></td>
<td align="center">💥</td>
<td align="center"><code>:collision:</code></td>
<td align="center">💥</td>
<td align="center"><code>:anger:</code></td>
<td align="center">💢</td>
</tr>
<tr>
<td align="center"><code>:exclamation:</code></td>
<td align="center">❗</td>
<td align="center"><code>:question:</code></td>
<td align="center">❓</td>
<td align="center"><code>:grey_exclamation:</code></td>
<td align="center">❕</td>
</tr>
<tr>
<td align="center"><code>:grey_question:</code></td>
<td align="center">❔</td>
<td align="center"><code>:zzz:</code></td>
<td align="center">💤</td>
<td align="center"><code>:dash:</code></td>
<td align="center">💨</td>
</tr>
<tr>
<td align="center"><code>:sweat_drops:</code></td>
<td align="center">💦</td>
<td align="center"><code>:notes:</code></td>
<td align="center">🎶</td>
<td align="center"><code>:musical_note:</code></td>
<td align="center">🎵</td>
</tr>
<tr>
<td align="center"><code>:fire:</code></td>
<td align="center">🔥</td>
<td align="center"><code>:hankey:</code></td>
<td align="center">💩</td>
<td align="center"><code>:poop:</code></td>
<td align="center">💩</td>
</tr>
<tr>
<td align="center"><code>::</code></td>
<td align="center">💩</td>
<td align="center"><code>:+1:</code></td>
<td align="center">👍</td>
<td align="center"><code>:thumbsup:</code></td>
<td align="center">👍</td>
</tr>
<tr>
<td align="center"><code>:-1:</code></td>
<td align="center">👎</td>
<td align="center"><code>:thumbsdown:</code></td>
<td align="center">👎</td>
<td align="center"><code>:ok_hand:</code></td>
<td align="center">👌</td>
</tr>
<tr>
<td align="center"><code>:punch:</code></td>
<td align="center">👊</td>
<td align="center"><code>:facepunch:</code></td>
<td align="center">👊</td>
<td align="center"><code>:fist:</code></td>
<td align="center">✊</td>
</tr>
<tr>
<td align="center"><code>:v:</code></td>
<td align="center">✌️</td>
<td align="center"><code>:wave:</code></td>
<td align="center">👋</td>
<td align="center"><code>:hand:</code></td>
<td align="center">✋</td>
</tr>
<tr>
<td align="center"><code>:raised_hand:</code></td>
<td align="center">✋</td>
<td align="center"><code>:open_hands:</code></td>
<td align="center">👐</td>
<td align="center"><code>:point_up:</code></td>
<td align="center">☝️</td>
</tr>
<tr>
<td align="center"><code>:point_down:</code></td>
<td align="center">👇</td>
<td align="center"><code>:point_left:</code></td>
<td align="center">👈</td>
<td align="center"><code>:point_right:</code></td>
<td align="center">👉</td>
</tr>
<tr>
<td align="center"><code>:raised_hands:</code></td>
<td align="center">🙌</td>
<td align="center"><code>:pray:</code></td>
<td align="center">🙏</td>
<td align="center"><code>:point_up_2:</code></td>
<td align="center">👆</td>
</tr>
<tr>
<td align="center"><code>:clap:</code></td>
<td align="center">👏</td>
<td align="center"><code>:muscle:</code></td>
<td align="center">💪</td>
<td align="center"><code>:metal:</code></td>
<td align="center">🤘</td>
</tr>
<tr>
<td align="center"><code>:fu:</code></td>
<td align="center">🖕</td>
<td align="center"><code>:walking:</code></td>
<td align="center">🚶</td>
<td align="center"><code>:runner:</code></td>
<td align="center">🏃</td>
</tr>
<tr>
<td align="center"><code>:running:</code></td>
<td align="center">🏃</td>
<td align="center"><code>:couple:</code></td>
<td align="center">👫</td>
<td align="center"><code>:family:</code></td>
<td align="center">👪</td>
</tr>
<tr>
<td align="center"><code>:two_men_holding_hands:</code></td>
<td align="center">👬</td>
<td align="center"><code>:two_women_holding_hands:</code></td>
<td align="center">👭</td>
<td align="center"><code>:dancer:</code></td>
<td align="center">💃</td>
</tr>
<tr>
<td align="center"><code>:dancers:</code></td>
<td align="center">👯</td>
<td align="center"><code>:ok_woman:</code></td>
<td align="center">🙆</td>
<td align="center"><code>:no_good:</code></td>
<td align="center">🙅</td>
</tr>
<tr>
<td align="center"><code>:information_desk_person:</code></td>
<td align="center">💁</td>
<td align="center"><code>:raising_hand:</code></td>
<td align="center">🙋</td>
<td align="center"><code>:bride_with_veil:</code></td>
<td align="center">👰</td>
</tr>
<tr>
<td align="center"><code>:person_with_pouting_face:</code></td>
<td align="center">🙎</td>
<td align="center"><code>:person_frowning:</code></td>
<td align="center">🙍</td>
<td align="center"><code>:bow:</code></td>
<td align="center">🙇</td>
</tr>
<tr>
<td align="center"><code>:couplekiss:</code></td>
<td align="center">💏</td>
<td align="center"><code>:couple_with_heart:</code></td>
<td align="center">💑</td>
<td align="center"><code>:massage:</code></td>
<td align="center">💆</td>
</tr>
<tr>
<td align="center"><code>:haircut:</code></td>
<td align="center">💇</td>
<td align="center"><code>:nail_care:</code></td>
<td align="center">💅</td>
<td align="center"><code>:boy:</code></td>
<td align="center">👦</td>
</tr>
<tr>
<td align="center"><code>:girl:</code></td>
<td align="center">👧</td>
<td align="center"><code>:woman:</code></td>
<td align="center">👩</td>
<td align="center"><code>:man:</code></td>
<td align="center">👨</td>
</tr>
<tr>
<td align="center"><code>:baby:</code></td>
<td align="center">👶</td>
<td align="center"><code>:older_woman:</code></td>
<td align="center">👵</td>
<td align="center"><code>:older_man:</code></td>
<td align="center">👴</td>
</tr>
<tr>
<td align="center"><code>:person_with_blond_hair:</code></td>
<td align="center">👱</td>
<td align="center"><code>:man_with_gua_pi_mao:</code></td>
<td align="center">👲</td>
<td align="center"><code>:man_with_turban:</code></td>
<td align="center">:man_with_turban:</td>
</tr>
<tr>
<td align="center"><code>:construction_worker:</code></td>
<td align="center">👷</td>
<td align="center"><code>:cop:</code></td>
<td align="center">👮</td>
<td align="center"><code>:angel:</code></td>
<td align="center">:angel:</td>
</tr>
<tr>
<td align="center"><code>:princess:</code></td>
<td align="center">👸</td>
<td align="center"><code>:smiley_cat:</code></td>
<td align="center">😺</td>
<td align="center"><code>:smile_cat:</code></td>
<td align="center">:smile_cat:</td>
</tr>
<tr>
<td align="center"><code>:heart_eyes_cat:</code></td>
<td align="center">😻</td>
<td align="center"><code>:kissing_cat:</code></td>
<td align="center">😽</td>
<td align="center"><code>:smirk_cat:</code></td>
<td align="center">:smirk_cat:</td>
</tr>
<tr>
<td align="center"><code>:scream_cat:</code></td>
<td align="center">🙀</td>
<td align="center"><code>:crying_cat_face:</code></td>
<td align="center">😿</td>
<td align="center"><code>:joy_cat:</code></td>
<td align="center">:joy_cat:</td>
</tr>
<tr>
<td align="center"><code>:pouting_cat:</code></td>
<td align="center">😾</td>
<td align="center"><code>:japanese_ogre:</code></td>
<td align="center">👹</td>
<td align="center"><code>:japanese_goblin:</code></td>
<td align="center">👺</td>
</tr>
<tr>
<td align="center"><code>:see_no_evil:</code></td>
<td align="center">🙈</td>
<td align="center"><code>:hear_no_evil:</code></td>
<td align="center">🙉</td>
<td align="center"><code>:speak_no_evil:</code></td>
<td align="center">🙊</td>
</tr>
<tr>
<td align="center"><code>:guardsman:</code></td>
<td align="center">💂</td>
<td align="center"><code>:skull:</code></td>
<td align="center">💀</td>
<td align="center"><code>:feet:</code></td>
<td align="center">🐾</td>
</tr>
<tr>
<td align="center"><code>:lips:</code></td>
<td align="center">👄</td>
<td align="center"><code>:kiss:</code></td>
<td align="center">💋</td>
<td align="center"><code>:droplet:</code></td>
<td align="center">💧</td>
</tr>
<tr>
<td align="center"><code>:ear:</code></td>
<td align="center">👂</td>
<td align="center"><code>:eyes:</code></td>
<td align="center">👀</td>
<td align="center"><code>:nose:</code></td>
<td align="center">👃</td>
</tr>
<tr>
<td align="center"><code>:tongue:</code></td>
<td align="center">👅</td>
<td align="center"><code>:love_letter:</code></td>
<td align="center">💌</td>
<td align="center"><code>:bust_in_silhouette:</code></td>
<td align="center">👤</td>
</tr>
<tr>
<td align="center"><code>:busts_in_silhouette:</code></td>
<td align="center">👥</td>
<td align="center"><code>:speech_balloon:</code></td>
<td align="center">💬</td>
<td align="center"><code>:thought_balloon:</code></td>
<td align="center">💭</td>
</tr>
</tbody></table>
]]></content>
      <categories>
        <category>工具</category>
      </categories>
      <tags>
        <tag>markdown</tag>
        <tag>emoji</tag>
      </tags>
  </entry>
  <entry>
    <title>学习 React 基础</title>
    <url>/2020/04/14/268.html</url>
    <content><![CDATA[<h2 id="React-基本概述"><a href="#React-基本概述" class="headerlink" title="React 基本概述"></a>React 基本概述</h2><h3 id="React-背景"><a href="#React-背景" class="headerlink" title="React 背景"></a>React 背景</h3><p><a href="https://react.docschina.org/">React</a> 起源于 Facebook(Meta) 的内部项目（2011，News Feed），之后又被用来开发网站（2012，Instagram），并于 2013 年 5 月开源。</p>
<h3 id="React-是什么"><a href="#React-是什么" class="headerlink" title="React 是什么"></a>React 是什么</h3><p><a href="https://react.docschina.org/">React</a> 是一个用于构建<strong>用户界面</strong>的 JavaScript <strong>库</strong>。</p>
<ul>
<li>用户界面：HTML 界面。</li>
<li>Library（库）和 Framework（框架）：库的特点是<strong>小而巧</strong>，针对特定问题的单一解决方案。框架的特点是<strong>大而全</strong>，提供了一整套的解决方案。</li>
</ul>
<h3 id="React-趋势"><a href="#React-趋势" class="headerlink" title="React 趋势"></a>React 趋势</h3><p>从 <a href="https://www.npmtrends.com/angular-vs-react-vs-vue">NPM 下载量</a> 来看，React &gt; Vue &gt; Angular。</p>
<h3 id="React-特点"><a href="#React-特点" class="headerlink" title="React 特点"></a>React 特点</h3><p><strong>声明式</strong></p>
<p>只需要描述UI（HTML）看起来是什么样子，就像写 HTML 一样简单，React 内部负责渲染 UI，并在数据变化时自动更新 UI。</p>
<pre class="language-js" data-language="js"><code class="language-js"><span class="token keyword">const</span> jsx <span class="token operator">=</span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>div className<span class="token operator">=</span><span class="token string">'app'</span><span class="token operator">></span>
        <span class="token operator">&lt;</span>h1<span class="token operator">></span>Hello World！<span class="token operator">&lt;</span><span class="token operator">/</span>h1<span class="token operator">></span>
        <span class="token operator">&lt;</span>p<span class="token operator">></span>动态数据：<span class="token punctuation">&#123;</span>count<span class="token punctuation">&#125;</span><span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">></span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span>
<span class="token punctuation">)</span></code></pre>

<p><strong>组件化</strong></p>
<p>把复杂的页面拆分成一个一个的单元，这些组成页面的基本单元就是组件，通过组合、复用组件来编写复杂界面的方式，就是组件化。</p>
<p><strong>小结：</strong></p>
<p>使用 React 除了可以开发 Web 应用，还可以使用 React Native 开发原生移动应用，甚至可以开发 VR（虚拟现实）应用（React 360）。</p>
<p>相比较于 Vue，React 强调尽可能的利用 JS 语言自身的能力来编写 UI，而不是通过造轮子增强 HTML 的功能。</p>
<h3 id="脚手架创建项目"><a href="#脚手架创建项目" class="headerlink" title="脚手架创建项目"></a>脚手架创建项目</h3><p><strong>脚手架意义</strong></p>
<p>现代的 Web 应用要考虑的问题很多，除了编写业务代码之外，还要考虑代码规范、预编译、压缩合并、打包上线等工作，需要有一套完整的解决方案来辅助我们快速开发，而 <a href="https://create-react-app.dev/">React 脚手架</a> 就是这么一套完整的解决方案，它零配置，开箱即用，让我们从繁杂的 Webpack 配置当中解脱出来，更关注于业务本身。</p>
<p>使用 <a href="https://create-react-app.dev/">create-react-app</a> 这个命令行工具，它是 React 官方团队出的一个构建 React 应用的脚手架工具。</p>
<p><strong>方法一</strong></p>
<ol>
<li>全局安装<code>npm i -g create-react-app</code>或者<code>yarn global add create-react-app</code>。</li>
<li>初始化项目<code>create-react-app my-app</code>，my-app 表示项目名称，可以修改。</li>
<li>启动项目：<code>yarn start</code>or <code>npm start</code>。</li>
</ol>
<p>🙁 缺点：全局安装命令无法保证命令一直是最新版本。</p>
<p><strong>方法二（推荐）</strong></p>
<ol>
<li>命令：<code>npx create-react-app react-basic</code>。</li>
<li>启动项目：<code>yarn start</code> or <code>npm start</code>。</li>
<li>npx 是 <code>npm@v5.2</code> 版本新添加的命令，用来简化 npm 工具包的使用流程。</li>
</ol>
<p>😄 优点：<code>npx</code> 会调用最新的 <code>create-react-app</code> 直接创建 React 项目。</p>
<h3 id="渲染-Hello-World"><a href="#渲染-Hello-World" class="headerlink" title="渲染 Hello World"></a>渲染 Hello World</h3><img src="https://zhihur.com/resource/images/ifer_hello_world.png">

<p><strong>步骤</strong></p>
<ol>
<li>删除 <code>src</code> 和 <code>public</code> 目录中的所有内容。</li>
<li>新建 <code>public/index.html</code>。</li>
<li>新建 <code>src/index.js</code> 文件。</li>
<li>引入 React 核心库和涉及 DOM 操作的包。</li>
<li>调用 <code>React.createElement()</code> 方法创建 React 元素。</li>
<li>调用 <code>ReactDOM.render()</code> 方法渲染 React 元素到页面。</li>
</ol>
<h3 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h3><ol>
<li>删除 <code>src</code> 和 <code>public</code> 目录中的所有内容。</li>
<li>新建 <code>public/index.html</code>。</li>
</ol>
<pre class="language-js" data-language="js"><code class="language-js"><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token constant">DOCTYPE</span> html<span class="token operator">></span>
<span class="token operator">&lt;</span>html lang<span class="token operator">=</span><span class="token string">"en"</span><span class="token operator">></span>
    <span class="token operator">&lt;</span>head<span class="token operator">></span>
        <span class="token operator">&lt;</span>meta charset<span class="token operator">=</span><span class="token string">"UTF-8"</span> <span class="token operator">/</span><span class="token operator">></span>
        <span class="token operator">&lt;</span>meta http<span class="token operator">-</span>equiv<span class="token operator">=</span><span class="token string">"X-UA-Compatible"</span> content<span class="token operator">=</span><span class="token string">"IE=edge"</span> <span class="token operator">/</span><span class="token operator">></span>
        <span class="token operator">&lt;</span>meta name<span class="token operator">=</span><span class="token string">"viewport"</span> content<span class="token operator">=</span><span class="token string">"width=device-width, initial-scale=1.0"</span> <span class="token operator">/</span><span class="token operator">></span>
        <span class="token operator">&lt;</span>title<span class="token operator">></span>Document<span class="token operator">&lt;</span><span class="token operator">/</span>title<span class="token operator">></span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>head<span class="token operator">></span>

    <span class="token operator">&lt;</span>body<span class="token operator">></span>
        <span class="token operator">&lt;</span>div id<span class="token operator">=</span><span class="token string">"root"</span><span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>body<span class="token operator">></span>
<span class="token operator">&lt;</span><span class="token operator">/</span>html<span class="token operator">></span></code></pre>

<ol start="3">
<li><p>新建 <code>src/index.js</code> 文件。</p>
</li>
<li><p>引入 React 核心库和涉及 DOM 操作的包。</p>
</li>
</ol>
<p><code>src/index.js</code></p>
<pre class="language-js" data-language="js"><code class="language-js"><span class="token comment">// create-react-app 脚手架生成的项目中已经下载好了 react 和 react-dom，无需重复下载，直接使用即可</span>
<span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">'react'</span>
<span class="token keyword">import</span> ReactDOM <span class="token keyword">from</span> <span class="token string">'react-dom'</span></code></pre>

<ol start="5">
<li>调用 <code>React.createElement()</code> 方法创建 React 元素。</li>
</ol>
<pre class="language-js" data-language="js"><code class="language-js"><span class="token comment">// 标签名、标签属性、标签内容，返回的是一个 React 元素（虚拟 DOM）</span>
<span class="token keyword">const</span> title <span class="token operator">=</span> React<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'h1'</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token string">'Hello World'</span><span class="token punctuation">)</span></code></pre>



<ol start="6">
<li>调用 <code>ReactDOM.render()</code> 方法渲染 React 元素到页面。</li>
</ol>
<pre class="language-js" data-language="js"><code class="language-js">ReactDOM<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span>title<span class="token punctuation">,</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'#root'</span><span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre>

<h3 id="React-createElement-📝"><a href="#React-createElement-📝" class="headerlink" title="React.createElement() 📝"></a>React.createElement() 📝</h3><p>如何用 <code>React.createElement()</code> 创建出如下结构？</p>
<pre class="language-js" data-language="js"><code class="language-js"><span class="token operator">&lt;</span>div className<span class="token operator">=</span><span class="token string">"wrap"</span><span class="token operator">></span>
    <span class="token operator">&lt;</span>ul<span class="token operator">></span>
        <span class="token operator">&lt;</span>li<span class="token operator">></span>React<span class="token operator">&lt;</span><span class="token operator">/</span>li<span class="token operator">></span>
        <span class="token operator">&lt;</span>li<span class="token operator">></span>Vue<span class="token operator">&lt;</span><span class="token operator">/</span>li<span class="token operator">></span>
        <span class="token operator">&lt;</span>li<span class="token operator">></span>Angular<span class="token operator">&lt;</span><span class="token operator">/</span>li<span class="token operator">></span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>ul<span class="token operator">></span>
<span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span></code></pre>

<p><strong>重点</strong></p>
<pre class="language-js" data-language="js"><code class="language-js">React<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'标签名'</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span> 标签上的属性<span class="token number">1</span>：值<span class="token number">1</span> <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> 子元素<span class="token number">1</span><span class="token punctuation">,</span> 子元素<span class="token number">2</span><span class="token punctuation">)</span></code></pre>

<p>如果有更复杂的就需要使用 JSX</p>
<h3 id="JSX-基本介绍"><a href="#JSX-基本介绍" class="headerlink" title="JSX 基本介绍"></a>JSX 基本介绍</h3><p><code>React.createElement()</code> 创建 React 元素的问题：繁琐/不简洁；不直观，无法一眼看出所描述的结构；代码不容易维护！</p>
<pre class="language-js" data-language="js"><code class="language-js">React<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span>
    <span class="token string">'div'</span><span class="token punctuation">,</span>
    <span class="token punctuation">&#123;</span> <span class="token literal-property property">className</span><span class="token operator">:</span> <span class="token string">'wrap'</span> <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
    React<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'ul'</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> React<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'li'</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token string">'React'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> React<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'li'</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token string">'Vue'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> React<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'li'</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token string">'Angular'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span></code></pre>

<p>对比下面 JSX 的写法</p>
<pre class="language-js" data-language="js"><code class="language-js"><span class="token operator">&lt;</span>div className<span class="token operator">=</span><span class="token string">"wrap"</span><span class="token operator">></span>
    <span class="token operator">&lt;</span>ul<span class="token operator">></span>
        <span class="token operator">&lt;</span>li<span class="token operator">></span>React<span class="token operator">&lt;</span><span class="token operator">/</span>li<span class="token operator">></span>
        <span class="token operator">&lt;</span>li<span class="token operator">></span>Vue<span class="token operator">&lt;</span><span class="token operator">/</span>li<span class="token operator">></span>
        <span class="token operator">&lt;</span>li<span class="token operator">></span>Angular<span class="token operator">&lt;</span><span class="token operator">/</span>li<span class="token operator">></span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>ul<span class="token operator">></span>
<span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span></code></pre>

<p><strong>JSX 是什么</strong></p>
<p>JSX 是 JavaScript XML 的简写，表示可以在 JavaScript 代码中写 XML（HTML） 格式的代码。</p>
<p>优势：声明式语法更加直观，与 HTML 结构相同，降低了学习成本，提高了开发效率，JSX 是 React 的核心之一。</p>
<p><strong>JSX 基本使用</strong></p>
<ol>
<li>使用 JSX 创建 React 元素</li>
</ol>
<pre class="language-js" data-language="js"><code class="language-js"><span class="token keyword">const</span> title <span class="token operator">=</span> <span class="token operator">&lt;</span>h1<span class="token operator">></span>Hello <span class="token constant">JSX</span><span class="token operator">&lt;</span><span class="token operator">/</span>h1<span class="token operator">></span></code></pre>



<ol start="2">
<li>使用 <code>ReactDOM.render()</code> 方法渲染 React 元素到页面中</li>
</ol>
<pre class="language-js" data-language="js"><code class="language-js">ReactDOM<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span>title<span class="token punctuation">,</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'#root'</span><span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre>

<p><strong>JSX 是如何工作的</strong></p>
<p>🤔 换句话说，JSX 并不是标准的 ECMAScript 语法，为什么 React 脚手架中可以直接使用 JSX 呢？</p>
<ul>
<li>JSX 需要使用 Babel 编译成 <code>React.createElement()</code> 的形式，然后配合 React 才能在浏览器中使用，而 <code>create-react-app</code> 脚手架中已经内置了 Babel 及相关配置。</li>
<li>编译 JSX 语法的包为：<a href="https://www.npmjs.com/package/@babel/preset-react">@babel/preset-react</a>，<a href="https://www.babeljs.cn/repl#?browsers=defaults%2C%20not%20ie%2011%2C%20not%20ie_mob%2011&build=&builtIns=false&corejs=3.6&spec=false&loose=false&code_lz=DwCwjAfAEgpgNnA9gAgFIGUAawD04JA&debug=false&forceAllTransforms=false&shippedProposals=false&circleciRepo=&evaluate=false&fileSize=false&timeTravel=false&sourceType=module&lineWrap=true&presets=env%2Creact%2Cstage-2&prettier=false&targets=&version=7.16.2&externalPlugins=&assumptions=%7B%7D">在线体验</a>。</li>
</ul>
<pre class="language-js" data-language="js"><code class="language-js"><span class="token keyword">const</span> r <span class="token operator">=</span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>div className<span class="token operator">=</span><span class="token string">'wrap'</span><span class="token operator">></span>
        <span class="token operator">&lt;</span>h1<span class="token operator">></span>Hello World<span class="token operator">&lt;</span><span class="token operator">/</span>h1<span class="token operator">></span>
        <span class="token operator">&lt;</span>p<span class="token operator">></span>React<span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">></span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span>
<span class="token punctuation">)</span></code></pre>

<ol>
<li>必须有 1 个根节点，或者虚拟根节点 <code>&lt;&gt;&lt;/&gt;</code>、<code>&lt;React.Fragment&gt;&lt;/React.Fragment&gt;</code>。</li>
<li>属性名一般是驼峰的写法且不能是 JS 中的关键字，例如 class 改成 className，label 的 for 属性改为 <code>htmlFor</code>，colspan 改为 <code>colSpan</code>。</li>
<li>元素若没有子节点，可以使用单标签，但一定要闭合，例如 <code>&lt;span/&gt;</code>。</li>
<li><code>React@16.14</code> 之前需要先引入 React 才能使用 JSX（这个也好理解，因为 JSX 最后还是要被转成 <code>React.createElement()</code> 的形式）。</li>
<li>换行建议使用 <code>()</code> 进行包裹，防止换行的时候<a href="https://stackoverflow.com/questions/2846283/what-are-the-rules-for-javascripts-automatic-semicolon-insertion-asi">自动插入分号</a>的 Bug。</li>
</ol>
<img src="https://zhihur.com/resource/images/ifer_bug.png">

<p><strong>使用表达式</strong></p>
<p><strong>单大括号</strong>中可以使用任意的表达式（可以产生结果的式子）。</p>
<ul>
<li>普通的简单数据类型。</li>
</ul>
<pre class="language-js" data-language="js"><code class="language-js"><span class="token keyword">const</span> name <span class="token operator">=</span> <span class="token string">'zs'</span>
<span class="token keyword">const</span> age <span class="token operator">=</span> <span class="token number">18</span>
<span class="token keyword">const</span> title <span class="token operator">=</span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>h1<span class="token operator">></span>
        姓名：<span class="token punctuation">&#123;</span>name<span class="token punctuation">&#125;</span><span class="token punctuation">,</span> 年龄：<span class="token punctuation">&#123;</span>age<span class="token punctuation">&#125;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>h1<span class="token operator">></span>
<span class="token punctuation">)</span></code></pre>



<ul>
<li>对象中的属性。</li>
</ul>
<pre class="language-js" data-language="js"><code class="language-js"><span class="token keyword">const</span> car <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
    <span class="token literal-property property">brand</span><span class="token operator">:</span> <span class="token string">'玛莎拉蒂'</span><span class="token punctuation">,</span>
<span class="token punctuation">&#125;</span>
<span class="token keyword">const</span> title <span class="token operator">=</span> <span class="token operator">&lt;</span>h1<span class="token operator">></span>汽车：<span class="token punctuation">&#123;</span>car<span class="token punctuation">.</span>brand<span class="token punctuation">&#125;</span><span class="token operator">&lt;</span><span class="token operator">/</span>h1<span class="token operator">></span></code></pre>



<ul>
<li>数组中的某一项甚至整个数组。</li>
</ul>
<pre class="language-js" data-language="js"><code class="language-js"><span class="token keyword">const</span> friends <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'张三'</span><span class="token punctuation">,</span> <span class="token string">'李四'</span><span class="token punctuation">]</span>
<span class="token keyword">const</span> title <span class="token operator">=</span> <span class="token operator">&lt;</span>h1<span class="token operator">></span>汽车：<span class="token punctuation">&#123;</span>friends<span class="token punctuation">&#125;</span><span class="token operator">&lt;</span><span class="token operator">/</span>h1<span class="token operator">></span></code></pre>



<ul>
<li>可以调用方法。</li>
</ul>
<pre class="language-js" data-language="js"><code class="language-js"><span class="token keyword">function</span> <span class="token function">sayHi</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">return</span> <span class="token string">'你好'</span>
<span class="token punctuation">&#125;</span>
<span class="token keyword">const</span> title <span class="token operator">=</span> <span class="token operator">&lt;</span>h1<span class="token operator">></span>姓名：<span class="token punctuation">&#123;</span><span class="token function">sayHi</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token operator">&lt;</span><span class="token operator">/</span>h1<span class="token operator">></span></code></pre>

<ul>
<li>JS 对象虽然也是表达式，但是不能直接嵌套在 <code>&#123;&#125;</code> 中，一般只会出现在 style 属性中。</li>
<li>JSX 本身也是表达式。</li>
</ul>
<pre class="language-js" data-language="js"><code class="language-js"><span class="token keyword">const</span> span <span class="token operator">=</span> <span class="token operator">&lt;</span>span<span class="token operator">></span>我是一个span<span class="token operator">&lt;</span><span class="token operator">/</span>span<span class="token operator">></span>
<span class="token keyword">const</span> title <span class="token operator">=</span> <span class="token operator">&lt;</span>h1<span class="token operator">></span>盒子<span class="token punctuation">&#123;</span>span<span class="token punctuation">&#125;</span><span class="token operator">&lt;</span><span class="token operator">/</span>h1<span class="token operator">></span></code></pre>

<p><strong>小结</strong></p>
<ul>
<li>JSX 中可以包含任意的表达式（除了对象）。</li>
<li>JSX 中不能放语句，例如 <code>if</code>、<code>switch</code>、<code>for</code>、<code>while</code> 等。</li>
</ul>
<h4 id="列表渲染"><a href="#列表渲染" class="headerlink" title="列表渲染"></a><strong>列表渲染</strong></h4><p><strong>小试牛刀</strong></p>
<ul>
<li>后端返回的数据。</li>
</ul>
<pre class="language-none"><code class="language-none">const arr &#x3D; [
    &#123; id: 1, name: &#39;Vue&#39; &#125;,
    &#123; id: 2, name: &#39;React&#39; &#125;,
    &#123; id: 3, name: &#39;Angular&#39; &#125;,
]</code></pre>



<ul>
<li>期望实现的效果。</li>
</ul>
<img src="https://zhihur.com/resource/images/ifer_list_jsx.png">

<h3 id="代码实现"><a href="#代码实现" class="headerlink" title="代码实现"></a>代码实现</h3><p>手动拼接如下。</p>
<pre class="language-none"><code class="language-none">&lt;ul&gt;
    &lt;li&gt;&#123;list[0].name&#125;&lt;&#x2F;li&gt;
    &lt;li&gt;&#123;list[1].name&#125;&lt;&#x2F;li&gt;
    &lt;li&gt;&#123;list[2].name&#125;&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;</code></pre>



<p>简化上面的代码：可以使用 <code>map()</code> 方法渲染一组数据。</p>
<pre class="language-none"><code class="language-none">import ReactDOM from &#39;react-dom&#39;

const list &#x3D; [
    &#123; id: 1, name: &#39;Vue&#39; &#125;,
    &#123; id: 2, name: &#39;React&#39; &#125;,
    &#123; id: 3, name: &#39;Angular&#39; &#125;,
]

const arrJsx &#x3D; list.map((item) &#x3D;&gt; &lt;li key&#x3D;&#123;item.id&#125;&gt;&#123;item.name&#125;&lt;&#x2F;li&gt;)

const loadData &#x3D; () &#x3D;&gt; &#123;
    return &lt;ul&gt;&#123;arrJsx&#125;&lt;&#x2F;ul&gt;
&#125;

ReactDOM.render(loadData(), document.querySelector(&#39;#root&#39;))</code></pre>



<h3 id="关于-key"><a href="#关于-key" class="headerlink" title="关于 key"></a>关于 key</h3><ol>
<li>特点：key 值要保证唯一，尽量避免使用索引号，key 在最终的 HTML 结构中是看不见的。</li>
<li>加在哪里：<code>map()</code> 遍历谁，就把 key 加在谁上。</li>
<li>作用：React 内部用来进行<strong>性能优化</strong>时使用的，key 在最终的 HTML 结构中是看不见的。</li>
</ol>
<h3 id="渲染数据-📝"><a href="#渲染数据-📝" class="headerlink" title="渲染数据 📝"></a>渲染数据 📝</h3><pre class="language-js" data-language="js"><code class="language-js"><span class="token keyword">const</span> list <span class="token operator">=</span> <span class="token punctuation">[</span>
    <span class="token punctuation">&#123;</span> <span class="token literal-property property">id</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'奔驰'</span><span class="token punctuation">,</span> <span class="token literal-property property">price</span><span class="token operator">:</span> <span class="token number">11000</span> <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
    <span class="token punctuation">&#123;</span> <span class="token literal-property property">id</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'宝马'</span><span class="token punctuation">,</span> <span class="token literal-property property">price</span><span class="token operator">:</span> <span class="token number">13000</span> <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
    <span class="token punctuation">&#123;</span> <span class="token literal-property property">id</span><span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'法拉利'</span><span class="token punctuation">,</span> <span class="token literal-property property">price</span><span class="token operator">:</span> <span class="token number">15000</span> <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span></code></pre>

<p>需求：根据上面数据生成下面结果。</p>
<pre class="language-js" data-language="js"><code class="language-js"><span class="token operator">&lt;</span>ul<span class="token operator">></span>
    <span class="token operator">&lt;</span>li<span class="token operator">></span>
        <span class="token operator">&lt;</span>h3<span class="token operator">></span>车名：奔驰<span class="token operator">&lt;</span><span class="token operator">/</span>h3<span class="token operator">></span>
        <span class="token operator">&lt;</span>p<span class="token operator">></span>价格：<span class="token number">11000</span><span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">></span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>li<span class="token operator">></span>
    <span class="token operator">&lt;</span>li<span class="token operator">></span>
        <span class="token operator">&lt;</span>h3<span class="token operator">></span>车名：宝马<span class="token operator">&lt;</span><span class="token operator">/</span>h3<span class="token operator">></span>
        <span class="token operator">&lt;</span>p<span class="token operator">></span>价格：<span class="token number">13000</span><span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">></span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>li<span class="token operator">></span>
    <span class="token operator">&lt;</span>li<span class="token operator">></span>
        <span class="token operator">&lt;</span>h3<span class="token operator">></span>车名：法拉利<span class="token operator">&lt;</span><span class="token operator">/</span>h3<span class="token operator">></span>
        <span class="token operator">&lt;</span>p<span class="token operator">></span>价格：<span class="token number">15000</span><span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">></span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>li<span class="token operator">></span>
<span class="token operator">&lt;</span><span class="token operator">/</span>ul<span class="token operator">></span></code></pre>

<pre class="language-js" data-language="js"><code class="language-js"><span class="token keyword">const</span> arr <span class="token operator">=</span> list<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">item</span><span class="token punctuation">)</span><span class="token operator">=></span><span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>ul<span class="token operator">></span>
        <span class="token operator">&lt;</span>li key<span class="token operator">=</span><span class="token punctuation">&#123;</span>item<span class="token punctuation">.</span>id<span class="token punctuation">&#125;</span><span class="token operator">></span>
          <span class="token operator">&lt;</span>h3<span class="token operator">></span><span class="token punctuation">&#123;</span>item<span class="token punctuation">.</span>name<span class="token punctuation">&#125;</span><span class="token operator">&lt;</span><span class="token operator">/</span>h3<span class="token operator">></span>
          <span class="token operator">&lt;</span>p<span class="token operator">></span><span class="token punctuation">&#123;</span>item<span class="token punctuation">.</span>price<span class="token punctuation">&#125;</span><span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">></span>
        <span class="token operator">&lt;</span><span class="token operator">/</span>li<span class="token operator">></span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>ul<span class="token operator">></span>
<span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre>

<h2 id="样式处理"><a href="#样式处理" class="headerlink" title="样式处理"></a>样式处理</h2><h3 id="目标"><a href="#目标" class="headerlink" title="目标"></a>目标</h3><p>掌握 React 中使用样式的两种方式。</p>
<h3 id="行内样式"><a href="#行内样式" class="headerlink" title="行内样式"></a>行内样式</h3><ul>
<li>语法</li>
</ul>
<pre class="language-js" data-language="js"><code class="language-js"><span class="token operator">&lt;</span>元素 style<span class="token operator">=</span><span class="token punctuation">&#123;</span> <span class="token punctuation">&#123;</span>css属性<span class="token number">1</span>：值<span class="token number">1</span><span class="token punctuation">,</span>css属性<span class="token number">2</span>：值<span class="token number">2</span><span class="token punctuation">&#125;</span> <span class="token punctuation">&#125;</span><span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>元素<span class="token operator">></span></code></pre>

<ul>
<li>需求</li>
</ul>
<img src="https://zhihur.com/resource/images/react_style.png">

<ul>
<li>代码</li>
</ul>
<pre class="language-js" data-language="js"><code class="language-js"><span class="token operator">&lt;</span>div style<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#123;</span> <span class="token literal-property property">width</span><span class="token operator">:</span> <span class="token number">200</span><span class="token punctuation">,</span> <span class="token literal-property property">height</span><span class="token operator">:</span> <span class="token number">200</span><span class="token punctuation">,</span> <span class="token literal-property property">lineHeight</span><span class="token operator">:</span> <span class="token string">'200px'</span><span class="token punctuation">,</span> <span class="token literal-property property">backgroundColor</span><span class="token operator">:</span> <span class="token string">'black'</span><span class="token punctuation">,</span> <span class="token literal-property property">color</span><span class="token operator">:</span> <span class="token string">'white'</span><span class="token punctuation">,</span> <span class="token literal-property property">textAlign</span><span class="token operator">:</span> <span class="token string">'center'</span><span class="token punctuation">,</span> <span class="token literal-property property">fontSize</span><span class="token operator">:</span> <span class="token number">30</span> <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token operator">></span>React<span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span></code></pre>



<ul>
<li><p>注意点</p>
<p>a，为啥有两个<code>&#123;&#123; &#125;&#125;</code>，外层的 <code>&#123;&#125;</code> 表示要开始写 JS 表达式了，内层的 <code>&#123;&#125;</code> 表示是一个对象。</p>
<p>b，属性名是小驼峰格式，例如 <code>background-color</code> 需要写成 <code>backgroundColor</code>。</p>
<p>c，属性值是字符串，如果单位是 px，可以简写成数值。</p>
</li>
</ul>
<h3 id="className"><a href="#className" class="headerlink" title="className"></a>className</h3><ul>
<li>用 <code>className</code> 定义类名。</li>
<li>在 <code>src</code> 目录中准备 <code>index.css</code> 文件，然后在 <code>index.js</code> 文件中通过 <code>import &#39;./index.css&#39;</code> 引入文件。</li>
</ul>
<p><code>index.css</code></p>
<pre class="language-js" data-language="js"><code class="language-js"><span class="token punctuation">.</span>title <span class="token punctuation">&#123;</span>
    <span class="token literal-property property">width</span><span class="token operator">:</span> 200px<span class="token punctuation">;</span>
    <span class="token literal-property property">height</span><span class="token operator">:</span> 200px<span class="token punctuation">;</span>
    <span class="token literal-property property">color</span><span class="token operator">:</span> white<span class="token punctuation">;</span>
    background<span class="token operator">-</span>color<span class="token operator">:</span> black<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span></code></pre>

<p><code>index.js</code></p>
<pre class="language-js" data-language="js"><code class="language-js"><span class="token keyword">import</span> <span class="token string">'./index.css'</span>
<span class="token punctuation">;</span><span class="token operator">&lt;</span>div className<span class="token operator">=</span><span class="token string">'title'</span><span class="token operator">></span>Hello React<span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span></code></pre>



<h3 id="小结"><a href="#小结" class="headerlink" title="小结"></a>小结</h3><ul>
<li>类名使用 <code>className</code>，<strong>推荐</strong>。</li>
<li>行内样式，<code>&lt;div style=&#123;&#123; color: 'red' &#125;&#125;&gt;Hello&lt;/div&gt;</code>。</li>
</ul>
]]></content>
      <categories>
        <category>React.js</category>
      </categories>
      <tags>
        <tag>前端</tag>
        <tag>React</tag>
      </tags>
  </entry>
  <entry>
    <title>React 组件</title>
    <url>/2020/04/20/272.html</url>
    <content><![CDATA[<h1 id="React-组件"><a href="#React-组件" class="headerlink" title="React 组件"></a>React 组件</h1><h3 id="概念"><a href="#概念" class="headerlink" title="概念"></a>概念</h3><p>组件就是页面中的一部分，是 React 的一等公民，使用 React 就是在用组件，而所谓的组件化开发就是采用分而治之的思想来管理繁杂的页面逻辑。</p>
<img src="https://zhihur.com/resource/images/components.png"/>

<h3 id="特点"><a href="#特点" class="headerlink" title="特点"></a>特点</h3><p>独立、可复用、可组合。</p>
<h3 id="分类"><a href="#分类" class="headerlink" title="分类"></a>分类</h3><ul>
<li>功能使用：UI 组件（AntD）和业务组件（留言板）；普通组件（在一个组件中直接使用的组件）和路由组件（通过路由跳转访问到的组件）。</li>
<li>创建方式：函数组件和类组件。</li>
</ul>
<h2 id="函数式组件"><a href="#函数式组件" class="headerlink" title="函数式组件"></a>函数式组件</h2><h3 id="介绍"><a href="#介绍" class="headerlink" title="介绍"></a>介绍</h3><ul>
<li><p>概念</p>
<p>通过函数创建出来的组件，又称简单组件或无状态组件（React16.8 以后函数式组件也可以拥有自己的状态），<strong>本质上来说就是一个 JS 函数</strong>。</p>
</li>
<li><p>步骤</p>
<ol>
<li><p>先定义。</p>
<p>a，函数名称<strong>必须以大写字母开头</strong>。</p>
<p>b，<strong>必须有返回值</strong>，返回值表示该组件的结构，如果不想渲染任何内容，可以 <code>return null</code>。</p>
</li>
<li><p>再使用。</p>
<p>a，<code>&lt;函数名/&gt;</code>，单标签闭合。</p>
<p>b，<code>&lt;函数名&gt;&lt;/函数名&gt;</code>，双标签。</p>
</li>
</ol>
</li>
<li><p>注意点</p>
<p>函数式组件中的 this 指向是 undefined，因为 Babel 编译后的代码开启了严格模式，<a href="https://www.babeljs.cn/repl#?browsers=defaults%2C%20not%20ie%2011%2C%20not%20ie_mob%2011&build=&builtIns=false&corejs=3.6&spec=false&loose=false&code_lz=GYVwdgxgLglg9mABAWQJ4GEC2AHAFASkQG8AoASACcBTKECpAHgAsBGAPkF_FQB1NB4fUBG_QG9yDAPSs2JAL5A&debug=false&forceAllTransforms=false&shippedProposals=false&circleciRepo=&evaluate=false&fileSize=false&timeTravel=false&sourceType=module&lineWrap=true&presets=env%2Ces2015%2Creact%2Cstage-0&prettier=false&targets=&version=7.15.8&externalPlugins=">Babel 试一试</a>。</p>
</li>
</ul>
<pre class="language-js" data-language="js"><code class="language-js"><span class="token keyword">import</span> ReactDOM <span class="token keyword">from</span> <span class="token string">'react-dom'</span>

<span class="token keyword">function</span> <span class="token function">Hello</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">return</span> <span class="token operator">&lt;</span>div<span class="token operator">></span>这是第一个函数组件<span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span>
<span class="token punctuation">&#125;</span>
<span class="token comment">// const Hello = () => &lt;h1>这是一个函数组件！&lt;/h1>;</span>

<span class="token comment">// 把函数的名字作为标签名进行渲染，可以使用单闭合，或双标签的形式</span>
ReactDOM<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token operator">&lt;</span>Hello <span class="token operator">/</span><span class="token operator">></span><span class="token punctuation">,</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'root'</span><span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre>

<p>React 解析 <code>&lt;Hello/&gt;</code> 标签，发现是大写开头的会被当做组件进行解析，解析的时候又发现其是一个函数式组件，随后会调用此函数，将返回的虚拟 DOM 转为真实 DOM，并渲染到页面中。</p>
<h2 id="类组件"><a href="#类组件" class="headerlink" title="类组件"></a>类组件</h2><h3 id="介绍-1"><a href="#介绍-1" class="headerlink" title="介绍"></a>介绍</h3><p>a，使用 ES6 语法的 class 创建的组件，又称复杂组件或有状态组件。</p>
<p>b，类名称也必须要大写字母开头。</p>
<p>c，类组件应该继承 <code>React.Component</code> 父类，从而可以使用父类中提供的方法或者属性。</p>
<p>d，类组件必须提供 <code>render()</code> 方法，此方法中的 this 指向此组件的实例对象，此方法中必须要有 return 返回值。</p>
<pre class="language-js" data-language="js"><code class="language-js"><span class="token keyword">class</span> <span class="token class-name">Hello</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span> <span class="token punctuation">&#123;</span>
    <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> <span class="token operator">&lt;</span>div<span class="token operator">></span>这是第一个类组件<span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>
ReactDOM<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token operator">&lt;</span>Hello <span class="token operator">/</span><span class="token operator">></span><span class="token punctuation">,</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'root'</span><span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre>

<p>了解 <code>ReactDOM.render()</code> 解析类式组件的过程：React 解析 <code>&lt;Hello/&gt;</code> 标签，发现是大写开头的会被当做组件进行解析，解析的时候又发现其是一个类组件，会自动的 new 出来该类的实例，并通过实例调用原型上的 <code>render()</code> 方法，将 <code>render()</code> 方法返回的虚拟 DOM 转为真实 DOM，并渲染到页面中。</p>
<h2 id="提取组件"><a href="#提取组件" class="headerlink" title="提取组件"></a>提取组件</h2><h3 id="实现"><a href="#实现" class="headerlink" title="实现"></a>实现</h3><ol>
<li>创建 App.js，创建组件（函数 或 类）。</li>
<li>在 App.js 中通过 export default 默认导出该组件。</li>
<li>在 index.js 中通过 import 默认导入 App 组件。</li>
<li>渲染组件。</li>
</ol>
<h3 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h3><pre class="language-js" data-language="js"><code class="language-js">App<span class="token punctuation">.</span>jsx
<span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">&#123;</span> Component <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'react'</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">App</span> <span class="token keyword">extends</span> <span class="token class-name">Component</span> <span class="token punctuation">&#123;</span>
    <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> <span class="token operator">&lt;</span>div<span class="token operator">></span>Hello World<span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span></code></pre>



<pre class="language-js" data-language="js"><code class="language-js">index<span class="token punctuation">.</span>js
<span class="token keyword">import</span> ReactDOM <span class="token keyword">from</span> <span class="token string">'react-dom'</span>
<span class="token keyword">import</span> App <span class="token keyword">from</span> <span class="token string">'./App'</span>

ReactDOM<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token operator">&lt;</span>App <span class="token operator">/</span><span class="token operator">></span><span class="token punctuation">,</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'#root'</span><span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre>

<h2 id="组件的状态"><a href="#组件的状态" class="headerlink" title="组件的状态"></a>组件的状态</h2><h3 id="关于状态"><a href="#关于状态" class="headerlink" title="关于状态"></a>关于状态</h3><h4 id="概念-1"><a href="#概念-1" class="headerlink" title="概念"></a>概念</h4><p>状态就是用来描述事物在某一时刻的的数据，例如：9 月 23 号时书的库存数量；18 岁时人的身高等。</p>
<h4 id="特点-1"><a href="#特点-1" class="headerlink" title="特点"></a>特点</h4><p>状态能被改变，改变了之后视图会有对应的变化。</p>
<h4 id="作用"><a href="#作用" class="headerlink" title="作用"></a>作用</h4><ul>
<li>保存数据。</li>
<li>数据变化响应到视图（React 包内部的操作）。</li>
</ul>
<h3 id="有状态-无状态组件"><a href="#有状态-无状态组件" class="headerlink" title="有状态/无状态组件"></a>有状态/无状态组件</h3><ul>
<li>有状态组件：能定义 state 的组件，类组件就是<strong>有状态组件</strong>。</li>
<li>无状态组件：不能定义 state 的组件，函数组件一般叫做<strong>无状态组件</strong>。</li>
</ul>
<blockquote>
<p>2019 年 02 月 06 日，React v16.8 中引入了 React Hooks，从而函数式组件也能定义自己的状态了。</p>
</blockquote>
<h3 id="无状态组件的应用场景"><a href="#无状态组件的应用场景" class="headerlink" title="无状态组件的应用场景"></a>无状态组件的应用场景</h3><ul>
<li>组件本身就不需要有状态，例如渲染一段静态的内容。</li>
<li>组件本身就没有状态，有可能只需要从外部传入的状态就够了。</li>
</ul>
<h2 id="类组件的状态"><a href="#类组件的状态" class="headerlink" title="类组件的状态"></a>类组件的状态</h2><h3 id="定义"><a href="#定义" class="headerlink" title="定义"></a>定义</h3><p>第一种方式：在 constructor 中通过 <code>this.state = &#123;&#125;</code>。</p>
<pre class="language-js" data-language="js"><code class="language-js"><span class="token keyword">class</span> <span class="token class-name">App</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span> <span class="token punctuation">&#123;</span>
    <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
            <span class="token literal-property property">list</span><span class="token operator">:</span> <span class="token punctuation">[</span>
                <span class="token punctuation">&#123;</span> <span class="token literal-property property">id</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'明天会更好'</span> <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
                <span class="token punctuation">&#123;</span> <span class="token literal-property property">id</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'今天'</span> <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
            <span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span></code></pre>



<p>第二种方式：通过 state 来定义状态，<strong>state 对应的值必须是一个对象</strong>。</p>
<pre class="language-js" data-language="js"><code class="language-js"><span class="token keyword">class</span> <span class="token class-name">App</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span> <span class="token punctuation">&#123;</span>
    state <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
        <span class="token literal-property property">list</span><span class="token operator">:</span> <span class="token punctuation">[</span>
            <span class="token punctuation">&#123;</span> <span class="token literal-property property">id</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'明天会更好'</span> <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
            <span class="token punctuation">&#123;</span> <span class="token literal-property property">id</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'今天'</span> <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
        <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">&#125;</span>
    <span class="token comment">// ...</span>
<span class="token punctuation">&#125;</span></code></pre>



<blockquote>
<p>思考两种方式的差异？</p>
</blockquote>
<h3 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h3><pre class="language-js" data-language="js"><code class="language-js"><span class="token keyword">class</span> <span class="token class-name">App</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span> <span class="token punctuation">&#123;</span>
    <span class="token comment">// ...</span>
    <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> <span class="token punctuation">(</span>
            <span class="token operator">&lt;</span><span class="token operator">></span>
                <span class="token operator">&lt;</span>h1<span class="token operator">></span>歌曲数量：<span class="token punctuation">&#123;</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>list<span class="token punctuation">.</span>length<span class="token punctuation">&#125;</span><span class="token operator">&lt;</span><span class="token operator">/</span>h1<span class="token operator">></span>
                <span class="token operator">&lt;</span>ul<span class="token operator">></span>
                    <span class="token punctuation">&#123;</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>list<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">item</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">(</span>
                        <span class="token operator">&lt;</span>li key<span class="token operator">=</span><span class="token punctuation">&#123;</span>item<span class="token punctuation">.</span>id<span class="token punctuation">&#125;</span><span class="token operator">></span><span class="token punctuation">&#123;</span>item<span class="token punctuation">.</span>name<span class="token punctuation">&#125;</span><span class="token operator">&lt;</span><span class="token operator">/</span>li<span class="token operator">></span>
                    <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span>
                <span class="token operator">&lt;</span><span class="token operator">/</span>ul<span class="token operator">></span>
            <span class="token operator">&lt;</span><span class="token operator">/</span><span class="token operator">></span>
        <span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span></code></pre>

<h2 id="事件绑定"><a href="#事件绑定" class="headerlink" title="事件绑定"></a>事件绑定</h2><h3 id="语法"><a href="#语法" class="headerlink" title="语法"></a>语法</h3><pre class="language-js" data-language="js"><code class="language-js"><span class="token operator">&lt;</span>元素 事件名<span class="token number">1</span><span class="token operator">=</span><span class="token punctuation">&#123;</span>事件处理函数<span class="token number">1</span><span class="token punctuation">&#125;</span> 事件名<span class="token number">2</span><span class="token operator">=</span><span class="token punctuation">&#123;</span>事件处理函数<span class="token number">2</span><span class="token punctuation">&#125;</span><span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>元素<span class="token operator">></span></code></pre>



<p>注意：React 事件名采用驼峰命名法，比如 onClick、onMouseEnter 等。</p>
<h3 id="类组件中事件绑定"><a href="#类组件中事件绑定" class="headerlink" title="类组件中事件绑定"></a>类组件中事件绑定</h3><p>需求：点击按钮控制台打印 ‘Hello World’。</p>
<pre class="language-js" data-language="js"><code class="language-js"><span class="token keyword">class</span> <span class="token class-name">App</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span> <span class="token punctuation">&#123;</span>
    <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> <span class="token punctuation">(</span>
            <span class="token operator">&lt;</span>button
                onClick<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
                    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Hello World'</span><span class="token punctuation">)</span>
                <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span>
            <span class="token operator">></span>
                click
            <span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">></span>
        <span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span></code></pre>



<p>也可以把事件处理函数进行提取。</p>
<pre class="language-js" data-language="js"><code class="language-js"><span class="token keyword">class</span> <span class="token class-name">App</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span> <span class="token punctuation">&#123;</span>
    <span class="token function">handleClick</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Hello World'</span><span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span>
    <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> <span class="token operator">&lt;</span>button onClick<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token keyword">this</span><span class="token punctuation">.</span>handleClick<span class="token punctuation">&#125;</span><span class="token operator">></span>click<span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">></span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span></code></pre>



<h3 id="函数式组件中的事件绑定"><a href="#函数式组件中的事件绑定" class="headerlink" title="函数式组件中的事件绑定"></a>函数式组件中的事件绑定</h3><pre class="language-js" data-language="js"><code class="language-js"><span class="token keyword">const</span> <span class="token function-variable function">App</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">const</span> <span class="token function-variable function">handleClick</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Hello World'</span><span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span>
    <span class="token keyword">return</span> <span class="token operator">&lt;</span>button onClick<span class="token operator">=</span><span class="token punctuation">&#123;</span>handleClick<span class="token punctuation">&#125;</span><span class="token operator">></span>click<span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">></span>
<span class="token punctuation">&#125;</span></code></pre>

<h3 id="获得事件对象"><a href="#获得事件对象" class="headerlink" title="获得事件对象"></a>获得事件对象</h3><p>通过形参 <code>e</code> 可以拿到事件对象，例如 <code>e.target</code> 就是触发事件的那个 DOM 元素。</p>
<h2 id="解决-this-指向问题"><a href="#解决-this-指向问题" class="headerlink" title="解决 this 指向问题"></a>解决 this 指向问题</h2><h3 id="方法-1"><a href="#方法-1" class="headerlink" title="方法 1"></a>方法 1</h3><p>高阶函数：通过 this 来直接<strong>调用</strong> handleClick 并返回箭头函数。</p>
<p>🧐 柯里化：通过函数调用继续返回函数的形式，实现多次接收参数最后统一处理的函数编码形式。</p>
<pre class="language-js" data-language="js"><code class="language-js"><span class="token keyword">class</span> <span class="token class-name">App</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span> <span class="token punctuation">&#123;</span>
    state <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
        <span class="token literal-property property">count</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
    <span class="token punctuation">&#125;</span>
    <span class="token function">handleClick</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token comment">// 这里的 this 指向是什么？那就看是谁调用的！</span>
        <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>count<span class="token punctuation">)</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> <span class="token punctuation">(</span>
            <span class="token operator">&lt;</span>div<span class="token operator">></span>
                <span class="token operator">&lt;</span>h2<span class="token operator">></span>计数器：<span class="token punctuation">&#123;</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>count<span class="token punctuation">&#125;</span><span class="token operator">&lt;</span><span class="token operator">/</span>h2<span class="token operator">></span>
                <span class="token operator">&lt;</span>button onClick<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">handleClick</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token operator">></span><span class="token operator">+</span><span class="token number">1</span><span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">></span>
            <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span>
        <span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span></code></pre>



<h3 id="方法-2"><a href="#方法-2" class="headerlink" title="方法 2"></a>方法 2</h3><p>包裹一层箭头函数。</p>
<p>箭头函数中的 this 指向“外部”，即 render 函数，而 render 函数中的 this 正是组件实例。</p>
<pre class="language-js" data-language="js"><code class="language-js"><span class="token keyword">class</span> <span class="token class-name">App</span> <span class="token keyword">extends</span> <span class="token class-name">Component</span> <span class="token punctuation">&#123;</span>
    state <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
        <span class="token literal-property property">count</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
    <span class="token punctuation">&#125;</span>
    <span class="token function">handleClick</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>count<span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span>
    <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> <span class="token punctuation">(</span>
            <span class="token operator">&lt;</span>div<span class="token operator">></span>
                <span class="token operator">&lt;</span>h2<span class="token operator">></span>计数器：<span class="token punctuation">&#123;</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>count<span class="token punctuation">&#125;</span><span class="token operator">&lt;</span><span class="token operator">/</span>h2<span class="token operator">></span>
                <span class="token operator">&lt;</span>button onClick<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">handleClick</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token operator">></span><span class="token operator">+</span><span class="token number">1</span><span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">></span>
            <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span>
        <span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span></code></pre>



<h3 id="方法-3"><a href="#方法-3" class="headerlink" title="方法 3"></a>方法 3</h3><p>使用 bind。</p>
<pre class="language-js" data-language="js"><code class="language-js"><span class="token keyword">class</span> <span class="token class-name">App</span> <span class="token keyword">extends</span> <span class="token class-name">Component</span> <span class="token punctuation">&#123;</span>
    state <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
        <span class="token literal-property property">count</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
    <span class="token punctuation">&#125;</span>
    <span class="token function">handleClick</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>count<span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span>
    <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> <span class="token punctuation">(</span>
            <span class="token operator">&lt;</span>div<span class="token operator">></span>
                <span class="token operator">&lt;</span>h2<span class="token operator">></span>计数器：<span class="token punctuation">&#123;</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>count<span class="token punctuation">&#125;</span><span class="token operator">&lt;</span><span class="token operator">/</span>h2<span class="token operator">></span>
                <span class="token operator">&lt;</span>button onClick<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">handleClick</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token operator">></span><span class="token operator">+</span><span class="token number">1</span><span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">></span>
            <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span>
        <span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span></code></pre>



<h3 id="扩展"><a href="#扩展" class="headerlink" title="扩展"></a>扩展</h3><p>🤔 关于 class 中的实例方法和原型方法？</p>
<p>原型方法演示</p>
<pre class="language-js" data-language="js"><code class="language-js"><span class="token keyword">class</span> <span class="token class-name">App</span> <span class="token punctuation">&#123;</span>
    <span class="token function">handleClick</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">const</span> app1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">App</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> app2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">App</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment">// 通过打印也能发现 handleClick 确实是挂载到原型上的</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>app1<span class="token punctuation">)</span>
<span class="token comment">// 每一个实例访问到的都是挂载到原型上的方法，所以等价</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>app1<span class="token punctuation">.</span>handleClick <span class="token operator">===</span> app2<span class="token punctuation">.</span>handleClick<span class="token punctuation">)</span></code></pre>



<p>实例方法演示</p>
<pre class="language-js" data-language="js"><code class="language-js"><span class="token keyword">class</span> <span class="token class-name">App</span> <span class="token punctuation">&#123;</span>
    <span class="token function-variable function">handleClick</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">const</span> app1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">App</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> app2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">App</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment">// 通过打印也能发现 handleClick 确实是挂载到实例上的</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>app1<span class="token punctuation">)</span>
<span class="token comment">// 每一个实例访问到的都是挂载到自己上的方法，所以不等价</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>app1<span class="token punctuation">.</span>handleClick <span class="token operator">===</span> app2<span class="token punctuation">.</span>handleClick<span class="token punctuation">)</span></code></pre>



<p>所以，要明白在 class 中直接写的方法和通过赋值语句添加的方法本质上不一样。</p>
<p><strong>注意：在 constructor 中挂载的方法也是实例方法。</strong></p>
<h3 id="方法-4"><a href="#方法-4" class="headerlink" title="方法 4"></a>方法 4</h3><p>通过赋值语句往<strong>实例</strong>上面添加一个箭头函数。</p>
<pre class="language-js" data-language="js"><code class="language-js"><span class="token keyword">class</span> <span class="token class-name">App</span> <span class="token keyword">extends</span> <span class="token class-name">Component</span> <span class="token punctuation">&#123;</span>
    state <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
        <span class="token literal-property property">count</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
    <span class="token punctuation">&#125;</span>
    <span class="token function-variable function">handleClick</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>count<span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span>
    <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> <span class="token punctuation">(</span>
            <span class="token operator">&lt;</span>div<span class="token operator">></span>
                <span class="token operator">&lt;</span>h2<span class="token operator">></span>计数器：<span class="token punctuation">&#123;</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>count<span class="token punctuation">&#125;</span><span class="token operator">&lt;</span><span class="token operator">/</span>h2<span class="token operator">></span>
                <span class="token operator">&lt;</span>button onClick<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token keyword">this</span><span class="token punctuation">.</span>handleClick<span class="token punctuation">&#125;</span><span class="token operator">></span><span class="token operator">+</span><span class="token number">1</span><span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">></span>
            <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span>
        <span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span></code></pre>



<p>证明“外层” this 确实是组件实例</p>
<pre class="language-js" data-language="js"><code class="language-js"><span class="token keyword">class</span> <span class="token class-name">App</span> <span class="token punctuation">&#123;</span>
    temp <span class="token operator">=</span> <span class="token keyword">this</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">App</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>app <span class="token operator">===</span> app<span class="token punctuation">.</span>temp<span class="token punctuation">)</span></code></pre>



<h3 id="方法-5"><a href="#方法-5" class="headerlink" title="方法 5"></a>方法 5</h3><p>在构造函数中再创建一个实例方法，和原型方法公用一个函数体。</p>
<pre class="language-js" data-language="js"><code class="language-js"><span class="token keyword">class</span> <span class="token class-name">App</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span> <span class="token punctuation">&#123;</span>
    <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
            <span class="token literal-property property">count</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
        <span class="token punctuation">&#125;</span>
        <span class="token comment">// 1. 往实例自身上又挂载了一个 handleClick 函数</span>
        <span class="token comment">// 2. 此函数的函数体是通过原型上 handleClick 函数生成的新函数</span>
        <span class="token comment">// 3. 并把原型上 handleClick 函数中的 this 通过 bind 绑定为了 this，而这里构造函数中的 this 正是实例对象</span>
        <span class="token comment">// 4. 其实点击的时候调用的是这个构造函数 handleClick（就近原则），而这个构造函数中的 handleClick 执行的是原型上的 handleClick 的函数体</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>handleClick <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">handleClick</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span>
    <span class="token function">handleClick</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>count<span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span>
    <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> <span class="token punctuation">(</span>
            <span class="token operator">&lt;</span>div<span class="token operator">></span>
                <span class="token operator">&lt;</span>h2<span class="token operator">></span>计数器：<span class="token punctuation">&#123;</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>count<span class="token punctuation">&#125;</span><span class="token operator">&lt;</span><span class="token operator">/</span>h2<span class="token operator">></span>
                <span class="token operator">&lt;</span>button onClick<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token keyword">this</span><span class="token punctuation">.</span>handleClick<span class="token punctuation">&#125;</span><span class="token operator">></span><span class="token operator">+</span><span class="token number">1</span><span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">></span>
            <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span>
        <span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span></code></pre>

<h2 id="修改状态"><a href="#修改状态" class="headerlink" title="修改状态"></a>修改状态</h2><h3 id="错误写法"><a href="#错误写法" class="headerlink" title="错误写法"></a>错误写法</h3><pre class="language-js" data-language="js"><code class="language-js"><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>count <span class="token operator">+=</span> <span class="token number">1</span> <span class="token comment">// 数据确实也会变，但不是响应式的！</span></code></pre>



<h3 id="内容"><a href="#内容" class="headerlink" title="内容"></a>内容</h3><ul>
<li>语法：<code>this.setState(&#123; 要修改的部分数据 &#125;)</code>。</li>
<li>作用：修改 state 并更新视图。</li>
<li>来源：<code>setState()</code> 函数是通过继承而来的。</li>
<li>注意：<code>setState()</code> 的操作是合并，不会影响没有操作到的数据。</li>
</ul>
<pre class="language-js" data-language="js"><code class="language-js"><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span> <span class="token literal-property property">count</span><span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>count <span class="token operator">+</span> <span class="token number">1</span> <span class="token punctuation">&#125;</span><span class="token punctuation">)</span></code></pre>



<h2 id="状态的不可变性"><a href="#状态的不可变性" class="headerlink" title="状态的不可变性"></a>状态的不可变性</h2><h3 id="解释"><a href="#解释" class="headerlink" title="解释"></a>解释</h3><p>也就是说不要<strong>直接修改</strong>原数据，而是要<strong>产生一份新数据</strong>，然后通过 <code>setState()</code> 用新的数据覆盖原数据，这么做的其中一个重要原因就是为了 SCU（shouldComponentUpdate），为了性能优化。</p>
<h3 id="不建议写法"><a href="#不建议写法" class="headerlink" title="不建议写法"></a>不建议写法</h3><pre class="language-js" data-language="js"><code class="language-js"><span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">&#123;</span> Component <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'react'</span>
<span class="token keyword">import</span> ReactDOM <span class="token keyword">from</span> <span class="token string">'react-dom'</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">App</span> <span class="token keyword">extends</span> <span class="token class-name">Component</span> <span class="token punctuation">&#123;</span>
    state <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
        <span class="token literal-property property">count</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
        <span class="token literal-property property">list</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token literal-property property">person</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
            <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'jack'</span><span class="token punctuation">,</span>
            <span class="token literal-property property">age</span><span class="token operator">:</span> <span class="token number">18</span><span class="token punctuation">,</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
    <span class="token punctuation">&#125;</span>
    <span class="token function-variable function">changeCount</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>count<span class="token operator">++</span>
        <span class="token comment">// 不要上面的写法，即便通过下面的操作也能做到更新视图</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
            <span class="token literal-property property">count</span><span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>count<span class="token punctuation">,</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span>
    <span class="token function-variable function">changeList</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>list<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token string">'Hello React'</span><span class="token punctuation">)</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
            <span class="token literal-property property">list</span><span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>list<span class="token punctuation">,</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span>
    <span class="token function-variable function">changePerson</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>person<span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">'ifer'</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>person<span class="token punctuation">.</span>age <span class="token operator">=</span> <span class="token number">19</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
            <span class="token literal-property property">person</span><span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>person<span class="token punctuation">,</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span>
    <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> <span class="token punctuation">(</span>
            <span class="token operator">&lt;</span>div<span class="token operator">></span>
                <span class="token operator">&lt;</span>h3<span class="token operator">></span>count<span class="token operator">&lt;</span><span class="token operator">/</span>h3<span class="token operator">></span>
                <span class="token operator">&lt;</span>p<span class="token operator">></span><span class="token punctuation">&#123;</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>count<span class="token punctuation">&#125;</span><span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">></span>
                <span class="token operator">&lt;</span>button onClick<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token keyword">this</span><span class="token punctuation">.</span>changeCount<span class="token punctuation">&#125;</span><span class="token operator">></span>click<span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">></span>
                <span class="token operator">&lt;</span>hr <span class="token operator">/</span><span class="token operator">></span>
                <span class="token operator">&lt;</span>h3<span class="token operator">></span>list<span class="token operator">&lt;</span><span class="token operator">/</span>h3<span class="token operator">></span>
                <span class="token operator">&lt;</span>ul<span class="token operator">></span>
                    <span class="token punctuation">&#123;</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>list<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">item<span class="token punctuation">,</span> index</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">(</span>
                        <span class="token operator">&lt;</span>li key<span class="token operator">=</span><span class="token punctuation">&#123;</span>index<span class="token punctuation">&#125;</span><span class="token operator">></span><span class="token punctuation">&#123;</span>item<span class="token punctuation">&#125;</span><span class="token operator">&lt;</span><span class="token operator">/</span>li<span class="token operator">></span>
                    <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span>
                <span class="token operator">&lt;</span><span class="token operator">/</span>ul<span class="token operator">></span>
                <span class="token operator">&lt;</span>button onClick<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token keyword">this</span><span class="token punctuation">.</span>changeList<span class="token punctuation">&#125;</span><span class="token operator">></span>click<span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">></span>
                <span class="token operator">&lt;</span>hr <span class="token operator">/</span><span class="token operator">></span>
                <span class="token operator">&lt;</span>h3<span class="token operator">></span>person<span class="token operator">&lt;</span><span class="token operator">/</span>h3<span class="token operator">></span>
                <span class="token operator">&lt;</span>p<span class="token operator">></span>
                    <span class="token punctuation">&#123;</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>person<span class="token punctuation">.</span>name<span class="token punctuation">&#125;</span> <span class="token punctuation">&#123;</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>person<span class="token punctuation">.</span>age<span class="token punctuation">&#125;</span>
                <span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">></span>
                <span class="token operator">&lt;</span>button onClick<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token keyword">this</span><span class="token punctuation">.</span>changePerson<span class="token punctuation">&#125;</span><span class="token operator">></span>click<span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">></span>
            <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span>
        <span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

ReactDOM<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token operator">&lt;</span>App <span class="token operator">/</span><span class="token operator">></span><span class="token punctuation">,</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'#root'</span><span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre>



<h3 id="建议写法"><a href="#建议写法" class="headerlink" title="建议写法"></a>建议写法</h3><pre class="language-js" data-language="js"><code class="language-js"><span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">&#123;</span> Component <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'react'</span>
<span class="token keyword">import</span> ReactDOM <span class="token keyword">from</span> <span class="token string">'react-dom'</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">App</span> <span class="token keyword">extends</span> <span class="token class-name">Component</span> <span class="token punctuation">&#123;</span>
    state <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
        <span class="token literal-property property">count</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
        <span class="token literal-property property">list</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token literal-property property">person</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
            <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'jack'</span><span class="token punctuation">,</span>
            <span class="token literal-property property">age</span><span class="token operator">:</span> <span class="token number">18</span><span class="token punctuation">,</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
    <span class="token punctuation">&#125;</span>
    <span class="token function-variable function">changeCount</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
            <span class="token literal-property property">count</span><span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>count <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span>
    <span class="token function-variable function">changeList</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
            <span class="token literal-property property">list</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token operator">...</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>list<span class="token punctuation">,</span> <span class="token string">'Hello React'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span>
    <span class="token function-variable function">changePerson</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
            <span class="token literal-property property">person</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
                <span class="token operator">...</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>person<span class="token punctuation">,</span>
                <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'ifer'</span><span class="token punctuation">,</span>
                <span class="token literal-property property">age</span><span class="token operator">:</span> <span class="token number">19</span><span class="token punctuation">,</span>
            <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span>
    <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> <span class="token punctuation">(</span>
            <span class="token operator">&lt;</span>div<span class="token operator">></span>
                <span class="token operator">&lt;</span>h3<span class="token operator">></span>count<span class="token operator">&lt;</span><span class="token operator">/</span>h3<span class="token operator">></span>
                <span class="token operator">&lt;</span>p<span class="token operator">></span><span class="token punctuation">&#123;</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>count<span class="token punctuation">&#125;</span><span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">></span>
                <span class="token operator">&lt;</span>button onClick<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token keyword">this</span><span class="token punctuation">.</span>changeCount<span class="token punctuation">&#125;</span><span class="token operator">></span>click<span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">></span>
                <span class="token operator">&lt;</span>hr <span class="token operator">/</span><span class="token operator">></span>
                <span class="token operator">&lt;</span>h3<span class="token operator">></span>list<span class="token operator">&lt;</span><span class="token operator">/</span>h3<span class="token operator">></span>
                <span class="token operator">&lt;</span>ul<span class="token operator">></span>
                    <span class="token punctuation">&#123;</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>list<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">item<span class="token punctuation">,</span> index</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">(</span>
                        <span class="token operator">&lt;</span>li key<span class="token operator">=</span><span class="token punctuation">&#123;</span>index<span class="token punctuation">&#125;</span><span class="token operator">></span><span class="token punctuation">&#123;</span>item<span class="token punctuation">&#125;</span><span class="token operator">&lt;</span><span class="token operator">/</span>li<span class="token operator">></span>
                    <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span>
                <span class="token operator">&lt;</span><span class="token operator">/</span>ul<span class="token operator">></span>
                <span class="token operator">&lt;</span>button onClick<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token keyword">this</span><span class="token punctuation">.</span>changeList<span class="token punctuation">&#125;</span><span class="token operator">></span>click<span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">></span>
                <span class="token operator">&lt;</span>hr <span class="token operator">/</span><span class="token operator">></span>
                <span class="token operator">&lt;</span>h3<span class="token operator">></span>person<span class="token operator">&lt;</span><span class="token operator">/</span>h3<span class="token operator">></span>
                <span class="token operator">&lt;</span>p<span class="token operator">></span>
                    <span class="token punctuation">&#123;</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>person<span class="token punctuation">.</span>name<span class="token punctuation">&#125;</span> <span class="token punctuation">&#123;</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>person<span class="token punctuation">.</span>age<span class="token punctuation">&#125;</span>
                <span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">></span>
                <span class="token operator">&lt;</span>button onClick<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token keyword">this</span><span class="token punctuation">.</span>changePerson<span class="token punctuation">&#125;</span><span class="token operator">></span>click<span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">></span>
            <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span>
        <span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

ReactDOM<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token operator">&lt;</span>App <span class="token operator">/</span><span class="token operator">></span><span class="token punctuation">,</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'#root'</span><span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre>

<h2 id="受控表单组件"><a href="#受控表单组件" class="headerlink" title="受控表单组件"></a>受控表单组件</h2><img src="https://zhihur.com/resource/images/ifer_form.png">

<h3 id="概念-2"><a href="#概念-2" class="headerlink" title="概念"></a>概念</h3><p>受控不受控一般是针对表单来说的，所谓受控表单组件，即表单元素的 value 值受到了 React 中状态（state）的控制（对状态的操作会影响视图，视图的变化又会反映到状态上）。</p>
<h3 id="input"><a href="#input" class="headerlink" title="input"></a>input</h3><ol>
<li>在 state 中添加一个状态，作为表单元素的 value 值（数据影响视图）。</li>
<li>给表单元素绑定 onChange 事件，将表单元素的值设置为 state 的值（视图影响数据）。</li>
</ol>
<pre class="language-js" data-language="js"><code class="language-js"><span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">'react'</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">App</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span> <span class="token punctuation">&#123;</span>
    state <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
        <span class="token literal-property property">username</span><span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span>
    <span class="token punctuation">&#125;</span>
    <span class="token function-variable function">changeText</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
            <span class="token literal-property property">username</span><span class="token operator">:</span> e<span class="token punctuation">.</span>target<span class="token punctuation">.</span>value<span class="token punctuation">,</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span>
    <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">const</span> <span class="token punctuation">&#123;</span> username <span class="token punctuation">&#125;</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>state
        <span class="token keyword">return</span> <span class="token punctuation">(</span>
            <span class="token operator">&lt;</span>ul<span class="token operator">></span>
                <span class="token operator">&lt;</span>li<span class="token operator">></span>
                    <span class="token operator">&lt;</span>label htmlFor<span class="token operator">=</span><span class="token string">'username'</span><span class="token operator">></span>用户名<span class="token operator">&lt;</span><span class="token operator">/</span>label<span class="token operator">></span>
                    <span class="token operator">&lt;</span>input id<span class="token operator">=</span><span class="token string">'username'</span> type<span class="token operator">=</span><span class="token string">'text'</span> value<span class="token operator">=</span><span class="token punctuation">&#123;</span>username<span class="token punctuation">&#125;</span> onChange<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token keyword">this</span><span class="token punctuation">.</span>changeText<span class="token punctuation">&#125;</span> <span class="token operator">/</span><span class="token operator">></span>
                <span class="token operator">&lt;</span><span class="token operator">/</span>li<span class="token operator">></span>
            <span class="token operator">&lt;</span><span class="token operator">/</span>ul<span class="token operator">></span>
        <span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span></code></pre>



<h3 id="textarea"><a href="#textarea" class="headerlink" title="textarea"></a>textarea</h3><p>操作方式和 input 框一样。</p>
<pre class="language-js" data-language="js"><code class="language-js"><span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">'react'</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">App</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span> <span class="token punctuation">&#123;</span>
    state <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
        <span class="token literal-property property">content</span><span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span>
    <span class="token punctuation">&#125;</span>
    <span class="token function-variable function">changeTextArea</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
            <span class="token literal-property property">content</span><span class="token operator">:</span> e<span class="token punctuation">.</span>target<span class="token punctuation">.</span>value<span class="token punctuation">,</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span>
    <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">const</span> <span class="token punctuation">&#123;</span> content <span class="token punctuation">&#125;</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>state
        <span class="token keyword">return</span> <span class="token punctuation">(</span>
            <span class="token operator">&lt;</span>ul<span class="token operator">></span>
                <span class="token punctuation">&#123;</span><span class="token comment">/* ... */</span><span class="token punctuation">&#125;</span>
                <span class="token operator">&lt;</span>li<span class="token operator">></span>
                    <span class="token operator">&lt;</span>label htmlFor<span class="token operator">=</span><span class="token string">'content'</span><span class="token operator">></span>其他信息<span class="token operator">&lt;</span><span class="token operator">/</span>label<span class="token operator">></span>
                    <span class="token operator">&lt;</span>textarea id<span class="token operator">=</span><span class="token string">'content'</span> cols<span class="token operator">=</span><span class="token string">'30'</span> rows<span class="token operator">=</span><span class="token string">'10'</span> value<span class="token operator">=</span><span class="token punctuation">&#123;</span>content<span class="token punctuation">&#125;</span> onChange<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token keyword">this</span><span class="token punctuation">.</span>changeTextArea<span class="token punctuation">&#125;</span><span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>textarea<span class="token operator">></span>
                <span class="token operator">&lt;</span><span class="token operator">/</span>li<span class="token operator">></span>
            <span class="token operator">&lt;</span><span class="token operator">/</span>ul<span class="token operator">></span>
        <span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span></code></pre>



<h3 id="select"><a href="#select" class="headerlink" title="select"></a>select</h3><pre class="language-js" data-language="js"><code class="language-js"><span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">'react'</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">App</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span> <span class="token punctuation">&#123;</span>
    state <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
        <span class="token literal-property property">frame</span><span class="token operator">:</span> <span class="token string">'react'</span><span class="token punctuation">,</span>
    <span class="token punctuation">&#125;</span>
    <span class="token function-variable function">changeOption</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
            <span class="token literal-property property">frame</span><span class="token operator">:</span> e<span class="token punctuation">.</span>target<span class="token punctuation">.</span>value<span class="token punctuation">,</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span>
    <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">const</span> <span class="token punctuation">&#123;</span> frame <span class="token punctuation">&#125;</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>state
        <span class="token keyword">return</span> <span class="token punctuation">(</span>
            <span class="token operator">&lt;</span>ul<span class="token operator">></span>
                <span class="token punctuation">&#123;</span><span class="token comment">/* ... */</span><span class="token punctuation">&#125;</span>
                <span class="token operator">&lt;</span>li<span class="token operator">></span>
                    <span class="token operator">&lt;</span>label htmlFor<span class="token operator">=</span><span class="token string">'frame'</span><span class="token operator">></span>框架<span class="token operator">&lt;</span><span class="token operator">/</span>label<span class="token operator">></span>
                    <span class="token operator">&lt;</span>select id<span class="token operator">=</span><span class="token string">'frame'</span> value<span class="token operator">=</span><span class="token punctuation">&#123;</span>frame<span class="token punctuation">&#125;</span> onChange<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token keyword">this</span><span class="token punctuation">.</span>changeOption<span class="token punctuation">&#125;</span><span class="token operator">></span>
                        <span class="token operator">&lt;</span>option value<span class="token operator">=</span><span class="token string">'vue'</span><span class="token operator">></span>Vue<span class="token operator">&lt;</span><span class="token operator">/</span>option<span class="token operator">></span>
                        <span class="token operator">&lt;</span>option value<span class="token operator">=</span><span class="token string">'react'</span><span class="token operator">></span>React<span class="token operator">&lt;</span><span class="token operator">/</span>option<span class="token operator">></span>
                        <span class="token operator">&lt;</span>option value<span class="token operator">=</span><span class="token string">'angular'</span><span class="token operator">></span>Angular<span class="token operator">&lt;</span><span class="token operator">/</span>option<span class="token operator">></span>
                    <span class="token operator">&lt;</span><span class="token operator">/</span>select<span class="token operator">></span>
                <span class="token operator">&lt;</span><span class="token operator">/</span>li<span class="token operator">></span>
            <span class="token operator">&lt;</span><span class="token operator">/</span>ul<span class="token operator">></span>
        <span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span></code></pre>



<h3 id="radio"><a href="#radio" class="headerlink" title="radio"></a>radio</h3><p>多个单选按钮，绑定的值可以是一个字符串。</p>
<pre class="language-js" data-language="js"><code class="language-js"><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">App</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span> <span class="token punctuation">&#123;</span>
    state <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
        <span class="token literal-property property">checkedRadio</span><span class="token operator">:</span> <span class="token string">'male'</span><span class="token punctuation">,</span>
    <span class="token punctuation">&#125;</span>
    <span class="token function-variable function">changeRadio</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
            <span class="token literal-property property">checkedRadio</span><span class="token operator">:</span> e<span class="token punctuation">.</span>target<span class="token punctuation">.</span>value<span class="token punctuation">,</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span>
    <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">const</span> <span class="token punctuation">&#123;</span> checkedRadio <span class="token punctuation">&#125;</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>state
        <span class="token keyword">return</span> <span class="token punctuation">(</span>
            <span class="token operator">&lt;</span>ul<span class="token operator">></span>
                <span class="token punctuation">&#123;</span><span class="token comment">/* ... */</span><span class="token punctuation">&#125;</span>
                <span class="token operator">&lt;</span>li<span class="token operator">></span>
                    <span class="token operator">&lt;</span>input id<span class="token operator">=</span><span class="token string">'male'</span> type<span class="token operator">=</span><span class="token string">'radio'</span> value<span class="token operator">=</span><span class="token string">'male'</span> checked<span class="token operator">=</span><span class="token punctuation">&#123;</span>checkedRadio <span class="token operator">===</span> <span class="token string">'male'</span><span class="token punctuation">&#125;</span> onChange<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token keyword">this</span><span class="token punctuation">.</span>changeRadio<span class="token punctuation">&#125;</span> <span class="token operator">/</span><span class="token operator">></span>
                    <span class="token operator">&lt;</span>label htmlFor<span class="token operator">=</span><span class="token string">'male'</span><span class="token operator">></span>男<span class="token operator">&lt;</span><span class="token operator">/</span>label<span class="token operator">></span>
                    <span class="token operator">&lt;</span>input id<span class="token operator">=</span><span class="token string">'female'</span> type<span class="token operator">=</span><span class="token string">'radio'</span> value<span class="token operator">=</span><span class="token string">'female'</span> checked<span class="token operator">=</span><span class="token punctuation">&#123;</span>checkedRadio <span class="token operator">===</span> <span class="token string">'female'</span><span class="token punctuation">&#125;</span> onChange<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token keyword">this</span><span class="token punctuation">.</span>changeRadio<span class="token punctuation">&#125;</span> <span class="token operator">/</span><span class="token operator">></span>
                    <span class="token operator">&lt;</span>label htmlFor<span class="token operator">=</span><span class="token string">'female'</span><span class="token operator">></span>女<span class="token operator">&lt;</span><span class="token operator">/</span>label<span class="token operator">></span>
                    <span class="token operator">&lt;</span>input id<span class="token operator">=</span><span class="token string">'unknow'</span> type<span class="token operator">=</span><span class="token string">'radio'</span> value<span class="token operator">=</span><span class="token string">'unknow'</span> checked<span class="token operator">=</span><span class="token punctuation">&#123;</span>checkedRadio <span class="token operator">===</span> <span class="token string">'unknow'</span><span class="token punctuation">&#125;</span> onChange<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token keyword">this</span><span class="token punctuation">.</span>changeRadio<span class="token punctuation">&#125;</span> <span class="token operator">/</span><span class="token operator">></span>
                    <span class="token operator">&lt;</span>label htmlFor<span class="token operator">=</span><span class="token string">'unknow'</span><span class="token operator">></span>未知<span class="token operator">&lt;</span><span class="token operator">/</span>label<span class="token operator">></span>
                <span class="token operator">&lt;</span><span class="token operator">/</span>li<span class="token operator">></span>
            <span class="token operator">&lt;</span><span class="token operator">/</span>ul<span class="token operator">></span>
        <span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span></code></pre>



<h3 id="checkbox"><a href="#checkbox" class="headerlink" title="checkbox"></a>checkbox</h3><p>绑定的值可以是一个数组。</p>
<pre class="language-js" data-language="js"><code class="language-js"><span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">'react'</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">App</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span> <span class="token punctuation">&#123;</span>
    state <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
        <span class="token literal-property property">username</span><span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span>
        <span class="token literal-property property">content</span><span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span>
        <span class="token literal-property property">frame</span><span class="token operator">:</span> <span class="token string">'react'</span><span class="token punctuation">,</span>
        <span class="token literal-property property">checkedRadio</span><span class="token operator">:</span> <span class="token string">'male'</span><span class="token punctuation">,</span>
        <span class="token literal-property property">checkedFruit</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'apple'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">&#125;</span>
    <span class="token function-variable function">changeText</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
            <span class="token literal-property property">username</span><span class="token operator">:</span> e<span class="token punctuation">.</span>target<span class="token punctuation">.</span>value<span class="token punctuation">,</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span>
    <span class="token function-variable function">changeTextArea</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
            <span class="token literal-property property">content</span><span class="token operator">:</span> e<span class="token punctuation">.</span>target<span class="token punctuation">.</span>value<span class="token punctuation">,</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span>
    <span class="token function-variable function">changeOption</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
            <span class="token literal-property property">frame</span><span class="token operator">:</span> e<span class="token punctuation">.</span>target<span class="token punctuation">.</span>value<span class="token punctuation">,</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span>
    <span class="token function-variable function">changeRadio</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
            <span class="token literal-property property">checkedRadio</span><span class="token operator">:</span> e<span class="token punctuation">.</span>target<span class="token punctuation">.</span>value<span class="token punctuation">,</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span>
    <span class="token function-variable function">changeCheckBox</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">const</span> checkedFruit <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token operator">...</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>checkedFruit<span class="token punctuation">]</span>
        <span class="token keyword">const</span> idx <span class="token operator">=</span> checkedFruit<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>target<span class="token punctuation">.</span>value<span class="token punctuation">)</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>idx <span class="token operator">===</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token comment">// 数组中没有找到，说明没有被选中，那就把数据添加到数组，进行选中的操作</span>
            checkedFruit<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>target<span class="token punctuation">.</span>value<span class="token punctuation">)</span>
        <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
            <span class="token comment">// 找到了，说明已被选中，通过删除数组中的数据取消选中</span>
            checkedFruit<span class="token punctuation">.</span><span class="token function">splice</span><span class="token punctuation">(</span>idx<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
        <span class="token punctuation">&#125;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
            checkedFruit<span class="token punctuation">,</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span>
    <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">const</span> <span class="token punctuation">&#123;</span> username<span class="token punctuation">,</span> content<span class="token punctuation">,</span> frame<span class="token punctuation">,</span> checkedRadio<span class="token punctuation">,</span> checkedFruit <span class="token punctuation">&#125;</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>state
        <span class="token keyword">return</span> <span class="token punctuation">(</span>
            <span class="token operator">&lt;</span>ul<span class="token operator">></span>
                <span class="token operator">&lt;</span>li<span class="token operator">></span>
                    <span class="token operator">&lt;</span>label htmlFor<span class="token operator">=</span><span class="token string">'username'</span><span class="token operator">></span>用户名<span class="token operator">&lt;</span><span class="token operator">/</span>label<span class="token operator">></span>
                    <span class="token operator">&lt;</span>input id<span class="token operator">=</span><span class="token string">'username'</span> type<span class="token operator">=</span><span class="token string">'text'</span> value<span class="token operator">=</span><span class="token punctuation">&#123;</span>username<span class="token punctuation">&#125;</span> onChange<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token keyword">this</span><span class="token punctuation">.</span>changeText<span class="token punctuation">&#125;</span> <span class="token operator">/</span><span class="token operator">></span>
                <span class="token operator">&lt;</span><span class="token operator">/</span>li<span class="token operator">></span>
                <span class="token operator">&lt;</span>li<span class="token operator">></span>
                    <span class="token operator">&lt;</span>label htmlFor<span class="token operator">=</span><span class="token string">'content'</span><span class="token operator">></span>其他信息<span class="token operator">&lt;</span><span class="token operator">/</span>label<span class="token operator">></span>
                    <span class="token operator">&lt;</span>textarea id<span class="token operator">=</span><span class="token string">'content'</span> cols<span class="token operator">=</span><span class="token string">'30'</span> rows<span class="token operator">=</span><span class="token string">'10'</span> value<span class="token operator">=</span><span class="token punctuation">&#123;</span>content<span class="token punctuation">&#125;</span> onChange<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token keyword">this</span><span class="token punctuation">.</span>changeTextArea<span class="token punctuation">&#125;</span><span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>textarea<span class="token operator">></span>
                <span class="token operator">&lt;</span><span class="token operator">/</span>li<span class="token operator">></span>
                <span class="token operator">&lt;</span>li<span class="token operator">></span>
                    <span class="token operator">&lt;</span>label htmlFor<span class="token operator">=</span><span class="token string">'frame'</span><span class="token operator">></span>框架<span class="token operator">&lt;</span><span class="token operator">/</span>label<span class="token operator">></span>
                    <span class="token operator">&lt;</span>select id<span class="token operator">=</span><span class="token string">'frame'</span> value<span class="token operator">=</span><span class="token punctuation">&#123;</span>frame<span class="token punctuation">&#125;</span> onChange<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token keyword">this</span><span class="token punctuation">.</span>changeOption<span class="token punctuation">&#125;</span><span class="token operator">></span>
                        <span class="token operator">&lt;</span>option value<span class="token operator">=</span><span class="token string">'vue'</span><span class="token operator">></span>Vue<span class="token operator">&lt;</span><span class="token operator">/</span>option<span class="token operator">></span>
                        <span class="token operator">&lt;</span>option value<span class="token operator">=</span><span class="token string">'react'</span><span class="token operator">></span>React<span class="token operator">&lt;</span><span class="token operator">/</span>option<span class="token operator">></span>
                        <span class="token operator">&lt;</span>option value<span class="token operator">=</span><span class="token string">'angular'</span><span class="token operator">></span>Angular<span class="token operator">&lt;</span><span class="token operator">/</span>option<span class="token operator">></span>
                    <span class="token operator">&lt;</span><span class="token operator">/</span>select<span class="token operator">></span>
                <span class="token operator">&lt;</span><span class="token operator">/</span>li<span class="token operator">></span>
                <span class="token operator">&lt;</span>li<span class="token operator">></span>
                    <span class="token operator">&lt;</span>input id<span class="token operator">=</span><span class="token string">'male'</span> type<span class="token operator">=</span><span class="token string">'radio'</span> value<span class="token operator">=</span><span class="token string">'male'</span> checked<span class="token operator">=</span><span class="token punctuation">&#123;</span>checkedRadio <span class="token operator">===</span> <span class="token string">'male'</span><span class="token punctuation">&#125;</span> onChange<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token keyword">this</span><span class="token punctuation">.</span>changeRadio<span class="token punctuation">&#125;</span> <span class="token operator">/</span><span class="token operator">></span>
                    <span class="token operator">&lt;</span>label htmlFor<span class="token operator">=</span><span class="token string">'male'</span><span class="token operator">></span>男<span class="token operator">&lt;</span><span class="token operator">/</span>label<span class="token operator">></span>
                    <span class="token operator">&lt;</span>input id<span class="token operator">=</span><span class="token string">'female'</span> type<span class="token operator">=</span><span class="token string">'radio'</span> value<span class="token operator">=</span><span class="token string">'female'</span> checked<span class="token operator">=</span><span class="token punctuation">&#123;</span>checkedRadio <span class="token operator">===</span> <span class="token string">'female'</span><span class="token punctuation">&#125;</span> onChange<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token keyword">this</span><span class="token punctuation">.</span>changeRadio<span class="token punctuation">&#125;</span> <span class="token operator">/</span><span class="token operator">></span>
                    <span class="token operator">&lt;</span>label htmlFor<span class="token operator">=</span><span class="token string">'female'</span><span class="token operator">></span>女<span class="token operator">&lt;</span><span class="token operator">/</span>label<span class="token operator">></span>
                    <span class="token operator">&lt;</span>input id<span class="token operator">=</span><span class="token string">'unknow'</span> type<span class="token operator">=</span><span class="token string">'radio'</span> value<span class="token operator">=</span><span class="token string">'unknow'</span> checked<span class="token operator">=</span><span class="token punctuation">&#123;</span>checkedRadio <span class="token operator">===</span> <span class="token string">'unknow'</span><span class="token punctuation">&#125;</span> onChange<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token keyword">this</span><span class="token punctuation">.</span>changeRadio<span class="token punctuation">&#125;</span> <span class="token operator">/</span><span class="token operator">></span>
                    <span class="token operator">&lt;</span>label htmlFor<span class="token operator">=</span><span class="token string">'unknow'</span><span class="token operator">></span>未知<span class="token operator">&lt;</span><span class="token operator">/</span>label<span class="token operator">></span>
                <span class="token operator">&lt;</span><span class="token operator">/</span>li<span class="token operator">></span>
                <span class="token operator">&lt;</span>li<span class="token operator">></span>
                    <span class="token operator">&lt;</span>input id<span class="token operator">=</span><span class="token string">'apple'</span> type<span class="token operator">=</span><span class="token string">'checkbox'</span> value<span class="token operator">=</span><span class="token string">'apple'</span> checked<span class="token operator">=</span><span class="token punctuation">&#123;</span>checkedFruit<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span><span class="token string">'apple'</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span> onChange<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token keyword">this</span><span class="token punctuation">.</span>changeCheckBox<span class="token punctuation">&#125;</span> <span class="token operator">/</span><span class="token operator">></span>
                    <span class="token operator">&lt;</span>label htmlFor<span class="token operator">=</span><span class="token string">'apple'</span><span class="token operator">></span>Apple<span class="token operator">&lt;</span><span class="token operator">/</span>label<span class="token operator">></span>
                    <span class="token operator">&lt;</span>input id<span class="token operator">=</span><span class="token string">'orange'</span> type<span class="token operator">=</span><span class="token string">'checkbox'</span> value<span class="token operator">=</span><span class="token string">'orange'</span> checked<span class="token operator">=</span><span class="token punctuation">&#123;</span>checkedFruit<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span><span class="token string">'orange'</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span> onChange<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token keyword">this</span><span class="token punctuation">.</span>changeCheckBox<span class="token punctuation">&#125;</span> <span class="token operator">/</span><span class="token operator">></span>
                    <span class="token operator">&lt;</span>label htmlFor<span class="token operator">=</span><span class="token string">'orange'</span><span class="token operator">></span>Orange<span class="token operator">&lt;</span><span class="token operator">/</span>label<span class="token operator">></span>
                <span class="token operator">&lt;</span><span class="token operator">/</span>li<span class="token operator">></span>
            <span class="token operator">&lt;</span><span class="token operator">/</span>ul<span class="token operator">></span>
        <span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span></code></pre>



<h3 id="完整代码"><a href="#完整代码" class="headerlink" title="完整代码"></a>完整代码</h3><pre class="language-js" data-language="js"><code class="language-js"><span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">'react'</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">App</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span> <span class="token punctuation">&#123;</span>
    state <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
        <span class="token literal-property property">username</span><span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span>
        <span class="token literal-property property">content</span><span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span>
        <span class="token literal-property property">frame</span><span class="token operator">:</span> <span class="token string">'react'</span><span class="token punctuation">,</span>
        <span class="token literal-property property">checkedRadio</span><span class="token operator">:</span> <span class="token string">'male'</span><span class="token punctuation">,</span>
        <span class="token literal-property property">checkedFruit</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'apple'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">&#125;</span>
    <span class="token function-variable function">changeText</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
            <span class="token literal-property property">username</span><span class="token operator">:</span> e<span class="token punctuation">.</span>target<span class="token punctuation">.</span>value<span class="token punctuation">,</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span>
    <span class="token function-variable function">changeTextArea</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
            <span class="token literal-property property">content</span><span class="token operator">:</span> e<span class="token punctuation">.</span>target<span class="token punctuation">.</span>value<span class="token punctuation">,</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span>
    <span class="token function-variable function">changeOption</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
            <span class="token literal-property property">frame</span><span class="token operator">:</span> e<span class="token punctuation">.</span>target<span class="token punctuation">.</span>value<span class="token punctuation">,</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span>
    <span class="token function-variable function">changeRadio</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
            <span class="token literal-property property">checkedRadio</span><span class="token operator">:</span> e<span class="token punctuation">.</span>target<span class="token punctuation">.</span>value<span class="token punctuation">,</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span>
    <span class="token function-variable function">changeCheckBox</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">const</span> checkedFruit <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token operator">...</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>checkedFruit<span class="token punctuation">]</span>
        <span class="token keyword">const</span> idx <span class="token operator">=</span> checkedFruit<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>target<span class="token punctuation">.</span>value<span class="token punctuation">)</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>idx <span class="token operator">===</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token comment">// 数组中没有找到，说明没有被选中，那就把数据添加到数组，进行选中的操作</span>
            checkedFruit<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>target<span class="token punctuation">.</span>value<span class="token punctuation">)</span>
        <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
            <span class="token comment">// 找到了，说明已被选中，通过删除数组中的数据取消选中</span>
            checkedFruit<span class="token punctuation">.</span><span class="token function">splice</span><span class="token punctuation">(</span>idx<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
        <span class="token punctuation">&#125;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
            checkedFruit<span class="token punctuation">,</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span>
    <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">const</span> <span class="token punctuation">&#123;</span> username<span class="token punctuation">,</span> content<span class="token punctuation">,</span> frame<span class="token punctuation">,</span> checkedRadio<span class="token punctuation">,</span> checkedFruit <span class="token punctuation">&#125;</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>state
        <span class="token keyword">return</span> <span class="token punctuation">(</span>
            <span class="token operator">&lt;</span>ul<span class="token operator">></span>
                <span class="token operator">&lt;</span>li<span class="token operator">></span>
                    <span class="token operator">&lt;</span>label htmlFor<span class="token operator">=</span><span class="token string">'username'</span><span class="token operator">></span>用户名<span class="token operator">&lt;</span><span class="token operator">/</span>label<span class="token operator">></span>
                    <span class="token operator">&lt;</span>input id<span class="token operator">=</span><span class="token string">'username'</span> type<span class="token operator">=</span><span class="token string">'text'</span> value<span class="token operator">=</span><span class="token punctuation">&#123;</span>username<span class="token punctuation">&#125;</span> onChange<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token keyword">this</span><span class="token punctuation">.</span>changeText<span class="token punctuation">&#125;</span> <span class="token operator">/</span><span class="token operator">></span>
                <span class="token operator">&lt;</span><span class="token operator">/</span>li<span class="token operator">></span>
                <span class="token operator">&lt;</span>li<span class="token operator">></span>
                    <span class="token operator">&lt;</span>label htmlFor<span class="token operator">=</span><span class="token string">'content'</span><span class="token operator">></span>其他信息<span class="token operator">&lt;</span><span class="token operator">/</span>label<span class="token operator">></span>
                    <span class="token operator">&lt;</span>textarea id<span class="token operator">=</span><span class="token string">'content'</span> cols<span class="token operator">=</span><span class="token string">'30'</span> rows<span class="token operator">=</span><span class="token string">'10'</span> value<span class="token operator">=</span><span class="token punctuation">&#123;</span>content<span class="token punctuation">&#125;</span> onChange<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token keyword">this</span><span class="token punctuation">.</span>changeTextArea<span class="token punctuation">&#125;</span><span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>textarea<span class="token operator">></span>
                <span class="token operator">&lt;</span><span class="token operator">/</span>li<span class="token operator">></span>
                <span class="token operator">&lt;</span>li<span class="token operator">></span>
                    <span class="token operator">&lt;</span>label htmlFor<span class="token operator">=</span><span class="token string">'frame'</span><span class="token operator">></span>框架<span class="token operator">&lt;</span><span class="token operator">/</span>label<span class="token operator">></span>
                    <span class="token operator">&lt;</span>select id<span class="token operator">=</span><span class="token string">'frame'</span> value<span class="token operator">=</span><span class="token punctuation">&#123;</span>frame<span class="token punctuation">&#125;</span> onChange<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token keyword">this</span><span class="token punctuation">.</span>changeOption<span class="token punctuation">&#125;</span><span class="token operator">></span>
                        <span class="token operator">&lt;</span>option value<span class="token operator">=</span><span class="token string">'vue'</span><span class="token operator">></span>Vue<span class="token operator">&lt;</span><span class="token operator">/</span>option<span class="token operator">></span>
                        <span class="token operator">&lt;</span>option value<span class="token operator">=</span><span class="token string">'react'</span><span class="token operator">></span>React<span class="token operator">&lt;</span><span class="token operator">/</span>option<span class="token operator">></span>
                        <span class="token operator">&lt;</span>option value<span class="token operator">=</span><span class="token string">'angular'</span><span class="token operator">></span>Angular<span class="token operator">&lt;</span><span class="token operator">/</span>option<span class="token operator">></span>
                    <span class="token operator">&lt;</span><span class="token operator">/</span>select<span class="token operator">></span>
                <span class="token operator">&lt;</span><span class="token operator">/</span>li<span class="token operator">></span>
                <span class="token operator">&lt;</span>li<span class="token operator">></span>
                    <span class="token operator">&lt;</span>input id<span class="token operator">=</span><span class="token string">'male'</span> type<span class="token operator">=</span><span class="token string">'radio'</span> value<span class="token operator">=</span><span class="token string">'male'</span> checked<span class="token operator">=</span><span class="token punctuation">&#123;</span>checkedRadio <span class="token operator">===</span> <span class="token string">'male'</span><span class="token punctuation">&#125;</span> onChange<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token keyword">this</span><span class="token punctuation">.</span>changeRadio<span class="token punctuation">&#125;</span> <span class="token operator">/</span><span class="token operator">></span>
                    <span class="token operator">&lt;</span>label htmlFor<span class="token operator">=</span><span class="token string">'male'</span><span class="token operator">></span>男<span class="token operator">&lt;</span><span class="token operator">/</span>label<span class="token operator">></span>
                    <span class="token operator">&lt;</span>input id<span class="token operator">=</span><span class="token string">'female'</span> type<span class="token operator">=</span><span class="token string">'radio'</span> value<span class="token operator">=</span><span class="token string">'female'</span> checked<span class="token operator">=</span><span class="token punctuation">&#123;</span>checkedRadio <span class="token operator">===</span> <span class="token string">'female'</span><span class="token punctuation">&#125;</span> onChange<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token keyword">this</span><span class="token punctuation">.</span>changeRadio<span class="token punctuation">&#125;</span> <span class="token operator">/</span><span class="token operator">></span>
                    <span class="token operator">&lt;</span>label htmlFor<span class="token operator">=</span><span class="token string">'female'</span><span class="token operator">></span>女<span class="token operator">&lt;</span><span class="token operator">/</span>label<span class="token operator">></span>
                    <span class="token operator">&lt;</span>input id<span class="token operator">=</span><span class="token string">'unknow'</span> type<span class="token operator">=</span><span class="token string">'radio'</span> value<span class="token operator">=</span><span class="token string">'unknow'</span> checked<span class="token operator">=</span><span class="token punctuation">&#123;</span>checkedRadio <span class="token operator">===</span> <span class="token string">'unknow'</span><span class="token punctuation">&#125;</span> onChange<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token keyword">this</span><span class="token punctuation">.</span>changeRadio<span class="token punctuation">&#125;</span> <span class="token operator">/</span><span class="token operator">></span>
                    <span class="token operator">&lt;</span>label htmlFor<span class="token operator">=</span><span class="token string">'unknow'</span><span class="token operator">></span>未知<span class="token operator">&lt;</span><span class="token operator">/</span>label<span class="token operator">></span>
                <span class="token operator">&lt;</span><span class="token operator">/</span>li<span class="token operator">></span>
                <span class="token operator">&lt;</span>li<span class="token operator">></span>
                    <span class="token operator">&lt;</span>input id<span class="token operator">=</span><span class="token string">'apple'</span> type<span class="token operator">=</span><span class="token string">'checkbox'</span> value<span class="token operator">=</span><span class="token string">'apple'</span> checked<span class="token operator">=</span><span class="token punctuation">&#123;</span>checkedFruit<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span><span class="token string">'apple'</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span> onChange<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token keyword">this</span><span class="token punctuation">.</span>changeCheckBox<span class="token punctuation">&#125;</span> <span class="token operator">/</span><span class="token operator">></span>
                    <span class="token operator">&lt;</span>label htmlFor<span class="token operator">=</span><span class="token string">'apple'</span><span class="token operator">></span>Apple<span class="token operator">&lt;</span><span class="token operator">/</span>label<span class="token operator">></span>
                    <span class="token operator">&lt;</span>input id<span class="token operator">=</span><span class="token string">'orange'</span> type<span class="token operator">=</span><span class="token string">'checkbox'</span> value<span class="token operator">=</span><span class="token string">'orange'</span> checked<span class="token operator">=</span><span class="token punctuation">&#123;</span>checkedFruit<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span><span class="token string">'orange'</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span> onChange<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token keyword">this</span><span class="token punctuation">.</span>changeCheckBox<span class="token punctuation">&#125;</span> <span class="token operator">/</span><span class="token operator">></span>
                    <span class="token operator">&lt;</span>label htmlFor<span class="token operator">=</span><span class="token string">'orange'</span><span class="token operator">></span>Orange<span class="token operator">&lt;</span><span class="token operator">/</span>label<span class="token operator">></span>
                <span class="token operator">&lt;</span><span class="token operator">/</span>li<span class="token operator">></span>
            <span class="token operator">&lt;</span><span class="token operator">/</span>ul<span class="token operator">></span>
        <span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span></code></pre>



<h3 id="简化代码"><a href="#简化代码" class="headerlink" title="简化代码"></a>简化代码</h3><ol>
<li>添加 name。</li>
<li>把 key 都替换成 <code>e.target.name</code>。</li>
<li>观察规律，提取成一个 handleChange 函数。</li>
<li>根据 <code>e.target.type</code> 做出判断。</li>
<li>继续精简。</li>
</ol>
<pre class="language-js" data-language="js"><code class="language-js"><span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">'react'</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">App</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span> <span class="token punctuation">&#123;</span>
    state <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
        <span class="token literal-property property">username</span><span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span>
        <span class="token literal-property property">content</span><span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span>
        <span class="token literal-property property">frame</span><span class="token operator">:</span> <span class="token string">'react'</span><span class="token punctuation">,</span>
        <span class="token literal-property property">checkedRadio</span><span class="token operator">:</span> <span class="token string">'male'</span><span class="token punctuation">,</span>
        <span class="token literal-property property">checkedFruit</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'apple'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">&#125;</span>
    <span class="token function-variable function">handleChange</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">let</span> v
        <span class="token keyword">if</span> <span class="token punctuation">(</span>e<span class="token punctuation">.</span>target<span class="token punctuation">.</span>type <span class="token operator">===</span> <span class="token string">'checkbox'</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">const</span> checkedFruit <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token operator">...</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>checkedFruit<span class="token punctuation">]</span>
            <span class="token keyword">const</span> idx <span class="token operator">=</span> checkedFruit<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>target<span class="token punctuation">.</span>value<span class="token punctuation">)</span>
            idx <span class="token operator">===</span> <span class="token operator">-</span><span class="token number">1</span> <span class="token operator">?</span> checkedFruit<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>target<span class="token punctuation">.</span>value<span class="token punctuation">)</span> <span class="token operator">:</span> checkedFruit<span class="token punctuation">.</span><span class="token function">splice</span><span class="token punctuation">(</span>idx<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
            v <span class="token operator">=</span> checkedFruit
        <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
            v <span class="token operator">=</span> e<span class="token punctuation">.</span>target<span class="token punctuation">.</span>value
        <span class="token punctuation">&#125;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
            <span class="token punctuation">[</span>e<span class="token punctuation">.</span>target<span class="token punctuation">.</span>name<span class="token punctuation">]</span><span class="token operator">:</span> v<span class="token punctuation">,</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span>
    <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">const</span> <span class="token punctuation">&#123;</span> username<span class="token punctuation">,</span> content<span class="token punctuation">,</span> frame<span class="token punctuation">,</span> checkedRadio<span class="token punctuation">,</span> checkedFruit <span class="token punctuation">&#125;</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>state
        <span class="token keyword">return</span> <span class="token punctuation">(</span>
            <span class="token operator">&lt;</span>ul<span class="token operator">></span>
                <span class="token operator">&lt;</span>li<span class="token operator">></span>
                    <span class="token operator">&lt;</span>label htmlFor<span class="token operator">=</span><span class="token string">'username'</span><span class="token operator">></span>用户名<span class="token operator">&lt;</span><span class="token operator">/</span>label<span class="token operator">></span>
                    <span class="token operator">&lt;</span>input id<span class="token operator">=</span><span class="token string">'username'</span> name<span class="token operator">=</span><span class="token string">'username'</span> type<span class="token operator">=</span><span class="token string">'text'</span> value<span class="token operator">=</span><span class="token punctuation">&#123;</span>username<span class="token punctuation">&#125;</span> onChange<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token keyword">this</span><span class="token punctuation">.</span>handleChange<span class="token punctuation">&#125;</span> <span class="token operator">/</span><span class="token operator">></span>
                <span class="token operator">&lt;</span><span class="token operator">/</span>li<span class="token operator">></span>
                <span class="token operator">&lt;</span>li<span class="token operator">></span>
                    <span class="token operator">&lt;</span>label htmlFor<span class="token operator">=</span><span class="token string">'content'</span><span class="token operator">></span>其他信息<span class="token operator">&lt;</span><span class="token operator">/</span>label<span class="token operator">></span>
                    <span class="token operator">&lt;</span>textarea id<span class="token operator">=</span><span class="token string">'content'</span> name<span class="token operator">=</span><span class="token string">'content'</span> cols<span class="token operator">=</span><span class="token string">'30'</span> rows<span class="token operator">=</span><span class="token string">'10'</span> value<span class="token operator">=</span><span class="token punctuation">&#123;</span>content<span class="token punctuation">&#125;</span> onChange<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token keyword">this</span><span class="token punctuation">.</span>handleChange<span class="token punctuation">&#125;</span><span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>textarea<span class="token operator">></span>
                <span class="token operator">&lt;</span><span class="token operator">/</span>li<span class="token operator">></span>
                <span class="token operator">&lt;</span>li<span class="token operator">></span>
                    <span class="token operator">&lt;</span>label htmlFor<span class="token operator">=</span><span class="token string">'frame'</span><span class="token operator">></span>框架<span class="token operator">&lt;</span><span class="token operator">/</span>label<span class="token operator">></span>
                    <span class="token operator">&lt;</span>select id<span class="token operator">=</span><span class="token string">'frame'</span> name<span class="token operator">=</span><span class="token string">'frame'</span> value<span class="token operator">=</span><span class="token punctuation">&#123;</span>frame<span class="token punctuation">&#125;</span> onChange<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token keyword">this</span><span class="token punctuation">.</span>handleChange<span class="token punctuation">&#125;</span><span class="token operator">></span>
                        <span class="token operator">&lt;</span>option value<span class="token operator">=</span><span class="token string">'vue'</span><span class="token operator">></span>Vue<span class="token operator">&lt;</span><span class="token operator">/</span>option<span class="token operator">></span>
                        <span class="token operator">&lt;</span>option value<span class="token operator">=</span><span class="token string">'react'</span><span class="token operator">></span>React<span class="token operator">&lt;</span><span class="token operator">/</span>option<span class="token operator">></span>
                        <span class="token operator">&lt;</span>option value<span class="token operator">=</span><span class="token string">'angular'</span><span class="token operator">></span>Angular<span class="token operator">&lt;</span><span class="token operator">/</span>option<span class="token operator">></span>
                    <span class="token operator">&lt;</span><span class="token operator">/</span>select<span class="token operator">></span>
                <span class="token operator">&lt;</span><span class="token operator">/</span>li<span class="token operator">></span>
                <span class="token operator">&lt;</span>li<span class="token operator">></span>
                    <span class="token operator">&lt;</span>input id<span class="token operator">=</span><span class="token string">'male'</span> name<span class="token operator">=</span><span class="token string">'checkedRadio'</span> type<span class="token operator">=</span><span class="token string">'radio'</span> value<span class="token operator">=</span><span class="token string">'male'</span> checked<span class="token operator">=</span><span class="token punctuation">&#123;</span>checkedRadio <span class="token operator">===</span> <span class="token string">'male'</span><span class="token punctuation">&#125;</span> onChange<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token keyword">this</span><span class="token punctuation">.</span>handleChange<span class="token punctuation">&#125;</span> <span class="token operator">/</span><span class="token operator">></span>
                    <span class="token operator">&lt;</span>label htmlFor<span class="token operator">=</span><span class="token string">'male'</span><span class="token operator">></span>男<span class="token operator">&lt;</span><span class="token operator">/</span>label<span class="token operator">></span>
                    <span class="token operator">&lt;</span>input id<span class="token operator">=</span><span class="token string">'female'</span> name<span class="token operator">=</span><span class="token string">'checkedRadio'</span> type<span class="token operator">=</span><span class="token string">'radio'</span> value<span class="token operator">=</span><span class="token string">'female'</span> checked<span class="token operator">=</span><span class="token punctuation">&#123;</span>checkedRadio <span class="token operator">===</span> <span class="token string">'female'</span><span class="token punctuation">&#125;</span> onChange<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token keyword">this</span><span class="token punctuation">.</span>handleChange<span class="token punctuation">&#125;</span> <span class="token operator">/</span><span class="token operator">></span>
                    <span class="token operator">&lt;</span>label htmlFor<span class="token operator">=</span><span class="token string">'female'</span><span class="token operator">></span>女<span class="token operator">&lt;</span><span class="token operator">/</span>label<span class="token operator">></span>
                    <span class="token operator">&lt;</span>input id<span class="token operator">=</span><span class="token string">'unknow'</span> name<span class="token operator">=</span><span class="token string">'checkedRadio'</span> type<span class="token operator">=</span><span class="token string">'radio'</span> value<span class="token operator">=</span><span class="token string">'unknow'</span> checked<span class="token operator">=</span><span class="token punctuation">&#123;</span>checkedRadio <span class="token operator">===</span> <span class="token string">'unknow'</span><span class="token punctuation">&#125;</span> onChange<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token keyword">this</span><span class="token punctuation">.</span>handleChange<span class="token punctuation">&#125;</span> <span class="token operator">/</span><span class="token operator">></span>
                    <span class="token operator">&lt;</span>label htmlFor<span class="token operator">=</span><span class="token string">'unknow'</span><span class="token operator">></span>未知<span class="token operator">&lt;</span><span class="token operator">/</span>label<span class="token operator">></span>
                <span class="token operator">&lt;</span><span class="token operator">/</span>li<span class="token operator">></span>
                <span class="token operator">&lt;</span>li<span class="token operator">></span>
                    <span class="token operator">&lt;</span>input id<span class="token operator">=</span><span class="token string">'apple'</span> name<span class="token operator">=</span><span class="token string">'checkedFruit'</span> type<span class="token operator">=</span><span class="token string">'checkbox'</span> value<span class="token operator">=</span><span class="token string">'apple'</span> checked<span class="token operator">=</span><span class="token punctuation">&#123;</span>checkedFruit<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span><span class="token string">'apple'</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span> onChange<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token keyword">this</span><span class="token punctuation">.</span>handleChange<span class="token punctuation">&#125;</span> <span class="token operator">/</span><span class="token operator">></span>
                    <span class="token operator">&lt;</span>label htmlFor<span class="token operator">=</span><span class="token string">'apple'</span><span class="token operator">></span>Apple<span class="token operator">&lt;</span><span class="token operator">/</span>label<span class="token operator">></span>
                    <span class="token operator">&lt;</span>input id<span class="token operator">=</span><span class="token string">'orange'</span> name<span class="token operator">=</span><span class="token string">'checkedFruit'</span> type<span class="token operator">=</span><span class="token string">'checkbox'</span> value<span class="token operator">=</span><span class="token string">'orange'</span> checked<span class="token operator">=</span><span class="token punctuation">&#123;</span>checkedFruit<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span><span class="token string">'orange'</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span> onChange<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token keyword">this</span><span class="token punctuation">.</span>handleChange<span class="token punctuation">&#125;</span> <span class="token operator">/</span><span class="token operator">></span>
                    <span class="token operator">&lt;</span>label htmlFor<span class="token operator">=</span><span class="token string">'orange'</span><span class="token operator">></span>Orange<span class="token operator">&lt;</span><span class="token operator">/</span>label<span class="token operator">></span>
                <span class="token operator">&lt;</span><span class="token operator">/</span>li<span class="token operator">></span>
            <span class="token operator">&lt;</span><span class="token operator">/</span>ul<span class="token operator">></span>
        <span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span></code></pre>



<h2 id="非受控表单组件"><a href="#非受控表单组件" class="headerlink" title="非受控表单组件"></a>非受控表单组件</h2><h3 id="概念-3"><a href="#概念-3" class="headerlink" title="概念"></a>概念</h3><p>非受控组件则是通过操作 DOM 的方式来获取数据，表单中的 value 并没有和 state 中的数据进行绑定。</p>
<h3 id="内容-1"><a href="#内容-1" class="headerlink" title="内容"></a>内容</h3><p>通过 <code>React.createRef()</code> 获取 DOM。</p>
<pre class="language-js" data-language="js"><code class="language-js"><span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">&#123;</span> Component <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'react'</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">App</span> <span class="token keyword">extends</span> <span class="token class-name">Component</span> <span class="token punctuation">&#123;</span>
    <span class="token comment">// Step1</span>
    input <span class="token operator">=</span> React<span class="token punctuation">.</span><span class="token function">createRef</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token function-variable function">handleChange</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
        <span class="token comment">// Step3</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>input<span class="token punctuation">.</span>current<span class="token punctuation">.</span>value<span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span>
    <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> <span class="token punctuation">(</span>
            <span class="token operator">&lt;</span>div<span class="token operator">></span>
                <span class="token punctuation">&#123;</span><span class="token comment">/* Step2 */</span><span class="token punctuation">&#125;</span>
                <span class="token operator">&lt;</span>input ref<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token keyword">this</span><span class="token punctuation">.</span>input<span class="token punctuation">&#125;</span> type<span class="token operator">=</span><span class="token string">'text'</span> placeholder<span class="token operator">=</span><span class="token string">'输入内容'</span> onChange<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token keyword">this</span><span class="token punctuation">.</span>handleChange<span class="token punctuation">&#125;</span> <span class="token operator">/</span><span class="token operator">></span>
            <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span>
        <span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span></code></pre>

<p>…end</p>
]]></content>
      <categories>
        <category>React.js</category>
      </categories>
      <tags>
        <tag>前端</tag>
        <tag>React</tag>
        <tag>组件</tag>
      </tags>
  </entry>
  <entry>
    <title>React Hooks 系列之 useState</title>
    <url>/2020/06/03/387.html</url>
    <content><![CDATA[<h1 id="React-Hooks-系列之-useState"><a href="#React-Hooks-系列之-useState" class="headerlink" title="React_Hooks 系列之 useState"></a>React_Hooks 系列之 useState</h1><p>本系列将讲述 React Hooks的使用方法，从useState开始，将包含以下内容：</p>
<ul>
<li>useState</li>
<li>useEffect</li>
<li>useContext</li>
<li>useReducer</li>
<li>useCallback</li>
<li>useMemo</li>
<li>useRef</li>
<li>custom hooks</li>
</ul>
<p>掌握 React Hooks api 将更好的帮助我们在工作中使用，对 React 的掌握更上一层楼。</p>
<p>前提，需要会使用 React Class 的写法，会使用 <code>setState()</code> 和 props。</p>
<p>下面从第一个例子开始吧。</p>
<h2 id="简单的useState-Counter-计数器示例"><a href="#简单的useState-Counter-计数器示例" class="headerlink" title="简单的useState - Counter 计数器示例"></a>简单的useState - Counter 计数器示例</h2><p>点击+1的计数器</p>
<p>Class 组件的写法</p>
<p>CounterClass.tsx</p>
<pre class="language-js" data-language="js"><code class="language-js"><span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">&#123;</span> Component <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'react'</span>

<span class="token keyword">class</span> <span class="token class-name">CounterClass</span> <span class="token keyword">extends</span> <span class="token class-name">Component</span> <span class="token punctuation">&#123;</span>

  state <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
    <span class="token literal-property property">count</span><span class="token operator">:</span> <span class="token number">0</span>
  <span class="token punctuation">&#125;</span>

  <span class="token function-variable function">incrementCount</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
      <span class="token literal-property property">count</span><span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>count <span class="token operator">+</span> <span class="token number">1</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
  <span class="token punctuation">&#125;</span>

  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">const</span> <span class="token punctuation">&#123;</span> count <span class="token punctuation">&#125;</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>state
    <span class="token keyword">return</span> <span class="token punctuation">(</span>
      <span class="token operator">&lt;</span>div<span class="token operator">></span>
        <span class="token operator">&lt;</span>button onClick<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token keyword">this</span><span class="token punctuation">.</span>incrementCount<span class="token punctuation">&#125;</span><span class="token operator">></span>Count <span class="token punctuation">&#123;</span>count<span class="token punctuation">&#125;</span><span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">></span>
      <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span>
    <span class="token punctuation">)</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> CounterClass</code></pre>

<p>App.tsx</p>
<pre class="language-js" data-language="js"><code class="language-js"><span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">'react'</span>

<span class="token keyword">import</span> <span class="token string">'./App.css'</span>

<span class="token keyword">import</span> CounterClass <span class="token keyword">from</span> <span class="token string">'./components/CounterClass'</span>

<span class="token keyword">const</span> <span class="token function-variable function">App</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>div className<span class="token operator">=</span><span class="token string">"App"</span><span class="token operator">></span>
      <span class="token operator">&lt;</span>CounterClass <span class="token operator">/</span><span class="token operator">></span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span>
  <span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> App</code></pre>

<p>效果如下</p>
<img src="https://gw.alicdn.com/tfs/TB1oZQLveL2gK0jSZPhXXahvXXa-306-179.gif">

<p>创建这样的一个计数器分为简单的3步</p>
<ol>
<li>创建一个 Class 组件</li>
<li>创建 state</li>
<li>创建 increment 方法</li>
</ol>
<p>接下来看看如何使用 Function Component 和 state hook 实现</p>
<h2 id="State-Hook-实现"><a href="#State-Hook-实现" class="headerlink" title="State Hook 实现"></a>State Hook 实现</h2><p>HookCounter.tsx</p>
<pre class="language-tsx" data-language="tsx"><code class="language-tsx"><span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">&#123;</span> useState <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'react'</span>

<span class="token keyword">function</span> <span class="token function">HookCounter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>count<span class="token punctuation">,</span> setCount<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">&#123;</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
        <span class="token function">setCount</span><span class="token punctuation">(</span>count <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span>
      <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></span><span class="token punctuation">></span></span><span class="token plain-text">Count </span><span class="token punctuation">&#123;</span>count<span class="token punctuation">&#125;</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
  <span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> HookCounter</code></pre>

<p>App.tsx</p>
<pre class="language-tsx" data-language="tsx"><code class="language-tsx"><span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">'react'</span>

<span class="token keyword">import</span> <span class="token string">'./App.css'</span>

<span class="token comment">// import CounterClass from './components/1CounterClass'</span>
<span class="token keyword">import</span> HookCounter <span class="token keyword">from</span> <span class="token string">'./components/1HookCounter'</span>

<span class="token keyword">const</span> <span class="token function-variable function">App</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">className</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>App<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">HookCounter</span></span> <span class="token punctuation">/></span></span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
  <span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> App</code></pre>

<p>效果也和 Class 组件相同</p>
<p>我们来看 useState 的使用方法</p>
<pre class="language-tsx" data-language="tsx"><code class="language-tsx"><span class="token keyword">const</span> <span class="token punctuation">[</span>state<span class="token punctuation">,</span> setState<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span>initialState<span class="token punctuation">)</span></code></pre>

<p>这行代码返回一个 state，以及更新 state 的函数。</p>
<p>在初始渲染期间，返回的状态 (state) 与传入的第一个参数 (initialState) 值相同。</p>
<p>setState 函数用于更新 state。它接收一个新的 state 值并将组件的一次重新渲染加入队列。</p>
<h3 id="小结：Hooks-的使用规则"><a href="#小结：Hooks-的使用规则" class="headerlink" title="小结：Hooks 的使用规则"></a>小结：Hooks 的使用规则</h3><ul>
<li><p>只能在顶层作用域调用 Hooks</p>
<ul>
<li>不能在内部的循环、条件判断、嵌套的方法中使用</li>
</ul>
</li>
<li><p>只能在 React Function 里使用 Hooks</p>
<ul>
<li>不能在其他普通函数的 function 中使用 Hooks</li>
</ul>
</li>
</ul>
<h2 id="useState-with-Previous-State"><a href="#useState-with-Previous-State" class="headerlink" title="useState with Previous State"></a>useState with Previous State</h2><p>本节讲述如何使用 previous state，当你的 state 值依赖上一个状态值时，就会用到 previous state。</p>
<p>依然通过 Counter 的例子说明，增加了按钮点击 +1 或 -1</p>
<h3 id="Counter-示例"><a href="#Counter-示例" class="headerlink" title="Counter 示例"></a>Counter 示例</h3><p>HookCounter.tsx</p>
<pre class="language-tsx" data-language="tsx"><code class="language-tsx"><span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">&#123;</span> useState <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'react'</span>

<span class="token keyword">function</span> <span class="token function">HookCounter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>

  <span class="token keyword">const</span> initialCount <span class="token operator">=</span> <span class="token number">0</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>count<span class="token punctuation">,</span> setCount<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span>initialCount<span class="token punctuation">)</span>

  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span><span class="token plain-text">
      Count: </span><span class="token punctuation">&#123;</span>count<span class="token punctuation">&#125;</span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">&#123;</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
        <span class="token function">setCount</span><span class="token punctuation">(</span>initialCount<span class="token punctuation">)</span>
      <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></span><span class="token punctuation">></span></span><span class="token plain-text">Reset</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">&#123;</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
        <span class="token function">setCount</span><span class="token punctuation">(</span>count <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span>
      <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></span><span class="token punctuation">></span></span><span class="token plain-text"> + 1 </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">&#123;</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
        <span class="token function">setCount</span><span class="token punctuation">(</span>count <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span>
      <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></span><span class="token punctuation">></span></span><span class="token plain-text"> - 1 </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
  <span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> HookCounter</code></pre>

<p>App.tsx</p>
<pre class="language-tsx" data-language="tsx"><code class="language-tsx"><span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">'react'</span>

<span class="token keyword">import</span> <span class="token string">'./App.css'</span>

<span class="token keyword">import</span> HookCounter <span class="token keyword">from</span> <span class="token string">'./components/3HookCounter'</span>

<span class="token keyword">const</span> <span class="token function-variable function">App</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">className</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>App<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">HookCounter</span></span> <span class="token punctuation">/></span></span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
  <span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> App</code></pre>

<p>效果如下：</p>
<img src="https://gw.alicdn.com/tfs/TB13LIYva61gK0jSZFlXXXDKFXa-306-179.gif">

<p>看起来效果没有问题，<strong>但是这样写是不安全的！</strong> 这不是更改计数器的正确方法。下面告诉你为什么：</p>
<p>同样也是举个例子，在上述的示例中再增加一个按钮，每次累加5</p>
<p>代码如下</p>
<pre class="language-tsx" data-language="tsx"><code class="language-tsx"><span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">&#123;</span> useState <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'react'</span>

<span class="token keyword">function</span> <span class="token function">HookCounter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>

  <span class="token keyword">const</span> initialCount <span class="token operator">=</span> <span class="token number">0</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>count<span class="token punctuation">,</span> setCount<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span>initialCount<span class="token punctuation">)</span>

<span class="token operator">+</span>  <span class="token keyword">const</span> <span class="token function-variable function">increment5</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
<span class="token operator">+</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">5</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
<span class="token operator">+</span>      <span class="token function">setCount</span><span class="token punctuation">(</span>count <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span>
<span class="token operator">+</span>    <span class="token punctuation">&#125;</span>
<span class="token operator">+</span>  <span class="token punctuation">&#125;</span>

  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span><span class="token plain-text">
      Count: </span><span class="token punctuation">&#123;</span>count<span class="token punctuation">&#125;</span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">&#123;</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
        <span class="token function">setCount</span><span class="token punctuation">(</span>initialCount<span class="token punctuation">)</span>
      <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></span><span class="token punctuation">></span></span><span class="token plain-text">Reset</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">&#123;</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
        <span class="token function">setCount</span><span class="token punctuation">(</span>count <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span>
      <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></span><span class="token punctuation">></span></span><span class="token plain-text"> + 1 </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">&#123;</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
        <span class="token function">setCount</span><span class="token punctuation">(</span>count <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span>
      <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></span><span class="token punctuation">></span></span><span class="token plain-text"> - 1 </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span><span class="token plain-text">
+      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">&#123;</span>increment5<span class="token punctuation">&#125;</span></span><span class="token punctuation">></span></span><span class="token plain-text"> + 5 </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
  <span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> HookCounter</code></pre>

<p>点击 + 5 时，只加了 1</p>
<img src="https://gw.alicdn.com/tfs/TB1AdMTvoz1gK0jSZLeXXb9kVXa-306-179.gif">

<p>这是因为 setCount 方法是异步的，不能立即反应并更新，瞬间调动多次入参中的 count 仍然是旧的值，没有被更新。</p>
<p>将代码修改如下：</p>
<pre class="language-tsx" data-language="tsx"><code class="language-tsx"><span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">&#123;</span> useState <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'react'</span>

<span class="token keyword">function</span> <span class="token function">HookCounter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>

  <span class="token keyword">const</span> initialCount <span class="token operator">=</span> <span class="token number">0</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>count<span class="token punctuation">,</span> setCount<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span>initialCount<span class="token punctuation">)</span>

  <span class="token keyword">const</span> <span class="token function-variable function">increment5</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">5</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
<span class="token operator">+</span>      <span class="token function">setCount</span><span class="token punctuation">(</span>prevCount <span class="token operator">=></span> prevCount <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span>
  <span class="token punctuation">&#125;</span>

  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span><span class="token plain-text">
      Count: </span><span class="token punctuation">&#123;</span>count<span class="token punctuation">&#125;</span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">&#123;</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
        <span class="token function">setCount</span><span class="token punctuation">(</span>initialCount<span class="token punctuation">)</span>
      <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></span><span class="token punctuation">></span></span><span class="token plain-text">Reset</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">&#123;</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
        <span class="token function">setCount</span><span class="token punctuation">(</span>count <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span>
      <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></span><span class="token punctuation">></span></span><span class="token plain-text"> + 1 </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">&#123;</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
        <span class="token function">setCount</span><span class="token punctuation">(</span>count <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span>
      <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></span><span class="token punctuation">></span></span><span class="token plain-text"> - 1 </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">&#123;</span>increment5<span class="token punctuation">&#125;</span></span><span class="token punctuation">></span></span><span class="token plain-text"> + 5 </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
  <span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> HookCounter</code></pre>

<img src="https://gw.alicdn.com/tfs/TB1ZG3WvkL0gK0jSZFAXXcA9pXa-306-179.gif">

<p>注意到如果要使用 previous state，则需要通过 function 的方式传入 value 再返回变化后的新 value，将 <code>+ 1</code> <code>-1</code> 的功能也修改一下，完善后的代码如下：</p>
<pre class="language-none"><code class="language-none">import React, &#123; useState &#125; from &#39;react&#39;

function HookCounter() &#123;

  const initialCount &#x3D; 0
  const [count, setCount] &#x3D; useState(initialCount)

  const increment5 &#x3D; () &#x3D;&gt; &#123;
    for (let i &#x3D; 0; i &lt; 5; i++) &#123;
      setCount(prevCount &#x3D;&gt; prevCount + 1)
    &#125;
  &#125;

  return (
    &lt;div&gt;
      Count: &#123;count&#125;
      &lt;button onClick&#x3D;&#123;() &#x3D;&gt; &#123;
        setCount(initialCount)
      &#125;&#125;&gt;Reset&lt;&#x2F;button&gt;
      &lt;button onClick&#x3D;&#123;() &#x3D;&gt; &#123;
        setCount(prevCount &#x3D;&gt; prevCount + 1)
      &#125;&#125;&gt; + 1 &lt;&#x2F;button&gt;
      &lt;button onClick&#x3D;&#123;() &#x3D;&gt; &#123;
        setCount(prevCount &#x3D;&gt; prevCount - 1)
      &#125;&#125;&gt; - 1 &lt;&#x2F;button&gt;
      &lt;button onClick&#x3D;&#123;increment5&#125;&gt; + 5 &lt;&#x2F;button&gt;
    &lt;&#x2F;div&gt;
  )
&#125;

export default HookCounter</code></pre>

<h3 id="小结"><a href="#小结" class="headerlink" title="小结"></a>小结</h3><p>使用 previousState 时，要使用 setter function 的方式，传参给 setState 方法。来确保拿到的是准确的 previous state。</p>
<p>在重新渲染中，useState 返回的第一个值将始终是更新后最新的 state。</p>
<h2 id="useState-with-Object"><a href="#useState-with-Object" class="headerlink" title="useState with Object"></a>useState with Object</h2><p>当 useState 中的 state 为对象时，调用相应的 setState 有一些要注意的地方，useState 不会自动合并更新对象，你可以用函数式的 setState 结合展开运算符来达到合并更新对象的效果。</p>
<h3 id="错误示例-firstName-amp-lastName"><a href="#错误示例-firstName-amp-lastName" class="headerlink" title="错误示例 firstName &amp; lastName"></a>错误示例 firstName &amp; lastName</h3><p>HookCounter.tsx</p>
<pre class="language-none"><code class="language-none">import React, &#123; useState &#125; from &#39;react&#39;

function HookCounter() &#123;

  const [name, setName] &#x3D; useState(&#123;
    firstName: &#39;&#39;,
    lastName: &#39;&#39;
  &#125;)

  return (
    &lt;form&gt;
      &lt;input
        type&#x3D;&quot;text&quot;
        value&#x3D;&#123;name.firstName&#125;
        onChange&#x3D;&#123;e &#x3D;&gt; &#123;
          setName(&#123;
            firstName: e.target.value
          &#125;)
        &#125;&#125;
      &#x2F;&gt;
      &lt;input
        type&#x3D;&quot;text&quot;
        value&#x3D;&#123;name.lastName&#125;
        onChange&#x3D;&#123;e &#x3D;&gt; &#123;
          setName(&#123;
            lastName: e.target.value
          &#125;)
        &#125;&#125;
      &#x2F;&gt;
      &lt;h2&gt;Your first name is &#123;name.firstName&#125;&lt;&#x2F;h2&gt;
      &lt;h2&gt;Your last name is &#123;name.lastName&#125;&lt;&#x2F;h2&gt;
    &lt;&#x2F;form&gt;
  )
&#125;

export default HookCounter</code></pre>

<p>注意到 input 标签上的 onChange 中，每次 setName 时，只对对象中的一个属性做了操作。只给 firstName 赋值时，lastName 属性会消失，这是一种错误的写法。</p>
<p>由于我使用了 tsx 来写组件，我的编译器直接就报错了：</p>
<img src="https://gw.alicdn.com/tfs/TB1q8E0voY1gK0jSZFCXXcwqXXa-1098-822.jpg">

<h3 id="正确示例-手动合并对象"><a href="#正确示例-手动合并对象" class="headerlink" title="正确示例-手动合并对象"></a>正确示例-手动合并对象</h3><p>这里要使用展开运算符，来解决这个对象的问题</p>
<pre class="language-tsx" data-language="tsx"><code class="language-tsx"><span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">&#123;</span> useState <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'react'</span>

<span class="token keyword">function</span> <span class="token function">HookCounter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>

  <span class="token keyword">const</span> <span class="token punctuation">[</span>name<span class="token punctuation">,</span> setName<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
    firstName<span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span>
    lastName<span class="token operator">:</span> <span class="token string">''</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>

  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span><span class="token punctuation">></span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span>
        <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>text<span class="token punctuation">"</span></span>
        <span class="token attr-name">value</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">&#123;</span>name<span class="token punctuation">.</span>firstName<span class="token punctuation">&#125;</span></span>
        <span class="token attr-name">onChange</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">&#123;</span>e <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
          <span class="token function">setName</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
            <span class="token operator">...</span>name<span class="token punctuation">,</span>
            firstName<span class="token operator">:</span> e<span class="token punctuation">.</span>target<span class="token punctuation">.</span>value
          <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></span>
      <span class="token punctuation">/></span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span>
        <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>text<span class="token punctuation">"</span></span>
        <span class="token attr-name">value</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">&#123;</span>name<span class="token punctuation">.</span>lastName<span class="token punctuation">&#125;</span></span>
        <span class="token attr-name">onChange</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">&#123;</span>e <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
          <span class="token function">setName</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
            <span class="token operator">...</span>name<span class="token punctuation">,</span>
            lastName<span class="token operator">:</span> e<span class="token punctuation">.</span>target<span class="token punctuation">.</span>value
          <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></span>
      <span class="token punctuation">/></span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h2</span><span class="token punctuation">></span></span><span class="token plain-text">Your first name is </span><span class="token punctuation">&#123;</span>name<span class="token punctuation">.</span>firstName<span class="token punctuation">&#125;</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h2</span><span class="token punctuation">></span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h2</span><span class="token punctuation">></span></span><span class="token plain-text">Your last name is </span><span class="token punctuation">&#123;</span>name<span class="token punctuation">.</span>lastName<span class="token punctuation">&#125;</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h2</span><span class="token punctuation">></span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h2</span><span class="token punctuation">></span></span><span class="token punctuation">&#123;</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h2</span><span class="token punctuation">></span></span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>form</span><span class="token punctuation">></span></span>
  <span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> HookCounter</code></pre>

<img src="https://gw.alicdn.com/tfs/TB1mfIUvXY7gK0jSZKzXXaikpXa-373-215.gif">

<h3 id="小结-1"><a href="#小结-1" class="headerlink" title="小结"></a>小结</h3><p>state hook 中操作对象时，不会自动合并对象中的属性，需要我们手动来合并，可以运用展开运算符。</p>
<p>那么，数组也是类似的，见下一节。</p>
<h2 id="useState-with-Array"><a href="#useState-with-Array" class="headerlink" title="useState with Array"></a>useState with Array</h2><h3 id="列表示例"><a href="#列表示例" class="headerlink" title="列表示例"></a>列表示例</h3><p>点击按钮，列表增加一个1-10的随机数</p>
<p>UseStateWithArray.tsx</p>
<pre class="language-tsx" data-language="tsx"><code class="language-tsx"><span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">&#123;</span> useState <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'react'</span>

<span class="token keyword">interface</span> <span class="token class-name">ItemType</span> <span class="token punctuation">&#123;</span>
  id<span class="token operator">:</span> <span class="token builtin">number</span>
  value<span class="token operator">:</span> <span class="token builtin">number</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">function</span> <span class="token function">UseStateWithArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>items<span class="token punctuation">,</span> setItems<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token generic-function"><span class="token function">useState</span><span class="token generic class-name"><span class="token operator">&lt;</span>ItemType<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">></span></span></span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

  <span class="token keyword">const</span> <span class="token function-variable function">addItem</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    <span class="token function">setItems</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
      <span class="token operator">...</span>items<span class="token punctuation">,</span>
      <span class="token punctuation">&#123;</span>
        id<span class="token operator">:</span> items<span class="token punctuation">.</span>length<span class="token punctuation">,</span>
        value<span class="token operator">:</span> Math<span class="token punctuation">.</span><span class="token function">ceil</span><span class="token punctuation">(</span>Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">10</span><span class="token punctuation">)</span>
      <span class="token punctuation">&#125;</span>
    <span class="token punctuation">]</span><span class="token punctuation">)</span>
  <span class="token punctuation">&#125;</span>

  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">&#123;</span>addItem<span class="token punctuation">&#125;</span></span><span class="token punctuation">></span></span><span class="token plain-text">add a number</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ul</span><span class="token punctuation">></span></span><span class="token plain-text">
        </span><span class="token punctuation">&#123;</span>
          items<span class="token punctuation">.</span>length <span class="token operator">></span> <span class="token number">0</span> <span class="token operator">&amp;&amp;</span> items<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span>item<span class="token operator">:</span> ItemType<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">(</span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span> <span class="token attr-name">key</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">&#123;</span>item<span class="token punctuation">.</span>id<span class="token punctuation">&#125;</span></span><span class="token punctuation">></span></span><span class="token punctuation">&#123;</span>item<span class="token punctuation">.</span>value<span class="token punctuation">&#125;</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">></span></span>
          <span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">&#125;</span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ul</span><span class="token punctuation">></span></span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
  <span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> UseStateWithArray</code></pre>

<p>效果如下：</p>
<img src="https://gw.alicdn.com/tfs/TB1vcE7vXY7gK0jSZKzXXaikpXa-418-215.gif">

<h2 id="useState-总结"><a href="#useState-总结" class="headerlink" title="useState 总结"></a>useState 总结</h2><p>关于 useState 的使用就到这里，这里稍作总结。</p>
<ul>
<li>可以在函数式组件中使用 state</li>
<li>在类组件中，state 是一个对象，但是 useState 中，state可以不是对象，可以是任何类型</li>
<li>useState 返回2个元素的数组<ul>
<li>第一个是 state 的当前值</li>
<li>第二个是 state 的 setter 方法，调用时会触发 rerender<ul>
<li>若当前的 state 依赖 previous state，可以传入一个函数到 state 的 setter 方法中，入参为 previous state，返回新的 state</li>
</ul>
</li>
</ul>
</li>
<li>对于对象和数组，注意 state 中不会自动补全旧的变量，需要使用展开运算符自己手动补充</li>
</ul>
<p>useState 的学习就到这里，下一篇将一起来学习 useEffect 的使用。</p>
]]></content>
      <categories>
        <category>JavaScript</category>
      </categories>
      <tags>
        <tag>React</tag>
        <tag>hooks</tag>
      </tags>
  </entry>
  <entry>
    <title>React Hooks 系列之 useEffect</title>
    <url>/2020/06/05/389.html</url>
    <content><![CDATA[<h1 id="React-Hooks-系列之-useEffect"><a href="#React-Hooks-系列之-useEffect" class="headerlink" title="React Hooks 系列之 useEffect"></a>React Hooks 系列之 useEffect</h1><p>掌握 React Hooks api 将更好的帮助我们在工作中使用，对 React 的掌握更上一层楼。</p>
<p>今天来总结学习到的 useEffect 的使用方法</p>
<h2 id="为什么使用-useEffect"><a href="#为什么使用-useEffect" class="headerlink" title="为什么使用 useEffect"></a>为什么使用 useEffect</h2><h3 id="生命周期中写逻辑的问题"><a href="#生命周期中写逻辑的问题" class="headerlink" title="生命周期中写逻辑的问题"></a>生命周期中写逻辑的问题</h3><p>react 中旧的生命周期可能会有副作用，比如页面的 title 要展示点击次数时，代码如下：</p>
<pre class="language-none"><code class="language-none">componentDidMount() &#123;
  document.title &#x3D; &#96;$&#123;this.state.count&#125; times&#96;
&#125;
componentDidUpdate() &#123;
  document.title &#x3D; &#96;$&#123;this.state.count&#125; times&#96;
&#125;</code></pre>

<p>在 componentDidMount 和 componentDidUpdate 中都写了同样的代码，我们不能在组件的生命周期中挂载一次，这就导致了代码重复的问题。</p>
<p>另一个例子，页面中包含了倒计时，并且在页面销毁时要清除倒计时 timer</p>
<pre class="language-tsx" data-language="tsx"><code class="language-tsx"><span class="token function">componentDidMount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>interval <span class="token operator">=</span> <span class="token function">setInterval</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>tick<span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span>
<span class="token function">componentWillUnmount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token function">clearInterval</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>interval<span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span></code></pre>

<p>如果这个组件比较复杂，同时包含了上述的两种逻辑，那么代码如下：</p>
<pre class="language-tsx" data-language="tsx"><code class="language-tsx"><span class="token function">componentDidMount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  document<span class="token punctuation">.</span>title <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>count<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string"> times</span><span class="token template-punctuation string">`</span></span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>interval <span class="token operator">=</span> <span class="token function">setInterval</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>tick<span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span>
<span class="token function">componentDidUpdate</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  document<span class="token punctuation">.</span>title <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>count<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string"> times</span><span class="token template-punctuation string">`</span></span>
<span class="token punctuation">&#125;</span>
<span class="token function">componentWillUnmount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token function">clearInterval</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>interval<span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span></code></pre>

<p>我们看到2个问题</p>
<ol>
<li>代码重复。设置标题的代码重复了1遍</li>
<li>代码分散。逻辑看起来就分散在了组件生命周期的各个地方</li>
</ol>
<p>因此，我们需要更好的方法解决</p>
<h3 id="useEffect-解决的问题"><a href="#useEffect-解决的问题" class="headerlink" title="useEffect 解决的问题"></a>useEffect 解决的问题</h3><ul>
<li>EffectHook 用于函数式组件中副作用，执行一些相关的操作，解决上述的问题</li>
<li>可以认为是 componentDidMount, componentDidUpdate, componentWillUnmount 的替代品</li>
</ul>
<p>接下来学习如何使用 useEffect。</p>
<h2 id="useEffect-After-Render-的使用"><a href="#useEffect-After-Render-的使用" class="headerlink" title="useEffect After Render 的使用"></a>useEffect After Render 的使用</h2><p>举个例子，通过一个点击按钮，修改页面 title 的例子来说明</p>
<h3 id="Class-组件的写法示例"><a href="#Class-组件的写法示例" class="headerlink" title="Class 组件的写法示例"></a>Class 组件的写法示例</h3><p>7ClassCounter.tsx</p>
<pre class="language-tsx" data-language="tsx"><code class="language-tsx"><span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">&#123;</span> Component <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'react'</span>

<span class="token keyword">class</span> <span class="token class-name">ClassCounter</span> <span class="token keyword">extends</span> <span class="token class-name">Component</span> <span class="token punctuation">&#123;</span>

  state <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
    count<span class="token operator">:</span> <span class="token number">0</span>
  <span class="token punctuation">&#125;</span>

  <span class="token function">componentDidMount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    document<span class="token punctuation">.</span>title <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>count<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string"> times</span><span class="token template-punctuation string">`</span></span>
  <span class="token punctuation">&#125;</span>
  <span class="token function">componentDidUpdate</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    document<span class="token punctuation">.</span>title <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>count<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string"> times</span><span class="token template-punctuation string">`</span></span>
  <span class="token punctuation">&#125;</span>

  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">&#123;</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
          <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
            count<span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>count <span class="token operator">+</span> <span class="token number">1</span>
          <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></span><span class="token punctuation">></span></span><span class="token plain-text">
          Clicked </span><span class="token punctuation">&#123;</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>count<span class="token punctuation">&#125;</span><span class="token plain-text"> times
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span><span class="token plain-text">

      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
    <span class="token punctuation">)</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> ClassCounter</code></pre>

<p>App.tsx</p>
<pre class="language-tsx" data-language="tsx"><code class="language-tsx"><span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">'react'</span>

<span class="token keyword">import</span> <span class="token string">'./App.css'</span>

<span class="token keyword">import</span> ClassCounter <span class="token keyword">from</span> <span class="token string">'./components/7ClassCounter'</span>

<span class="token keyword">const</span> <span class="token function-variable function">App</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">className</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>App<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">ClassCounter</span></span> <span class="token punctuation">/></span></span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
  <span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> App</code></pre>

<p>效果如下：</p>
<img src="https://gw.alicdn.com/tfs/TB1yhhavy_1gK0jSZFqXXcpaXXa-418-215.gif">

<h3 id="使用-useEffect-改写上述示例"><a href="#使用-useEffect-改写上述示例" class="headerlink" title="使用 useEffect 改写上述示例"></a>使用 useEffect 改写上述示例</h3><p>接下来使用函数时组件实现上述的例子</p>
<p>7HookCounter.tsx</p>
<pre class="language-tsx" data-language="tsx"><code class="language-tsx"><span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">&#123;</span> useState<span class="token punctuation">,</span> useEffect <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'react'</span>

<span class="token keyword">function</span> <span class="token function">HookCounter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>count<span class="token punctuation">,</span> setCount<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>

  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    document<span class="token punctuation">.</span>title <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>count<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string"> times</span><span class="token template-punctuation string">`</span></span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>

  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">&#123;</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
        <span class="token function">setCount</span><span class="token punctuation">(</span>prevCount <span class="token operator">=></span> prevCount <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span>
      <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></span> <span class="token punctuation">></span></span><span class="token plain-text">Clicked </span><span class="token punctuation">&#123;</span>count<span class="token punctuation">&#125;</span><span class="token plain-text"> times</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
  <span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> HookCounter</code></pre>

<p>效果和 Class 组件相同</p>
<img src="https://gw.alicdn.com/tfs/TB1yhhavy_1gK0jSZFqXXcpaXXa-418-215.gif">

<p>可以看到 useEffect 的第一个入参是一个匿名函数，它会在每次 render 后调用。在第一次 render 和后续的更新 render 都会被调用。</p>
<p>另外，useEffect 写在函数式组件内，这样就可以直接拿到 props 和 state 的值，不用写 this 之类的代码。</p>
<h2 id="有条件地执行-useEffect"><a href="#有条件地执行-useEffect" class="headerlink" title="有条件地执行 useEffect"></a>有条件地执行 useEffect</h2><p>上一节了解到 useEffect 会在每次 render 后执行里面的函数，这可能会有一些性能问题，接下来就讲一讲如何有条件地执行 useEffect 中的匿名函数。</p>
<p>在上一节的示例上进行扩展一个输入 name 的功能，通过判断只执行 count 变化带来的逻辑。</p>
<h3 id="Class-组件的写法示例-1"><a href="#Class-组件的写法示例-1" class="headerlink" title="Class 组件的写法示例"></a>Class 组件的写法示例</h3><pre class="language-tsx" data-language="tsx"><code class="language-tsx"><span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">&#123;</span> Component <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'react'</span>

<span class="token keyword">interface</span> <span class="token class-name">stateType</span> <span class="token punctuation">&#123;</span>
  count<span class="token operator">:</span> <span class="token builtin">number</span>
  name<span class="token operator">:</span> <span class="token builtin">string</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">class</span> <span class="token class-name">ClassCounter</span> <span class="token keyword">extends</span> <span class="token class-name">Component</span> <span class="token punctuation">&#123;</span>

  state <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
    count<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
    name<span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span>
  <span class="token punctuation">&#125;</span>

  <span class="token function">componentDidMount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    document<span class="token punctuation">.</span>title <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>count<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string"> times</span><span class="token template-punctuation string">`</span></span>
  <span class="token punctuation">&#125;</span>

  <span class="token function">componentDidUpdate</span><span class="token punctuation">(</span>prevProps<span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">,</span> prevState<span class="token operator">:</span> stateType<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>prevState<span class="token punctuation">.</span>count <span class="token operator">!==</span> <span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>count<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
      <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Update title'</span><span class="token punctuation">)</span>
      document<span class="token punctuation">.</span>title <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>count<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string"> times</span><span class="token template-punctuation string">`</span></span>
    <span class="token punctuation">&#125;</span>
  <span class="token punctuation">&#125;</span>

  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span>
          <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>text<span class="token punctuation">"</span></span>
          <span class="token attr-name">value</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">&#123;</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>name<span class="token punctuation">&#125;</span></span>
          <span class="token attr-name">onChange</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">&#123;</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
              name<span class="token operator">:</span> e<span class="token punctuation">.</span>target<span class="token punctuation">.</span>value
            <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
          <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></span>
        <span class="token punctuation">/></span></span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">&#123;</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
          <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
            count<span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>count <span class="token operator">+</span> <span class="token number">1</span>
          <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></span><span class="token punctuation">></span></span><span class="token plain-text">
          Clicked </span><span class="token punctuation">&#123;</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>count<span class="token punctuation">&#125;</span><span class="token plain-text"> times
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
    <span class="token punctuation">)</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> ClassCounter</code></pre>

<p>为了更好的性能，注意代码中判断了 prevState</p>
<h3 id="useEffect-的写法"><a href="#useEffect-的写法" class="headerlink" title="useEffect 的写法"></a>useEffect 的写法</h3><pre class="language-tsx" data-language="tsx"><code class="language-tsx"><span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">&#123;</span> useState<span class="token punctuation">,</span> useEffect <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'react'</span>

<span class="token keyword">function</span> <span class="token function">HookCounter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>count<span class="token punctuation">,</span> setCount<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>name<span class="token punctuation">,</span> setName<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span>

  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'useEffect - update title'</span><span class="token punctuation">)</span>
    document<span class="token punctuation">.</span>title <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">You clicked </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>count<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string"> times</span><span class="token template-punctuation string">`</span></span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>count<span class="token punctuation">]</span><span class="token punctuation">)</span>

  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span>
        <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>text<span class="token punctuation">"</span></span>
        <span class="token attr-name">value</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">&#123;</span>name<span class="token punctuation">&#125;</span></span>
        <span class="token attr-name">onChange</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">&#123;</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
          <span class="token function">setName</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>target<span class="token punctuation">.</span>value<span class="token punctuation">)</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></span>
      <span class="token punctuation">/></span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">&#123;</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
        <span class="token function">setCount</span><span class="token punctuation">(</span>prevCount <span class="token operator">=></span> prevCount <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span>
      <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></span> <span class="token punctuation">></span></span><span class="token plain-text">Clicked </span><span class="token punctuation">&#123;</span>count<span class="token punctuation">&#125;</span><span class="token plain-text"> times</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
  <span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> HookCounter</code></pre>

<p>注意到 useEffect 的第二个参数 <code>[count]</code>，这个参数是一个数组，元素是要被观察的 state 或 props，只有指定的这个变量发生变化时，才会触发 useEffect 中的第一个参数匿名函数的执行。这有利于性能的保证。</p>
<h2 id="只执行1次-useEffect"><a href="#只执行1次-useEffect" class="headerlink" title="只执行1次 useEffect"></a>只执行1次 useEffect</h2><p>本节通过一个记录鼠标坐标的示例研究一下如何只执行一次 useEffect</p>
<h3 id="记录鼠标位置示例-Class-写法"><a href="#记录鼠标位置示例-Class-写法" class="headerlink" title="记录鼠标位置示例 Class 写法"></a>记录鼠标位置示例 Class 写法</h3><pre class="language-tsx" data-language="tsx"><code class="language-tsx"><span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">&#123;</span> Component <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'react'</span>

<span class="token keyword">class</span> <span class="token class-name">RunEffectsOnlyOnce</span> <span class="token keyword">extends</span> <span class="token class-name">Component</span> <span class="token punctuation">&#123;</span>
  state <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
    x<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
    y<span class="token operator">:</span> <span class="token number">0</span>
  <span class="token punctuation">&#125;</span>

  <span class="token function-variable function">logMousePos</span> <span class="token operator">=</span> <span class="token punctuation">(</span>e<span class="token operator">:</span> MouseEvent<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
      x<span class="token operator">:</span> e<span class="token punctuation">.</span>clientX<span class="token punctuation">,</span>
      y<span class="token operator">:</span> e<span class="token punctuation">.</span>clientY
    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
  <span class="token punctuation">&#125;</span>

  <span class="token function">componentDidMount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    document<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'mousemove'</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>logMousePos<span class="token punctuation">)</span>
  <span class="token punctuation">&#125;</span>

  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span><span class="token plain-text">
        Y - </span><span class="token punctuation">&#123;</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>y<span class="token punctuation">&#125;</span><span class="token plain-text">, X - </span><span class="token punctuation">&#123;</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>x<span class="token punctuation">&#125;</span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
    <span class="token punctuation">)</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> RunEffectsOnlyOnce</code></pre>

<img src="https://gw.alicdn.com/tfs/TB1ydpavET1gK0jSZFrXXcNCXXa-295-225.gif">

<p>这里只在 componentDidMount 中做了事件绑定，只执行了一次事件绑定</p>
<h3 id="useEffect-中记录鼠标坐标"><a href="#useEffect-中记录鼠标坐标" class="headerlink" title="useEffect 中记录鼠标坐标"></a>useEffect 中记录鼠标坐标</h3><p>上述效果改造为函数式组件</p>
<pre class="language-tsx" data-language="tsx"><code class="language-tsx"><span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">&#123;</span> useState<span class="token punctuation">,</span> useEffect <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'react'</span>

<span class="token keyword">function</span> <span class="token function">RunEffectsOnlyOnce</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>

  <span class="token keyword">const</span> <span class="token punctuation">[</span>x<span class="token punctuation">,</span> setX<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>y<span class="token punctuation">,</span> setY<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>

  <span class="token keyword">const</span> <span class="token function-variable function">logMousePos</span> <span class="token operator">=</span> <span class="token punctuation">(</span>e<span class="token operator">:</span> MouseEvent<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    <span class="token function">setX</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>clientX<span class="token punctuation">)</span>
    <span class="token function">setY</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>clientY<span class="token punctuation">)</span>
  <span class="token punctuation">&#125;</span>

  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'addEventListener'</span><span class="token punctuation">)</span>
    document<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'mousemove'</span><span class="token punctuation">,</span> logMousePos<span class="token punctuation">)</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span><span class="token plain-text">
      Y - </span><span class="token punctuation">&#123;</span>y<span class="token punctuation">&#125;</span><span class="token plain-text">, X - </span><span class="token punctuation">&#123;</span>x<span class="token punctuation">&#125;</span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
  <span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> RunEffectsOnlyOnce</code></pre>

<p>注意到 useEffect 方法的第二个参数传入一个空数组，有效的避免了多次调用的问题。</p>
<p>如果想执行只运行一次的 effect（仅在组件挂载和卸载时执行），可以传递一个空数组（[]）作为第二个参数。这就告诉 React 你的 effect 不依赖于 props 或 state 中的任何值，所以它永远都不需要重复执行。这并不属于特殊情况 —— 它依然遵循依赖数组的工作方式。</p>
<p>如果你传入了一个空数组（[]），effect 内部的 props 和 state 就会一直拥有其初始值。尽管传入 [] 作为第二个参数更接近大家更熟悉的 <code>componentDidMount</code> 和 <code>componentWillUnmount</code> 思维模式，但我们有更好的方式来避免过于频繁的重复调用 effect。除此之外，请记得 React 会等待浏览器完成画面渲染之后才会延迟调用 <code>useEffect</code>，因此会使得额外操作很方便。</p>
<h2 id="需要清除的-Effect"><a href="#需要清除的-Effect" class="headerlink" title="需要清除的 Effect"></a>需要清除的 Effect</h2><p>本节研究如何实现 willUnmount 这个生命周期，实现组件销毁时，清除 effect 逻辑。</p>
<p>在上一个demo中增加一个逻辑，点击按钮展示或隐藏鼠标的坐标组件。</p>
<h3 id="显示与移除组件"><a href="#显示与移除组件" class="headerlink" title="显示与移除组件"></a>显示与移除组件</h3><p>共三个文件，结构如下</p>
<img src="https://gw.alicdn.com/tfs/TB1R_pPFHY1gK0jSZTEXXXDQVXa-309-277.png">

<p>App.tsx</p>
<pre class="language-tsx" data-language="tsx"><code class="language-tsx"><span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">'react'</span>

<span class="token keyword">import</span> <span class="token string">'./App.css'</span>

<span class="token keyword">import</span> MouseContainer <span class="token keyword">from</span> <span class="token string">'./components/10MouseContainer'</span>

<span class="token keyword">const</span> <span class="token function-variable function">App</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">className</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>App<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">MouseContainer</span></span> <span class="token punctuation">/></span></span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
  <span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> App</code></pre>

<p>MouseContainer.tsx</p>
<pre class="language-tsx" data-language="tsx"><code class="language-tsx"><span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">&#123;</span> useState <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'react'</span>

<span class="token keyword">import</span> RunEffectsOnlyOnce <span class="token keyword">from</span> <span class="token string">'./9RunEffectsOnlyOnce'</span>

<span class="token keyword">function</span> <span class="token function">MouseContainer</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>display<span class="token punctuation">,</span> setDisplay<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">&#123;</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">setDisplay</span><span class="token punctuation">(</span><span class="token operator">!</span>display<span class="token punctuation">)</span><span class="token punctuation">&#125;</span></span><span class="token punctuation">></span></span><span class="token plain-text">Toggle display</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span><span class="token plain-text">
      </span><span class="token punctuation">&#123;</span>display <span class="token operator">&amp;&amp;</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">RunEffectsOnlyOnce</span></span> <span class="token punctuation">/></span></span><span class="token punctuation">&#125;</span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
  <span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> MouseContainer</code></pre>

<p>MousePos</p>
<pre class="language-tsx" data-language="tsx"><code class="language-tsx"><span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">&#123;</span> useState<span class="token punctuation">,</span> useEffect <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'react'</span>

<span class="token keyword">function</span> <span class="token function">RunEffectsOnlyOnce</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>

  <span class="token keyword">const</span> <span class="token punctuation">[</span>x<span class="token punctuation">,</span> setX<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>y<span class="token punctuation">,</span> setY<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>

  <span class="token keyword">const</span> <span class="token function-variable function">logMousePos</span> <span class="token operator">=</span> <span class="token punctuation">(</span>e<span class="token operator">:</span> MouseEvent<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    <span class="token function">setX</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>clientX<span class="token punctuation">)</span>
    <span class="token function">setY</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>clientY<span class="token punctuation">)</span>
  <span class="token punctuation">&#125;</span>

  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'addEventListener'</span><span class="token punctuation">)</span>
    document<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'mousemove'</span><span class="token punctuation">,</span> logMousePos<span class="token punctuation">)</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span><span class="token plain-text">
      Y - </span><span class="token punctuation">&#123;</span>y<span class="token punctuation">&#125;</span><span class="token plain-text">, X - </span><span class="token punctuation">&#123;</span>x<span class="token punctuation">&#125;</span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
  <span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> RunEffectsOnlyOnce</code></pre>

<img src="https://gw.alicdn.com/tfs/TB1nYXavEH1gK0jSZSyXXXtlpXa-579-284.gif">

<p>执行后发现隐藏了位置组件后，有一个错误警告。这是因为没有正确卸载子组件导致的。mousemove 事件依然被监听着和执行。并且可能会导致内存泄露。</p>
<h3 id="componentWillUnmount"><a href="#componentWillUnmount" class="headerlink" title="componentWillUnmount"></a>componentWillUnmount</h3><p>因此要在卸载组件时，确保所有的监听和订阅都已经被移除。若是在 Class 组件中，可以如下代码</p>
<pre class="language-tsx" data-language="tsx"><code class="language-tsx"><span class="token function">componentWillUnmount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  document<span class="token punctuation">.</span><span class="token function">removeEventListener</span><span class="token punctuation">(</span><span class="token string">'mousemove'</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>logMousePos<span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span></code></pre>

<p>但是在 useEffect 该如何写呢？请往下看</p>
<pre class="language-tsx" data-language="tsx"><code class="language-tsx"><span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'addEventListener'</span><span class="token punctuation">)</span>
  document<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'mousemove'</span><span class="token punctuation">,</span> logMousePos<span class="token punctuation">)</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    document<span class="token punctuation">.</span><span class="token function">removeEventListener</span><span class="token punctuation">(</span><span class="token string">'mousemove'</span><span class="token punctuation">,</span> logMousePos<span class="token punctuation">)</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span></code></pre>

<p>在 useEffect 的第一个参数中添加一个 return 匿名函数，这个匿名函数将在组件卸载的时候执行，因此我们在这里移除监听就好了。</p>
<img src="https://gw.alicdn.com/tfs/TB1eAcBvX67gK0jSZPfXXahhFXa-579-284.gif">

<p>如果需要一些在组件卸载时清除功能的代码，就写在 useEffect 第一个参数的返回匿名函数中吧。</p>
<h2 id="useEffect-中依赖错误导致的-bug"><a href="#useEffect-中依赖错误导致的-bug" class="headerlink" title="useEffect 中依赖错误导致的 bug"></a>useEffect 中依赖错误导致的 bug</h2><p>useEffect 的依赖(第二个参数)错误导致的问题。</p>
<p>以每秒 +1 的计数器为示例</p>
<h3 id="Class-组件示例"><a href="#Class-组件示例" class="headerlink" title="Class 组件示例"></a>Class 组件示例</h3><p>11Counter.tsx</p>
<pre class="language-tsx" data-language="tsx"><code class="language-tsx"><span class="token comment">/**
 * 每秒 +1 的计数器
 */</span>

<span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">&#123;</span> Component <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'react'</span>

<span class="token keyword">class</span> <span class="token class-name">Counter</span> <span class="token keyword">extends</span> <span class="token class-name">Component</span> <span class="token punctuation">&#123;</span>

  state <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
    count<span class="token operator">:</span> <span class="token number">0</span>
  <span class="token punctuation">&#125;</span>

  timer<span class="token operator">:</span> <span class="token builtin">number</span> <span class="token operator">|</span> <span class="token keyword">undefined</span>

  <span class="token function-variable function">tick</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
      count<span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>count <span class="token operator">+</span> <span class="token number">1</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
  <span class="token punctuation">&#125;</span>

  <span class="token function">componentDidMount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>timer <span class="token operator">=</span> window<span class="token punctuation">.</span><span class="token function">setInterval</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>tick<span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span>
  <span class="token punctuation">&#125;</span>

  <span class="token function">componentWillUnmount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token function">clearInterval</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>timer<span class="token punctuation">)</span>
  <span class="token punctuation">&#125;</span>


  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span><span class="token punctuation">></span></span><span class="token punctuation">&#123;</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>count<span class="token punctuation">&#125;</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">></span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
    <span class="token punctuation">)</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> Counter</code></pre>

<p>App.tsx</p>
<pre class="language-tsx" data-language="tsx"><code class="language-tsx"><span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">'react'</span>

<span class="token keyword">import</span> <span class="token string">'./App.css'</span>

<span class="token keyword">import</span> IntervalCounter <span class="token keyword">from</span> <span class="token string">'./components/11Counter'</span>

<span class="token keyword">const</span> <span class="token function-variable function">App</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">className</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>App<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">IntervalCounter</span></span> <span class="token punctuation">/></span></span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
  <span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> App</code></pre>

<p>执行没有问题，效果如下</p>
<img src="https://gw.alicdn.com/tfs/TB1CiNxx9f2gK0jSZFPXXXsopXa-487-270.gif">

<h3 id="hooks-示例"><a href="#hooks-示例" class="headerlink" title="hooks 示例"></a>hooks 示例</h3><p>IntervalCounterHooks.tsx</p>
<pre class="language-none"><code class="language-none">import React, &#123; useState, useEffect &#125; from &#39;react&#39;

function IntervalCouterHooks() &#123;

  const [count, setCount] &#x3D; useState(0)

  const tick &#x3D; () &#x3D;&gt; &#123;
    setCount(count + 1)
  &#125;

  useEffect(() &#x3D;&gt; &#123;
    const interval &#x3D; setInterval(tick, 1000)
    return () &#x3D;&gt; &#123;
      clearInterval(interval)
    &#125;
  &#125;, [])

  return (
    &lt;div&gt;
      &#123;count&#125;
    &lt;&#x2F;div&gt;
  )
&#125;

export default IntervalCouterHooks</code></pre>

<p>App.tsx</p>
<pre class="language-tsx" data-language="tsx"><code class="language-tsx"><span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">'react'</span>

<span class="token keyword">import</span> <span class="token string">'./App.css'</span>

<span class="token keyword">import</span> IntervalCounter <span class="token keyword">from</span> <span class="token string">'./components/11Counter'</span>
<span class="token keyword">import</span> IntervalCounterHooks <span class="token keyword">from</span> <span class="token string">'./components/11IntervalCouterHooks'</span>

<span class="token keyword">const</span> <span class="token function-variable function">App</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">className</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>App<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">IntervalCounter</span></span> <span class="token punctuation">/></span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">IntervalCounterHooks</span></span> <span class="token punctuation">/></span></span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
  <span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> App</code></pre>

<p>但是计数器没有正常工作，效果如下</p>
<img src="https://gw.alicdn.com/tfs/TB13TdBx7T2gK0jSZPcXXcKkpXa-425-270.gif">

<p>传入空的依赖数组 <code>[]</code>，意味着该 hook 只在组件挂载时运行一次，并非重新渲染时。但如此会有问题，在 <code>setInterval</code> <code>的回调中，count</code> 的值不会发生变化。因为当 effect 执行时，我们会创建一个闭包，并将 <code>count</code> 的值被保存在该闭包当中，且初值为 0。每隔一秒，回调就会执行 <code>setCount(0 + 1)</code>，因此，<code>count</code> 永远不会超过 1。</p>
<p>解法一：这里我们不能将 useEffect 的第二个参数设置为空数组，而是 <code>[count]</code>。</p>
<p>指定 <code>[count]</code> 作为依赖列表就能修复这个 Bug，但会导致每次改变发生时定时器都被重置。事实上，每个 <code>setInterval</code> 在被清除前（类似于 setTimeout）都会调用一次。但这并不是我们想要的。要解决这个问题，我们可以使用 setState 的函数式更新形式。它允许我们指定 state 该如何改变而不用引用当前 state，即下面的解法二</p>
<p>解法二：</p>
<p>将</p>
<pre class="language-tsx" data-language="tsx"><code class="language-tsx"><span class="token function">setCount</span><span class="token punctuation">(</span>count <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span></code></pre>

<p>改为</p>
<pre class="language-tsx" data-language="tsx"><code class="language-tsx"><span class="token function">setCount</span><span class="token punctuation">(</span><span class="token punctuation">(</span>preCount<span class="token punctuation">)</span> <span class="token operator">=></span>  preCount <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span></code></pre>

<p>useEffect 的依赖数组里依然使用空数组。这里设置了 count 的值是和上一个值有关，也解决了问题。此时，<code>setInterval</code> 的回调依旧每秒调用一次，但每次 setCount 内部的回调取到的 <code>count</code> 是最新值（在回调中变量命名为 c）。</p>
<img src="https://gw.alicdn.com/tfs/TB1eq1qAeT2gK0jSZFvXXXnFXXa-433-292.gif">

<h3 id="多个-useEffect"><a href="#多个-useEffect" class="headerlink" title="多个 useEffect"></a>多个 useEffect</h3><p>如果代码中有多个业务逻辑，可以将他们写在不同的 useEffect 中，并且可以写多个 useState 和他们匹配分组使用，会让业务逻辑更加清晰。</p>
<h2 id="Fetch-Data-with-Effect-Hook"><a href="#Fetch-Data-with-Effect-Hook" class="headerlink" title="Fetch Data with Effect Hook"></a>Fetch Data with Effect Hook</h2><h3 id="简单获取数据"><a href="#简单获取数据" class="headerlink" title="简单获取数据"></a>简单获取数据</h3><p>本节讲述使用 useEffect 来获取数据，本文使用 axios 库示例。</p>
<p><a href="https://jsonplaceholder.typicode.com/">https://jsonplaceholder.typicode.com/</a> 网站提供了示例的请求，返回了一些 json 数据。</p>
<pre class="language-tsx" data-language="tsx"><code class="language-tsx"><span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">&#123;</span> useState<span class="token punctuation">,</span> useEffect <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'react'</span>

<span class="token keyword">import</span> axios <span class="token keyword">from</span> <span class="token string">'axios'</span>

<span class="token keyword">interface</span> <span class="token class-name">postType</span> <span class="token punctuation">&#123;</span>
  userId<span class="token operator">:</span> <span class="token builtin">number</span>
  id<span class="token operator">:</span> <span class="token builtin">number</span>
  title<span class="token operator">:</span> <span class="token builtin">string</span>
  body<span class="token operator">:</span> <span class="token builtin">string</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">function</span> <span class="token function">FetchData</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>

  <span class="token keyword">const</span> <span class="token punctuation">[</span>posts<span class="token punctuation">,</span> setPosts<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token generic-function"><span class="token function">useState</span><span class="token generic class-name"><span class="token operator">&lt;</span>postType<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">></span></span></span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    axios<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'https://jsonplaceholder.typicode.com/posts'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
      <span class="token keyword">const</span> data<span class="token operator">:</span> postType<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> res<span class="token punctuation">.</span>data
      <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>
      <span class="token function">setPosts</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span>rej<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
      <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>rej<span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ul</span><span class="token punctuation">></span></span><span class="token plain-text">
        </span><span class="token punctuation">&#123;</span>
          posts<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span>item<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">(</span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span>
              <span class="token attr-name">key</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">&#123;</span>item<span class="token punctuation">.</span>id<span class="token punctuation">&#125;</span></span>
            <span class="token punctuation">></span></span><span class="token plain-text">
              </span><span class="token punctuation">&#123;</span>item<span class="token punctuation">.</span>title<span class="token punctuation">&#125;</span><span class="token plain-text">
            </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">></span></span>
          <span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">&#125;</span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ul</span><span class="token punctuation">></span></span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
  <span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> FetchData</code></pre>

<p>这里注意 ts 在 useState 中的写法。</p>
<pre class="language-tsx" data-language="tsx"><code class="language-tsx"><span class="token keyword">const</span> <span class="token punctuation">[</span>posts<span class="token punctuation">,</span> setPosts<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token generic-function"><span class="token function">useState</span><span class="token generic class-name"><span class="token operator">&lt;</span>postType<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">></span></span></span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span></code></pre>

<p>注意 useEffect 第二个依赖参数传入空数组，保证了 useEffect 只执行一次。</p>
<h3 id="输入id获取不同数据"><a href="#输入id获取不同数据" class="headerlink" title="输入id获取不同数据"></a>输入id获取不同数据</h3><pre class="language-tsx" data-language="tsx"><code class="language-tsx"><span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">&#123;</span> useState<span class="token punctuation">,</span> useEffect <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'react'</span>

<span class="token keyword">import</span> axios <span class="token keyword">from</span> <span class="token string">'axios'</span>

<span class="token keyword">interface</span> <span class="token class-name">postType</span> <span class="token punctuation">&#123;</span>
  userId<span class="token operator">:</span> <span class="token builtin">number</span>
  id<span class="token operator">:</span> <span class="token builtin">number</span>
  title<span class="token operator">:</span> <span class="token builtin">string</span>
  body<span class="token operator">:</span> <span class="token builtin">string</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">function</span> <span class="token function">FetchData</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>post<span class="token punctuation">,</span> setPost<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token generic-function"><span class="token function">useState</span><span class="token generic class-name"><span class="token operator">&lt;</span>postType<span class="token operator">></span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>id<span class="token punctuation">,</span> setId<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token string">'1'</span><span class="token punctuation">)</span>

  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>id<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
      axios<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">https://jsonplaceholder.typicode.com/posts/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>id<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">const</span> data<span class="token operator">:</span> postType <span class="token operator">=</span> res<span class="token punctuation">.</span>data
        <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>
        <span class="token function">setPost</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>
      <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
        <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
      <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>id<span class="token punctuation">]</span><span class="token punctuation">)</span>

  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span>
        <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>text<span class="token punctuation">"</span></span>
        <span class="token attr-name">value</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">&#123;</span>id<span class="token punctuation">&#125;</span></span>
        <span class="token attr-name">onChange</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">&#123;</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
          <span class="token function">setId</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>target<span class="token punctuation">.</span>value<span class="token punctuation">)</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></span>
      <span class="token punctuation">/></span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span><span class="token plain-text">
        </span><span class="token punctuation">&#123;</span>
          post <span class="token operator">&amp;&amp;</span> post<span class="token punctuation">.</span>title
        <span class="token punctuation">&#125;</span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
  <span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> FetchData</code></pre>

<img src="https://gw.alicdn.com/tfs/TB1wvCvAXP7gK0jSZFjXXc5aXXa-432-292.gif">

<h3 id="button-点击触发-effect"><a href="#button-点击触发-effect" class="headerlink" title="button 点击触发 effect"></a>button 点击触发 effect</h3><p>监听按钮点击触发变化，执行 effect 方法</p>
<pre class="language-tsx" data-language="tsx"><code class="language-tsx"><span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">&#123;</span> useState<span class="token punctuation">,</span> useEffect <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'react'</span>

<span class="token keyword">import</span> axios <span class="token keyword">from</span> <span class="token string">'axios'</span>

<span class="token keyword">interface</span> <span class="token class-name">postType</span> <span class="token punctuation">&#123;</span>
  userId<span class="token operator">:</span> <span class="token builtin">number</span>
  id<span class="token operator">:</span> <span class="token builtin">number</span>
  title<span class="token operator">:</span> <span class="token builtin">string</span>
  body<span class="token operator">:</span> <span class="token builtin">string</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">function</span> <span class="token function">FetchData</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>post<span class="token punctuation">,</span> setPost<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token generic-function"><span class="token function">useState</span><span class="token generic class-name"><span class="token operator">&lt;</span>postType<span class="token operator">></span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>id<span class="token punctuation">,</span> setId<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token string">'1'</span><span class="token punctuation">)</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>idFromBtnClick<span class="token punctuation">,</span> setIdFromBtnClick<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token string">'1'</span><span class="token punctuation">)</span>

  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>idFromBtnClick<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
      axios<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">https://jsonplaceholder.typicode.com/posts/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>idFromBtnClick<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">const</span> data<span class="token operator">:</span> postType <span class="token operator">=</span> res<span class="token punctuation">.</span>data
        <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>
        <span class="token function">setPost</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>
      <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
        <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
      <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>idFromBtnClick<span class="token punctuation">]</span><span class="token punctuation">)</span>

  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span>
        <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>text<span class="token punctuation">"</span></span>
        <span class="token attr-name">value</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">&#123;</span>id<span class="token punctuation">&#125;</span></span>
        <span class="token attr-name">onChange</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">&#123;</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
          <span class="token function">setId</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>target<span class="token punctuation">.</span>value<span class="token punctuation">)</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></span>
      <span class="token punctuation">/></span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span>
        <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">&#123;</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
          <span class="token function">setIdFromBtnClick</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></span>
      <span class="token punctuation">></span></span><span class="token plain-text">Fetch Post</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span><span class="token plain-text">
        </span><span class="token punctuation">&#123;</span>
          post <span class="token operator">&amp;&amp;</span> post<span class="token punctuation">.</span>title
        <span class="token punctuation">&#125;</span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
  <span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> FetchData</code></pre>

<img src="https://gw.alicdn.com/tfs/TB1sH2tAi_1gK0jSZFqXXcpaXXa-432-292.gif">

<h2 id="小结"><a href="#小结" class="headerlink" title="小结"></a>小结</h2><p>本章从为什么使用 useEffect 开始说起，用户解决代码重复代码分散的问题，useEffect 可以更好的组织代码。</p>
<p>useEffect api 的用法，第一个参数为匿名函数，作为 effect 要执行的内容。第二个参数为数组，用于观察改变的 props 或 state 进行有条件的触发 effect，或者传入空数组，让 effect 只执行一次。useEffect 返回一个匿名函数，在组件销毁是执行，可以有效避免内存泄露的风险。</p>
<p>最后举了几个例子来展示如何在 useEffect 中执行发起请求获取数据的逻辑。下一章将讲述 useContext 这个 api。</p>
]]></content>
      <categories>
        <category>JavaScript</category>
      </categories>
      <tags>
        <tag>React</tag>
        <tag>hooks</tag>
      </tags>
  </entry>
  <entry>
    <title>React Hooks 系列之 useReducer</title>
    <url>/2020/06/13/395.html</url>
    <content><![CDATA[<p>掌握 React Hooks api 将更好的帮助你在工作中使用，对 React 的掌握更上一层楼。</p>
<p>首先我们将讲讲什么是 reducer，以及为什么使用 reducer。研究一下 JavaScript 中的 reducer 是什么，这将有助于理解 react hook 中的 <code>useReducer</code>。好，现在开始吧。</p>
<h2 id="什么是-useReducer"><a href="#什么是-useReducer" class="headerlink" title="什么是 useReducer"></a>什么是 useReducer</h2><p><code>useReducer</code> 是一个用于状态管理的 hook api。是 <code>useState</code> 的替代方案。</p>
<p>那么 <code>useReducer</code> 和 <code>useState</code> 的区别是什么呢？答案是<code>useState</code> 是使用 <code>useReducer</code> 构建的。</p>
<p>那么什么时候使用 <code>useReducer</code> 还是 <code>useState</code> 呢？我们完成本章的学习就能找到答案。</p>
<h3 id="reducer"><a href="#reducer" class="headerlink" title="reducer"></a>reducer</h3><pre class="language-js" data-language="js"><code class="language-js">useState <span class="token operator">-</span> state
useEffect <span class="token operator">-</span> side effects
useContext <span class="token operator">-</span> context <span class="token constant">API</span>
useReducer <span class="token operator">-</span> reducers</code></pre>

<p>可以看到 useReducer 一定也与 reducer 有关，接下来看看什么是 reducer。之所以要了解什么是 reducer 是为了你不需要掌握 redux 而学会 useReducer，当然，如果你了解Redux，对本章理解会更容易。下面开始</p>
<p>如果你研究过原生 JavaScript，你会发现有一些内置方法，如 <code>foreach</code>, <code>map</code>, <code>reduce</code>。我们来深入看一下 <code>reduce</code> 方法。在 MDN 上可以看到 <a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Array/Reduce"><code>Array.prototype.reduce()</code> 的文档</a>，文档中说</p>
<blockquote>
<p>reduce() 方法对数组中的每个元素执行一个由您提供的 reducer 函数(升序执行)，将其结果汇总为单个返回值。</p>
</blockquote>
<pre class="language-tsx" data-language="tsx"><code class="language-tsx"><span class="token keyword">const</span> array1 <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token function-variable function">reducer</span> <span class="token operator">=</span> <span class="token punctuation">(</span>accumulator<span class="token punctuation">,</span> currentValue<span class="token punctuation">)</span> <span class="token operator">=></span> accumulator <span class="token operator">+</span> currentValue<span class="token punctuation">;</span>

<span class="token comment">// 1 + 2 + 3 + 4</span>
<span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>array1<span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span>reducer<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// expected output: 10</span>

<span class="token comment">// 5 + 1 + 2 + 3 + 4</span>
<span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>array1<span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span>reducer<span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// expected output: 15</span></code></pre>

<p>需要注意的是：reduce 方法接受2个参数，第一个为 reducer 函数，第二个为初始值（给 reducer 函数使用）。reduce 方法返回函数累计处理的结果。</p>
<p>而 reducer 函数有2个必填入参：</p>
<ul>
<li><code>accumulator</code> 累计器累计回调的返回值; 它是上一次调用回调时返回的累积值，或 initialValue。</li>
<li><code>currentValue</code> 数组中正在处理的元素。</li>
</ul>
<h3 id="reducer-与-useReducer"><a href="#reducer-与-useReducer" class="headerlink" title="reducer 与 useReducer"></a>reducer 与 useReducer</h3><p>reducer 与 useReducer 这两者之间有巨大的相似之处。</p>
<table>
<thead>
<tr>
<th>reduce in JavaScript</th>
<th>useReducer in React</th>
</tr>
</thead>
<tbody><tr>
<td><code>array.reduce(reducer, initialValue)</code></td>
<td><code>useReducer(reducer, initialState)</code></td>
</tr>
<tr>
<td><code>singleValue = reducer(accumulator, itemValue)</code></td>
<td><code>newState = reducer(currentState, action)</code></td>
</tr>
<tr>
<td>reduce method returns a single value</td>
<td>useReducer returns a pair of values. [newState, dispatch]</td>
</tr>
</tbody></table>
<p>上述表格目前看不懂也没有关系，后续通过例子会详细说明。</p>
<p>在这一小节我们学到了：</p>
<ul>
<li><code>useReducer</code> 是一个用于状态管理的 hook api。</li>
<li><code>useReducer</code> 与 reducer 函数有关</li>
<li><code>useReducer(reducer, initialState)</code> 接受2个参数，分别为 reducer 函数 和 初始状态</li>
<li><code>reducer(currentState, action)</code> 也是接受2个参数，分别为当前状态和 action，返回一个 new state</li>
</ul>
<h2 id="simple-state-amp-action"><a href="#simple-state-amp-action" class="headerlink" title="simple state &amp; action"></a>simple state &amp; action</h2><p>在本节，我们来看一个计数器的例子，来学习 simple state &amp; action</p>
<ol>
<li>import useReducer api</li>
<li>声明 reducer function 和 initialState</li>
<li>调用执行 reducer</li>
</ol>
<p>CounterOne.tsx</p>
<pre class="language-tsx" data-language="tsx"><code class="language-tsx"><span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">&#123;</span> useReducer <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'react'</span>

<span class="token keyword">const</span> initialState <span class="token operator">=</span> <span class="token number">0</span>
<span class="token keyword">const</span> <span class="token function-variable function">reducer</span> <span class="token operator">=</span> <span class="token punctuation">(</span>state<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">,</span> action<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">switch</span> <span class="token punctuation">(</span>action<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">case</span> <span class="token string">'increment'</span><span class="token operator">:</span>
      <span class="token keyword">return</span> state <span class="token operator">+</span> <span class="token number">1</span>
    <span class="token keyword">case</span> <span class="token string">'decrement'</span><span class="token operator">:</span>
      <span class="token keyword">return</span> state <span class="token operator">-</span> <span class="token number">1</span>
    <span class="token keyword">case</span> <span class="token string">'reset'</span><span class="token operator">:</span>
      <span class="token keyword">return</span> initialState
    <span class="token keyword">default</span><span class="token operator">:</span>
      <span class="token keyword">return</span> state
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">function</span> <span class="token function">CounterOne</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>count<span class="token punctuation">,</span> dispatch<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useReducer</span><span class="token punctuation">(</span>reducer<span class="token punctuation">,</span> initialState<span class="token punctuation">)</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span><span class="token plain-text">Count - </span><span class="token punctuation">&#123;</span>count<span class="token punctuation">&#125;</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span>
        <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">&#123;</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token string">'increment'</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span></span>
      <span class="token punctuation">></span></span><span class="token plain-text">Increment</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span>
        <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">&#123;</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token string">'decrement'</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span></span>
      <span class="token punctuation">></span></span><span class="token plain-text">Decrement</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span>
        <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">&#123;</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token string">'reset'</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span></span>
      <span class="token punctuation">></span></span><span class="token plain-text">Reset</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
  <span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> CounterOne</code></pre>

<p>App.tsx</p>
<pre class="language-tsx" data-language="tsx"><code class="language-tsx"><span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">'react'</span>

<span class="token keyword">import</span> <span class="token string">'./App.css'</span>

<span class="token keyword">import</span> CounterOne <span class="token keyword">from</span> <span class="token string">'./components/19CounterOne'</span>

<span class="token keyword">const</span> <span class="token function-variable function">App</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">className</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>App<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">CounterOne</span></span> <span class="token punctuation">/></span></span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
  <span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> App</code></pre>

<p>页面展示如下：</p>
<p><img src="https://gw.alicdn.com/tfs/TB17DPMFLb2gK0jSZK9XXaEgFXa-432-209.gif" alt="img"></p>
<p>在回顾一下代码，首先 import useReducer</p>
<pre class="language-tsx" data-language="tsx"><code class="language-tsx"><span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">&#123;</span> useReducer <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'react'</span></code></pre>

<p>然后调用 useReducer</p>
<pre class="language-tsx" data-language="tsx"><code class="language-tsx"><span class="token keyword">const</span> <span class="token punctuation">[</span>count<span class="token punctuation">,</span> dispatch<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useReducer</span><span class="token punctuation">(</span>reducer<span class="token punctuation">,</span> initialState<span class="token punctuation">)</span></code></pre>

<p>声明 reducer, initialState</p>
<pre class="language-tsx" data-language="tsx"><code class="language-tsx"><span class="token keyword">const</span> initialState <span class="token operator">=</span> <span class="token number">0</span>
<span class="token keyword">const</span> <span class="token function-variable function">reducer</span> <span class="token operator">=</span> <span class="token punctuation">(</span>state<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">,</span> action<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">switch</span> <span class="token punctuation">(</span>action<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">case</span> <span class="token string">'increment'</span><span class="token operator">:</span>
      <span class="token keyword">return</span> state <span class="token operator">+</span> <span class="token number">1</span>
    <span class="token keyword">case</span> <span class="token string">'decrement'</span><span class="token operator">:</span>
      <span class="token keyword">return</span> state <span class="token operator">-</span> <span class="token number">1</span>
    <span class="token keyword">case</span> <span class="token string">'reset'</span><span class="token operator">:</span>
      <span class="token keyword">return</span> initialState
    <span class="token keyword">default</span><span class="token operator">:</span>
      <span class="token keyword">return</span> state
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span></code></pre>

<p>reducer function 的2个参数，分别为当前 state 和 action， 并根据不同的 action 返回不同的新的 state。</p>
<p>useReducer 返回了一个数组，2个元素分别为 state 和 dispatch 方法。其中 state 在我们的例子中就是当前的 count 值，dispatch 方法接受一个参数，执行对应的 action。dispatch 执行后，对应的 state 会改变，组件会 rerender，来展示最新的状态。</p>
<p>这就是使用 simple state 和 simple action 的例子，本例中 state 是一个 number 类型，action 也是简单的 string 类型，这和 Redux 的模式稍有不同。接下来我们看一个稍复杂的例子。</p>
<h2 id="complex-state-amp-action"><a href="#complex-state-amp-action" class="headerlink" title="complex state &amp; action"></a>complex state &amp; action</h2><p>下面我们看第二个例子。将使用对象作为 state 和 action 的值，这就比较类似 Redux 的模式了。</p>
<p>CounterTwo.tsx</p>
<pre class="language-tsx" data-language="tsx"><code class="language-tsx"><span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">&#123;</span> useReducer <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'react'</span>

<span class="token keyword">const</span> initialState <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
  firstCounter<span class="token operator">:</span> <span class="token number">0</span>
<span class="token punctuation">&#125;</span>
<span class="token keyword">const</span> <span class="token function-variable function">reducer</span> <span class="token operator">=</span> <span class="token punctuation">(</span>
  state<span class="token operator">:</span> <span class="token punctuation">&#123;</span>
    firstCounter<span class="token operator">:</span> <span class="token builtin">number</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
  action<span class="token operator">:</span> <span class="token punctuation">&#123;</span>
    type<span class="token operator">:</span> <span class="token builtin">string</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">switch</span> <span class="token punctuation">(</span>action<span class="token punctuation">.</span>type<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">case</span> <span class="token string">'increment'</span><span class="token operator">:</span>
      <span class="token keyword">return</span> <span class="token punctuation">&#123;</span>
        firstCounter<span class="token operator">:</span> state<span class="token punctuation">.</span>firstCounter <span class="token operator">+</span> <span class="token number">1</span>
      <span class="token punctuation">&#125;</span>
    <span class="token keyword">case</span> <span class="token string">'decrement'</span><span class="token operator">:</span>
      <span class="token keyword">return</span> <span class="token punctuation">&#123;</span>
        firstCounter<span class="token operator">:</span> state<span class="token punctuation">.</span>firstCounter <span class="token operator">-</span> <span class="token number">1</span>
      <span class="token punctuation">&#125;</span>
    <span class="token keyword">case</span> <span class="token string">'reset'</span><span class="token operator">:</span>
      <span class="token keyword">return</span> initialState
    <span class="token keyword">default</span><span class="token operator">:</span>
      <span class="token keyword">return</span> state
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">function</span> <span class="token function">CounterTwo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>count<span class="token punctuation">,</span> dispatch<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useReducer</span><span class="token punctuation">(</span>reducer<span class="token punctuation">,</span> initialState<span class="token punctuation">)</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span><span class="token plain-text">Count - </span><span class="token punctuation">&#123;</span>count<span class="token punctuation">.</span>firstCounter<span class="token punctuation">&#125;</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span>
        <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">&#123;</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span> type<span class="token operator">:</span> <span class="token string">'increment'</span> <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span></span>
      <span class="token punctuation">></span></span><span class="token plain-text">Increment</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span>
        <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">&#123;</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span> type<span class="token operator">:</span> <span class="token string">'decrement'</span> <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span></span>
      <span class="token punctuation">></span></span><span class="token plain-text">Decrement</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span>
        <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">&#123;</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span> type<span class="token operator">:</span> <span class="token string">'reset'</span> <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span></span>
      <span class="token punctuation">></span></span><span class="token plain-text">Reset</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
  <span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> CounterTwo</code></pre>

<p>App.tsx</p>
<pre class="language-tsx" data-language="tsx"><code class="language-tsx"><span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">'react'</span>

<span class="token keyword">import</span> <span class="token string">'./App.css'</span>

<span class="token keyword">import</span> CounterTwo <span class="token keyword">from</span> <span class="token string">'./components/20CountTwo'</span>

<span class="token keyword">const</span> <span class="token function-variable function">App</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">className</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>App<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">CounterTwo</span></span> <span class="token punctuation">/></span></span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
  <span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> App</code></pre>

<p>页面展示如下：</p>
<p><img src="https://gw.alicdn.com/tfs/TB17DPMFLb2gK0jSZK9XXaEgFXa-432-209.gif" alt="img"></p>
<p>与上一节的示例效果相同。现在，我们已经将 state 和 action 都改写为对象了，那么这样写有什么好处呢？</p>
<p>其一的好处是 action 现在是一个对象了，可以有多个属性决定 action 的效果。例如我们再添加一个 +5 的逻辑。</p>
<p>CounterTwo.tsx</p>
<pre class="language-tsx" data-language="tsx"><code class="language-tsx"><span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">&#123;</span> useReducer <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'react'</span>

<span class="token keyword">const</span> initialState <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
  firstCounter<span class="token operator">:</span> <span class="token number">0</span>
<span class="token punctuation">&#125;</span>
<span class="token keyword">const</span> <span class="token function-variable function">reducer</span> <span class="token operator">=</span> <span class="token punctuation">(</span>
  state<span class="token operator">:</span> <span class="token punctuation">&#123;</span>
    firstCounter<span class="token operator">:</span> <span class="token builtin">number</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
  action<span class="token operator">:</span> <span class="token punctuation">&#123;</span>
    type<span class="token operator">:</span> <span class="token builtin">string</span>
    value<span class="token operator">:</span> <span class="token builtin">number</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">switch</span> <span class="token punctuation">(</span>action<span class="token punctuation">.</span>type<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">case</span> <span class="token string">'increment'</span><span class="token operator">:</span>
      <span class="token keyword">return</span> <span class="token punctuation">&#123;</span>
        firstCounter<span class="token operator">:</span> state<span class="token punctuation">.</span>firstCounter <span class="token operator">+</span> action<span class="token punctuation">.</span>value
      <span class="token punctuation">&#125;</span>
    <span class="token keyword">case</span> <span class="token string">'decrement'</span><span class="token operator">:</span>
      <span class="token keyword">return</span> <span class="token punctuation">&#123;</span>
        firstCounter<span class="token operator">:</span> state<span class="token punctuation">.</span>firstCounter <span class="token operator">-</span> action<span class="token punctuation">.</span>value
      <span class="token punctuation">&#125;</span>
    <span class="token keyword">case</span> <span class="token string">'reset'</span><span class="token operator">:</span>
      <span class="token keyword">return</span> initialState
    <span class="token keyword">default</span><span class="token operator">:</span>
      <span class="token keyword">return</span> state
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">function</span> <span class="token function">CounterTwo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>count<span class="token punctuation">,</span> dispatch<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useReducer</span><span class="token punctuation">(</span>reducer<span class="token punctuation">,</span> initialState<span class="token punctuation">)</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span><span class="token plain-text">Count - </span><span class="token punctuation">&#123;</span>count<span class="token punctuation">.</span>firstCounter<span class="token punctuation">&#125;</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span>
        <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">&#123;</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
          type<span class="token operator">:</span> <span class="token string">'increment'</span><span class="token punctuation">,</span>
          value<span class="token operator">:</span> <span class="token number">1</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span></span>
      <span class="token punctuation">></span></span><span class="token plain-text">Increment</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span>
        <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">&#123;</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
          type<span class="token operator">:</span> <span class="token string">'decrement'</span><span class="token punctuation">,</span>
          value<span class="token operator">:</span> <span class="token number">1</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span></span>
      <span class="token punctuation">></span></span><span class="token plain-text">Decrement</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span>
        <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">&#123;</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
          type<span class="token operator">:</span> <span class="token string">'increment'</span><span class="token punctuation">,</span>
          value<span class="token operator">:</span> <span class="token number">5</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span></span>
      <span class="token punctuation">></span></span><span class="token plain-text">Increment 5</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span>
        <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">&#123;</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
          type<span class="token operator">:</span> <span class="token string">'decrement'</span><span class="token punctuation">,</span>
          value<span class="token operator">:</span> <span class="token number">5</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span></span>
      <span class="token punctuation">></span></span><span class="token plain-text">Decrement 5</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span>
        <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">&#123;</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span> type<span class="token operator">:</span> <span class="token string">'reset'</span><span class="token punctuation">,</span> value<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span></span>
      <span class="token punctuation">></span></span><span class="token plain-text">Reset</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
  <span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> CounterTwo</code></pre>

<p>页面展示如下： <img src="https://gw.alicdn.com/tfs/TB1YCL3FKL2gK0jSZFmXXc7iXXa-432-209.gif" alt="img"></p>
<p>可以注意到给 action 增加了一个 value 属性，实现了加减 5 的逻辑。</p>
<p>第二个好处是 state 作为一个对象，就可以添加更多的 state 属性，例如我们在增加一个计数器2，代码如下：</p>
<pre class="language-tsx" data-language="tsx"><code class="language-tsx"><span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">&#123;</span> useReducer <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'react'</span>

<span class="token keyword">const</span> initialState <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
  firstCounter<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
  secondCounter<span class="token operator">:</span> <span class="token number">10</span><span class="token punctuation">,</span>
<span class="token punctuation">&#125;</span>
<span class="token keyword">const</span> <span class="token function-variable function">reducer</span> <span class="token operator">=</span> <span class="token punctuation">(</span>
  state<span class="token operator">:</span> <span class="token punctuation">&#123;</span>
    firstCounter<span class="token operator">:</span> <span class="token builtin">number</span>
    secondCounter<span class="token operator">:</span> <span class="token builtin">number</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
  action<span class="token operator">:</span> <span class="token punctuation">&#123;</span>
    type<span class="token operator">:</span> <span class="token builtin">string</span>
    value<span class="token operator">:</span> <span class="token builtin">number</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">switch</span> <span class="token punctuation">(</span>action<span class="token punctuation">.</span>type<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">case</span> <span class="token string">'increment'</span><span class="token operator">:</span>
      <span class="token keyword">return</span> <span class="token punctuation">&#123;</span>
        <span class="token operator">...</span>state<span class="token punctuation">,</span>
        firstCounter<span class="token operator">:</span> state<span class="token punctuation">.</span>firstCounter <span class="token operator">+</span> action<span class="token punctuation">.</span>value
      <span class="token punctuation">&#125;</span>
    <span class="token keyword">case</span> <span class="token string">'decrement'</span><span class="token operator">:</span>
      <span class="token keyword">return</span> <span class="token punctuation">&#123;</span>
        <span class="token operator">...</span>state<span class="token punctuation">,</span>
        firstCounter<span class="token operator">:</span> state<span class="token punctuation">.</span>firstCounter <span class="token operator">-</span> action<span class="token punctuation">.</span>value
      <span class="token punctuation">&#125;</span>
    <span class="token keyword">case</span> <span class="token string">'increment2'</span><span class="token operator">:</span>
      <span class="token keyword">return</span> <span class="token punctuation">&#123;</span>
        <span class="token operator">...</span>state<span class="token punctuation">,</span>
        secondCounter<span class="token operator">:</span> state<span class="token punctuation">.</span>secondCounter <span class="token operator">+</span> action<span class="token punctuation">.</span>value
      <span class="token punctuation">&#125;</span>
    <span class="token keyword">case</span> <span class="token string">'decrement2'</span><span class="token operator">:</span>
      <span class="token keyword">return</span> <span class="token punctuation">&#123;</span>
        <span class="token operator">...</span>state<span class="token punctuation">,</span>
        secondCounter<span class="token operator">:</span> state<span class="token punctuation">.</span>secondCounter <span class="token operator">-</span> action<span class="token punctuation">.</span>value
      <span class="token punctuation">&#125;</span>
    <span class="token keyword">case</span> <span class="token string">'reset'</span><span class="token operator">:</span>
      <span class="token keyword">return</span> initialState
    <span class="token keyword">default</span><span class="token operator">:</span>
      <span class="token keyword">return</span> state
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">function</span> <span class="token function">CounterTwo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>count<span class="token punctuation">,</span> dispatch<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useReducer</span><span class="token punctuation">(</span>reducer<span class="token punctuation">,</span> initialState<span class="token punctuation">)</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span><span class="token plain-text">First Count - </span><span class="token punctuation">&#123;</span>count<span class="token punctuation">.</span>firstCounter<span class="token punctuation">&#125;</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span><span class="token plain-text">Second Count - </span><span class="token punctuation">&#123;</span>count<span class="token punctuation">.</span>secondCounter<span class="token punctuation">&#125;</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span>
        <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">&#123;</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
          type<span class="token operator">:</span> <span class="token string">'increment'</span><span class="token punctuation">,</span>
          value<span class="token operator">:</span> <span class="token number">1</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span></span>
      <span class="token punctuation">></span></span><span class="token plain-text">Increment</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span>
        <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">&#123;</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
          type<span class="token operator">:</span> <span class="token string">'decrement'</span><span class="token punctuation">,</span>
          value<span class="token operator">:</span> <span class="token number">1</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span></span>
      <span class="token punctuation">></span></span><span class="token plain-text">Decrement</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span>
        <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">&#123;</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
          type<span class="token operator">:</span> <span class="token string">'increment'</span><span class="token punctuation">,</span>
          value<span class="token operator">:</span> <span class="token number">5</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span></span>
      <span class="token punctuation">></span></span><span class="token plain-text">Increment 5</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span>
        <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">&#123;</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
          type<span class="token operator">:</span> <span class="token string">'decrement'</span><span class="token punctuation">,</span>
          value<span class="token operator">:</span> <span class="token number">5</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span></span>
      <span class="token punctuation">></span></span><span class="token plain-text">Decrement 5</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span>
          <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">&#123;</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
            type<span class="token operator">:</span> <span class="token string">'increment2'</span><span class="token punctuation">,</span>
            value<span class="token operator">:</span> <span class="token number">1</span>
          <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span></span>
        <span class="token punctuation">></span></span><span class="token plain-text">Increment second</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span>
          <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">&#123;</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
            type<span class="token operator">:</span> <span class="token string">'decrement2'</span><span class="token punctuation">,</span>
            value<span class="token operator">:</span> <span class="token number">1</span>
          <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span></span>
        <span class="token punctuation">></span></span><span class="token plain-text">Decrement second</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span>
        <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">&#123;</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span> type<span class="token operator">:</span> <span class="token string">'reset'</span><span class="token punctuation">,</span> value<span class="token operator">:</span> <span class="token number">0</span> <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span></span>
      <span class="token punctuation">></span></span><span class="token plain-text">Reset</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
  <span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> CounterTwo</code></pre>

<p>页面展示效果如下</p>
<p><img src="https://gw.alicdn.com/tfs/TB1SQPZFFY7gK0jSZKzXXaikpXa-432-209.gif" alt="img"></p>
<p>这样我们就能同时维护 2 个计时器。</p>
<h2 id="multiple-useReducers"><a href="#multiple-useReducers" class="headerlink" title="multiple useReducers"></a>multiple useReducers</h2><p>如果有多个 state，但 state 变化的方式又是相同的时候，可以多次使用 useReducer。</p>
<p>CounterThree.tsx</p>
<pre class="language-tsx" data-language="tsx"><code class="language-tsx"><span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">&#123;</span> useReducer <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'react'</span>

<span class="token keyword">const</span> initialState <span class="token operator">=</span> <span class="token number">0</span>
<span class="token keyword">const</span> <span class="token function-variable function">reducer</span> <span class="token operator">=</span> <span class="token punctuation">(</span>state<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">,</span> action<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">switch</span> <span class="token punctuation">(</span>action<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">case</span> <span class="token string">'increment'</span><span class="token operator">:</span>
      <span class="token keyword">return</span> state <span class="token operator">+</span> <span class="token number">1</span>
    <span class="token keyword">case</span> <span class="token string">'decrement'</span><span class="token operator">:</span>
      <span class="token keyword">return</span> state <span class="token operator">-</span> <span class="token number">1</span>
    <span class="token keyword">case</span> <span class="token string">'reset'</span><span class="token operator">:</span>
      <span class="token keyword">return</span> initialState
    <span class="token keyword">default</span><span class="token operator">:</span>
      <span class="token keyword">return</span> state
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">function</span> <span class="token function">CounterThree</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>count<span class="token punctuation">,</span> dispatch<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useReducer</span><span class="token punctuation">(</span>reducer<span class="token punctuation">,</span> initialState<span class="token punctuation">)</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>countTwo<span class="token punctuation">,</span> dispatchTwo<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useReducer</span><span class="token punctuation">(</span>reducer<span class="token punctuation">,</span> initialState<span class="token punctuation">)</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span><span class="token plain-text">Count - </span><span class="token punctuation">&#123;</span>count<span class="token punctuation">&#125;</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span>
        <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">&#123;</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token string">'increment'</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span></span>
      <span class="token punctuation">></span></span><span class="token plain-text">Increment</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span>
        <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">&#123;</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token string">'decrement'</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span></span>
      <span class="token punctuation">></span></span><span class="token plain-text">Decrement</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span>
        <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">&#123;</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token string">'reset'</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span></span>
      <span class="token punctuation">></span></span><span class="token plain-text">Reset</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span><span class="token plain-text">

      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span><span class="token punctuation">/></span></span><span class="token plain-text">

      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span><span class="token plain-text">CountTwo - </span><span class="token punctuation">&#123;</span>countTwo<span class="token punctuation">&#125;</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span>
        <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">&#123;</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">dispatchTwo</span><span class="token punctuation">(</span><span class="token string">'increment'</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span></span>
      <span class="token punctuation">></span></span><span class="token plain-text">Increment</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span>
        <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">&#123;</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">dispatchTwo</span><span class="token punctuation">(</span><span class="token string">'decrement'</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span></span>
      <span class="token punctuation">></span></span><span class="token plain-text">Decrement</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span>
        <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">&#123;</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">dispatchTwo</span><span class="token punctuation">(</span><span class="token string">'reset'</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span></span>
      <span class="token punctuation">></span></span><span class="token plain-text">Reset</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
  <span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> CounterThree</code></pre>

<p>页面展示如下</p>
<p><img src="https://gw.alicdn.com/tfs/TB1f9P5FKT2gK0jSZFvXXXnFXXa-432-209.gif" alt="img"></p>
<p>这个例子中使用了多个 useReducer，但共用了一个 reducer function。这有效的避免了合并对象的麻烦（可以对比上一节使用展开运算法合并 state）。也提高了代码的复用性。</p>
<h2 id="useReducer-with-useContext"><a href="#useReducer-with-useContext" class="headerlink" title="useReducer with useContext"></a>useReducer with useContext</h2><p>截止目前我们已经学习了在组件内使用 useReducer 进行状态管理。如果在某些场景想再组件之间分享 state，进行全局的 state 管理时，我们可以使用 useReducer 加 useContext。</p>
<p>考虑这样一个场景，有3个子组件A, B, C，要在子组件内控制同一个计数器，常规的写法是将 counter 的方法写到父组件上，然后通过 props 的方式将 counter 方法和 state 传给子组件，子组件中调用通过 props 传入的 counter 方法，就会改变父组件中的 state，同时也能改变作为 props 传递给子组件的 app 中的 state。如下图：</p>
<p><img src="https://gw.alicdn.com/tfs/TB14QMhFQL0gK0jSZFAXXcA9pXa-717-274.png" alt="img"></p>
<p>看起来没什么问题，但是如果组件嵌套比较深的时候，这将非常糟糕，要一层一层将 counter 方法作为 props 传递给子组件。这时就要使用 useContext 加 useReducer 了。</p>
<p><img src="https://gw.alicdn.com/tfs/TB18LclFUY1gK0jSZFCXXcwqXXa-717-488.png" alt="img"></p>
<p>要完成这个需求分为 2 步</p>
<ol>
<li>使用 useReducer 在根节点创建一个 counter 方法</li>
<li>通过 useContext 为子组件提供和消费 context</li>
</ol>
<p>App.tsx</p>
<pre class="language-tsx" data-language="tsx"><code class="language-tsx"><span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">&#123;</span> useReducer <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'react'</span>
<span class="token keyword">import</span> <span class="token string">'./App.css'</span>
<span class="token keyword">import</span> <span class="token constant">A</span> <span class="token keyword">from</span> <span class="token string">'./components/22A'</span>
<span class="token keyword">import</span> <span class="token constant">B</span> <span class="token keyword">from</span> <span class="token string">'./components/22B'</span>
<span class="token keyword">import</span> <span class="token constant">C</span> <span class="token keyword">from</span> <span class="token string">'./components/22C'</span>

<span class="token keyword">interface</span> <span class="token class-name">CountContextType</span> <span class="token punctuation">&#123;</span>
  countState<span class="token operator">:</span> <span class="token builtin">number</span>
  <span class="token function-variable function">countDispatch</span><span class="token operator">:</span> <span class="token punctuation">(</span>action<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token keyword">void</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">export</span> <span class="token keyword">const</span> CountContext <span class="token operator">=</span> React<span class="token punctuation">.</span><span class="token function">createContext</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span> <span class="token keyword">as</span> CountContextType<span class="token punctuation">)</span>

<span class="token keyword">const</span> initialState <span class="token operator">=</span> <span class="token number">0</span>
<span class="token keyword">const</span> <span class="token function-variable function">reducer</span> <span class="token operator">=</span> <span class="token punctuation">(</span>state<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">,</span> action<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">switch</span> <span class="token punctuation">(</span>action<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">case</span> <span class="token string">'increment'</span><span class="token operator">:</span>
      <span class="token keyword">return</span> state <span class="token operator">+</span> <span class="token number">1</span>
    <span class="token keyword">case</span> <span class="token string">'decrement'</span><span class="token operator">:</span>
      <span class="token keyword">return</span> state <span class="token operator">-</span> <span class="token number">1</span>
    <span class="token keyword">case</span> <span class="token string">'reset'</span><span class="token operator">:</span>
      <span class="token keyword">return</span> initialState
    <span class="token keyword">default</span><span class="token operator">:</span>
      <span class="token keyword">return</span> state
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">const</span> <span class="token function-variable function">App</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>count<span class="token punctuation">,</span> dispatch<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useReducer</span><span class="token punctuation">(</span>reducer<span class="token punctuation">,</span> initialState<span class="token punctuation">)</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">CountContext.Provider</span></span>
      <span class="token attr-name">value</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#123;</span>
        countState<span class="token operator">:</span> count<span class="token punctuation">,</span>
        countDispatch<span class="token operator">:</span> dispatch<span class="token punctuation">,</span>
      <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></span>
    <span class="token punctuation">></span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">className</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>App<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token plain-text">
        Count - </span><span class="token punctuation">&#123;</span>count<span class="token punctuation">&#125;</span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">A</span></span> <span class="token punctuation">/></span></span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">B</span></span> <span class="token punctuation">/></span></span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">C</span></span> <span class="token punctuation">/></span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">CountContext.Provider</span></span><span class="token punctuation">></span></span>
  <span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> App</code></pre>

<p>A.tsx</p>
<pre class="language-tsx" data-language="tsx"><code class="language-tsx"><span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">&#123;</span> useContext <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'react'</span>
<span class="token keyword">import</span> <span class="token punctuation">&#123;</span> CountContext <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'../App'</span>

<span class="token keyword">function</span> <span class="token constant">A</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">const</span> countContext <span class="token operator">=</span> <span class="token function">useContext</span><span class="token punctuation">(</span>CountContext<span class="token punctuation">)</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span><span class="token plain-text">
      A - </span><span class="token punctuation">&#123;</span>countContext<span class="token punctuation">.</span>countState<span class="token punctuation">&#125;</span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span>
        <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">&#123;</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> countContext<span class="token punctuation">.</span><span class="token function">countDispatch</span><span class="token punctuation">(</span><span class="token string">'increment'</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span></span>
      <span class="token punctuation">></span></span><span class="token plain-text">Increment</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span>
        <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">&#123;</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> countContext<span class="token punctuation">.</span><span class="token function">countDispatch</span><span class="token punctuation">(</span><span class="token string">'decrement'</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span></span>
      <span class="token punctuation">></span></span><span class="token plain-text">Decrement</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span>
        <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">&#123;</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> countContext<span class="token punctuation">.</span><span class="token function">countDispatch</span><span class="token punctuation">(</span><span class="token string">'reset'</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span></span>
      <span class="token punctuation">></span></span><span class="token plain-text">Reset</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
  <span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token constant">A</span></code></pre>

<p>B.tsx</p>
<pre class="language-none"><code class="language-none">import React from &#39;react&#39;
import D from &#39;.&#x2F;22D&#39;

function B() &#123;
  return (
    &lt;div&gt;
      &lt;D &#x2F;&gt;
    &lt;&#x2F;div&gt;
  )
&#125;

export default B</code></pre>

<p>C.tsx</p>
<pre class="language-tsx" data-language="tsx"><code class="language-tsx"><span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">'react'</span>
<span class="token keyword">import</span> <span class="token constant">E</span> <span class="token keyword">from</span> <span class="token string">'./22E'</span>

<span class="token keyword">function</span> <span class="token constant">C</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">E</span></span> <span class="token punctuation">/></span></span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
  <span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token constant">C</span></code></pre>

<p>D.tsx</p>
<pre class="language-tsx" data-language="tsx"><code class="language-tsx"><span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">&#123;</span> useContext <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'react'</span>
<span class="token keyword">import</span> <span class="token punctuation">&#123;</span> CountContext <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'../App'</span>

<span class="token keyword">function</span> <span class="token constant">D</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">const</span> countContext <span class="token operator">=</span> <span class="token function">useContext</span><span class="token punctuation">(</span>CountContext<span class="token punctuation">)</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span><span class="token plain-text">
      D - </span><span class="token punctuation">&#123;</span>countContext<span class="token punctuation">.</span>countState<span class="token punctuation">&#125;</span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span>
        <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">&#123;</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> countContext<span class="token punctuation">.</span><span class="token function">countDispatch</span><span class="token punctuation">(</span><span class="token string">'increment'</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span></span>
      <span class="token punctuation">></span></span><span class="token plain-text">Increment</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span>
        <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">&#123;</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> countContext<span class="token punctuation">.</span><span class="token function">countDispatch</span><span class="token punctuation">(</span><span class="token string">'decrement'</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span></span>
      <span class="token punctuation">></span></span><span class="token plain-text">Decrement</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span>
        <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">&#123;</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> countContext<span class="token punctuation">.</span><span class="token function">countDispatch</span><span class="token punctuation">(</span><span class="token string">'reset'</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span></span>
      <span class="token punctuation">></span></span><span class="token plain-text">Reset</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
  <span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token constant">D</span></code></pre>

<p>E.tsx</p>
<pre class="language-tsx" data-language="tsx"><code class="language-tsx"><span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">'react'</span>

<span class="token keyword">import</span> <span class="token constant">F</span> <span class="token keyword">from</span> <span class="token string">'./22F'</span>

<span class="token keyword">function</span> <span class="token constant">E</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">F</span></span> <span class="token punctuation">/></span></span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
  <span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token constant">E</span></code></pre>

<p>F.tsx</p>
<pre class="language-tsx" data-language="tsx"><code class="language-tsx"><span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">&#123;</span> useContext <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'react'</span>
<span class="token keyword">import</span> <span class="token punctuation">&#123;</span> CountContext <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'../App'</span>

<span class="token keyword">function</span> <span class="token constant">F</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">const</span> countContext <span class="token operator">=</span> <span class="token function">useContext</span><span class="token punctuation">(</span>CountContext<span class="token punctuation">)</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span><span class="token plain-text">
      F - </span><span class="token punctuation">&#123;</span>countContext<span class="token punctuation">.</span>countState<span class="token punctuation">&#125;</span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span>
        <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">&#123;</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> countContext<span class="token punctuation">.</span><span class="token function">countDispatch</span><span class="token punctuation">(</span><span class="token string">'increment'</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span></span>
      <span class="token punctuation">></span></span><span class="token plain-text">Increment</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span>
        <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">&#123;</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> countContext<span class="token punctuation">.</span><span class="token function">countDispatch</span><span class="token punctuation">(</span><span class="token string">'decrement'</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span></span>
      <span class="token punctuation">></span></span><span class="token plain-text">Decrement</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span>
        <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">&#123;</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> countContext<span class="token punctuation">.</span><span class="token function">countDispatch</span><span class="token punctuation">(</span><span class="token string">'reset'</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span></span>
      <span class="token punctuation">></span></span><span class="token plain-text">Reset</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
  <span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token constant">F</span></code></pre>

<p>页面效果如下</p>
<p><img src="https://gw.alicdn.com/tfs/TB19OorFHj1gK0jSZFuXXcrHpXa-432-209.gif" alt="img"></p>
<p>我们再一起回顾一下</p>
<ol>
<li>在 App.tsx 中，我们使用 useReducer 创建了一个 counter，声明了初始值，创建了 reducer 函数，useReducer 返回了状态 count 和 dispatch 方法。</li>
<li>为了能让其他组件访问到 count 和 dispatch，我们通过 React.createContext 创建了 CountContext，并用 <code>&lt;CountContext.Provider&gt;</code> 包裹根节点。将 count 和 dispatch 作为 value 传给 Provider。</li>
<li>在子节点中，我们使用 useContext 获取到 count 和 dispatch 方法，通过调用 dispatch 实现对 count 的改变。</li>
</ol>
<h2 id="Fetching-Data-with-useReducer"><a href="#Fetching-Data-with-useReducer" class="headerlink" title="Fetching Data with useReducer"></a>Fetching Data with useReducer</h2><p>之前我们已经在 useEffect 的章节中学习掌握了如何请求数据，当时是使用了 useEffect 和 useState，现在我们再来看看如何使用 useReducer 去请求远程数据。</p>
<p>接下来我们做这样一个小需求：</p>
<ol>
<li>页面载入时请求数据</li>
<li>请求数据中展示 loading 状态</li>
<li>请求返回后移除 loading 样式，展示请求的数据；若请求失败，也移除 loading 展示错误提示</li>
</ol>
<p>我们将分别使用 useState 和 useReducer 来实现，并对比其中的区别。</p>
<h3 id="useState-实现请求"><a href="#useState-实现请求" class="headerlink" title="useState 实现请求"></a>useState 实现请求</h3><p>App.tsx</p>
<pre class="language-tsx" data-language="tsx"><code class="language-tsx"><span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">'react'</span>
<span class="token keyword">import</span> <span class="token string">'./App.css'</span>

<span class="token keyword">import</span> DataFetchingOne <span class="token keyword">from</span> <span class="token string">'./components/23DataFetchingOne'</span>

<span class="token keyword">const</span> <span class="token function-variable function">App</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">className</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>App<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">DataFetchingOne</span></span> <span class="token punctuation">/></span></span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
  <span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> App</code></pre>

<p>DataFetchingOne.tsx</p>
<pre class="language-tsx" data-language="tsx"><code class="language-tsx"><span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">&#123;</span> useState<span class="token punctuation">,</span> useEffect <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'react'</span>
<span class="token keyword">import</span> axios <span class="token keyword">from</span> <span class="token string">'axios'</span>

<span class="token keyword">interface</span> <span class="token class-name">postType</span> <span class="token punctuation">&#123;</span>
  userId<span class="token operator">:</span> <span class="token builtin">number</span>
  id<span class="token operator">:</span> <span class="token builtin">number</span>
  title<span class="token operator">:</span> <span class="token builtin">string</span>
  body<span class="token operator">:</span> <span class="token builtin">string</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">function</span> <span class="token function">DataFetchingOne</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>loading<span class="token punctuation">,</span> setLoading<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>error<span class="token punctuation">,</span> setError<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>post<span class="token punctuation">,</span> setPost<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span> <span class="token keyword">as</span> postType<span class="token punctuation">)</span>

  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    axios<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'https://jsonplaceholder.typicode.com/posts/1'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
      <span class="token function">setLoading</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span>
      <span class="token function">setPost</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>data<span class="token punctuation">)</span>
      <span class="token function">setError</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
      <span class="token function">setLoading</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span>
      <span class="token function">setPost</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span> <span class="token keyword">as</span> postType<span class="token punctuation">)</span>
      <span class="token function">setError</span><span class="token punctuation">(</span><span class="token string">'something went wrong'</span><span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span><span class="token plain-text">
      </span><span class="token punctuation">&#123;</span>
        loading
          <span class="token operator">?</span> <span class="token string">'Loading...'</span>
          <span class="token operator">:</span> post<span class="token punctuation">.</span>title
      <span class="token punctuation">&#125;</span><span class="token plain-text">
      </span><span class="token punctuation">&#123;</span>
        error
          <span class="token operator">?</span> error
          <span class="token operator">:</span> <span class="token keyword">null</span>
      <span class="token punctuation">&#125;</span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
  <span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> DataFetchingOne</code></pre>

<p>页面效果如下</p>
<p><img src="https://gw.alicdn.com/tfs/TB1Gg8wFYr1gK0jSZR0XXbP8XXa-557-209.gif" alt="img"></p>
<p>我们故意改错一个 axios 请求的链接，可以看到如下进入错误的逻辑。</p>
<p><img src="https://gw.alicdn.com/tfs/TB1kHNxFYr1gK0jSZFDXXb9yVXa-557-209.gif" alt="img"></p>
<p>注意到在这个实现中，我们使用了3个useState去控制 loading, post 和 error，接下来看看如何使用 useReducer 实现。</p>
<h3 id="useReducer-实现请求"><a href="#useReducer-实现请求" class="headerlink" title="useReducer 实现请求"></a>useReducer 实现请求</h3><p>App.tsx</p>
<pre class="language-tsx" data-language="tsx"><code class="language-tsx"><span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">'react'</span>
<span class="token keyword">import</span> <span class="token string">'./App.css'</span>

<span class="token keyword">import</span> DataFetchingOne <span class="token keyword">from</span> <span class="token string">'./components/23DataFetchingOne'</span>

<span class="token keyword">const</span> <span class="token function-variable function">App</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">className</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>App<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">DataFetchingOne</span></span> <span class="token punctuation">/></span></span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
  <span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> App
<span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">&#123;</span> useEffect<span class="token punctuation">,</span> useReducer <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'react'</span>
<span class="token keyword">import</span> axios <span class="token keyword">from</span> <span class="token string">'axios'</span>

<span class="token keyword">interface</span> <span class="token class-name">postType</span> <span class="token punctuation">&#123;</span>
  userId<span class="token operator">:</span> <span class="token builtin">number</span>
  id<span class="token operator">:</span> <span class="token builtin">number</span>
  title<span class="token operator">:</span> <span class="token builtin">string</span>
  body<span class="token operator">:</span> <span class="token builtin">string</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">type</span> <span class="token class-name">stateType</span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
  loading<span class="token operator">:</span> <span class="token builtin">boolean</span>
  error<span class="token operator">:</span> <span class="token builtin">string</span>
  post<span class="token operator">?</span><span class="token operator">:</span> postType <span class="token operator">|</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">type</span> <span class="token class-name">actionType</span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
  type<span class="token operator">:</span> <span class="token string">'FETCH_SUCCESS'</span> <span class="token operator">|</span> <span class="token string">'FETCH_ERROR'</span>
  payload<span class="token operator">?</span><span class="token operator">:</span> postType <span class="token operator">|</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">const</span> initialState <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
  loading<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  error<span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span>
  post<span class="token operator">:</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">const</span> <span class="token function-variable function">reducer</span> <span class="token operator">=</span> <span class="token punctuation">(</span>state<span class="token operator">:</span> stateType<span class="token punctuation">,</span> action<span class="token operator">:</span> actionType<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">switch</span> <span class="token punctuation">(</span>action<span class="token punctuation">.</span>type<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">case</span> <span class="token string">'FETCH_SUCCESS'</span><span class="token operator">:</span>
      <span class="token keyword">return</span> <span class="token punctuation">&#123;</span>
        loading<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
        error<span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span>
        post<span class="token operator">:</span> action<span class="token punctuation">.</span>payload<span class="token punctuation">,</span>
      <span class="token punctuation">&#125;</span>
    <span class="token keyword">case</span> <span class="token string">'FETCH_ERROR'</span><span class="token operator">:</span>
      <span class="token keyword">return</span> <span class="token punctuation">&#123;</span>
        loading<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
        error<span class="token operator">:</span> <span class="token string">'something went wrong'</span><span class="token punctuation">,</span>
        post<span class="token operator">:</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
      <span class="token punctuation">&#125;</span>
    <span class="token keyword">default</span><span class="token operator">:</span>
      <span class="token keyword">return</span> state
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">function</span> <span class="token function">DataFetchingTwo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>state<span class="token punctuation">,</span> dispatch<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useReducer</span><span class="token punctuation">(</span>reducer<span class="token punctuation">,</span> initialState<span class="token punctuation">)</span>

  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    axios<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'https://jsonplaceholder.typicode.com/posts/1'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
      <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
        type<span class="token operator">:</span> <span class="token string">'FETCH_SUCCESS'</span><span class="token punctuation">,</span>
        payload<span class="token operator">:</span> res<span class="token punctuation">.</span>data<span class="token punctuation">,</span>
      <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
      <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
        type<span class="token operator">:</span> <span class="token string">'FETCH_ERROR'</span>
      <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span><span class="token plain-text">
      </span><span class="token punctuation">&#123;</span>
        state<span class="token punctuation">.</span>loading
          <span class="token operator">?</span> <span class="token string">'Loading...'</span>
          <span class="token comment">// @ts-ignore</span>
          <span class="token operator">:</span> state<span class="token punctuation">.</span>post<span class="token punctuation">.</span>title
      <span class="token punctuation">&#125;</span><span class="token plain-text">
      </span><span class="token punctuation">&#123;</span>
        state<span class="token punctuation">.</span>error
          <span class="token operator">?</span> state<span class="token punctuation">.</span>error
          <span class="token operator">:</span> <span class="token keyword">null</span>
      <span class="token punctuation">&#125;</span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
  <span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> DataFetchingTwo</code></pre>

<p>页面展示效果与上一个例子相同</p>
<p><img src="https://gw.alicdn.com/tfs/TB1Gg8wFYr1gK0jSZR0XXbP8XXa-557-209.gif" alt="img"></p>
<p>可以看到，我们将 state 集合在了一起，在同一个对象，修改 state 的逻辑也聚合在了一起，即 reducer 函数中的 switch 部分。</p>
<p>至此你可能会好奇，什么时候该用 useState 什么时候该用 useReducer，我们继续往下看。</p>
<h2 id="useState-vs-useReducer"><a href="#useState-vs-useReducer" class="headerlink" title="useState vs useReducer"></a>useState vs useReducer</h2><ul>
<li>如果 state 的类型为 Number, String, Boolean 建议使用 useState，如果 state 的类型 为 Object 或 Array，建议使用 useReducer</li>
<li>如果 state 变化非常多，也是建议使用 useReducer，集中管理 state 变化，便于维护</li>
<li>如果 state 关联变化，建议使用 useReducer</li>
<li>业务逻辑如果很复杂，也建议使用 useReducer</li>
<li>如果 state 只想用在 组件内部，建议使用 useState，如果想维护全局 state 建议使用 useReducer</li>
</ul>
<table>
<thead>
<tr>
<th>Scenario</th>
<th>useState</th>
<th>useReducer</th>
</tr>
</thead>
<tbody><tr>
<td>Type of state</td>
<td>Number, String, Boolean</td>
<td>Object or Array</td>
</tr>
<tr>
<td>Number of state transitions</td>
<td>1 or 2</td>
<td>Too many</td>
</tr>
<tr>
<td>Related state transitions</td>
<td>No</td>
<td>Yes</td>
</tr>
<tr>
<td>Business logic</td>
<td>No business logic</td>
<td>Complex business logic</td>
</tr>
<tr>
<td>local vs global</td>
<td>local</td>
<td>global</td>
</tr>
</tbody></table>
<h2 id="小结"><a href="#小结" class="headerlink" title="小结"></a>小结</h2><p>本章主要讲述了 useReducer 的使用方法。从 JavaScript 中的 reduce api 开始，对比说明了什么是 useReducer。</p>
<p>学习了 useReducer 的简单状态的使用，复杂状态的使用，以及多个 useReducer 的使用。</p>
<p>掌握了组件嵌套多层时使用 useContext 加 useReducer 完成子组件修改全局state的方法，代码更优雅，可维护性更高。</p>
<p>通过对比 useState，学习了如何使用 useEffect 加 useReducer 请求数据，并控制 loading 状态的显示隐藏。</p>
<p>最后对比了 useState 和 useReducer，并给出了使用建议。</p>
]]></content>
      <categories>
        <category>JavaScript</category>
      </categories>
      <tags>
        <tag>React</tag>
        <tag>hooks</tag>
      </tags>
  </entry>
  <entry>
    <title>React_Hooks 系列之 useContext</title>
    <url>/2020/06/10/3080.html</url>
    <content><![CDATA[<p>掌握 React Hooks api 将更好的帮助你在工作中使用，对 React 的掌握更上一层楼。</p>
<p>今天来学习学习 Context 对象和 useContext 的使用方法。</p>
<h2 id="什么是-Context-Api"><a href="#什么是-Context-Api" class="headerlink" title="什么是 Context Api"></a>什么是 Context Api</h2><p>考虑这样一种场景，如果组件树结构如下，现在想从根节点传递一个 userName 的属性到叶子节点 A D F，通过 props 的方式传递，会不可避免的传递通过 B C E，即使这些组件也没有使用这个 userName 属性。</p>
<img src="https://gw.alicdn.com/tfs/TB1Nl38AAT2gK0jSZFkXXcIQFXa-1432-870.png">

<p>如果这样的嵌套树形结构有5层或10层，那么将是灾难式的开发维护体验。如果能不经过中间的节点直接到达需要的地方就可以避免这种问题，这时 Context api 就是来解决这个问题的。</p>
<p>Context api 是在组件树中传递数据但不用每层都经过的一种 api。下面我们一起看看 Context Hook 的使用方法。</p>
<h2 id="使用-Context"><a href="#使用-Context" class="headerlink" title="使用 Context"></a>使用 Context</h2><p>我们举个例子重点看下最右边的分支，C E F，从根节点传递一个变量 username 到 F 节点。</p>
<p>我们先创建好 App, ComponentC, ComponentE, ComponentF, 如下</p>
<p>App.tsx</p>
<pre class="language-tsx" data-language="tsx"><code class="language-tsx"><span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">'react'</span>

<span class="token keyword">import</span> <span class="token string">'./App.css'</span>

<span class="token keyword">import</span> ComponentC <span class="token keyword">from</span> <span class="token string">'./components/16ComponentC'</span>

<span class="token keyword">const</span> <span class="token function-variable function">App</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">className</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>App<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">ComponentC</span></span> <span class="token punctuation">/></span></span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
  <span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> App</code></pre>

<p>ComponentC.tsx</p>
<pre class="language-tsx" data-language="tsx"><code class="language-tsx"><span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">'react'</span>

<span class="token keyword">import</span> ComponentE <span class="token keyword">from</span> <span class="token string">'./16ComponentE'</span>

<span class="token keyword">function</span> <span class="token function">ComponentC</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">ComponentE</span></span> <span class="token punctuation">/></span></span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
  <span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> ComponentC</code></pre>

<p>ComponentE.tsx</p>
<pre class="language-tsx" data-language="tsx"><code class="language-tsx"><span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">'react'</span>

<span class="token keyword">import</span> ComponentF <span class="token keyword">from</span> <span class="token string">'./16ComponentF'</span>

<span class="token keyword">function</span> <span class="token function">ComponentE</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">ComponentF</span></span> <span class="token punctuation">/></span></span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
  <span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> ComponentE</code></pre>

<p>ComponentF.tsx</p>
<pre class="language-tsx" data-language="tsx"><code class="language-tsx"><span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">'react'</span>

<span class="token keyword">function</span> <span class="token function">ComponentF</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span><span class="token plain-text">
      ComponentF
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
  <span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> ComponentF</code></pre>

<p>页面展示如下：</p>
<p><img src="https://gw.alicdn.com/tfs/TB1_nrMFkL0gK0jSZFAXXcA9pXa-438-193.png" alt="img"></p>
<p>接下来我们来研究如何使用 Context 将 username 从 App 传递到 ComponentF，共分为以下3个步骤</p>
<h3 id="创建-context"><a href="#创建-context" class="headerlink" title="创建 context"></a>创建 context</h3><p>在根节点 App.tsx 中使用 <code>createContext()</code> 来创建一个 context</p>
<pre class="language-tsx" data-language="tsx"><code class="language-tsx"><span class="token keyword">const</span> UserContext <span class="token operator">=</span> React<span class="token punctuation">.</span><span class="token function">createContext</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span></code></pre>

<blockquote>
<p>创建一个 Context 对象。当 React 渲染一个订阅了这个 Context 对象的组件，这个组件会从组件树中离自身最近的那个匹配的 Provider 中读取到当前的 context 值。</p>
<p>只有当组件所处的树中没有匹配到 Provider 时，其 defaultValue 参数才会生效。这有助于在不使用 Provider 包装组件的情况下对组件进行测试。注意：将 undefined 传递给 Provider 的 value 时，消费组件的 defaultValue 不会生效。</p>
</blockquote>
<h3 id="提供-Provider"><a href="#提供-Provider" class="headerlink" title="提供 Provider"></a>提供 Provider</h3><p>在根节点中使用 Provider 包裹子节点，将 context 提供给子节点</p>
<pre class="language-tsx" data-language="tsx"><code class="language-tsx"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">UserContext.Provider</span></span> <span class="token attr-name">value</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">&#123;</span><span class="token string">'chuanshi'</span><span class="token punctuation">&#125;</span></span><span class="token punctuation">></span></span><span class="token plain-text">
  </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">ComponentC</span></span> <span class="token punctuation">/></span></span><span class="token plain-text">
</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">UserContext.Provider</span></span><span class="token punctuation">></span></span></code></pre>

<blockquote>
<p>每个 Context 对象都会返回一个 Provider React 组件，它允许消费组件订阅 context 的变化。</p>
<p>Provider 接收一个 <code>value</code> 属性，传递给消费组件。一个 Provider 可以和多个消费组件有对应关系。多个 Provider 也可以嵌套使用，里层的会覆盖外层的数据。</p>
<p>当 Provider 的 <code>value</code> 值发生变化时，它内部的所有消费组件都会重新渲染。Provider 及其内部 consumer 组件都不受制于 <code>shouldComponentUpdate</code> 函数，因此当 consumer 组件在其祖先组件退出更新的情况下也能更新。</p>
<p>通过新旧值检测来确定变化，使用了与 Object.is 相同的算法。</p>
</blockquote>
<p>别忘了将之前定义好的 Context export 出去，以便在子孙节点中引入</p>
<pre class="language-tsx" data-language="tsx"><code class="language-tsx"><span class="token keyword">export</span> <span class="token keyword">const</span> UserContext <span class="token operator">=</span> React<span class="token punctuation">.</span><span class="token function">createContext</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span></code></pre>

<p>此时 App.tsx 的完整代码为</p>
<pre class="language-tsx" data-language="tsx"><code class="language-tsx"><span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">'react'</span>

<span class="token keyword">import</span> <span class="token string">'./App.css'</span>

<span class="token keyword">import</span> ComponentC <span class="token keyword">from</span> <span class="token string">'./components/16ComponentC'</span>

<span class="token keyword">export</span> <span class="token keyword">const</span> UserContext <span class="token operator">=</span> React<span class="token punctuation">.</span><span class="token function">createContext</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> <span class="token function-variable function">App</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">className</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>App<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">UserContext.Provider</span></span> <span class="token attr-name">value</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">&#123;</span><span class="token string">'chuanshi'</span><span class="token punctuation">&#125;</span></span><span class="token punctuation">></span></span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">ComponentC</span></span> <span class="token punctuation">/></span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">UserContext.Provider</span></span><span class="token punctuation">></span></span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
  <span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> App</code></pre>

<h3 id="在使用的节点处消费-Context"><a href="#在使用的节点处消费-Context" class="headerlink" title="在使用的节点处消费 Context"></a>在使用的节点处消费 Context</h3><p>import context 对象</p>
<pre class="language-tsx" data-language="tsx"><code class="language-tsx"><span class="token keyword">import</span> <span class="token punctuation">&#123;</span> UserContext <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'../App'</span></code></pre>

<p>使用 Consumer 进行消费</p>
<pre class="language-tsx" data-language="tsx"><code class="language-tsx"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">UserContext.Consumer</span></span><span class="token punctuation">></span></span><span class="token plain-text">
  </span><span class="token punctuation">&#123;</span>
    <span class="token punctuation">(</span>user<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">(</span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span><span class="token plain-text">
        User context value </span><span class="token punctuation">&#123;</span>user<span class="token punctuation">&#125;</span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
    <span class="token punctuation">)</span>
  <span class="token punctuation">&#125;</span><span class="token plain-text">
</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">UserContext.Consumer</span></span><span class="token punctuation">></span></span></code></pre>

<blockquote>
<p>这里，React 组件也可以订阅到 context 变更。这能让你在函数式组件中完成订阅 context。</p>
<p>这需要函数作为子元素（function as a child）这种做法。这个函数接收当前的 context 值，返回一个 React 节点。传递给函数的 value 值等同于往上组件树离这个 context 最近的 Provider 提供的 value 值。如果没有对应的 Provider，value 参数等同于传递给 createContext() 的 defaultValue。</p>
</blockquote>
<p>完整的 ComponentF.tsx 代码如下</p>
<pre class="language-tsx" data-language="tsx"><code class="language-tsx"><span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">'react'</span>

<span class="token keyword">import</span> <span class="token punctuation">&#123;</span> UserContext <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'../App'</span>

<span class="token keyword">function</span> <span class="token function">ComponentF</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">UserContext.Consumer</span></span><span class="token punctuation">></span></span><span class="token plain-text">
        </span><span class="token punctuation">&#123;</span>
          <span class="token punctuation">(</span>user<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">(</span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span><span class="token plain-text">
              User context value </span><span class="token punctuation">&#123;</span>user<span class="token punctuation">&#125;</span><span class="token plain-text">
            </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
          <span class="token punctuation">)</span>
        <span class="token punctuation">&#125;</span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">UserContext.Consumer</span></span><span class="token punctuation">></span></span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
  <span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> ComponentF</code></pre>

<p>效果如下</p>
<p><img src="https://gw.alicdn.com/tfs/TB1CSB6FpT7gK0jSZFpXXaTkpXa-448-210.png" alt="img"></p>
<p>目前看只有1个 Context 的时候情况还好，下面我们来看看有多个 Context 的情况</p>
<h3 id="多个-Context-情况"><a href="#多个-Context-情况" class="headerlink" title="多个 Context 情况"></a>多个 Context 情况</h3><p>我们在 App.tsx 中再增加一个 Context</p>
<pre class="language-tsx" data-language="tsx"><code class="language-tsx"><span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">'react'</span>

<span class="token keyword">import</span> <span class="token string">'./App.css'</span>

<span class="token keyword">import</span> ComponentC <span class="token keyword">from</span> <span class="token string">'./components/16ComponentC'</span>

<span class="token keyword">export</span> <span class="token keyword">const</span> UserContext <span class="token operator">=</span> React<span class="token punctuation">.</span><span class="token function">createContext</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> ChannelContext <span class="token operator">=</span> React<span class="token punctuation">.</span><span class="token function">createContext</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> <span class="token function-variable function">App</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">className</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>App<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">UserContext.Provider</span></span> <span class="token attr-name">value</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">&#123;</span><span class="token string">'chuanshi'</span><span class="token punctuation">&#125;</span></span><span class="token punctuation">></span></span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">ChannelContext.Provider</span></span> <span class="token attr-name">value</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">&#123;</span><span class="token string">'code volution'</span><span class="token punctuation">&#125;</span></span><span class="token punctuation">></span></span><span class="token plain-text">
          </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">ComponentC</span></span> <span class="token punctuation">/></span></span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">ChannelContext.Provider</span></span><span class="token punctuation">></span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">UserContext.Provider</span></span><span class="token punctuation">></span></span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
  <span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> App</code></pre>

<p>接下来在 component F 中消费它们</p>
<pre class="language-tsx" data-language="tsx"><code class="language-tsx"><span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">'react'</span>

<span class="token keyword">import</span> <span class="token punctuation">&#123;</span> UserContext<span class="token punctuation">,</span> ChannelContext <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'../App'</span>

<span class="token keyword">function</span> <span class="token function">ComponentF</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">UserContext.Consumer</span></span><span class="token punctuation">></span></span><span class="token plain-text">
        </span><span class="token punctuation">&#123;</span>
          <span class="token punctuation">(</span>user<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">(</span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">ChannelContext.Consumer</span></span><span class="token punctuation">></span></span><span class="token plain-text">
              </span><span class="token punctuation">&#123;</span>
                <span class="token punctuation">(</span>channel<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">(</span>
                  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span><span class="token plain-text">
                    User context value </span><span class="token punctuation">&#123;</span>user<span class="token punctuation">&#125;</span><span class="token plain-text">, channel value </span><span class="token punctuation">&#123;</span>channel<span class="token punctuation">&#125;</span><span class="token plain-text">
                  </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
                <span class="token punctuation">)</span>
              <span class="token punctuation">&#125;</span><span class="token plain-text">
            </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">ChannelContext.Consumer</span></span><span class="token punctuation">></span></span>

          <span class="token punctuation">)</span>
        <span class="token punctuation">&#125;</span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">UserContext.Consumer</span></span><span class="token punctuation">></span></span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
  <span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> ComponentF</code></pre>

<p>页面展示如下</p>
<p><img src="https://gw.alicdn.com/tfs/TB1XC47Fvb2gK0jSZK9XXaEgFXa-453-183.png" alt="img"></p>
<p>虽然代码运行没有问题，但是美观性和可读性都不太好，如果使用多个 Context，有个更好的方法，就是使用 Context hook 来解决消费多个 Context 的代码优雅问题。</p>
<h2 id="useContext"><a href="#useContext" class="headerlink" title="useContext"></a>useContext</h2><p>举个例子，我们在上述的 demo 中的 component E 中通过 <code>useContext</code> 使用根节点创建的 Context。分为以下步骤</p>
<ol>
<li>从 react 对象中 import <code>useContext</code> 这个 hook api</li>
<li>import 根节点创建的 Context 对象（可以导入多个）</li>
<li>执行 <code>useContext()</code> 方法，将 Context 传入</li>
</ol>
<p>ComponentE 完整代码:</p>
<pre class="language-tsx" data-language="tsx"><code class="language-tsx"><span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">&#123;</span> useContext <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'react'</span>

<span class="token keyword">import</span> ComponentF <span class="token keyword">from</span> <span class="token string">'./16ComponentF'</span>
<span class="token keyword">import</span> <span class="token punctuation">&#123;</span>UserContext<span class="token punctuation">,</span> ChannelContext<span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'../App'</span>

<span class="token keyword">function</span> <span class="token function">ComponentE</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">const</span> user <span class="token operator">=</span> <span class="token function">useContext</span><span class="token punctuation">(</span>UserContext<span class="token punctuation">)</span>
  <span class="token keyword">const</span> channel <span class="token operator">=</span> <span class="token function">useContext</span><span class="token punctuation">(</span>ChannelContext<span class="token punctuation">)</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">ComponentF</span></span> <span class="token punctuation">/></span></span><span class="token plain-text">
      --- </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span><span class="token punctuation">/></span></span><span class="token plain-text">
      </span><span class="token punctuation">&#123;</span>user<span class="token punctuation">&#125;</span><span class="token plain-text"> - </span><span class="token punctuation">&#123;</span>channel<span class="token punctuation">&#125;</span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
  <span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> ComponentE</code></pre>

<p>页面展示如下</p>
<p><img src="https://gw.alicdn.com/tfs/TB1NnVuFUT1gK0jSZFhXXaAtVXa-453-224.png" alt="img"></p>
<p>其关键的一行代码如下</p>
<pre class="language-tsx" data-language="tsx"><code class="language-tsx"><span class="token keyword">const</span> value <span class="token operator">=</span> <span class="token function">useContext</span><span class="token punctuation">(</span>MyContext<span class="token punctuation">)</span></code></pre>

<blockquote>
<p>useContext 方法接收一个 context 对象（<code>React.createContext</code> 的返回值）并返回该 context 的当前值。当前的 context 值由上层组件中距离当前组件最近的 <code>&lt;MyContext.Provider&gt;</code> 的 <code>value</code> prop 决定。</p>
<p>当组件上层最近的 <code>&lt;MyContext.Provider&gt;</code> 更新时，该 Hook 会触发重渲染，并使用最新传递给 <code>MyContext</code> provider 的 context <code>value</code> 值。即使祖先使用 <code>React.memo</code> 或 <code>shouldComponentUpdate</code>，也会在组件本身使用 <code>useContext</code> 时重新渲染。</p>
<p>可以理解为，<code>useContext(MyContext)</code> 相当于 class 组件中的 <code>static contextType = MyContext</code> 或者 <code>&lt;MyContext.Consumer&gt;</code>。</p>
<p><code>useContext(MyContext)</code> 只是让你能够读取 context 的值以及订阅 context 的变化。你仍然需要在上层组件树中使用 <code>&lt;MyContext.Provider&gt;</code> 来为下层组件提供 context。</p>
</blockquote>
<p>至此，关于 useContext hook api 我们已经掌握了使用方式，可以看到通过 useContext 可以极大的减小多个 Context 使用的代码复杂的问题。</p>
]]></content>
      <categories>
        <category>JavaScript</category>
      </categories>
      <tags>
        <tag>React</tag>
        <tag>hooks</tag>
      </tags>
  </entry>
  <entry>
    <title>React Hooks 系列之 useCallback</title>
    <url>/2020/06/15/397.html</url>
    <content><![CDATA[<p>掌握 React Hooks api 将更好的帮助你在工作中使用，对 React 的掌握更上一层楼。</p>
<p>在我们开始深入学习 useCallback 前，先回顾一下性能优化相关的内容，这将有助于我们理解什么是 useCallback，为什么使用它，以及怎么使用它。</p>
<p>依然先从一个组件多次被复用的代码场景看起。</p>
<h2 id="组件多次被复用的场景"><a href="#组件多次被复用的场景" class="headerlink" title="组件多次被复用的场景"></a>组件多次被复用的场景</h2><p>有如下的，组件树结构。ParentWrap 包含 Title 组件、2次使用 Count 组件、2次使用 Button 组件。</p>
<p>点击 Button，对应的 Count 分别会增加。</p>
<p><img src="https://gw.alicdn.com/tfs/TB1e0AVGpT7gK0jSZFpXXaTkpXa-1270-595.png" alt="img"></p>
<p>App.tsx</p>
<pre class="language-tsx" data-language="tsx"><code class="language-tsx"><span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">'react'</span>
<span class="token keyword">import</span> <span class="token string">'./App.css'</span>

<span class="token keyword">import</span> ParentComponent <span class="token keyword">from</span> <span class="token string">'./components/26ParentComponenet'</span>

<span class="token keyword">const</span> <span class="token function-variable function">App</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">className</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>App<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">ParentComponent</span></span> <span class="token punctuation">/></span></span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
  <span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> App</code></pre>

<p>ParentComponent.tsx</p>
<pre class="language-tsx" data-language="tsx"><code class="language-tsx"><span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">&#123;</span> useState <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'react'</span>
<span class="token keyword">import</span> Title <span class="token keyword">from</span> <span class="token string">'./26Title'</span>
<span class="token keyword">import</span> Count <span class="token keyword">from</span> <span class="token string">'./26Count'</span>
<span class="token keyword">import</span> Button <span class="token keyword">from</span> <span class="token string">'./26Button'</span>

<span class="token keyword">function</span> <span class="token function">ParentComponenet</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>age<span class="token punctuation">,</span> setAge<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token number">29</span><span class="token punctuation">)</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>salary<span class="token punctuation">,</span> setSalary<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token number">50000</span><span class="token punctuation">)</span>
  <span class="token keyword">const</span> <span class="token function-variable function">incrementAge</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    <span class="token function">setAge</span><span class="token punctuation">(</span>age <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span>
  <span class="token punctuation">&#125;</span>
  <span class="token keyword">const</span> <span class="token function-variable function">incrementSalary</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    <span class="token function">setSalary</span><span class="token punctuation">(</span>salary <span class="token operator">+</span> <span class="token number">1000</span><span class="token punctuation">)</span>
  <span class="token punctuation">&#125;</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Title</span></span> <span class="token punctuation">/></span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Count</span></span>
        <span class="token attr-name">text</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Age<span class="token punctuation">"</span></span>
        <span class="token attr-name">count</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">&#123;</span>age<span class="token punctuation">&#125;</span></span>
      <span class="token punctuation">/></span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Button</span></span>
        <span class="token attr-name">handleClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">&#123;</span>incrementAge<span class="token punctuation">&#125;</span></span>
      <span class="token punctuation">></span></span><span class="token plain-text">Increment age</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">Button</span></span><span class="token punctuation">></span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Count</span></span>
        <span class="token attr-name">text</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Salary<span class="token punctuation">"</span></span>
        <span class="token attr-name">count</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">&#123;</span>salary<span class="token punctuation">&#125;</span></span>
      <span class="token punctuation">/></span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Button</span></span>
        <span class="token attr-name">handleClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">&#123;</span>incrementSalary<span class="token punctuation">&#125;</span></span>
      <span class="token punctuation">></span></span><span class="token plain-text">Increment salary</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">Button</span></span><span class="token punctuation">></span></span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
  <span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> ParentComponenet</code></pre>

<p>Title.tsx</p>
<pre class="language-tsx" data-language="tsx"><code class="language-tsx"><span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">'react'</span>

<span class="token keyword">function</span> <span class="token function">Title</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Rendering Title'</span><span class="token punctuation">)</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h2</span><span class="token punctuation">></span></span><span class="token plain-text">useCallback</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h2</span><span class="token punctuation">></span></span>
  <span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> Title</code></pre>

<p>Count.tsx</p>
<pre class="language-tsx" data-language="tsx"><code class="language-tsx"><span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">'react'</span>

<span class="token keyword">function</span> <span class="token function">Count</span><span class="token punctuation">(</span>props<span class="token operator">:</span> <span class="token punctuation">&#123;</span>
  text<span class="token operator">:</span> <span class="token builtin">string</span>
  count<span class="token operator">:</span> <span class="token builtin">number</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Rendering </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>props<span class="token punctuation">.</span>text<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span><span class="token plain-text">
      </span><span class="token punctuation">&#123;</span>props<span class="token punctuation">.</span>text<span class="token punctuation">&#125;</span><span class="token plain-text"> - </span><span class="token punctuation">&#123;</span>props<span class="token punctuation">.</span>count<span class="token punctuation">&#125;</span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
  <span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> Count</code></pre>

<p>Button.tsx</p>
<pre class="language-tsx" data-language="tsx"><code class="language-tsx"><span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">'react'</span>

<span class="token keyword">function</span> <span class="token function">Button</span><span class="token punctuation">(</span>props<span class="token operator">:</span> <span class="token punctuation">&#123;</span>
  <span class="token function-variable function">handleClick</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token keyword">void</span>
  children<span class="token operator">:</span> <span class="token builtin">string</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Rendering button'</span><span class="token punctuation">,</span> props<span class="token punctuation">.</span>children<span class="token punctuation">)</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">&#123;</span>props<span class="token punctuation">.</span>handleClick<span class="token punctuation">&#125;</span></span><span class="token punctuation">></span></span><span class="token plain-text">
      </span><span class="token punctuation">&#123;</span>props<span class="token punctuation">.</span>children<span class="token punctuation">&#125;</span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span>
  <span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> Button</code></pre>

<p>当然，我们可以将所有的 jsx 代码写在一起，我们这么组织代码的主要原因是让大家理解 react 中的性能优化，以及如何使用 useCallback api 进行性能优化。</p>
<p>而我们要关注到的是性能问题，可以在 console 中看到，每次点击时，看到以下日志：</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">Rendering Title
Rendering Age
Rendering button Increment age
Rendering Salary
Rendering button Increment salary</code></pre>

<p>每次状态改变都触发了所有组件的 rerender，这个示例比较简单，但是假如未来遇到20、30、甚至50个组件 rerender 的时候，就一定要考虑到性能问题了。下面讲讲在这个示例中怎么进行优化。</p>
<h2 id="使用-React-memo-优化"><a href="#使用-React-memo-优化" class="headerlink" title="使用 React.memo 优化"></a>使用 React.memo 优化</h2><p>在本例中，我们当然希望点击增加年龄的按钮时，只有关于年龄的 Count 和 Button 进行 rerender，而其他组件不发生 rerender，点击增加 salary 时也一样。如何才能做到呢？答案是 <code>React.memo</code>。</p>
<p>我们给 Title.tsx, Count.tsx, Button.tsx 添加 <code>React.memo()</code>，代码如下：</p>
<p>Title.tsx</p>
<pre class="language-tsx" data-language="tsx"><code class="language-tsx"><span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">'react'</span>

<span class="token keyword">function</span> <span class="token function">Title</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Rendering Title'</span><span class="token punctuation">)</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h2</span><span class="token punctuation">></span></span><span class="token plain-text">useCallback</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h2</span><span class="token punctuation">></span></span>
  <span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> React<span class="token punctuation">.</span><span class="token function">memo</span><span class="token punctuation">(</span>Title<span class="token punctuation">)</span></code></pre>

<p>Count.tsx</p>
<pre class="language-tsx" data-language="tsx"><code class="language-tsx"><span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">'react'</span>

<span class="token keyword">function</span> <span class="token function">Count</span><span class="token punctuation">(</span>props<span class="token operator">:</span> <span class="token punctuation">&#123;</span>
  text<span class="token operator">:</span> <span class="token builtin">string</span>
  count<span class="token operator">:</span> <span class="token builtin">number</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Rendering </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>props<span class="token punctuation">.</span>text<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span><span class="token plain-text">
      </span><span class="token punctuation">&#123;</span>props<span class="token punctuation">.</span>text<span class="token punctuation">&#125;</span><span class="token plain-text"> - </span><span class="token punctuation">&#123;</span>props<span class="token punctuation">.</span>count<span class="token punctuation">&#125;</span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
  <span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> React<span class="token punctuation">.</span><span class="token function">memo</span><span class="token punctuation">(</span>Count<span class="token punctuation">)</span></code></pre>

<p>Button.tsx</p>
<pre class="language-tsx" data-language="tsx"><code class="language-tsx"><span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">'react'</span>

<span class="token keyword">function</span> <span class="token function">Button</span><span class="token punctuation">(</span>props<span class="token operator">:</span> <span class="token punctuation">&#123;</span>
  <span class="token function-variable function">handleClick</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token keyword">void</span>
  children<span class="token operator">:</span> <span class="token builtin">string</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Rendering button'</span><span class="token punctuation">,</span> props<span class="token punctuation">.</span>children<span class="token punctuation">)</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">&#123;</span>props<span class="token punctuation">.</span>handleClick<span class="token punctuation">&#125;</span></span><span class="token punctuation">></span></span><span class="token plain-text">
      </span><span class="token punctuation">&#123;</span>props<span class="token punctuation">.</span>children<span class="token punctuation">&#125;</span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span>
  <span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> React<span class="token punctuation">.</span><span class="token function">memo</span><span class="token punctuation">(</span>Button<span class="token punctuation">)</span></code></pre>

<p>效果如下：</p>
<p><img src="https://gw.alicdn.com/tfs/TB18aNkGKL2gK0jSZFmXXc7iXXa-702-606.gif" alt="img"></p>
<blockquote>
<p>React.memo 为高阶组件。它与 React.PureComponent 非常相似，但只适用于函数组件，而不适用 class 组件。</p>
</blockquote>
<pre class="language-tsx" data-language="tsx"><code class="language-tsx"><span class="token keyword">const</span> MyComponent <span class="token operator">=</span> React<span class="token punctuation">.</span><span class="token function">memo</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token function">MyComponent</span><span class="token punctuation">(</span>props<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token comment">/* 使用 props 渲染 */</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>

<blockquote>
<p>如果你的函数组件在给定相同 props 的情况下渲染相同的结果，那么你可以通过将其包装在 React.memo 中调用，以此通过记忆组件渲染结果的方式来提高组件的性能表现。这意味着在这种情况下，React 将跳过渲染组件的操作并直接复用最近一次渲染的结果。</p>
<p>React.memo 仅检查 props 变更。如果函数组件被 React.memo 包裹，且其实现中拥有 useState 或 useContext 的 Hook，当 context 发生变化时，它仍会重新渲染。</p>
<p>默认情况下其只会对复杂对象做浅层对比，如果你想要控制对比过程，那么请将自定义的比较函数通过第二个参数传入来实现。</p>
</blockquote>
<pre class="language-tsx" data-language="tsx"><code class="language-tsx"><span class="token keyword">function</span> <span class="token function">MyComponent</span><span class="token punctuation">(</span>props<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token comment">/* 使用 props 渲染 */</span>
<span class="token punctuation">&#125;</span>
<span class="token keyword">function</span> <span class="token function">areEqual</span><span class="token punctuation">(</span>prevProps<span class="token punctuation">,</span> nextProps<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token comment">/*
  如果把 nextProps 传入 render 方法的返回结果与
  将 prevProps 传入 render 方法的返回结果一致则返回 true，
  否则返回 false
  */</span>
<span class="token punctuation">&#125;</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> React<span class="token punctuation">.</span><span class="token function">memo</span><span class="token punctuation">(</span>MyComponent<span class="token punctuation">,</span> areEqual<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>

<blockquote>
<p>此方法仅作为性能优化的方式而存在。但请不要依赖它来“阻止”渲染，因为这会产生 bug。</p>
</blockquote>
<p>但是，使用了 React.memo 后，我们看到点击增加年龄的按钮时，日志变为了</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">Rendering Age
Rendering button Increment age
Rendering button Increment salary</code></pre>

<p>依然有不相关的 rerender <code>Rendering button Increment salary</code>，我们来分析一下。</p>
<p>在 ParentComponenet.tsx 中，我们看到点击 Increment age 按钮时，导致了 state 变化，ParentComponenet 进行了 rerender。<code>&lt;Title /&gt;</code> 没有传入属性，React.memo 判断出不需要 rerender，但是 Increment salary 按钮上的属性 incrementSalary 方法，实际上被重新创建了，导致了这个 Button 传入的 props 发生了变化，因此 React.memo 没有阻止 rerender。点击按钮 Increment salary 导致的相同的现象也是同理。那么如何解决呢？答案是使用 useCallback hook。</p>
<h2 id="useCallback"><a href="#useCallback" class="headerlink" title="useCallback"></a>useCallback</h2><h3 id="什么是-useCallback"><a href="#什么是-useCallback" class="headerlink" title="什么是 useCallback"></a>什么是 useCallback</h3><pre class="language-tsx" data-language="tsx"><code class="language-tsx"><span class="token keyword">const</span> memoizedCallback <span class="token operator">=</span> <span class="token function">useCallback</span><span class="token punctuation">(</span>
  <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    <span class="token function">doSomething</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
  <span class="token punctuation">[</span>a<span class="token punctuation">,</span> b<span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>

<blockquote>
<p>返回一个 memoized 回调函数。</p>
<p>把内联回调函数及依赖项数组作为参数传入 <code>useCallback</code>，它将返回该回调函数的 memoized 版本，该回调函数仅在某个依赖项改变时才会更新。当你把回调函数传递给经过优化的并使用引用相等性去避免非必要渲染（例如 shouldComponentUpdate）的子组件时，它将非常有用。</p>
</blockquote>
<p>类比到我们的例子中，useCallback 会缓存我们的 <code>incrementSalary()</code> 如果 salary 没有变化，直接返回缓存的值，如果 salary 发生变化，也就是 useCallback 的依赖发生变化，那么一个新的方法将被返回。</p>
<p>这就可以帮助我们解决只依赖某个变量的子组件避免不必要的 render 问题。</p>
<h3 id="如何使用-useCallback"><a href="#如何使用-useCallback" class="headerlink" title="如何使用 useCallback"></a>如何使用 useCallback</h3><p>步骤如下：</p>
<ol>
<li>import useCallback</li>
<li>调用 useCallback</li>
</ol>
<p>我们将 ParentComponenet.tsx 中的 incrementAge 和 incrementSalary 使用 useCallback 改写如下：</p>
<pre class="language-tsx" data-language="tsx"><code class="language-tsx"><span class="token keyword">const</span> incrementAge <span class="token operator">=</span> <span class="token function">useCallback</span><span class="token punctuation">(</span>
  <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    <span class="token function">setAge</span><span class="token punctuation">(</span>age <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
  <span class="token punctuation">[</span>age<span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">)</span>

<span class="token keyword">const</span> incrementSalary <span class="token operator">=</span> <span class="token function">useCallback</span><span class="token punctuation">(</span>
  <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    <span class="token function">setSalary</span><span class="token punctuation">(</span>salary <span class="token operator">+</span> <span class="token number">1000</span><span class="token punctuation">)</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
  <span class="token punctuation">[</span>salary<span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">)</span></code></pre>

<p><img src="https://gw.alicdn.com/tfs/TB1iQVkGLb2gK0jSZK9XXaEgFXa-702-411.gif" alt="img"></p>
<p>可以看到，已经达到了我们的目的，点击 Increment age 时，salary 的按钮组件也没有 rerender。至此，我们已经完成了所有的性能优化。</p>
<h2 id="小结"><a href="#小结" class="headerlink" title="小结"></a>小结</h2><p>本章我们从一个组件多次被复用的的例子说起，一步一步对其进行性能优化，核心是阻止不必要的 rerender。</p>
<p>学习使用了 React.memo 在 props 或 state 没有变化时，阻止组件的 rerender。</p>
<p>学习了什么是 useCallback，如何使用 useCallback 缓存一个方法，只依赖某几个变量变化才更新，避免了每次传递给子组件的 props 都被更新，最终也是阻止了子组件不必要的 rerender。</p>
]]></content>
      <categories>
        <category>JavaScript</category>
      </categories>
      <tags>
        <tag>React</tag>
        <tag>hooks</tag>
      </tags>
  </entry>
  <entry>
    <title>React Hooks 系列之 useRef</title>
    <url>/2020/06/25/405.html</url>
    <content><![CDATA[<p>掌握 React Hooks api 将更好的帮助你在工作中使用，对 React 的掌握更上一层楼。</p>
<p>接下来我们要一起学习 useRef hook，它可以让我们直接访问到组件中的的 Dom 节点。我们今天通过一个 input 输入框获取焦点的需求为例，来学习一下 useRef。</p>
<h2 id="页面载入-input-获取焦点示例"><a href="#页面载入-input-获取焦点示例" class="headerlink" title="页面载入 input 获取焦点示例"></a>页面载入 input 获取焦点示例</h2><p>FocusInput.tsx</p>
<pre class="language-tsx" data-language="tsx"><code class="language-tsx"><span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">&#123;</span> useEffect<span class="token punctuation">,</span> useRef<span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'react'</span>

<span class="token keyword">function</span> <span class="token function">FocusInput</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">const</span> inputRef <span class="token operator">=</span> <span class="token generic-function"><span class="token function">useRef</span><span class="token generic class-name"><span class="token operator">&lt;</span>HTMLInputElement<span class="token operator">></span></span></span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span>
  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    inputRef<span class="token punctuation">.</span>current <span class="token operator">&amp;&amp;</span> inputRef<span class="token punctuation">.</span>current<span class="token punctuation">.</span><span class="token function">focus</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">ref</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">&#123;</span>inputRef<span class="token punctuation">&#125;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>text<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
  <span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> FocusInput</code></pre>

<p>App.tsx</p>
<pre class="language-tsx" data-language="tsx"><code class="language-tsx"><span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">'react'</span>
<span class="token keyword">import</span> <span class="token string">'./App.css'</span>

<span class="token keyword">import</span> FocusInput <span class="token keyword">from</span> <span class="token string">'./components/28FocusInput'</span>

<span class="token keyword">const</span> <span class="token function-variable function">App</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">className</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>App<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">FocusInput</span></span> <span class="token punctuation">/></span></span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
  <span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> App</code></pre>

<p>页面展示效果</p>
<p><img src="https://gw.alicdn.com/tfs/TB1lxWlHkY2gK0jSZFgXXc5OFXa-363-125.gif" alt="img"></p>
<p>注意与 TypeScript 结合使用时的方式，需要先声明好泛型</p>
<pre class="language-tsx" data-language="tsx"><code class="language-tsx"><span class="token keyword">const</span> inputRef <span class="token operator">=</span> <span class="token generic-function"><span class="token function">useRef</span><span class="token generic class-name"><span class="token operator">&lt;</span>HTMLInputElement<span class="token operator">></span></span></span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span></code></pre>

<p>同时使用时需要判空</p>
<pre class="language-tsx" data-language="tsx"><code class="language-tsx">inputRef<span class="token punctuation">.</span>current <span class="token operator">&amp;&amp;</span> inputRef<span class="token punctuation">.</span>current<span class="token punctuation">.</span><span class="token function">focus</span><span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre>

<p>关于 ts 和 hooks 结合的方式可以参考文章 <a href="https://fettblog.eu/typescript-react/hooks/#useref">TypeScript and React: Hooks</a>。</p>
<blockquote>
<p><code>useRef</code> 返回一个可变的 ref 对象，其 <code>.current</code> 属性被初始化为传入的参数（initialValue）。返回的 ref 对象在组件的整个生命周期内保持不变。</p>
</blockquote>
<p>Refs 提供了一种方式，允许我们访问 DOM 节点或在 render 方法中创建的 React 元素。</p>
<p>在典型的 React 数据流中，props 是父组件与子组件交互的唯一方式。要修改一个子组件，你需要使用新的 props 来重新渲染它。但是，在某些情况下，你需要在典型数据流之外强制修改子组件。被修改的子组件可能是一个 React 组件的实例，也可能是一个 DOM 元素。对于这两种情况，React 都提供了解决办法。</p>
<h3 id="下面是几个适合使用-refs-的情况"><a href="#下面是几个适合使用-refs-的情况" class="headerlink" title="下面是几个适合使用 refs 的情况"></a>下面是几个适合使用 refs 的情况</h3><ul>
<li>管理焦点，文本选择或媒体播放。</li>
<li>触发强制动画。</li>
<li>集成第三方 DOM 库。</li>
</ul>
<p>避免使用 refs 来做任何可以通过声明式实现来完成的事情。举个例子，避免在 Dialog 组件里暴露 open() 和 close() 方法，最好传递 isOpen 属性。</p>
<h3 id="勿过度使用-Refs"><a href="#勿过度使用-Refs" class="headerlink" title="勿过度使用 Refs"></a>勿过度使用 Refs</h3><p>你可能首先会想到使用 refs 在你的 app 中“让事情发生”。如果是这种情况，请花一点时间，认真再考虑一下 state 属性应该被安排在哪个组件层中。通常你会想明白，让更高的组件层级拥有这个 state，是更恰当的。查看 状态提升 以获取更多有关示例。</p>
<p>更多关于 refs 和 Dom 的相关信息可以访问 React 官网 <a href="https://zh-hans.reactjs.org/docs/refs-and-the-dom.html">Refs and the DOM</a></p>
<p>下面我们再来学习一下 useRef 在另一个场景的使用。</p>
<h2 id="可以停止的计时器示例"><a href="#可以停止的计时器示例" class="headerlink" title="可以停止的计时器示例"></a>可以停止的计时器示例</h2><p>需求是页面上有一个每隔1秒自动加一的计时器，并且有个按钮，点击后计时器停止，先使用 Class 组件完成这样的需求</p>
<h3 id="Class-组件示例"><a href="#Class-组件示例" class="headerlink" title="Class 组件示例"></a>Class 组件示例</h3><p>ClassTimer.tsx</p>
<pre class="language-tsx" data-language="tsx"><code class="language-tsx"><span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">&#123;</span> Component <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'react'</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">ClassTimer</span> <span class="token keyword">extends</span> <span class="token class-name">Component<span class="token operator">&lt;</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span> timer<span class="token operator">:</span> <span class="token builtin">number</span> <span class="token punctuation">&#125;</span><span class="token operator">></span></span> <span class="token punctuation">&#123;</span>
  interval<span class="token operator">!</span><span class="token operator">:</span> <span class="token builtin">number</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span>props<span class="token operator">:</span> Readonly<span class="token operator">&lt;</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token operator">></span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">super</span><span class="token punctuation">(</span>props<span class="token punctuation">)</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
      timer<span class="token operator">:</span> <span class="token number">0</span>
    <span class="token punctuation">&#125;</span>
  <span class="token punctuation">&#125;</span>

  <span class="token function">componentDidMount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>interval <span class="token operator">=</span> window<span class="token punctuation">.</span><span class="token function">setInterval</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span>prevState <span class="token operator">=></span> <span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
        timer<span class="token operator">:</span> prevState<span class="token punctuation">.</span>timer <span class="token operator">+</span> <span class="token number">1</span>
      <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span>
  <span class="token punctuation">&#125;</span>

  <span class="token function">componentWillUnmount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token function">clearInterval</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>interval<span class="token punctuation">)</span>
  <span class="token punctuation">&#125;</span>

  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span><span class="token plain-text">
        Timer - </span><span class="token punctuation">&#123;</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>timer<span class="token punctuation">&#125;</span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span><span class="token punctuation">/></span></span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span>
          <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">&#123;</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
            <span class="token function">clearInterval</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>interval<span class="token punctuation">)</span>
          <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></span>
        <span class="token punctuation">></span></span><span class="token plain-text">Clear Timer</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
    <span class="token punctuation">)</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span></code></pre>

<p>App.tsx</p>
<pre class="language-tsx" data-language="tsx"><code class="language-tsx"><span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">'react'</span>
<span class="token keyword">import</span> <span class="token string">'./App.css'</span>

<span class="token keyword">import</span> ClassTimer <span class="token keyword">from</span> <span class="token string">'./components/29ClassTimer'</span>

<span class="token keyword">const</span> <span class="token function-variable function">App</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">className</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>App<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">ClassTimer</span></span> <span class="token punctuation">/></span></span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
  <span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> App</code></pre>

<p>页面展示如下</p>
<p><img src="https://gw.alicdn.com/tfs/TB1J31IHHr1gK0jSZFDXXb9yVXa-437-179.gif" alt="img"></p>
<h3 id="Function-组件示例"><a href="#Function-组件示例" class="headerlink" title="Function 组件示例"></a>Function 组件示例</h3><p>HookTimer.tsx</p>
<pre class="language-tsx" data-language="tsx"><code class="language-tsx"><span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">&#123;</span> useState<span class="token punctuation">,</span> useEffect<span class="token punctuation">,</span> useRef <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'react'</span>

<span class="token keyword">function</span> <span class="token function">HookTimer</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>timer<span class="token punctuation">,</span> setTimer<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>

  <span class="token comment">//  @ts-ignore</span>
  <span class="token keyword">const</span> intervalRef <span class="token operator">=</span> <span class="token function">useRef</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token punctuation">&#123;</span> current<span class="token operator">:</span> <span class="token builtin">number</span> <span class="token punctuation">&#125;</span>

  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    intervalRef<span class="token punctuation">.</span>current <span class="token operator">=</span> window<span class="token punctuation">.</span><span class="token function">setInterval</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
      <span class="token function">setTimer</span><span class="token punctuation">(</span>pre <span class="token operator">=></span> pre <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
      <span class="token function">clearInterval</span><span class="token punctuation">(</span>intervalRef<span class="token punctuation">.</span>current<span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span><span class="token plain-text">
      HookTimer - </span><span class="token punctuation">&#123;</span>timer<span class="token punctuation">&#125;</span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span> <span class="token punctuation">/></span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span>
        <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">&#123;</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
          <span class="token function">clearInterval</span><span class="token punctuation">(</span>intervalRef<span class="token punctuation">.</span>current<span class="token punctuation">)</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></span>
      <span class="token punctuation">></span></span><span class="token plain-text">Clear Hook Timer</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
  <span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> HookTimer</code></pre>

<p>App.tsx</p>
<pre class="language-tsx" data-language="tsx"><code class="language-tsx"><span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">'react'</span>
<span class="token keyword">import</span> <span class="token string">'./App.css'</span>

<span class="token keyword">import</span> ClassTimer <span class="token keyword">from</span> <span class="token string">'./components/29ClassTimer'</span>
<span class="token keyword">import</span> HookTimer <span class="token keyword">from</span> <span class="token string">'./components/29HookTimer'</span>

<span class="token keyword">const</span> <span class="token function-variable function">App</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">className</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>App<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">ClassTimer</span></span> <span class="token punctuation">/></span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>hr</span> <span class="token punctuation">/></span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">HookTimer</span></span> <span class="token punctuation">/></span></span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
  <span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> App</code></pre>

<p>页面展示如下</p>
<p><img src="https://gw.alicdn.com/tfs/TB1v51OHQL0gK0jSZFxXXXWHVXa-437-227.gif" alt="img"></p>
<p>这就是 useRef 的第二种用法，可以用它创建一个通用的容器，用来保存变量。</p>
<h2 id="小结"><a href="#小结" class="headerlink" title="小结"></a>小结</h2><p>本章我们学习了 useRef 的两种用法：一是让我们允许访问 Dom 节点；二是成为一个容器，用来缓存变量。第二种用法较为少见，需要多加注意，遇到类似的场景可以尝试使用。</p>
]]></content>
      <categories>
        <category>JavaScript</category>
      </categories>
      <tags>
        <tag>React</tag>
        <tag>hooks</tag>
      </tags>
  </entry>
  <entry>
    <title>React Hooks 系列之 custom Hook</title>
    <url>/2020/06/27/407.html</url>
    <content><![CDATA[<h1 id="React-Hooks-系列之-自定义-Hook"><a href="#React-Hooks-系列之-自定义-Hook" class="headerlink" title="React Hooks 系列之 自定义 Hook"></a>React Hooks 系列之 自定义 Hook</h1><p>掌握 React Hooks api 将更好的帮助你在工作中使用，对 React 的掌握更上一层楼。</p>
<p>学习了官方的这么多 hooks api，我们也可以创造一些自己的 hooks，甚至官方也在鼓励开发者将组件逻辑抽象到自定义 hooks 中，方便复用。</p>
<p>自定义 Hook 是一个函数，其名称以 “use” 开头，函数内部可以调用其他的 Hook。</p>
<p>通过自定义 Hook，可以将组件逻辑提取到可重用的函数中。</p>
<h2 id="useDocumentTitle-示例"><a href="#useDocumentTitle-示例" class="headerlink" title="useDocumentTitle 示例"></a>useDocumentTitle 示例</h2><h3 id="function-普通写法"><a href="#function-普通写法" class="headerlink" title="function 普通写法"></a>function 普通写法</h3><p>我们想创建一个计数器，计数器的值改变后，希望改变页面的 Title</p>
<p>DocTitleOne.tsx</p>
<pre class="language-tsx" data-language="tsx"><code class="language-tsx"><span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">&#123;</span> useState<span class="token punctuation">,</span> useEffect <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'react'</span>

<span class="token keyword">function</span> <span class="token function">DocTitleOne</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>count<span class="token punctuation">,</span> setCount<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    document<span class="token punctuation">.</span>title <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Count - </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>count<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token template-punctuation string">`</span></span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>count<span class="token punctuation">]</span><span class="token punctuation">)</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span>
        <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">&#123;</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
          <span class="token function">setCount</span><span class="token punctuation">(</span>count <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></span>
      <span class="token punctuation">></span></span><span class="token plain-text">Count - </span><span class="token punctuation">&#123;</span>count<span class="token punctuation">&#125;</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
  <span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> DocTitleOne</code></pre>

<p>App.tsx</p>
<pre class="language-tsx" data-language="tsx"><code class="language-tsx"><span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">'react'</span>
<span class="token keyword">import</span> <span class="token string">'./App.css'</span>

<span class="token keyword">import</span> DocTitleOne <span class="token keyword">from</span> <span class="token string">'./components/31DocTitleOne'</span>

<span class="token keyword">const</span> <span class="token function-variable function">App</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">className</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>App<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">DocTitleOne</span></span> <span class="token punctuation">/></span></span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
  <span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> App</code></pre>

<p>页面展示如下</p>
<p><img src="https://gw.alicdn.com/tfs/TB1ilw2HUY1gK0jSZFMXXaWcVXa-407-221.gif" alt="img"></p>
<p>运行没有问题，接下来又有一个需求的增量，就是页面要在另一个组件中也能改变页面的 Title，接下来我们创建一个新的组件。</p>
<p>DocTitleTwo.tsx</p>
<pre class="language-tsx" data-language="tsx"><code class="language-tsx"><span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">&#123;</span> useState<span class="token punctuation">,</span> useEffect <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'react'</span>

<span class="token keyword">function</span> <span class="token function">DocTitleTwo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>count<span class="token punctuation">,</span> setCount<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    document<span class="token punctuation">.</span>title <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Count - </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>count<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token template-punctuation string">`</span></span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>count<span class="token punctuation">]</span><span class="token punctuation">)</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span>
        <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">&#123;</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
          <span class="token function">setCount</span><span class="token punctuation">(</span>count <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></span>
      <span class="token punctuation">></span></span><span class="token plain-text">Count - </span><span class="token punctuation">&#123;</span>count<span class="token punctuation">&#125;</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
  <span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> DocTitleTwo</code></pre>

<p>App.tsx</p>
<pre class="language-tsx" data-language="tsx"><code class="language-tsx"><span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">'react'</span>
<span class="token keyword">import</span> <span class="token string">'./App.css'</span>

<span class="token keyword">import</span> DocTitleOne <span class="token keyword">from</span> <span class="token string">'./components/31DocTitleOne'</span>
<span class="token keyword">import</span> DocTitleTwo <span class="token keyword">from</span> <span class="token string">'./components/31DocTitleTwo'</span>

<span class="token keyword">const</span> <span class="token function-variable function">App</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">className</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>App<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">DocTitleOne</span></span> <span class="token punctuation">/></span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">DocTitleTwo</span></span> <span class="token punctuation">/></span></span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
  <span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> App</code></pre>

<p>页面展示如下</p>
<p><img src="https://gw.alicdn.com/tfs/TB1sNg1HUz1gK0jSZLeXXb9kVXa-407-221.gif" alt="img"></p>
<p>回顾代码，DocTitleTwo 显然重复了 DocTitleOne 的代码，设想一下如果有 10 个组件都要修改页面 title 的话，你肯定不想重复这些代码。这时就需要自定义 Hook 了。</p>
<p>这个示例中，我们可以创建一个自定义 Hook 来设置页面的 title。然后使用这个自定义 Hook 在不同的组件中。</p>
<h3 id="抽象出-useDocumentTitle-hook"><a href="#抽象出-useDocumentTitle-hook" class="headerlink" title="抽象出 useDocumentTitle hook"></a>抽象出 useDocumentTitle hook</h3><p>useDocumentTitle.tsx</p>
<pre class="language-tsx" data-language="tsx"><code class="language-tsx"><span class="token keyword">import</span> <span class="token punctuation">&#123;</span> useEffect <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'react'</span>

<span class="token keyword">function</span> <span class="token function">useDocumentTitle</span><span class="token punctuation">(</span>count<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    document<span class="token punctuation">.</span>title <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Count - </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>count<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token template-punctuation string">`</span></span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>count<span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> useDocumentTitle</code></pre>

<p>DocTitleOne.tsx</p>
<pre class="language-tsx" data-language="tsx"><code class="language-tsx"><span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">&#123;</span> useState <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'react'</span>
<span class="token keyword">import</span> useDocumentTitle <span class="token keyword">from</span> <span class="token string">'./hooks/useDocumentTitle'</span>

<span class="token keyword">function</span> <span class="token function">DocTitleOne</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>count<span class="token punctuation">,</span> setCount<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
  <span class="token function">useDocumentTitle</span><span class="token punctuation">(</span>count<span class="token punctuation">)</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span>
        <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">&#123;</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
          <span class="token function">setCount</span><span class="token punctuation">(</span>count <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></span>
      <span class="token punctuation">></span></span><span class="token plain-text">Count - </span><span class="token punctuation">&#123;</span>count<span class="token punctuation">&#125;</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
  <span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> DocTitleOne</code></pre>

<p>DocTitleTwo.tsx</p>
<pre class="language-tsx" data-language="tsx"><code class="language-tsx"><span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">&#123;</span> useState <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'react'</span>
<span class="token keyword">import</span> useDocumentTitle <span class="token keyword">from</span> <span class="token string">'./hooks/useDocumentTitle'</span>

<span class="token keyword">function</span> <span class="token function">DocTitleTwo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>count<span class="token punctuation">,</span> setCount<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
  <span class="token function">useDocumentTitle</span><span class="token punctuation">(</span>count<span class="token punctuation">)</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span>
        <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">&#123;</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
          <span class="token function">setCount</span><span class="token punctuation">(</span>count <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></span>
      <span class="token punctuation">></span></span><span class="token plain-text">Count - </span><span class="token punctuation">&#123;</span>count<span class="token punctuation">&#125;</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
  <span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> DocTitleTwo</code></pre>

<p>App.tsx</p>
<pre class="language-tsx" data-language="tsx"><code class="language-tsx"><span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">'react'</span>
<span class="token keyword">import</span> <span class="token string">'./App.css'</span>

<span class="token keyword">import</span> DocTitleOne <span class="token keyword">from</span> <span class="token string">'./components/31DocTitleOne'</span>
<span class="token keyword">import</span> DocTitleTwo <span class="token keyword">from</span> <span class="token string">'./components/31DocTitleTwo'</span>

<span class="token keyword">const</span> <span class="token function-variable function">App</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">className</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>App<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">DocTitleOne</span></span> <span class="token punctuation">/></span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">DocTitleTwo</span></span> <span class="token punctuation">/></span></span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
  <span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> App</code></pre>

<p>页面展示如下</p>
<p><img src="https://gw.alicdn.com/tfs/TB1sNg1HUz1gK0jSZLeXXb9kVXa-407-221.gif" alt="img"></p>
<p>我们回顾一下代码</p>
<p>在 DocTitleOne 中，引入了我们定义的 useDocumentTitle，传入了 count 这个状态的值。useDocumentTitle 中执行代码，将页面title 初始值设置为 0，然后继续渲染 DocTitleOne jsx 部分。点击按钮时，count 变为 1，触发了 DocTitleOne 的 rerender，useDocumentTitle 中入参也变为了 1，将页面 title 变为 1。</p>
<h2 id="useCounter-示例"><a href="#useCounter-示例" class="headerlink" title="useCounter 示例"></a>useCounter 示例</h2><h3 id="冗余的写法"><a href="#冗余的写法" class="headerlink" title="冗余的写法"></a>冗余的写法</h3><p>CounterOne.tsx</p>
<pre class="language-tsx" data-language="tsx"><code class="language-tsx"><span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">&#123;</span>useState<span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'react'</span>

<span class="token keyword">function</span> <span class="token function">CounterOne</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>count<span class="token punctuation">,</span> setCount<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
  <span class="token keyword">const</span> <span class="token function-variable function">increment</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    <span class="token function">setCount</span><span class="token punctuation">(</span>prevCount <span class="token operator">=></span> prevCount <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span>
  <span class="token punctuation">&#125;</span>
  <span class="token keyword">const</span> <span class="token function-variable function">decrement</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    <span class="token function">setCount</span><span class="token punctuation">(</span>prevCount <span class="token operator">=></span> prevCount <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span>
  <span class="token punctuation">&#125;</span>
  <span class="token keyword">const</span> <span class="token function-variable function">reset</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    <span class="token function">setCount</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
  <span class="token punctuation">&#125;</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h2</span><span class="token punctuation">></span></span><span class="token plain-text">Count - </span><span class="token punctuation">&#123;</span>count<span class="token punctuation">&#125;</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h2</span><span class="token punctuation">></span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">&#123;</span>increment<span class="token punctuation">&#125;</span></span><span class="token punctuation">></span></span><span class="token plain-text">increment</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">&#123;</span>decrement<span class="token punctuation">&#125;</span></span><span class="token punctuation">></span></span><span class="token plain-text">decrement</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">&#123;</span>reset<span class="token punctuation">&#125;</span></span><span class="token punctuation">></span></span><span class="token plain-text">reset</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
  <span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> CounterOne</code></pre>

<p>CounterTwo.tsx</p>
<pre class="language-tsx" data-language="tsx"><code class="language-tsx"><span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">&#123;</span>useState<span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'react'</span>

<span class="token keyword">function</span> <span class="token function">CounterTwo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>count<span class="token punctuation">,</span> setCount<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
  <span class="token keyword">const</span> <span class="token function-variable function">increment</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    <span class="token function">setCount</span><span class="token punctuation">(</span>prevCount <span class="token operator">=></span> prevCount <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span>
  <span class="token punctuation">&#125;</span>
  <span class="token keyword">const</span> <span class="token function-variable function">decrement</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    <span class="token function">setCount</span><span class="token punctuation">(</span>prevCount <span class="token operator">=></span> prevCount <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span>
  <span class="token punctuation">&#125;</span>
  <span class="token keyword">const</span> <span class="token function-variable function">reset</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    <span class="token function">setCount</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
  <span class="token punctuation">&#125;</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h2</span><span class="token punctuation">></span></span><span class="token plain-text">Count - </span><span class="token punctuation">&#123;</span>count<span class="token punctuation">&#125;</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h2</span><span class="token punctuation">></span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">&#123;</span>increment<span class="token punctuation">&#125;</span></span><span class="token punctuation">></span></span><span class="token plain-text">increment</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">&#123;</span>decrement<span class="token punctuation">&#125;</span></span><span class="token punctuation">></span></span><span class="token plain-text">decrement</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">&#123;</span>reset<span class="token punctuation">&#125;</span></span><span class="token punctuation">></span></span><span class="token plain-text">reset</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
  <span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> CounterTwo</code></pre>

<p>App.tsx</p>
<pre class="language-tsx" data-language="tsx"><code class="language-tsx"><span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">'react'</span>
<span class="token keyword">import</span> <span class="token string">'./App.css'</span>
<span class="token keyword">import</span> CounterOne <span class="token keyword">from</span> <span class="token string">'./components/32CounterOne'</span>
<span class="token keyword">import</span> CounterTwo <span class="token keyword">from</span> <span class="token string">'./components/32CounterTwo'</span>

<span class="token keyword">const</span> <span class="token function-variable function">App</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">className</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>App<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">CounterOne</span></span> <span class="token punctuation">/></span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">CounterTwo</span></span> <span class="token punctuation">/></span></span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
  <span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> App</code></pre>

<p>页面展示如下</p>
<p><img src="https://gw.alicdn.com/tfs/TB1Kf78HQL0gK0jSZFxXXXWHVXa-407-347.gif" alt="img"></p>
<p>相同的问题，我们有大量重复代码，接下来我们来看如何使用自定义 hook 来进行优化。</p>
<h3 id="useCounter-抽象"><a href="#useCounter-抽象" class="headerlink" title="useCounter 抽象"></a>useCounter 抽象</h3><p>useCounter.tsx</p>
<pre class="language-tsx" data-language="tsx"><code class="language-tsx"><span class="token keyword">import</span> <span class="token punctuation">&#123;</span> useState <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'react'</span>

<span class="token keyword">function</span> <span class="token function">useCounter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>count<span class="token punctuation">,</span> setCount<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
  <span class="token keyword">const</span> <span class="token function-variable function">increment</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    <span class="token function">setCount</span><span class="token punctuation">(</span>prevCount <span class="token operator">=></span> prevCount <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span>
  <span class="token punctuation">&#125;</span>
  <span class="token keyword">const</span> <span class="token function-variable function">decrement</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    <span class="token function">setCount</span><span class="token punctuation">(</span>prevCount <span class="token operator">=></span> prevCount <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span>
  <span class="token punctuation">&#125;</span>
  <span class="token keyword">const</span> <span class="token function-variable function">reset</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    <span class="token function">setCount</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
  <span class="token punctuation">&#125;</span>
  <span class="token keyword">return</span> <span class="token punctuation">[</span>count<span class="token punctuation">,</span> increment<span class="token punctuation">,</span> decrement<span class="token punctuation">,</span> reset<span class="token punctuation">]</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> useCounter</code></pre>

<p>CounterOne.tsx</p>
<pre class="language-tsx" data-language="tsx"><code class="language-tsx"><span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">'react'</span>
<span class="token keyword">import</span> useCounter <span class="token keyword">from</span> <span class="token string">'./hooks/useCounter'</span>

<span class="token keyword">function</span> <span class="token function">CounterOne</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>count<span class="token punctuation">,</span> increment<span class="token punctuation">,</span> decrement<span class="token punctuation">,</span> reset<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useCounter</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h2</span><span class="token punctuation">></span></span><span class="token plain-text">Count - </span><span class="token punctuation">&#123;</span>count<span class="token punctuation">&#125;</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h2</span><span class="token punctuation">></span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">&#123;</span>increment<span class="token punctuation">&#125;</span></span><span class="token punctuation">></span></span><span class="token plain-text">increment</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">&#123;</span>decrement<span class="token punctuation">&#125;</span></span><span class="token punctuation">></span></span><span class="token plain-text">decrement</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">&#123;</span>reset<span class="token punctuation">&#125;</span></span><span class="token punctuation">></span></span><span class="token plain-text">reset</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
  <span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> CounterOne</code></pre>

<p>CounterTwo.tsx</p>
<pre class="language-tsx" data-language="tsx"><code class="language-tsx"><span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">'react'</span>
<span class="token keyword">import</span> useCounter <span class="token keyword">from</span> <span class="token string">'./hooks/useCounter'</span>

<span class="token keyword">function</span> <span class="token function">CounterTwo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>count<span class="token punctuation">,</span> increment<span class="token punctuation">,</span> decrement<span class="token punctuation">,</span> reset<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useCounter</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h2</span><span class="token punctuation">></span></span><span class="token plain-text">Count - </span><span class="token punctuation">&#123;</span>count<span class="token punctuation">&#125;</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h2</span><span class="token punctuation">></span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">&#123;</span>increment<span class="token punctuation">&#125;</span></span><span class="token punctuation">></span></span><span class="token plain-text">increment</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">&#123;</span>decrement<span class="token punctuation">&#125;</span></span><span class="token punctuation">></span></span><span class="token plain-text">decrement</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">&#123;</span>reset<span class="token punctuation">&#125;</span></span><span class="token punctuation">></span></span><span class="token plain-text">reset</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
  <span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> CounterTwo</code></pre>

<p>App.tsx</p>
<pre class="language-tsx" data-language="tsx"><code class="language-tsx"><span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">'react'</span>
<span class="token keyword">import</span> <span class="token string">'./App.css'</span>
<span class="token keyword">import</span> CounterOne <span class="token keyword">from</span> <span class="token string">'./components/32CounterOne'</span>
<span class="token keyword">import</span> CounterTwo <span class="token keyword">from</span> <span class="token string">'./components/32CounterTwo'</span>

<span class="token keyword">const</span> <span class="token function-variable function">App</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">className</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>App<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">CounterOne</span></span> <span class="token punctuation">/></span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">CounterTwo</span></span> <span class="token punctuation">/></span></span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
  <span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> App</code></pre>

<p>页面展示依然如下</p>
<p><img src="https://gw.alicdn.com/tfs/TB1Kf78HQL0gK0jSZFxXXXWHVXa-407-347.gif" alt="img"></p>
<p>可以看到目前我们的代码结构就比较好了，我们还可以在 useCounter 中给 counter 设置初始值，如下</p>
<p>useCounter.tsx</p>
<pre class="language-tsx" data-language="tsx"><code class="language-tsx"><span class="token keyword">import</span> <span class="token punctuation">&#123;</span> useState <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'react'</span>

<span class="token keyword">function</span> <span class="token function">useCounter</span><span class="token punctuation">(</span>initialValue <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>count<span class="token punctuation">,</span> setCount<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span>initialValue<span class="token punctuation">)</span>
  <span class="token keyword">const</span> <span class="token function-variable function">increment</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    <span class="token function">setCount</span><span class="token punctuation">(</span>prevCount <span class="token operator">=></span> prevCount <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span>
  <span class="token punctuation">&#125;</span>
  <span class="token keyword">const</span> <span class="token function-variable function">decrement</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    <span class="token function">setCount</span><span class="token punctuation">(</span>prevCount <span class="token operator">=></span> prevCount <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span>
  <span class="token punctuation">&#125;</span>
  <span class="token keyword">const</span> <span class="token function-variable function">reset</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    <span class="token function">setCount</span><span class="token punctuation">(</span>initialValue<span class="token punctuation">)</span>
  <span class="token punctuation">&#125;</span>
  <span class="token keyword">return</span> <span class="token punctuation">[</span>count<span class="token punctuation">,</span> increment<span class="token punctuation">,</span> decrement<span class="token punctuation">,</span> reset<span class="token punctuation">]</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> useCounter</code></pre>

<p>使用时，对应的可以传入初始值</p>
<pre class="language-tsx" data-language="tsx"><code class="language-tsx"><span class="token keyword">const</span> <span class="token punctuation">[</span>count<span class="token punctuation">,</span> increment<span class="token punctuation">,</span> decrement<span class="token punctuation">,</span> reset<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useCounter</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span></code></pre>

<p>我们还可以修改每次增加或减少的数字，如下</p>
<pre class="language-tsx" data-language="tsx"><code class="language-tsx"><span class="token keyword">import</span> <span class="token punctuation">&#123;</span> useState <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'react'</span>

<span class="token keyword">function</span> <span class="token function">useCounter</span><span class="token punctuation">(</span>initialValue <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> value <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>count<span class="token punctuation">,</span> setCount<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span>initialValue<span class="token punctuation">)</span>
  <span class="token keyword">const</span> <span class="token function-variable function">increment</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    <span class="token function">setCount</span><span class="token punctuation">(</span>prevCount <span class="token operator">=></span> prevCount <span class="token operator">+</span> value<span class="token punctuation">)</span>
  <span class="token punctuation">&#125;</span>
  <span class="token keyword">const</span> <span class="token function-variable function">decrement</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    <span class="token function">setCount</span><span class="token punctuation">(</span>prevCount <span class="token operator">=></span> prevCount <span class="token operator">-</span> value<span class="token punctuation">)</span>
  <span class="token punctuation">&#125;</span>
  <span class="token keyword">const</span> <span class="token function-variable function">reset</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    <span class="token function">setCount</span><span class="token punctuation">(</span>initialValue<span class="token punctuation">)</span>
  <span class="token punctuation">&#125;</span>
  <span class="token keyword">return</span> <span class="token punctuation">[</span>count<span class="token punctuation">,</span> increment<span class="token punctuation">,</span> decrement<span class="token punctuation">,</span> reset<span class="token punctuation">]</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> useCounter</code></pre>

<p>使用时，对应的也可以增加入参</p>
<pre class="language-tsx" data-language="tsx"><code class="language-tsx"><span class="token keyword">const</span> <span class="token punctuation">[</span>count<span class="token punctuation">,</span> increment<span class="token punctuation">,</span> decrement<span class="token punctuation">,</span> reset<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useCounter</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span></code></pre>

<h2 id="useInput-示例"><a href="#useInput-示例" class="headerlink" title="useInput 示例"></a>useInput 示例</h2><p>示例是一个简单表单，用户可以填写姓名</p>
<h3 id="function-普通写法-1"><a href="#function-普通写法-1" class="headerlink" title="function 普通写法"></a>function 普通写法</h3><p>UserForm.tsx</p>
<pre class="language-tsx" data-language="tsx"><code class="language-tsx"><span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">&#123;</span> useState<span class="token punctuation">,</span> FormEvent <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'react'</span>

<span class="token keyword">function</span> <span class="token function">UserForm</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>firstName<span class="token punctuation">,</span> setFirstName<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>lastName<span class="token punctuation">,</span> setLastName<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span>
  <span class="token keyword">const</span> <span class="token function-variable function">submitHandler</span> <span class="token operator">=</span> <span class="token punctuation">(</span>e<span class="token operator">:</span> FormEvent<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    e<span class="token punctuation">.</span><span class="token function">preventDefault</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Hello </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>firstName<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string"> </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>lastName<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
  <span class="token punctuation">&#125;</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span> <span class="token attr-name">onSubmit</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">&#123;</span>submitHandler<span class="token punctuation">&#125;</span></span><span class="token punctuation">></span></span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span><span class="token plain-text">
          </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>label</span> <span class="token attr-name">htmlFor</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token plain-text">First name</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>label</span><span class="token punctuation">></span></span><span class="token plain-text">
          </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span>
            <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>text<span class="token punctuation">"</span></span>
            <span class="token attr-name">value</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">&#123;</span>firstName<span class="token punctuation">&#125;</span></span>
            <span class="token attr-name">onChange</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">&#123;</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
              <span class="token function">setFirstName</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>target<span class="token punctuation">.</span>value<span class="token punctuation">)</span>
            <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></span>
          <span class="token punctuation">/></span></span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span><span class="token plain-text">
          </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>label</span> <span class="token attr-name">htmlFor</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token plain-text">Last name</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>label</span><span class="token punctuation">></span></span><span class="token plain-text">
          </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span>
            <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>text<span class="token punctuation">"</span></span>
            <span class="token attr-name">value</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">&#123;</span>lastName<span class="token punctuation">&#125;</span></span>
            <span class="token attr-name">onChange</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">&#123;</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
              <span class="token function">setLastName</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>target<span class="token punctuation">.</span>value<span class="token punctuation">)</span>
            <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></span>
          <span class="token punctuation">/></span></span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span><span class="token punctuation">></span></span><span class="token plain-text">submit</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>form</span><span class="token punctuation">></span></span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
  <span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> UserForm</code></pre>

<p>App.tsx</p>
<pre class="language-tsx" data-language="tsx"><code class="language-tsx"><span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">'react'</span>
<span class="token keyword">import</span> <span class="token string">'./App.css'</span>

<span class="token keyword">import</span> UserForm <span class="token keyword">from</span> <span class="token string">'./components/33UserForm'</span>

<span class="token keyword">const</span> <span class="token function-variable function">App</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">className</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>App<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">UserForm</span></span> <span class="token punctuation">/></span></span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
  <span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> App</code></pre>

<p><img src="https://gw.alicdn.com/tfs/TB105U6HQL0gK0jSZFtXXXQCXXa-696-241.gif" alt="img"></p>
<h3 id="抽象出-useInput-hook"><a href="#抽象出-useInput-hook" class="headerlink" title="抽象出 useInput hook"></a>抽象出 useInput hook</h3><p>useInput.tsx</p>
<pre class="language-tsx" data-language="tsx"><code class="language-tsx"><span class="token keyword">import</span> <span class="token punctuation">&#123;</span> useState <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'react'</span>

<span class="token keyword">function</span> <span class="token function">useInput</span><span class="token punctuation">(</span>initialValue<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>value<span class="token punctuation">,</span> setValue<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span>initialValue<span class="token punctuation">)</span>
  <span class="token keyword">const</span> <span class="token function-variable function">reset</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    <span class="token function">setValue</span><span class="token punctuation">(</span>initialValue<span class="token punctuation">)</span>
  <span class="token punctuation">&#125;</span>
  <span class="token keyword">const</span> bind <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
    value<span class="token punctuation">,</span>
    <span class="token function">onChange</span><span class="token punctuation">(</span>e<span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
      <span class="token function">setValue</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>target<span class="token punctuation">.</span>value<span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span>
  <span class="token punctuation">&#125;</span>
  <span class="token keyword">return</span> <span class="token punctuation">[</span>value<span class="token punctuation">,</span> bind<span class="token punctuation">,</span> reset<span class="token punctuation">]</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> useInput</code></pre>

<p>UserForm.tsx</p>
<pre class="language-tsx" data-language="tsx"><code class="language-tsx"><span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">&#123;</span> FormEvent <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'react'</span>
<span class="token keyword">import</span> useInput <span class="token keyword">from</span> <span class="token string">'./hooks/useInput'</span>

<span class="token keyword">function</span> <span class="token function">UserForm</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>

  <span class="token keyword">const</span> <span class="token punctuation">[</span>firstName<span class="token punctuation">,</span> bindFirstName<span class="token punctuation">,</span> resetFirstName<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useInput</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>lastName<span class="token punctuation">,</span> bindLastName<span class="token punctuation">,</span> resetLastName<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useInput</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span>

  <span class="token keyword">const</span> <span class="token function-variable function">submitHandler</span> <span class="token operator">=</span> <span class="token punctuation">(</span>e<span class="token operator">:</span> FormEvent<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    e<span class="token punctuation">.</span><span class="token function">preventDefault</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Hello </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>firstName<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string"> </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>lastName<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
    <span class="token comment">// @ts-ignore</span>
    <span class="token function">resetFirstName</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token comment">// @ts-ignore</span>
    <span class="token function">resetLastName</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">&#125;</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span> <span class="token attr-name">onSubmit</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">&#123;</span>submitHandler<span class="token punctuation">&#125;</span></span><span class="token punctuation">></span></span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span><span class="token plain-text">
          </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>label</span> <span class="token attr-name">htmlFor</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token plain-text">First name</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>label</span><span class="token punctuation">></span></span><span class="token plain-text">
          </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span>
            <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>text<span class="token punctuation">"</span></span>
            <span class="token spread"><span class="token punctuation">&#123;</span><span class="token operator">...</span>bindFirstName<span class="token punctuation">&#125;</span></span>
          <span class="token punctuation">/></span></span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span><span class="token plain-text">
          </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>label</span> <span class="token attr-name">htmlFor</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token plain-text">Last name</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>label</span><span class="token punctuation">></span></span><span class="token plain-text">
          </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span>
            <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>text<span class="token punctuation">"</span></span>
            <span class="token spread"><span class="token punctuation">&#123;</span><span class="token operator">...</span>bindLastName<span class="token punctuation">&#125;</span></span>
          <span class="token punctuation">/></span></span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span><span class="token punctuation">></span></span><span class="token plain-text">submit</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>form</span><span class="token punctuation">></span></span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
  <span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> UserForm</code></pre>

<p>页面展示</p>
<p><img src="https://gw.alicdn.com/tfs/TB1zXxbH7T2gK0jSZFkXXcIQFXa-696-241.gif" alt="img"></p>
<h2 id="小结"><a href="#小结" class="headerlink" title="小结"></a>小结</h2><p>本章我们主要学习了自定义 Hook，举了 3 个例子，帮助我们学习抽象与复用代码。社区上还有很多人写了自己的自定义 Hook，大家也可以前去学习。也鼓励大家创造一些自己的自定义 Hook。</p>
<p>至此，本系列完结。祝一切顺利，大家都能学到东西。</p>
]]></content>
      <categories>
        <category>JavaScript</category>
      </categories>
      <tags>
        <tag>React</tag>
        <tag>hooks</tag>
      </tags>
  </entry>
  <entry>
    <title>React Hooks 系列之 useMemo</title>
    <url>/2020/06/21/401.html</url>
    <content><![CDATA[<p>掌握 React Hooks api 将更好的帮助你在工作中使用，对 React 的掌握更上一层楼。</p>
<p>我们学习了 useCallback 来进行性能优化，关于性能优化还有另一个 hook api，那就是 useMemo，下面我们一起通过一个例子来看看。</p>
<h2 id="计数器示例"><a href="#计数器示例" class="headerlink" title="计数器示例"></a>计数器示例</h2><p>依然是计数器示例，创建2个计数器，并能区分当前是奇数或者偶数，为了模拟点击按钮时包含大量的计算逻辑影响性能，在判断偶数的方法中添加了没有用的计算逻辑，为了让性能差的明显。代码如下</p>
<p>Counter.tsx</p>
<pre class="language-tsx" data-language="tsx"><code class="language-tsx"><span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">&#123;</span> useState <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'react'</span>

<span class="token keyword">function</span> <span class="token function">Counter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>counterOne<span class="token punctuation">,</span> setCounterOne<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>counterTwo<span class="token punctuation">,</span> setCounterTwo<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>

  <span class="token keyword">const</span> <span class="token function-variable function">incrementOne</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    <span class="token function">setCounterOne</span><span class="token punctuation">(</span>counterOne <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span>
  <span class="token punctuation">&#125;</span>

  <span class="token keyword">const</span> <span class="token function-variable function">incrementTwo</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    <span class="token function">setCounterTwo</span><span class="token punctuation">(</span>counterTwo <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span>
  <span class="token punctuation">&#125;</span>

  <span class="token keyword">const</span> <span class="token function-variable function">isEven</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span>
    <span class="token keyword">while</span> <span class="token punctuation">(</span>i <span class="token operator">&lt;</span> <span class="token number">1000000000</span><span class="token punctuation">)</span> i <span class="token operator">+=</span> <span class="token number">1</span>
    <span class="token keyword">return</span> counterOne <span class="token operator">%</span> <span class="token number">2</span> <span class="token operator">===</span> <span class="token number">0</span>
  <span class="token punctuation">&#125;</span>

  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span>
        <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">&#123;</span>incrementOne<span class="token punctuation">&#125;</span></span>
      <span class="token punctuation">></span></span><span class="token plain-text">Count One = </span><span class="token punctuation">&#123;</span>counterOne<span class="token punctuation">&#125;</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span><span class="token punctuation">></span></span><span class="token plain-text">
        </span><span class="token punctuation">&#123;</span>
          <span class="token function">isEven</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token string">'even'</span> <span class="token operator">:</span> <span class="token string">'odd'</span>
        <span class="token punctuation">&#125;</span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">></span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span> <span class="token punctuation">/></span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span>
        <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">&#123;</span>incrementTwo<span class="token punctuation">&#125;</span></span>
      <span class="token punctuation">></span></span><span class="token plain-text">Count Two = </span><span class="token punctuation">&#123;</span>counterTwo<span class="token punctuation">&#125;</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
  <span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> Counter</code></pre>

<p>App.tsx</p>
<pre class="language-tsx" data-language="tsx"><code class="language-tsx"><span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">'react'</span>
<span class="token keyword">import</span> <span class="token string">'./App.css'</span>

<span class="token keyword">import</span> Counter <span class="token keyword">from</span> <span class="token string">'./components/27.Counter'</span>

<span class="token keyword">const</span> <span class="token function-variable function">App</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">className</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>App<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Counter</span></span> <span class="token punctuation">/></span></span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
  <span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> App</code></pre>

<p>页面展示如下</p>
<p><img src="https://gw.alicdn.com/tfs/TB1r2l1GND1gK0jSZFKXXcJrVXa-702-286.gif" alt="img"></p>
<p>我们发现点击第一个按钮有较长的延迟，因为我们的判断偶数的逻辑中包含了大量的计算逻辑。但是，我们点击第二个按钮，也有较长的延迟！这很奇怪。</p>
<p>这是因为，每次 state 更新时，组件会 rerender，isEven 会被执行，这就是我们点击第二个按钮时，也会卡的原因。我们需要优化，告诉 React 不要有不必要的计算，特别是这种计算量复杂的。</p>
<p>在我们的示例中，我们要告诉 React，在点击第二个按钮时，不要执行 isEven 方法。这时就需要 useMemo hook 登场了。</p>
<h2 id="useMemo"><a href="#useMemo" class="headerlink" title="useMemo"></a>useMemo</h2><h3 id="优化示例"><a href="#优化示例" class="headerlink" title="优化示例"></a>优化示例</h3><p>与 useCallback 的用法类似。</p>
<pre class="language-tsx" data-language="tsx"><code class="language-tsx"><span class="token keyword">const</span> memoizedValue <span class="token operator">=</span> <span class="token function">useMemo</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">computeExpensiveValue</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>a<span class="token punctuation">,</span> b<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>

<blockquote>
<p>返回一个 memoized 值。 把“创建”函数和依赖项数组作为参数传入 <code>useMemo</code>，它仅会在某个依赖项改变时才重新计算 memoized 值。这种优化有助于避免在每次渲染时都进行高开销的计算。</p>
<p>记住，传入 <code>useMemo</code> 的函数会在渲染期间执行。请不要在这个函数内部执行与渲染无关的操作，诸如副作用这类的操作属于 <code>useEffect</code> 的适用范畴，而不是 <code>useMemo</code>。</p>
<p>如果没有提供依赖项数组，<code>useMemo</code> 在每次渲染时都会计算新的值。</p>
<p><strong>你可以把 useMemo 作为性能优化的手段，但不要把它当成语义上的保证。</strong> 将来，React 可能会选择“遗忘”以前的一些 memoized 值，并在下次渲染时重新计算它们，比如为离屏组件释放内存。先编写在没有 useMemo 的情况下也可以执行的代码 —— 之后再在你的代码中添加 useMemo，以达到优化性能的目的。</p>
</blockquote>
<p>首先引入 useMemo</p>
<pre class="language-tsx" data-language="tsx"><code class="language-tsx"><span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">&#123;</span> useState<span class="token punctuation">,</span> useMemo <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'react'</span></code></pre>

<p>然后将 isEven 方法使用 useMemo 改写，返回值赋给 isEven</p>
<pre class="language-tsx" data-language="tsx"><code class="language-tsx"><span class="token keyword">const</span> isEven <span class="token operator">=</span> <span class="token function">useMemo</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span>
  <span class="token keyword">while</span> <span class="token punctuation">(</span>i <span class="token operator">&lt;</span> <span class="token number">1000000000</span><span class="token punctuation">)</span> i <span class="token operator">+=</span> <span class="token number">1</span>
  <span class="token keyword">return</span> counterOne <span class="token operator">%</span> <span class="token number">2</span> <span class="token operator">===</span> <span class="token number">0</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>counterOne<span class="token punctuation">]</span><span class="token punctuation">)</span></code></pre>

<p>最后记得修改 isEven 使用的地方，已经从一个方法变为了一个变量</p>
<pre class="language-tsx" data-language="tsx"><code class="language-tsx"><span class="token punctuation">&#123;</span>
  isEven <span class="token operator">?</span> <span class="token string">'even'</span> <span class="token operator">:</span> <span class="token string">'odd'</span>
<span class="token punctuation">&#125;</span></code></pre>

<p>完整代码如下</p>
<p>Counter.tsx</p>
<pre class="language-tsx" data-language="tsx"><code class="language-tsx"><span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">&#123;</span> useState<span class="token punctuation">,</span> useMemo <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'react'</span>

<span class="token keyword">function</span> <span class="token function">Counter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>counterOne<span class="token punctuation">,</span> setCounterOne<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>counterTwo<span class="token punctuation">,</span> setCounterTwo<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>

  <span class="token keyword">const</span> <span class="token function-variable function">incrementOne</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    <span class="token function">setCounterOne</span><span class="token punctuation">(</span>counterOne <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span>
  <span class="token punctuation">&#125;</span>

  <span class="token keyword">const</span> <span class="token function-variable function">incrementTwo</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    <span class="token function">setCounterTwo</span><span class="token punctuation">(</span>counterTwo <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span>
  <span class="token punctuation">&#125;</span>

  <span class="token keyword">const</span> isEven <span class="token operator">=</span> <span class="token function">useMemo</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span>
    <span class="token keyword">while</span> <span class="token punctuation">(</span>i <span class="token operator">&lt;</span> <span class="token number">1000000000</span><span class="token punctuation">)</span> i <span class="token operator">+=</span> <span class="token number">1</span>
    <span class="token keyword">return</span> counterOne <span class="token operator">%</span> <span class="token number">2</span> <span class="token operator">===</span> <span class="token number">0</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>counterOne<span class="token punctuation">]</span><span class="token punctuation">)</span>

  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span>
        <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">&#123;</span>incrementOne<span class="token punctuation">&#125;</span></span>
      <span class="token punctuation">></span></span><span class="token plain-text">Count One = </span><span class="token punctuation">&#123;</span>counterOne<span class="token punctuation">&#125;</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span><span class="token punctuation">></span></span><span class="token plain-text">
        </span><span class="token punctuation">&#123;</span>
          isEven <span class="token operator">?</span> <span class="token string">'even'</span> <span class="token operator">:</span> <span class="token string">'odd'</span>
        <span class="token punctuation">&#125;</span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">></span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span> <span class="token punctuation">/></span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span>
        <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">&#123;</span>incrementTwo<span class="token punctuation">&#125;</span></span>
      <span class="token punctuation">></span></span><span class="token plain-text">Count Two = </span><span class="token punctuation">&#123;</span>counterTwo<span class="token punctuation">&#125;</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
  <span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> Counter</code></pre>

<p>效果如下</p>
<p><img src="https://gw.alicdn.com/tfs/TB1Oz_bb5cKOu4jSZKbXXc19XXa-702-286.gif" alt="img"></p>
<p>我们看到点击第二个按钮时，不会有任何卡顿，这是因为使用了 useMemo 只依赖了 counterOne 变量，点击第二个按钮时，isEven 读取的是缓存值，不需要再重新计算是否为偶数。</p>
<h3 id="useMemo-与-useCallback-的区别"><a href="#useMemo-与-useCallback-的区别" class="headerlink" title="useMemo 与 useCallback 的区别"></a>useMemo 与 useCallback 的区别</h3><p>useCallback 是缓存了函数自身，而 useMemo 是缓存了函数的返回值。</p>
<h2 id="小结"><a href="#小结" class="headerlink" title="小结"></a>小结</h2><p>本章通过示例展示了 useMemo 在性能优化中的作用。通过缓存函数的返回值，避免不必要的调用，从而避免了组件 rerender。</p>
<p>最后有分析了 useMemo 与 useCallback 的区别，即 useMemo 是缓存了函数的返回值，useCallback 是缓存了函数自身。这两个 api 都是性能优化的方法。</p>
]]></content>
      <categories>
        <category>JavaScript</category>
      </categories>
      <tags>
        <tag>React</tag>
        <tag>hooks</tag>
      </tags>
  </entry>
  <entry>
    <title>你真的了解浏览器Event-loop吗</title>
    <url>/2020/07/08/00708.html</url>
    <content><![CDATA[<h1 id="彻底搞懂浏览器Event-loop"><a href="#彻底搞懂浏览器Event-loop" class="headerlink" title="彻底搞懂浏览器Event-loop"></a>彻底搞懂浏览器Event-loop</h1><p>event-loop 算是很底层的一个东西了，可是我每次都很浅显的以为就是，任务的不断循环，同步，异步的执行，这次闲了下来准备盘一下它</p>
<h2 id="1-JavaScript-的运行机制"><a href="#1-JavaScript-的运行机制" class="headerlink" title="1. JavaScript 的运行机制"></a>1. JavaScript 的运行机制</h2><p>（1）所有同步任务都在主线程上执行，形成一个执行栈（execution context stack）。</p>
<p>（2）主线程之外，还存在”任务队列”(task queue)。只要异步任务有了运行结果，就在”任务队列”之中放置一个事件。</p>
<p>（3）一旦”执行栈”中的所有同步任务执行完毕，系统就会读取”任务队列”，看看里面有哪些事件。那些对应的异步任务，于是结束等待状态，进入执行栈，开始执行。</p>
<p>（4）主线程不断重复上面的第三步</p>
<p>概括即是: 调用栈中的同步任务都执行完毕，栈内被清空了，就代表主线程空闲了，这个时候就会去任务队列中按照顺序读取一个任务放入到栈中执行。每次栈内被清空，都会去读取任务队列有没有任务，有就读取执行，一直循环读取-执行的操作</p>
<blockquote>
<p>一个事件循环中有一个或者是多个任务队列</p>
</blockquote>
<blockquote>
<p>JavaScript中有两种异步任务:</p>
</blockquote>
<ol>
<li>宏任务: script（整体代码）, setTimeout, setInterval, setImmediate, I/O, UI rendering</li>
<li>微任务: process.nextTick（Nodejs）, Promises, Object.observe, MutationObserver;</li>
</ol>
<h3 id="2-事件循环-event-loop-是什么？"><a href="#2-事件循环-event-loop-是什么？" class="headerlink" title="2. 事件循环(event-loop)是什么？"></a>2. 事件循环(event-loop)是什么？</h3><p>主线程从”任务队列”中读取执行事件，这个过程是循环不断的，这个机制被称为事件循环。此机制具体如下:主线程会不断从任务队列中按顺序取任务执行，每执行完一个任务都会检查microtask队列是否为空（执行完一个任务的具体标志是函数执行栈为空），如果不为空则会一次性执行完所有microtask。然后再进入下一个循环去任务队列中取下一个任务执行。</p>
<blockquote>
<h4 id="详细说明"><a href="#详细说明" class="headerlink" title="详细说明:"></a>详细说明:</h4></blockquote>
<ol>
<li>选择当前要执行的宏任务队列，选择一个最先进入任务队列的宏任务，如果没有宏任务可以选择，则会跳转至microtask的执行步骤。</li>
<li>将事件循环的当前运行宏任务设置为已选择的宏任务。</li>
<li>运行宏任务。</li>
<li>将事件循环的当前运行任务设置为null。</li>
<li>将运行完的宏任务从宏任务队列中移除。</li>
<li>microtasks步骤：进入microtask检查点。</li>
<li>更新界面渲染。</li>
<li>返回第一步。</li>
</ol>
<p><strong>执行进入microtask检查的的具体步骤如下:</strong></p>
<ol>
<li>设置进入microtask检查点的标志为true。</li>
<li>当事件循环的微任务队列不为空时：选择一个最先进入microtask队列的microtask；设置事件循环的当前运行任务为已选择的microtask；运行microtask；设置事件循环的当前运行任务为null；将运行结束的microtask从microtask队列中移除。</li>
<li>对于相应事件循环的每个环境设置对象（environment settings object）,通知它们哪些promise为rejected。</li>
<li>清理indexedDB的事务。</li>
<li>设置进入microtask检查点的标志为false。</li>
</ol>
<p><strong>需要注意的是:当前执行栈执行完毕时会立刻先处理所有微任务队列中的事件, 然后再去宏任务队列中取出一个事件。同一次事件循环中, 微任务永远在宏任务之前执行。</strong></p>
<h3 id="3-Event-loop-是如何工作的？"><a href="#3-Event-loop-是如何工作的？" class="headerlink" title="3. Event-loop 是如何工作的？"></a>3. Event-loop 是如何工作的？</h3><p>先看一个简单的示例：</p>
<pre class="language-js" data-language="js"><code class="language-js"><span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=></span><span class="token punctuation">&#123;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"setTimeout1"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">data</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">222</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=></span><span class="token punctuation">&#123;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"setTimeout2"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token operator">=></span><span class="token punctuation">&#123;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">111</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>

<p>思考一下, 运行结果是什么？</p>
<p>运行结果为:</p>
<pre class="language-js" data-language="js"><code class="language-js"><span class="token number">111</span>
setTimeout1
<span class="token number">222</span>
setTimeout2</code></pre>

<p>我们来看一下为什么？</p>
<p>我们来详细说明一下, JS引擎是如何执行这段代码的:</p>
<ol>
<li>主线程上没有需要执行的代码</li>
<li>接着遇到setTimeout 0，它的作用是在 0ms 后将回调函数放到宏任务队列中(这个任务在下一次的事件循环中执行)。</li>
<li>接着遇到setTimeout 0，它的作用是在 0ms 后将回调函数放到宏任务队列中(这个任务在再下一次的事件循环中执行)。</li>
<li>首先检查微任务队列, 即 microtask队列，发现此队列不为空，执行第一个promise的then回调，输出 ‘111’。</li>
<li>此时microtask队列为空，进入下一个事件循环, 检查宏任务队列，发现有 setTimeout的回调函数，立即执行回调函数输出 ‘setTimeout1’,检查microtask 队列，发现队列不为空，执行promise的then回调，输出’222’，microtask队列为空，进入下一个事件循环。</li>
<li>检查宏任务队列，发现有 setTimeout的回调函数, 立即执行回调函数输出’setTimeout2’。</li>
</ol>
<p>再思考一下下面代码的执行顺序:</p>
<pre class="language-js" data-language="js"><code class="language-js">console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'script start'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'setTimeout---0'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'setTimeout---200'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'inner-setTimeout---0'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'promise5'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'promise1'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'promise2'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'promise3'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'script end'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>

<p>思考一下, 运行结果是什么？</p>
<p>运行结果为:</p>
<pre class="language-js" data-language="js"><code class="language-js">script start
script end
promise1
promise3
promise2
setTimeout<span class="token operator">--</span><span class="token operator">-</span><span class="token number">0</span>
setTimeout<span class="token operator">--</span><span class="token operator">-</span><span class="token number">200</span>
promise5
inner<span class="token operator">-</span>setTimeout<span class="token operator">--</span><span class="token operator">-</span><span class="token number">0</span></code></pre>

<p>那么为什么？</p>
<p>我们来详细说明一下, JS引擎是如何执行这段代码的:</p>
<ol>
<li>首先顺序执行完主进程上的同步任务，第一句和最后一句的console.log</li>
<li>接着遇到setTimeout 0，它的作用是在 0ms 后将回调函数放到宏任务队列中(这个任务在下一次的事件循环中执行)。</li>
<li>接着遇到setTimeout 200，它的作用是在 200ms 后将回调函数放到宏任务队列中(这个任务在再下一次的事件循环中执行)。</li>
<li>同步任务执行完之后，首先检查微任务队列, 即 microtask队列，发现此队列不为空，执行第一个promise的then回调，输出 ‘promise1’，然后执行第二个promise的then回调，输出’promise3’，由于第一个promise的.then()的返回依然是promise，所以第二个.then()会放到microtask队列继续执行，输出 ‘promise2’;</li>
<li>此时microtask队列为空，进入下一个事件循环, 检查宏任务队列，发现有 setTimeout的回调函数，立即执行回调函数输出 ‘setTimeout—0’,检查microtask 队列，队列为空，进入下一次事件循环.</li>
<li>检查宏任务队列，发现有 setTimeout的回调函数, 立即执行回调函数输出’setTimeout—200’.</li>
<li>接着遇到setTimeout 0，它的作用是在 0ms 后将回调函数放到宏任务队列中，检查微任务队列，即 microtask 队列，发现此队列不为空，执行promise的then回调，输出’promise5’。</li>
<li>此时microtask队列为空，进入下一个事件循环，检查宏任务队列，发现有 setTimeout 的回调函数，立即执行回调函数输出，输出’inner-setTimeout—0’。代码执行结束.</li>
</ol>
<h3 id="4-为什么会需要event-loop"><a href="#4-为什么会需要event-loop" class="headerlink" title="4. 为什么会需要event-loop?"></a>4. 为什么会需要event-loop?</h3><p>因为 JavaScript 是单线程的。单线程就意味着，所有任务需要排队，前一个任务结束，才会执行后一个任务。如果前一个任务耗时很长，后一个任务就不得不一直等着。为了协调事件（event），用户交互（user interaction），脚本（script），渲染（rendering），网络（networking）等，用户代理（user agent）必须使用事件循环（event loops）。</p>
<p>最后有一点需要注意的是：本文介绍的是浏览器的Event-loop，因此在测试验证时，一定要使用浏览器环境进行测试验证，如果使用了node环境，那么结果不一定是如上所说。</p>
]]></content>
      <categories>
        <category>JavaScript</category>
      </categories>
      <tags>
        <tag>事件循环</tag>
        <tag>浏览器</tag>
      </tags>
  </entry>
  <entry>
    <title>项目中可能会用到的前端性能优化</title>
    <url>/2020/07/01/449.html</url>
    <content><![CDATA[<h1 id="项目中可能会用到的优化方案"><a href="#项目中可能会用到的优化方案" class="headerlink" title="项目中可能会用到的优化方案"></a>项目中可能会用到的优化方案</h1><p>这前端性能优化可真是一个老生常谈的话题了，能在项目中优化的点有太多了，就像海绵里的水，只要你想挤一挤，它总是有的，那让我们来学习学习，看一下有木有平时没注意到的点呢？</p>
<h3 id="1-减少HTTP请求"><a href="#1-减少HTTP请求" class="headerlink" title="1.减少HTTP请求"></a>1.减少HTTP请求</h3><p>一个完整的HTTP请求需求经历<code>DNS</code>查找，TCP握手，浏览器发出HTTP请求，服务器接收请求，服务器处理请求并发回响应，浏览器接收响应等过程，所以建议将多个小文件合并为一个大文件，从而减少HTTP请求次数的原因</p>
<h3 id="2-使用HTTP2"><a href="#2-使用HTTP2" class="headerlink" title="2.使用HTTP2"></a>2.使用HTTP2</h3><p>HTTP相比<code>HTTP1.1</code>有如下几个优点：</p>
<p>解析速度快、多路复用、首部压缩、优先级、流量控制、服务器推送</p>
<h3 id="3-使用服务端渲染"><a href="#3-使用服务端渲染" class="headerlink" title="3.使用服务端渲染"></a>3.使用服务端渲染</h3><p>客户端渲染：获取HTML文件，根据需要下载<code>js</code>文件，运行文件，生成DOM，再渲染</p>
<p>服务端渲染：服务端返回HTML文件，客户端只需解析HTML</p>
<p>优点：首屏渲染快，SEO好</p>
<p>缺点：配置麻烦，增加了服务器的计算压力</p>
<h3 id="4-静态资源使用CDN"><a href="#4-静态资源使用CDN" class="headerlink" title="4.静态资源使用CDN"></a>4.静态资源使用<code>CDN</code></h3><p>内容分发网络（<code>CDN</code>）是一组分布在多个不同地理位置的Web服务器，我们都知道，当服务器离用户越远时，延迟越高。<code>CDN</code>就是为了解决这一问题，在多个位置部署服务器，让用户离服务器更近，从而缩短请求时间</p>
<h3 id="5-将CSS放在文件头部，JavaScript文件放在底部"><a href="#5-将CSS放在文件头部，JavaScript文件放在底部" class="headerlink" title="5.将CSS放在文件头部，JavaScript文件放在底部"></a>5.将<code>CSS</code>放在文件头部，JavaScript文件放在底部</h3><ul>
<li><code>CSS</code>执行会阻塞渲染，阻止<code>JS</code>执行</li>
<li><code>JS</code>加载和执行会阻塞HTML解析，阻止<code>CSSOM</code>构建</li>
</ul>
<p>如果这些<code>CSS</code>、<code>JS</code>标签放在HEAD标签里，并且需要加载和解析很久的话，那么页面就空白了。所以JS文件要放在底部（不阻止DOM解析，但会阻塞渲染）</p>
<p>那为什么<code>CSS</code>文件还要放在头部呢？</p>
<p>因为先加载HTML再加载<code>CSS</code>,会让用户第一时间看到的是没有样式的、丑陋的，为了避免这种情况发生，就要将<code>CSS</code>文件放在头部了。</p>
<p>另外，js文件也不是不可以放在头部，只要给script加上defer属性就好了，异步加载，延迟执行</p>
<h3 id="6-使用字体图标iconfont代替图片图标"><a href="#6-使用字体图标iconfont代替图片图标" class="headerlink" title="6.使用字体图标iconfont代替图片图标"></a>6.使用字体图标<code>iconfont</code>代替图片图标</h3><p>字体图标就是将图标制作成一个字体，使用时就跟字体一样，可以设置属性，例如font-size、color等等，非常方便。并且字体图标是矢量图，不会失真，还有一个优点就是生成的文件特别小</p>
<h3 id="7-巧用缓存，避免重复加载相同的资源"><a href="#7-巧用缓存，避免重复加载相同的资源" class="headerlink" title="7.巧用缓存，避免重复加载相同的资源"></a>7.巧用缓存，避免重复加载相同的资源</h3><p>为了避免用户每次访问网站都得请求文件，我们可以通过添加Expires或max-age来控制这一行为，Expires设置了一个时间，只要在这个时间之前，浏览器都不会请求文件，而是直接使用缓存，而max-age是一个相对时间，建议使用max-age代替Expires。</p>
<p>但随之就产生一个问题，当文件更新了怎么办？怎么通知浏览器重新请求文件？</p>
<p>可以通过更新页面中引用的资源链接地址，让浏览器主动放弃缓存，加载新资源</p>
<p>具体做法是把资源地址URL的修改与文件内容关联起来，也就是说，只有文件内容变化，才会导致相应URL变更，从而实现文件级别的精确缓存控制，什么东西与文件有关呢？我们会很自然的联想到利用数据摘要算法对文件求摘要信息，摘要信息与文件内容一一对应就有了一种可以精确到单个文件粒度的缓存控制依据了</p>
<h3 id="8-压缩文件"><a href="#8-压缩文件" class="headerlink" title="8.压缩文件"></a>8.压缩文件</h3><p>压缩文件可以减少文件下载时间，让用户体验性更好</p>
<p>得益于<code>webpack</code>和node的发展，现在压缩文件已经非常方便了</p>
<p>在<code>webpack</code>可以使用如下插件进行压缩：</p>
<ul>
<li>JavaScript：UglifyPlugin</li>
<li>CSS：MiniCssExtractPlugin</li>
<li>HTML：HtmlWebpackPlugin</li>
</ul>
<h3 id="9-图片懒加载"><a href="#9-图片懒加载" class="headerlink" title="9.图片懒加载"></a>9.图片懒加载</h3><p>在页面中，先不给图片设置路径，只有当图片出现在浏览器的可视区时，才去加载真正的图片，这就是图片懒加载，对于图片很多的网站来说，一次性加载全部图片会对用户体验造成很大的影响，所以需要使用图片懒加载</p>
<p>可以先给图片加上自定义属性 data-src</p>
<p>等页面可见时，使用<code>JS</code>加载图片：</p>
<pre class="language-js" data-language="js"><code class="language-js"><span class="token keyword">const</span> img<span class="token operator">=</span>document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'img'</span><span class="token punctuation">)</span>

img<span class="token punctuation">.</span>src<span class="token operator">=</span>img<span class="token punctuation">.</span>dataset<span class="token punctuation">.</span>src</code></pre>



<h3 id="10-减少重绘重排"><a href="#10-减少重绘重排" class="headerlink" title="10.减少重绘重排"></a>10.减少重绘重排</h3><p>浏览器渲染过程：</p>
<ol>
<li>解析HTML生成DOM树</li>
<li>解析<code>CSS</code>生成<code>CSSOM</code>规则树</li>
<li>解析<code>JS</code>，操作DOM树和<code>CSSOM</code>规则树</li>
<li>将DOM树与CSSOM规则树合并在一起生成渲染树</li>
<li>遍历渲染树开始布局，计算每个节点的位置大小信息</li>
<li>浏览器将所有图层的数据发送给<code>GPU</code>，<code>GPU</code>将图层合成并显示在屏幕上</li>
</ol>
<p><strong>重排</strong></p>
<p>当改变DOM元素的几何元素属性时，会导致浏览器重新生成渲染树，这个过程叫重排，也叫回流</p>
<p><strong>重绘</strong></p>
<p>当重新生成渲染树后，就要将渲染树每个节点绘制到屏幕，这个过程就叫重绘，不是所有的动作都会导致重排、例如改变字体颜色，只会导致重绘</p>
<p>什么操作会导致重排？</p>
<ul>
<li>添加或删除可见的DOM元素</li>
<li>元素位置改变</li>
<li>元素尺寸改变</li>
<li>内容改变</li>
<li>浏览器窗口尺寸改变</li>
</ul>
<p>如何减少重排重绘？</p>
<ul>
<li>用JavaScript修改样式时，最好不要直接写样式，而是替换class来改变样式</li>
<li>如果要对DOM元素执行一系列操作，可以将DOM元素脱离文档流，修改完成后，再将它带回文档，推荐使用隐藏元素(<code>display:none</code>)或文档碎片(<code>DocumentFragement</code>)</li>
<li>避免使用CSS表达式</li>
<li>避免使用display:table</li>
<li>属性连写，例如font系列 background系列</li>
</ul>
<h3 id="11-当判断条件数量越来越多时，越倾向于switch而不是if-else"><a href="#11-当判断条件数量越来越多时，越倾向于switch而不是if-else" class="headerlink" title="11.当判断条件数量越来越多时，越倾向于switch而不是if-else"></a>11.当判断条件数量越来越多时，越倾向于switch而不是if-else</h3><p>从性能上来说两者是一样的，但switch可读性更好，所以建议条件数量过多，改用switch，方便你我他</p>
<h3 id="12-不要覆盖原生方法"><a href="#12-不要覆盖原生方法" class="headerlink" title="12.不要覆盖原生方法"></a>12.不要覆盖原生方法</h3><p>无论你的<code>JavaScipt</code>代码如何优化，都比不上原生方法。因为原生方法是用低级语言写的(C/C++)并且被编译成机器码，成为浏览器的一部分，当原生方法可用时，尽量使用它们，特别是数学运算，和DOM操作</p>
<h3 id="小结："><a href="#小结：" class="headerlink" title="小结："></a>小结：</h3><p>其实还有很多很多，道阻且长，知识海洋无穷无尽，扬帆继续前行，慢慢学习，在项目中实践</p>
]]></content>
      <categories>
        <category>前端</category>
      </categories>
      <tags>
        <tag>性能优化</tag>
      </tags>
  </entry>
  <entry>
    <title>一文带你走进TS的世界-入门篇</title>
    <url>/2020/07/10/456.html</url>
    <content><![CDATA[<h1 id="学不会TS怎么办？那就多下功夫"><a href="#学不会TS怎么办？那就多下功夫" class="headerlink" title="学不会TS怎么办？那就多下功夫"></a>学不会TS怎么办？那就多下功夫</h1><p>Ts现在使用地越来越多，学计算机的就得不断的学习，才能更好的追逐这个时代，这是我不断学习的一些总结，不断复习巩固，加深印象，项目中才能游刃有余</p>
<h2 id="1-什么是TypeScript？"><a href="#1-什么是TypeScript？" class="headerlink" title="1.什么是TypeScript？"></a>1.什么是TypeScript？</h2><p>TypeScript简称TS，是JavaScript的超集，简单来说就是JS有的TS都有</p>
<p>TypeScript=Type+JavaScript（在JS基础上，为JS添加了类型支持/类型检测）</p>
<p>TypeScript是微软开发的开源编程语言，可以在任何运行JavaScript的地方运行</p>
<h2 id="2-安装"><a href="#2-安装" class="headerlink" title="2.安装"></a>2.安装</h2><blockquote>
<p>全局安装</p>
</blockquote>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token function">npm</span> <span class="token function">install</span> -g typescript</code></pre>

<h2 id="3-原始数据类型"><a href="#3-原始数据类型" class="headerlink" title="3.原始数据类型"></a>3.原始数据类型</h2><blockquote>
<p>我们在变量后面添加 :类型 就可以规定数据的类型，设置其他类型就会报错</p>
</blockquote>
<p>1.字符串 string</p>
<blockquote>
<p>双引号（””）或者单引号（’’）表示字符串</p>
</blockquote>
<pre class="language-js" data-language="js"><code class="language-js"><span class="token keyword">let</span> <span class="token literal-property property">name</span><span class="token operator">:</span>string<span class="token operator">=</span><span class="token string">'feico'</span></code></pre>

<p>2.数字 number</p>
<blockquote>
<p>支持十/十六/八 进制</p>
</blockquote>
<pre class="language-js" data-language="js"><code class="language-js"><span class="token keyword">let</span> <span class="token literal-property property">count</span><span class="token operator">:</span>number <span class="token operator">=</span> <span class="token number">100</span></code></pre>

<p>3.布尔 boolean</p>
<blockquote>
<p>只能是true/false</p>
</blockquote>
<pre class="language-js" data-language="js"><code class="language-js"><span class="token keyword">let</span> <span class="token literal-property property">flag</span><span class="token operator">:</span>boolean <span class="token operator">=</span> <span class="token boolean">true</span></code></pre>

<p>4.undefined</p>
<blockquote>
<p>用处不是很大</p>
</blockquote>
<pre class="language-js" data-language="js"><code class="language-js"><span class="token keyword">let</span> <span class="token literal-property property">ud</span><span class="token operator">:</span><span class="token keyword">undefined</span><span class="token operator">=</span><span class="token keyword">undefined</span></code></pre>

<p>5.null</p>
<blockquote>
<p>用处不是很大</p>
</blockquote>
<pre class="language-js" data-language="js"><code class="language-js"><span class="token keyword">let</span> <span class="token literal-property property">timer</span><span class="token operator">:</span><span class="token keyword">null</span> <span class="token operator">=</span> <span class="token keyword">null</span></code></pre>

<p>6.空 void</p>
<blockquote>
<p>没有任何类型，函数的没用返回值的使用void，返回值为空（undefined)</p>
</blockquote>
<pre class="language-js" data-language="js"><code class="language-js"><span class="token keyword">function</span> <span class="token function">getName</span><span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">str</span><span class="token operator">:</span>string</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token keyword">void</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span></code></pre>

<p>7.任意类型 any</p>
<blockquote>
<p>这里当类型不确定的时候，就可以使用any任意类型，不到万不得已不使用Unkonw类型和any一样可以容纳任意类型比any安全</p>
<p>平时用的不多</p>
</blockquote>
<pre class="language-js" data-language="js"><code class="language-js"><span class="token keyword">let</span> <span class="token literal-property property">obj</span><span class="token operator">:</span>any
obj <span class="token operator">=</span> <span class="token number">123</span>
obj <span class="token operator">=</span> <span class="token string">'123'</span>
<span class="token function-variable function">obj</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>
obj <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
obj <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span></code></pre>

<p>8.字面量</p>
<blockquote>
<p>定义什么就只能赋值什么</p>
</blockquote>
<pre class="language-js" data-language="js"><code class="language-js"><span class="token keyword">let</span> <span class="token literal-property property">hero</span><span class="token operator">:</span><span class="token string">'钢铁侠'</span>
hero<span class="token operator">=</span><span class="token string">'蜘蛛侠'</span>  ×
hero<span class="token operator">=</span><span class="token string">'钢铁侠'</span>  √</code></pre>

<pre class="language-js" data-language="js"><code class="language-js"><span class="token keyword">let</span> <span class="token literal-property property">hero</span><span class="token operator">:</span><span class="token string">'钢铁侠'</span> <span class="token operator">|</span> <span class="token string">'蜘蛛侠'</span>

hero <span class="token operator">=</span> <span class="token string">'钢铁侠'</span>  √
hero <span class="token operator">=</span> <span class="token string">'蜘蛛侠'</span>  √</code></pre>

<h2 id="4-复杂类型"><a href="#4-复杂类型" class="headerlink" title="4.复杂类型"></a>4.复杂类型</h2><p>1.数组 array</p>
<blockquote>
<p>设置数组的类型 比如这个例子 true 这个就会报错，不属于number，数组的元素必须是规定好的类型 其他类型同理</p>
</blockquote>
<pre class="language-js" data-language="js"><code class="language-js"><span class="token keyword">let</span> <span class="token literal-property property">arr</span><span class="token operator">:</span>number<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token boolean">true</span><span class="token punctuation">]</span> × 
<span class="token keyword">let</span> <span class="token literal-property property">arr</span><span class="token operator">:</span>number<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span>，<span class="token number">5</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">]</span> √</code></pre>

<p>2.元组 tuple</p>
<blockquote>
<p>学习过Python的同学应该不太陌生，其实可以把它看做一个数组，可以声明多个类型的数组，这样就能插入多个类型的数据，就是长度固定的数组</p>
</blockquote>
<pre class="language-js" data-language="js"><code class="language-js"><span class="token keyword">let</span> <span class="token literal-property property">tuple1</span><span class="token operator">:</span><span class="token punctuation">[</span>string<span class="token punctuation">,</span>boolean<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'测试'</span><span class="token punctuation">,</span><span class="token boolean">true</span><span class="token punctuation">]</span></code></pre>

<p>3.接口 interface</p>
<blockquote>
<p>它能很方便的帮我们定义 Object 类型，它是非常的灵活可以描述对象的各种类型</p>
</blockquote>
<p>与 java 的 interface有些区别，下面简单的看下</p>
<pre class="language-tsx" data-language="tsx"><code class="language-tsx"><span class="token keyword">interface</span> <span class="token class-name">Device</span> <span class="token punctuation">&#123;</span>
    type<span class="token operator">:</span><span class="token builtin">string</span>
    width<span class="token operator">:</span><span class="token builtin">number</span>
    height<span class="token operator">:</span><span class="token builtin">number</span>
<span class="token punctuation">&#125;</span>
<span class="token comment">// 定义 phone 的类型为Device 这个时候 上面定义的属性都必须有 而且不能有多余的属性</span>
<span class="token keyword">let</span> phone<span class="token operator">:</span>Device <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
    type<span class="token operator">:</span><span class="token string">'华为'</span><span class="token punctuation">,</span>
    width<span class="token operator">:</span><span class="token number">0.06</span>
    height<span class="token operator">:</span><span class="token number">0.21</span>
<span class="token punctuation">&#125;</span></code></pre>

<blockquote>
<p>在 interface 属性中添加？可以省略</p>
</blockquote>
<p>下面我们给height添加 <code>？</code></p>
<pre class="language-tsx" data-language="tsx"><code class="language-tsx"><span class="token keyword">interface</span> <span class="token class-name">Device</span> <span class="token punctuation">&#123;</span>
    type<span class="token operator">:</span><span class="token builtin">string</span>
    width<span class="token operator">:</span><span class="token builtin">number</span>
    height<span class="token operator">?</span><span class="token operator">:</span><span class="token builtin">number</span>  <span class="token comment">// 添加了 ？ 就代表可以没有</span>
<span class="token punctuation">&#125;</span>
<span class="token keyword">let</span> phone<span class="token operator">:</span>Device <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
    type<span class="token operator">:</span><span class="token string">'华为'</span><span class="token punctuation">,</span>
    width<span class="token operator">:</span><span class="token number">0.06</span>
<span class="token punctuation">&#125;</span></code></pre>

<blockquote>
<p><code>readonly</code> 不可改变的，定义完后就不能修改，是不是和 <code>const</code> 有点像，不过 <code>const</code> 是针对变量， <code>readonly</code> 是针对属性</p>
</blockquote>
<p>下面我们把id添加上readonly</p>
<pre class="language-tsx" data-language="tsx"><code class="language-tsx"><span class="token keyword">interface</span> <span class="token class-name">Device</span><span class="token punctuation">&#123;</span>
    <span class="token keyword">readonly</span> id<span class="token operator">:</span><span class="token builtin">number</span>
    type<span class="token operator">:</span><span class="token builtin">string</span>
    width<span class="token operator">:</span><span class="token builtin">number</span>
    height<span class="token operator">?</span><span class="token operator">:</span><span class="token builtin">number</span>  
<span class="token punctuation">&#125;</span>
<span class="token keyword">let</span> phone Device<span class="token operator">=</span> <span class="token punctuation">&#123;</span>
    id<span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">,</span>
    type<span class="token operator">:</span><span class="token string">'华为'</span><span class="token punctuation">,</span>
    width<span class="token operator">:</span><span class="token number">0.06</span>
<span class="token punctuation">&#125;</span>
phone<span class="token punctuation">.</span>id <span class="token operator">=</span> <span class="token number">123</span> ×</code></pre>

<p>4.函数 function</p>
<blockquote>
<p>我们要规定函数的输入类型 和 返回类型</p>
<p>在形参后面接冒号声明 形参的类型，在 ()后面 冒号声明返回值类型</p>
</blockquote>
<p>传入多余的参数会报错</p>
<pre class="language-tsx" data-language="tsx"><code class="language-tsx"><span class="token keyword">function</span> <span class="token function">sum</span><span class="token punctuation">(</span>num1<span class="token operator">:</span><span class="token builtin">number</span><span class="token punctuation">,</span>num2<span class="token operator">:</span><span class="token builtin">number</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token builtin">number</span><span class="token punctuation">&#123;</span>
    <span class="token keyword">return</span> num1<span class="token operator">+</span>num2
<span class="token punctuation">&#125;</span>

<span class="token function">sum</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span>
<span class="token function">sum</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">)</span> ×</code></pre>

<p>我们也可以为函数添加可选参数 这里用 ？ 即可，这样我们就可以调用两个参数或者三个参数不报错</p>
<pre class="language-js" data-language="js"><code class="language-js"><span class="token keyword">function</span> <span class="token function">sum</span><span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">num1</span><span class="token operator">:</span>number<span class="token punctuation">,</span><span class="token literal-property property">num2</span><span class="token operator">:</span>number<span class="token punctuation">,</span>num3<span class="token operator">?</span><span class="token operator">:</span>number</span><span class="token punctuation">)</span><span class="token operator">:</span>number<span class="token punctuation">&#123;</span>
    <span class="token keyword">return</span> num1<span class="token operator">+</span>num2
<span class="token punctuation">&#125;</span>
<span class="token function">sum</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span>
<span class="token function">sum</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">)</span> √</code></pre>

<p>可选参数之后不能再加规定类型的形参</p>
<pre class="language-js" data-language="js"><code class="language-js"><span class="token keyword">function</span> <span class="token function">sum</span><span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">num1</span><span class="token operator">:</span>number<span class="token punctuation">,</span><span class="token literal-property property">num2</span><span class="token operator">:</span>num2<span class="token operator">:</span>number<span class="token punctuation">,</span>num3<span class="token operator">?</span>number<span class="token punctuation">,</span><span class="token literal-property property">z</span><span class="token operator">:</span>number</span><span class="token punctuation">)</span><span class="token operator">:</span>number<span class="token punctuation">&#123;</span>
    <span class="token keyword">return</span> num1<span class="token operator">+</span>num2
<span class="token punctuation">&#125;</span>
<span class="token comment">// z:number 就是后加的类型</span></code></pre>

<p>我们可以把它添加个 ？ 变为可选参数</p>
<pre class="language-js" data-language="js"><code class="language-js"><span class="token keyword">function</span> <span class="token function">sum</span><span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">num1</span><span class="token operator">:</span>number<span class="token punctuation">,</span><span class="token literal-property property">num2</span><span class="token operator">:</span>number<span class="token punctuation">,</span>num3<span class="token operator">?</span><span class="token operator">:</span>number<span class="token punctuation">,</span>z<span class="token operator">?</span><span class="token operator">:</span>number</span><span class="token punctuation">)</span><span class="token operator">:</span>number<span class="token punctuation">&#123;</span>
    <span class="token keyword">return</span> num1<span class="token operator">+</span>num2
<span class="token punctuation">&#125;</span></code></pre>

<p>除了上面这种声明式写法还有一种表达式写法</p>
<pre class="language-js" data-language="js"><code class="language-js"><span class="token keyword">const</span> sum <span class="token operator">=</span> <span class="token punctuation">(</span>num1<span class="token operator">:</span>number<span class="token punctuation">,</span><span class="token literal-property property">num2</span><span class="token operator">:</span>number<span class="token punctuation">)</span><span class="token operator">:</span><span class="token parameter">number</span><span class="token operator">=></span><span class="token punctuation">&#123;</span>
    <span class="token keyword">return</span> num1<span class="token operator">+</span>num2
<span class="token punctuation">&#125;</span></code></pre>

<blockquote>
<p>有了上面的了解后我们来说下定义函数类型的变量</p>
</blockquote>
<p>这里这个函数还是上面那个</p>
<p>我们定义mysum指定它 的类型来接收我们上面定义的函数</p>
<p>() 里面是输入的形参的类型</p>
<p>=&gt; 代表是返回值的类型</p>
<p>： 后面的都是声明类型，和代码逻辑没有什么关系</p>
<pre class="language-js" data-language="js"><code class="language-js"><span class="token keyword">const</span> sum <span class="token operator">=</span> <span class="token punctuation">(</span>num1<span class="token operator">:</span>number<span class="token punctuation">,</span><span class="token literal-property property">num2</span><span class="token operator">:</span>number<span class="token punctuation">)</span><span class="token operator">:</span><span class="token parameter">number</span><span class="token operator">=></span><span class="token punctuation">&#123;</span>
	<span class="token keyword">return</span> num1<span class="token operator">+</span>nmm2
<span class="token punctuation">&#125;</span>
<span class="token keyword">let</span> <span class="token function-variable function">mysum</span><span class="token operator">:</span><span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">num</span><span class="token operator">:</span>number<span class="token punctuation">,</span><span class="token literal-property property">num2</span><span class="token operator">:</span>number</span><span class="token punctuation">)</span><span class="token operator">=></span>sum</code></pre>

<blockquote>
<p>我们刚才说了 interface 可以描述各种类型，那我们用 interface来描述下函数类型</p>
</blockquote>
<p>注意一点 之前用的=&gt; 来表示返回值类型</p>
<p>这里是在（）后 :来表示返回值类型</p>
<p>这里是（）后：返回值类型</p>
<pre class="language-js" data-language="js"><code class="language-js"><span class="token keyword">const</span> sum<span class="token operator">=</span><span class="token punctuation">(</span>num1<span class="token operator">:</span>number<span class="token punctuation">,</span><span class="token literal-property property">num2</span><span class="token operator">:</span>number<span class="token punctuation">)</span><span class="token operator">:</span><span class="token parameter">number</span><span class="token operator">=></span><span class="token punctuation">&#123;</span>
    <span class="token keyword">return</span> num1<span class="token operator">+</span>num2
<span class="token punctuation">&#125;</span>

<span class="token keyword">interface</span> <span class="token class-name">Isum</span><span class="token punctuation">&#123;</span>
    <span class="token punctuation">(</span>num1<span class="token operator">:</span>number<span class="token punctuation">,</span><span class="token literal-property property">num2</span><span class="token operator">:</span>number<span class="token punctuation">)</span><span class="token operator">:</span>number
<span class="token punctuation">&#125;</span>
<span class="token keyword">let</span> <span class="token literal-property property">mysum</span><span class="token operator">:</span>Isum <span class="token operator">=</span> sum</code></pre>

<p><strong>5.联合类型 union types</strong></p>
<blockquote>
<p>但对于一个变量的类型可能是几种类型的时候我们可以使用any，但是any的返回是不是有点大了，不到万不得已不使用</p>
<p>我们如果知道是其中的哪几种类型的话，我们就可以使用 联合<strong>调用类型</strong>用 | 分隔</p>
</blockquote>
<p>比如下面的例子，hello 可能是 number 或者 string</p>
<pre class="language-js" data-language="js"><code class="language-js"><span class="token comment">// 联合类型</span>
<span class="token keyword">let</span> <span class="token literal-property property">hello</span><span class="token operator">:</span>number <span class="token operator">|</span> string
hello <span class="token operator">=</span> <span class="token string">'string'</span>
hello <span class="token operator">=</span> <span class="token number">123</span></code></pre>

<p>注意：在没有赋值之前，只能访问共同的方法、属性，比如下面的例子，number没有length属性</p>
<pre class="language-js" data-language="js"><code class="language-js"><span class="token comment">// 联合类型</span>
<span class="token keyword">let</span> <span class="token literal-property property">hello</span><span class="token operator">:</span>number <span class="token operator">|</span> string
hello<span class="token punctuation">.</span>length
hello<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
hello<span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre>

<p><strong>6.对象object</strong></p>
<blockquote>
<p>我们直接 let  a:object 是不是没有什么意义，因为 js 中对象太多了</p>
</blockquote>
<p>我们可以这样来用</p>
<pre class="language-tsx" data-language="tsx"><code class="language-tsx"><span class="token keyword">let</span> character<span class="token operator">:</span><span class="token punctuation">&#123;</span>name<span class="token operator">:</span><span class="token builtin">string</span><span class="token punctuation">;</span>age<span class="token operator">:</span><span class="token builtin">number</span><span class="token punctuation">&#125;</span>
character<span class="token operator">=</span><span class="token punctuation">&#123;</span>
    name<span class="token operator">:</span><span class="token string">'钢铁侠'</span><span class="token punctuation">,</span>
    age<span class="token operator">:</span><span class="token number">18</span>
<span class="token punctuation">&#125;</span></code></pre>

<p>属性必须在类型 <code>&#123;name:string;age:number&#125;</code>中</p>
<h2 id="5-断言-type-inference"><a href="#5-断言-type-inference" class="headerlink" title="5.断言 type inference"></a>5.断言 type inference</h2><blockquote>
<p>当在上面联合类型的变量传入的时候，我们声明了这个类型为 <code>number | string</code> 它不能不能调用 <code>length</code> 方法</p>
<p>机器没法判断这个类型，但是我们比机器更了解这个类型，我们人为可以指定类型 <code>string</code> 这里我们就可以用到 <strong>类型断言</strong></p>
</blockquote>
<p><strong>1.我们就用 <code>as</code> 来进行断言</strong></p>
<pre class="language-tsx" data-language="tsx"><code class="language-tsx"><span class="token keyword">function</span> <span class="token function">getLength</span><span class="token punctuation">(</span>params<span class="token operator">:</span><span class="token builtin">number</span> <span class="token operator">|</span> <span class="token builtin">string</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token builtin">number</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">const</span> str <span class="token operator">=</span> params <span class="token keyword">as</span> <span class="token builtin">string</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>str<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> str<span class="token punctuation">.</span>length
    <span class="token punctuation">&#125;</span>
    <span class="token keyword">return</span> str<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>length
<span class="token punctuation">&#125;</span></code></pre>

<p><strong>2.还有一种写法 <code>&lt;类型&gt;</code> 两者的功能都是一样的</strong></p>
<pre class="language-tsx" data-language="tsx"><code class="language-tsx"><span class="token keyword">function</span> <span class="token function">getLength</span><span class="token punctuation">(</span>params<span class="token operator">:</span><span class="token builtin">number</span> <span class="token operator">|</span> <span class="token builtin">string</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token builtin">number</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">const</span> str <span class="token operator">=</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>string</span><span class="token punctuation">></span></span><span class="token plain-text">params
    if(str.length)</span><span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> str<span class="token punctuation">.</span>length
    <span class="token punctuation">&#125;</span><span class="token plain-text">
    return str.toString().length
&#125;</span></code></pre>

<h2 id="6-类型守卫-type-guard"><a href="#6-类型守卫-type-guard" class="headerlink" title="6.类型守卫 type guard"></a>6.类型守卫 type guard</h2><blockquote>
<p>遇到联合类型的时候，使用类型守卫可以 缩小范围</p>
</blockquote>
<p>实现以下和上面一样的方法</p>
<pre class="language-tsx" data-language="tsx"><code class="language-tsx"><span class="token keyword">function</span> <span class="token function">getLength</span><span class="token punctuation">(</span>params<span class="token operator">:</span><span class="token builtin">number</span> <span class="token operator">|</span> <span class="token builtin">string</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token builtin">number</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">typeof</span> params <span class="token operator">===</span> <span class="token string">'string'</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> params<span class="token punctuation">.</span>length
    <span class="token punctuation">&#125;</span>
    <span class="token keyword">return</span> params<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>length
<span class="token punctuation">&#125;</span></code></pre>

<p>类型守卫除了typeof之外，还有instanceof、in</p>
<h2 id="7-类-class"><a href="#7-类-class" class="headerlink" title="7.类 class"></a>7.类 class</h2><p>在 <code>ES6</code> 中就有 类的概念了，在 <code>TS</code> 中对类添加一些功能，这里只说下几个常用的</p>
<blockquote>
<p>先写个基础的 类</p>
</blockquote>
<pre class="language-tsx" data-language="tsx"><code class="language-tsx"><span class="token keyword">class</span> <span class="token class-name">Parent</span> <span class="token punctuation">&#123;</span>
    <span class="token function">constructor</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name
    <span class="token punctuation">&#125;</span>
    <span class="token function">eat</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
        <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span><span class="token keyword">this</span><span class="token punctuation">.</span>name<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string">在吃饭</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>
<span class="token keyword">let</span> zs <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Parent</span><span class="token punctuation">(</span><span class="token string">'小强'</span><span class="token punctuation">)</span>
zs<span class="token punctuation">.</span><span class="token function">eat</span><span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre>

<blockquote>
<p>我们先来说下 3个访问修饰符</p>
</blockquote>
<p><code>Public</code>:修饰的属性或方法是共有的 在 <strong>任何地方</strong> 都能访问</p>
<p><code>Private</code>:修饰的属性或方法是私有的 只有 <strong>本类</strong> 中访问</p>
<p><code>Protected</code>:修饰的属性或方法是受保护的 在 <strong>本类</strong> 和 <strong>子类中</strong> 能够访问</p>
<p>比如指定父类中 <code>money</code> 访问权限为 <code>private</code> ,只能在 <code>Parent</code> 访问，子类访问会出错</p>
<pre class="language-tsx" data-language="tsx"><code class="language-tsx"><span class="token keyword">class</span> <span class="token class-name">Parent</span><span class="token punctuation">&#123;</span>
    <span class="token keyword">public</span> name<span class="token operator">:</span><span class="token builtin">string</span>
    <span class="token keyword">private</span> money<span class="token operator">:</span><span class="token builtin">number</span>
    <span class="token function">constructor</span><span class="token punctuation">(</span>name<span class="token operator">:</span><span class="token builtin">string</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name
    <span class="token punctuation">&#125;</span>
<span class="token function">eat</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span><span class="token keyword">this</span><span class="token punctuation">.</span>name<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string">在吃饭</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">class</span> <span class="token class-name">Son</span> <span class="token keyword">extends</span> <span class="token class-name">Parent</span><span class="token punctuation">&#123;</span>
    <span class="token keyword">private</span> son_money：<span class="token builtin">number</span>
    <span class="token function">constructor</span><span class="token punctuation">(</span>name<span class="token operator">:</span><span class="token builtin">string</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
        <span class="token keyword">super</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>son_money <span class="token operator">=</span> <span class="token keyword">super</span><span class="token punctuation">.</span>money  <span class="token operator">&lt;</span><span class="token operator">-</span>  <span class="token comment">//money 为私有属性，只能在类 Parent中访问</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span></code></pre>

<p>我们可以设置访问权限为 <code>protected</code> ，这样子类就能访问</p>
<pre class="language-tsx" data-language="tsx"><code class="language-tsx"><span class="token keyword">class</span> <span class="token class-name">Parent</span><span class="token punctuation">&#123;</span>
    <span class="token keyword">public</span> name<span class="token operator">:</span><span class="token builtin">string</span>
    <span class="token keyword">protected</span> money<span class="token operator">:</span><span class="token builtin">number</span>
    <span class="token function">constructor</span><span class="token punctuation">(</span>name<span class="token operator">:</span><span class="token builtin">string</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name
    <span class="token punctuation">&#125;</span>
<span class="token function">eat</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span><span class="token keyword">this</span><span class="token punctuation">.</span>name<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string">在吃饭</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">class</span> <span class="token class-name">Son</span> <span class="token keyword">extends</span> <span class="token class-name">Parent</span><span class="token punctuation">&#123;</span>
    <span class="token keyword">private</span> son_money：<span class="token builtin">number</span>
    <span class="token function">constructor</span><span class="token punctuation">(</span>name<span class="token operator">:</span><span class="token builtin">string</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
        <span class="token keyword">super</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>son_money <span class="token operator">=</span> <span class="token keyword">super</span><span class="token punctuation">.</span>money 
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span></code></pre>

<blockquote>
<p>静态属性 static</p>
</blockquote>
<p>上面的 <code>name</code> <code>money</code> 这两个属性都是通过 实例 去访问的</p>
<p>使用 <code>static</code> 修饰的属性是通过 类 去访问，是每个实例共有的</p>
<p>同样 <code>static</code> 可以修饰 方法，用 <code>static</code> 修饰的方法称为 类方法，可以使用类直接调用</p>
<pre class="language-tsx" data-language="tsx"><code class="language-tsx"><span class="token keyword">class</span> <span class="token class-name">Parent</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">static</span> species<span class="token operator">:</span><span class="token builtin">string</span><span class="token operator">=</span><span class="token string">'man'</span>
    <span class="token keyword">public</span> name<span class="token operator">:</span><span class="token builtin">string</span>
    <span class="token keyword">private</span> money<span class="token operator">:</span><span class="token builtin">number</span>
    <span class="token function">constructor</span><span class="token punctuation">(</span>name<span class="token operator">:</span><span class="token builtin">string</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name
    <span class="token punctuation">&#125;</span>
    <span class="token function">eat</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
        <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span><span class="token keyword">this</span><span class="token punctuation">.</span>name<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string">在吃饭</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>
<span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>Parent<span class="token punctuation">.</span>species<span class="token punctuation">)</span></code></pre>

<blockquote>
<p>只读 readonly</p>
</blockquote>
<p>我们给属性添加上 <code>readonly</code> 就能保证该属性<strong>只读</strong>，<strong>不能修改</strong>，如果存在 <code>static</code> 修饰符，写在其后</p>
<pre class="language-tsx" data-language="tsx"><code class="language-tsx"><span class="token keyword">class</span> <span class="token class-name">Parent</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">static</span> <span class="token keyword">readonly</span> species<span class="token operator">:</span><span class="token builtin">string</span><span class="token operator">=</span><span class="token string">'man'</span>
    pubilc name<span class="token operator">:</span><span class="token builtin">string</span>
    <span class="token keyword">private</span> money<span class="token operator">:</span><span class="token builtin">number</span>
    <span class="token function">constructor</span><span class="token punctuation">(</span>name<span class="token operator">:</span><span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name
    <span class="token punctuation">&#125;</span>
<span class="token function">eat</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span><span class="token keyword">this</span><span class="token punctuation">.</span>name<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string">在吃饭</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>
Parent<span class="token punctuation">.</span>species <span class="token operator">=</span> <span class="token string">'男人'</span>  <span class="token operator">&lt;</span><span class="token operator">-</span>  <span class="token comment">//无法分配到 soecies  因为它是只读属性</span></code></pre>

<blockquote>
<p>抽象类 <code>abstract</code></p>
</blockquote>
<p><code>TS</code> 新增的抽象类，还是简单说下概念吧，我们写一个类的时候，不希望直接使用该类创建实例<strong>（不能被new）</strong>那么我们把它设置为抽象类，让它不能被实例化</p>
<p>只能被继承</p>
<p>在 <code>class</code> 前面 添加 <code>abstract</code> 修饰符，</p>
<p>在抽象类中 可以写 <strong>抽象方法</strong> ，抽象类没有方法体</p>
<p>举个例子：一个动物的抽象类，有个叫的方法，不可能 每个动物的叫声一样吧，我们可以把它设置为抽象方法，具体功能子类进行实现（该怎么叫就由子类来写）</p>
<pre class="language-tsx" data-language="tsx"><code class="language-tsx"><span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name">Animal</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">public</span> name<span class="token operator">:</span><span class="token builtin">string</span>
    <span class="token function">constructor</span><span class="token punctuation">(</span>name<span class="token operator">:</span><span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name
    <span class="token punctuation">&#125;</span>
    <span class="token keyword">abstract</span> <span class="token function">brking</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token keyword">void</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">class</span> <span class="token class-name">Cat</span> <span class="token keyword">extends</span> <span class="token class-name">Animal</span> <span class="token punctuation">&#123;</span>
    <span class="token function">constructor</span><span class="token punctuation">(</span>name<span class="token operator">:</span><span class="token builtin">string</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
        <span class="token keyword">super</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span>
    <span class="token function">barking</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
        <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'喵喵！'</span><span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span></code></pre>

<p>属性的封装和 java 一样</p>
<h2 id="8-接口-interface"><a href="#8-接口-interface" class="headerlink" title="8.接口 interface"></a>8.接口 interface</h2><blockquote>
<p>为什么会出现接口</p>
</blockquote>
<p>为了解决继承的困境（一个类只能继承另一个类不能实现多的继承）</p>
<p>还有一种情况，人能够洗衣服，洗衣机也能洗衣服，洗衣机和人找不到一个共同的类，我们可以把洗衣机这个功能抽离出来写成接口，人和洗衣机去实现这个接口就行了</p>
<blockquote>
<p>我们可以用 implements 来实现接口</p>
</blockquote>
<pre class="language-tsx" data-language="tsx"><code class="language-tsx"><span class="token comment">// 衣服借口</span>
<span class="token keyword">interface</span> <span class="token class-name">clothes</span><span class="token punctuation">&#123;</span>
    <span class="token function">washClothes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token keyword">void</span>
<span class="token punctuation">&#125;</span>
<span class="token comment">// 人类</span>
<span class="token keyword">class</span> <span class="token class-name">Person</span> <span class="token keyword">implements</span> <span class="token class-name">Clothes</span><span class="token punctuation">&#123;</span>
    <span class="token function">washClothes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
        <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'人在洗衣服'</span><span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// 洗衣机类</span>
<span class="token keyword">class</span> <span class="token class-name">wMachine</span> <span class="token keyword">implements</span> <span class="token class-name">Clothes</span><span class="token punctuation">&#123;</span>
    <span class="token function">washClothes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
        <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'洗衣机洗衣服'</span><span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span></code></pre>

<blockquote>
<p>接口可以多实现</p>
</blockquote>
<pre class="language-tsx" data-language="tsx"><code class="language-tsx"><span class="token comment">// 衣服借口</span>
<span class="token keyword">interface</span> <span class="token class-name">Clothes</span><span class="token punctuation">&#123;</span>
    <span class="token function">washClothes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token keyword">void</span>
<span class="token punctuation">&#125;</span>
<span class="token comment">// 吃饭接口</span>
<span class="token keyword">interface</span> <span class="token class-name">Eat</span><span class="token punctuation">&#123;</span>
    <span class="token function">eatMeal</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token keyword">void</span>
<span class="token punctuation">&#125;</span>
<span class="token comment">// 人类</span>
    <span class="token keyword">class</span> <span class="token class-name">Person</span> <span class="token keyword">implements</span> <span class="token class-name">Clothes</span><span class="token punctuation">,</span>Eat<span class="token punctuation">&#123;</span>
        <span class="token function">washClothes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
            <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'人在洗衣服'</span><span class="token punctuation">)</span>
        <span class="token punctuation">&#125;</span>
        <span class="token function">eatMeal</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
            <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'人在吃饭'</span><span class="token punctuation">)</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span></code></pre>

<blockquote>
<p>接口之前可以继承</p>
</blockquote>
<p>下面这个例子接口继承了另一个接口，这样人类只需实现一个接口就行</p>
<pre class="language-tsx" data-language="tsx"><code class="language-tsx"><span class="token keyword">interface</span> <span class="token class-name">Clothes</span> <span class="token punctuation">&#123;</span>
    <span class="token function">washClothes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token keyword">void</span>
<span class="token punctuation">&#125;</span>
<span class="token comment">// 吃接口</span>
<span class="token keyword">interface</span> <span class="token class-name">Eat</span> <span class="token keyword">extends</span> <span class="token class-name">Clothes</span><span class="token punctuation">&#123;</span>
    <span class="token function">eatMeal</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token keyword">void</span>
<span class="token punctuation">&#125;</span>
<span class="token comment">// 人类</span>
    <span class="token keyword">class</span> <span class="token class-name">Person</span> <span class="token keyword">implements</span> <span class="token class-name">Eat</span><span class="token punctuation">&#123;</span>
        <span class="token function">washClothes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
            <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'人在洗衣服'</span><span class="token punctuation">)</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token function">eatMeal</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
        <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'人在吃饭'</span><span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span></code></pre>

<h2 id="9-枚举-enum"><a href="#9-枚举-enum" class="headerlink" title="9.枚举 enum"></a>9.枚举 enum</h2><blockquote>
<p>常量是在项目中经常使用，虽然 const 可以声明常量，但是有的常量取值是在一个范围里的，这里我们就需要使用 enum 来进行处理</p>
</blockquote>
<p><strong>1.数字枚举</strong></p>
<pre class="language-tsx" data-language="tsx"><code class="language-tsx"><span class="token comment">// 枚举星期</span>
<span class="token keyword">enum</span> Week <span class="token punctuation">&#123;</span>
    Monday<span class="token punctuation">,</span>
    Tuesday<span class="token punctuation">,</span>
    Wednesday<span class="token punctuation">,</span>
    Thursday<span class="token punctuation">,</span>
    Friday<span class="token punctuation">,</span>
    Saturday<span class="token punctuation">,</span>
    Sunday
<span class="token punctuation">&#125;</span>

<span class="token comment">// 默认从 0 开始</span>
<span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>Week<span class="token punctuation">.</span>Monday<span class="token punctuation">)</span>  <span class="token comment">// 0</span>
<span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>Week<span class="token punctuation">.</span>Tuesday<span class="token punctuation">)</span>  <span class="token comment">// 1</span>
<span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>Week<span class="token punctuation">.</span>Wednesday<span class="token punctuation">)</span>  <span class="token comment">// 2</span>

<span class="token comment">// 也可以通过下标获取</span>
<span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>Week<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>  <span class="token comment">// Monday</span>
<span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>Week<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>  <span class="token comment">// Tuesday</span>
<span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>Week<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span>  <span class="token comment">// Wednesday</span></code></pre>

<blockquote>
<p>可以修改枚举中的初始值</p>
</blockquote>
<pre class="language-tsx" data-language="tsx"><code class="language-tsx"><span class="token keyword">enum</span> Week <span class="token punctuation">&#123;</span>
Monday <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">,</span>
Tuesday<span class="token punctuation">,</span>
Wednesday<span class="token punctuation">,</span>
Thursday<span class="token punctuation">,</span>
Friday<span class="token punctuation">,</span>
Saturday<span class="token punctuation">,</span>
Sunday
<span class="token punctuation">&#125;</span>

<span class="token comment">// 修改之后依次增加</span>
<span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>Week<span class="token punctuation">.</span>Monday<span class="token punctuation">)</span>  <span class="token comment">// 3</span>
<span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>Week<span class="token punctuation">.</span>Tuesday<span class="token punctuation">)</span>  <span class="token comment">// 4</span>
<span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>Week<span class="token punctuation">.</span>Wednesday<span class="token punctuation">)</span>  <span class="token comment">// 5</span></code></pre>

<p><strong>2.字符串枚举</strong></p>
<pre class="language-tsx" data-language="tsx"><code class="language-tsx"><span class="token comment">// 枚举星期</span>
<span class="token keyword">enum</span> Week <span class="token punctuation">&#123;</span>
 Monday<span class="token operator">=</span><span class="token string">'Monday'</span><span class="token punctuation">,</span>
Tuesday<span class="token operator">=</span><span class="token string">'Tuesday'</span><span class="token punctuation">,</span>
Wednesday<span class="token operator">=</span><span class="token string">'Wednesday'</span><span class="token punctuation">,</span>
Thursday<span class="token operator">=</span><span class="token string">'Thursday'</span><span class="token punctuation">,</span>
Friday<span class="token operator">=</span><span class="token string">'Friday'</span><span class="token punctuation">,</span>
Saturday<span class="token operator">=</span><span class="token string">'Saturday'</span><span class="token punctuation">,</span>
Sunday<span class="token operator">=</span><span class="token string">'Sunday'</span>   
<span class="token punctuation">&#125;</span>

<span class="token comment">// 获得一个值后 对 week 枚举的值进行匹配</span>
<span class="token keyword">const</span> value <span class="token operator">=</span> <span class="token string">'Tuesday'</span>
<span class="token keyword">if</span><span class="token punctuation">(</span>vale <span class="token operator">===</span> Week<span class="token punctuation">.</span>Tuesday<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'匹配成功'</span><span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span><span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">'匹配失败'</span><span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span></code></pre>

<p>3.常量枚举</p>
<p>在 enum 前面添加一个 const 即可，它提高了性能</p>
<p>为什么这样说呢？我就把上面字符串枚举编译成 js 例子，和常量枚举编译对比一下</p>
<pre class="language-tsx" data-language="tsx"><code class="language-tsx"><span class="token comment">// 枚举星期 </span>
<span class="token keyword">var</span> <span class="token function">Week</span>
<span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span>Week<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
    Week<span class="token punctuation">[</span><span class="token string">"Monday"</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token string">"Monday"</span><span class="token punctuation">;</span>
    Week<span class="token punctuation">[</span><span class="token string">"Tuesday"</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token string">"Tuesday"</span><span class="token punctuation">;</span>
    Week<span class="token punctuation">[</span><span class="token string">"Wednesday"</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token string">"Wednesday"</span><span class="token punctuation">;</span>
    Week<span class="token punctuation">[</span><span class="token string">"Thursday"</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token string">"Thursday"</span><span class="token punctuation">;</span>
    Week<span class="token punctuation">[</span><span class="token string">"Friday"</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token string">"Friday"</span><span class="token punctuation">;</span>
    Week<span class="token punctuation">[</span><span class="token string">"Saturday"</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token string">"Saturday"</span><span class="token punctuation">;</span>
    Week<span class="token punctuation">[</span><span class="token string">"Sunday"</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token string">"Sunday"</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">(</span>Week <span class="token operator">||</span> <span class="token punctuation">(</span>Week <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment">// 获得一个值后 对 Week 枚举的值进行匹配</span>
<span class="token keyword">var</span> value <span class="token operator">=</span> <span class="token string">'Tuesday'</span>
<span class="token keyword">if</span><span class="token punctuation">(</span>value<span class="token operator">===</span>Week<span class="token punctuation">.</span>Tuesday<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>          <span class="token comment">// 字符串枚举</span>
    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'匹配成功'</span><span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span>
<span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">'匹配失败'</span><span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span></code></pre>

<pre class="language-tsx" data-language="tsx"><code class="language-tsx"><span class="token comment">// 获得一个值后 对 Week 枚举的值进行匹配</span>
<span class="token keyword">var</span> value <span class="token operator">=</span> <span class="token string">'Tuesday'</span>
<span class="token keyword">if</span><span class="token punctuation">(</span>value<span class="token operator">===</span><span class="token string">"Tuesday"</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>              <span class="token comment">// 常量枚举</span>
    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'匹配成功'</span><span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span>
<span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">'匹配失败'</span><span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span></code></pre>

<p>常量枚举直接找出Week.Tuesday 上面一截都没了</p>
<h2 id="10-泛型"><a href="#10-泛型" class="headerlink" title="10.泛型"></a>10.泛型</h2><blockquote>
<p>泛型就像一个占位符一个变量，在使用的时候我们可以将定义好的类型像参数一样传入，原封不动的输出</p>
</blockquote>
<p>比如这个例子我们就想返回一个值，在这里我写死是 number</p>
<pre class="language-tsx" data-language="tsx"><code class="language-tsx"><span class="token keyword">function</span> <span class="token function">getValue</span><span class="token punctuation">(</span>params<span class="token operator">:</span><span class="token builtin">number</span><span class="token punctuation">)</span> <span class="token operator">:</span><span class="token builtin">number</span><span class="token punctuation">&#123;</span>

<span class="token keyword">return</span> params

<span class="token punctuation">&#125;</span></code></pre>

<p>在实际中，未必就是number，我们就可以通过泛型来解决，定义好的类型传入进去，返回什么类型出来</p>
<blockquote>
<p>泛型简单介绍</p>
</blockquote>
<p>这里 T 是相当于一个占位符，在方法(变量，接口…等等)后面添加 <T></p>
<pre class="language-tsx" data-language="tsx"><code class="language-tsx"><span class="token keyword">function</span> <span class="token generic-function"><span class="token function">getValue</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">></span></span></span><span class="token punctuation">(</span>params<span class="token operator">:</span><span class="token constant">T</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token constant">T</span><span class="token punctuation">&#123;</span>
    <span class="token keyword">return</span> params
<span class="token punctuation">&#125;</span></code></pre>

<p>是不是看起来这么简单，其实还真是</p>
<p>然后我在使用 getValue这个方法的时候 只需要在实参规定好类型，编译器它也不笨，能够知道我们的参数类型，并将它们赋值给 T</p>
<pre class="language-tsx" data-language="tsx"><code class="language-tsx"><span class="token keyword">function</span> <span class="token generic-function"><span class="token function">getValue</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token number">123</span><span class="token operator">></span></span></span><span class="token punctuation">(</span>params<span class="token operator">:</span><span class="token number">123</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token number">123</span>
<span class="token function">getValue</span><span class="token punctuation">(</span><span class="token number">123</span><span class="token punctuation">)</span></code></pre>

<blockquote>
<p>多个参数</p>
</blockquote>
<pre class="language-tsx" data-language="tsx"><code class="language-tsx"><span class="token keyword">function</span> <span class="token generic-function"><span class="token function">getVale</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token constant">T</span><span class="token punctuation">,</span><span class="token constant">U</span><span class="token operator">></span></span></span><span class="token punctuation">(</span>params<span class="token operator">:</span><span class="token punctuation">[</span><span class="token constant">T</span><span class="token punctuation">,</span><span class="token constant">U</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token constant">T</span><span class="token punctuation">,</span><span class="token constant">U</span><span class="token punctuation">]</span><span class="token punctuation">&#123;</span>
    <span class="token keyword">return</span> params
<span class="token punctuation">&#125;</span></code></pre>

<p>在使用的时候，聪明的就判断出传入的类型，并修改了 T,U,非常滴方便</p>
<pre class="language-tsx" data-language="tsx"><code class="language-tsx"><span class="token keyword">function</span> <span class="token generic-function"><span class="token function">getValue</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token builtin">number</span><span class="token punctuation">,</span><span class="token builtin">string</span><span class="token operator">></span></span></span><span class="token punctuation">(</span>params<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token builtin">number</span><span class="token punctuation">,</span><span class="token builtin">string</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token builtin">number</span><span class="token punctuation">,</span><span class="token builtin">string</span><span class="token punctuation">]</span>
<span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">123</span><span class="token punctuation">,</span><span class="token string">'123'</span><span class="token punctuation">]</span><span class="token punctuation">)</span></code></pre>

<blockquote>
<p>我们可以使用 interface 来约束泛型</p>
</blockquote>
<p>在 T 后面 extends Ilen，定义 Ilen 里面代码表示，T必须要有length属性</p>
<p>这样在 方法里面调用 params.length就不会报错</p>
<pre class="language-tsx" data-language="tsx"><code class="language-tsx"><span class="token keyword">interface</span> <span class="token class-name">Ilen</span> <span class="token punctuation">&#123;</span>
    length<span class="token operator">:</span><span class="token builtin">number</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">function</span> <span class="token generic-function"><span class="token function">getLenght</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token constant">T</span> <span class="token keyword">extends</span> Ilen<span class="token operator">></span></span></span><span class="token punctuation">(</span>params<span class="token operator">:</span><span class="token constant">T</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token builtin">number</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">return</span> params<span class="token punctuation">.</span>length
<span class="token punctuation">&#125;</span>
<span class="token function">getLenght</span><span class="token punctuation">(</span><span class="token string">'str'</span><span class="token punctuation">)</span>
<span class="token function">getLenght</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

<span class="token function">getLenght</span><span class="token punctuation">(</span><span class="token number">123</span><span class="token punctuation">)</span></code></pre>

<blockquote>
<p>在 类使用泛型</p>
</blockquote>
<pre class="language-tsx" data-language="tsx"><code class="language-tsx"><span class="token keyword">class</span> <span class="token class-name">Kitchen<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">></span></span><span class="token punctuation">&#123;</span>
    <span class="token function">makeCake</span><span class="token punctuation">(</span>name<span class="token operator">:</span> <span class="token constant">T</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
        <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'厨房制作了'</span><span class="token operator">+</span>name<span class="token operator">+</span><span class="token string">'蛋糕'</span><span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">let</span> kit <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Kitchen<span class="token operator">&lt;</span><span class="token builtin">string</span><span class="token operator">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
kit<span class="token punctuation">.</span><span class="token function">makeCake</span><span class="token punctuation">(</span><span class="token string">'草莓'</span><span class="token punctuation">)</span>   √

Kit<span class="token punctuation">.</span><span class="token function">makeCake</span><span class="token punctuation">(</span><span class="token number">12345</span><span class="token punctuation">)</span>   ×</code></pre>

<blockquote>
<p>在 接口 使用泛型</p>
</blockquote>
<pre class="language-tsx" data-language="tsx"><code class="language-tsx"><span class="token keyword">interface</span> <span class="token class-name">keyValue<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token punctuation">,</span><span class="token constant">U</span><span class="token operator">></span></span><span class="token punctuation">&#123;</span>
    key<span class="token operator">:</span><span class="token constant">T</span>
    value<span class="token operator">:</span><span class="token constant">U</span>
<span class="token punctuation">&#125;</span>
<span class="token keyword">let</span> test<span class="token operator">:</span>keyValue<span class="token operator">&lt;</span><span class="token builtin">string</span><span class="token punctuation">,</span><span class="token builtin">number</span><span class="token operator">></span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span>key<span class="token operator">:</span><span class="token string">'test'</span><span class="token punctuation">,</span>value<span class="token operator">:</span><span class="token number">12345</span><span class="token punctuation">&#125;</span>
<span class="token keyword">let</span> test2<span class="token operator">:</span>keyValue<span class="token operator">&lt;</span><span class="token builtin">number</span><span class="token punctuation">,</span><span class="token builtin">string</span><span class="token operator">></span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span>key<span class="token operator">:</span><span class="token number">12345</span><span class="token punctuation">,</span>value<span class="token operator">:</span><span class="token string">'hello'</span><span class="token punctuation">&#125;</span></code></pre>

<blockquote>
<p>在 数组 使用泛型</p>
</blockquote>
<pre class="language-tsx" data-language="tsx"><code class="language-tsx"><span class="token comment">// 一开始我们都这样定义类型</span>
<span class="token keyword">let</span> myarr<span class="token operator">:</span><span class="token builtin">number</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">]</span>

<span class="token comment">// 使用泛型</span>
<span class="token keyword">let</span> myarr1<span class="token operator">:</span><span class="token builtin">Array</span><span class="token operator">&lt;</span><span class="token builtin">number</span><span class="token operator">>=</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">]</span>
<span class="token keyword">let</span> myarr2<span class="token operator">:</span><span class="token builtin">Array</span><span class="token operator">&lt;</span><span class="token builtin">string</span><span class="token operator">>=</span><span class="token punctuation">[</span><span class="token string">'1'</span><span class="token punctuation">,</span><span class="token string">'2'</span><span class="token punctuation">,</span><span class="token string">'3'</span><span class="token punctuation">,</span><span class="token string">'4'</span><span class="token punctuation">,</span><span class="token string">'5'</span><span class="token punctuation">]</span></code></pre>

<p>其实泛型还有很多很多使用方法，我写的是简单的入门级的一些</p>
<h2 id="11-类型别名"><a href="#11-类型别名" class="headerlink" title="11.类型别名"></a>11.类型别名</h2><blockquote>
<p>使用 type 给类型取别名</p>
</blockquote>
<pre class="language-tsx" data-language="tsx"><code class="language-tsx"><span class="token keyword">type</span> <span class="token class-name">test</span> <span class="token operator">=</span> <span class="token builtin">number</span>
<span class="token keyword">let</span> count_number<span class="token operator">:</span> test <span class="token operator">=</span> <span class="token number">1234</span>

<span class="token keyword">type</span> <span class="token class-name">test2</span> <span class="token operator">=</span> <span class="token builtin">number</span> <span class="token operator">|</span> <span class="token builtin">string</span>
<span class="token keyword">let</span> str<span class="token operator">:</span>test2 <span class="token operator">=</span> <span class="token string">'1234'</span>
<span class="token keyword">let</span> str2<span class="token operator">:</span>test2<span class="token operator">=</span><span class="token number">4321</span></code></pre>

<h2 id="12-交叉类型"><a href="#12-交叉类型" class="headerlink" title="12.交叉类型"></a>12.交叉类型</h2><blockquote>
<p>用 &amp; 进行连接</p>
</blockquote>
<p>把类型都组合起来，变量赋值必须满足交叉类型</p>
<pre class="language-tsx" data-language="tsx"><code class="language-tsx"><span class="token keyword">interface</span> <span class="token class-name">Itest</span><span class="token punctuation">&#123;</span>
    key<span class="token operator">:</span>stirng
<span class="token punctuation">&#125;</span>
<span class="token keyword">type</span> <span class="token class-name">test4</span> <span class="token operator">=</span> Itest <span class="token operator">&amp;</span> <span class="token punctuation">&#123;</span>value<span class="token operator">:</span>stirng<span class="token punctuation">&#125;</span>
<span class="token keyword">let</span> myrtest<span class="token operator">:</span>test4 <span class="token operator">=</span> <span class="token punctuation">&#123;</span>key<span class="token operator">:</span><span class="token string">'食之无味'</span><span class="token punctuation">,</span>value<span class="token operator">:</span><span class="token string">'弃之可惜'</span><span class="token punctuation">&#125;</span></code></pre>

<h3 id="小结："><a href="#小结：" class="headerlink" title="小结："></a>小结：</h3><p>js向后端语言靠近，证明了前端的不断强大，当然要学的还有很多很多，继续加油吧！</p>
]]></content>
      <categories>
        <category>TypeScript</category>
      </categories>
      <tags>
        <tag>语法</tag>
      </tags>
  </entry>
  <entry>
    <title>同步和异步的成长之路</title>
    <url>/2020/07/13/459.html</url>
    <content><![CDATA[<h1 id="同步和异步的成长之路"><a href="#同步和异步的成长之路" class="headerlink" title="同步和异步的成长之路"></a>同步和异步的成长之路</h1><p>今天来一起学习学习，同步和异步的成长之路，看看我们平时经常用到的同步异步是怎么在工作，运行的</p>
<p>那首先我们得知道的是</p>
<h2 id="1-什么是同步？"><a href="#1-什么是同步？" class="headerlink" title="1.什么是同步？"></a>1.什么是同步？</h2><p>所谓同步，就是在发出一个”调用”时，在没有得到结果之前，该“调用”就不返回。但是一旦调用返回，就得到返回值了。换句话说，就是由“调用者”主动等待这个“调用”的结果。此调用执行完之前，阻塞之后的代码执行。</p>
<h2 id="2-什么是异步？"><a href="#2-什么是异步？" class="headerlink" title="2.什么是异步？"></a>2.什么是异步？</h2><p>“调用”在发出之后，这个调用就直接返回了，所以没有返回结果。换句话说，当一个异步过程调用发出后，调用者不会立刻得到结果。而是在”调用”发出后，”被调用者”通过状态、通知来通知调用者，或通过回调函数处理这个调用。异步调用发出后，不影响后面代码的执行。</p>
<h2 id="3-JavaScript-中为什么需要异步？"><a href="#3-JavaScript-中为什么需要异步？" class="headerlink" title="3.JavaScript 中为什么需要异步？"></a>3.JavaScript 中为什么需要异步？</h2><p>首先我们知道JavaScript是单线程的(即使新增了webworker，但是本质上JS还是单线程)。同步代码意味着什么呢？意味着有可能会阻塞，当我们有一个任务需要时间较长时，如果使用同步方式，那么就会阻塞之后的代码执行。而异步则不会，我们不会等待异步代码的之后，继续执行异步任务之后的代码。</p>
<p>概念了解完了，我们就要进入今天的正题了。首先大家思考一下：平时在工作中，主要使用了哪些异步解决方案，这些异步方案有什么优缺点？</p>
<p>异步最早的解决方案是回调函数，如事件的回调，setInterval/setTimeout中的回调。但是回调函数有一个很常见的问题，就是回调地狱的问题(稍后会举例说明);</p>
<p>为了解决回调地狱的问题，社区提出了Promise解决方案，ES6将其写进了语言标准。Promise一定程度上解决了回调地狱的问题，但是Promise也存在一些问题，如错误不能被try catch，而且使用Promise的链式调用，其实并没有从根本上解决回调地狱的问题，只是换了一种写法。</p>
<p>ES6中引入 Generator 函数，Generator是一种异步编程解决方案，Generator 函数是协程在 ES6 的实现，最大特点就是可以交出函数的执行权，Generator 函数可以看出是异步任务的容器，需要暂停的地方，都用yield语句注明。但是 Generator 使用起来较为复杂。</p>
<p>ES7又提出了新的异步解决方案:async/await，async是 Generator 函数的语法糖，async/await 使得异步代码看起来像同步代码，异步编程发展的目标就是让异步逻辑的代码看起来像同步一样。</p>
<blockquote>
<p>回调函数 —&gt; Promise —&gt; Generator —&gt; async/await.</p>
</blockquote>
<h3 id="1-callback"><a href="#1-callback" class="headerlink" title="1.callback"></a>1.callback</h3><pre class="language-js" data-language="js"><code class="language-js"><span class="token comment">//node读取文件</span>
fs<span class="token punctuation">.</span><span class="token function">readFile</span><span class="token punctuation">(</span>xxx<span class="token punctuation">,</span> <span class="token string">'utf-8'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> data</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token comment">//code</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>

<p>回调函数的使用场景(包括但不限于):</p>
<ol>
<li>事件回调</li>
<li>Node API</li>
<li>setTimeout/setInterval中的回调函数</li>
<li>ajax 请求</li>
</ol>
<blockquote>
<p>回调函数的优点: 简单。</p>
</blockquote>
<blockquote>
<p>回调函数的缺点：</p>
</blockquote>
<p>异步回调嵌套会导致代码难以维护，并且不方便统一处理错误，不能 <code>try catch</code> 和 回调地狱(如先读取A文本内容，再根据A文本内容读取B再根据B的内容读取C…)。</p>
<pre class="language-js" data-language="js"><code class="language-js">fs<span class="token punctuation">.</span><span class="token function">readFile</span><span class="token punctuation">(</span><span class="token constant">A</span><span class="token punctuation">,</span> <span class="token string">'utf-8'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> data</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    fs<span class="token punctuation">.</span><span class="token function">readFile</span><span class="token punctuation">(</span><span class="token constant">B</span><span class="token punctuation">,</span> <span class="token string">'utf-8'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> data</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        fs<span class="token punctuation">.</span><span class="token function">readFile</span><span class="token punctuation">(</span><span class="token constant">C</span><span class="token punctuation">,</span> <span class="token string">'utf-8'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> data</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            fs<span class="token punctuation">.</span><span class="token function">readFile</span><span class="token punctuation">(</span><span class="token constant">D</span><span class="token punctuation">,</span> <span class="token string">'utf-8'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> data</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                <span class="token comment">//....</span>
            <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>

<h3 id="2-Promise"><a href="#2-Promise" class="headerlink" title="2.Promise"></a>2.Promise</h3><p>Promise 一定程度上解决了回调地狱的问题，Promise 最早由社区提出和实现，ES6 将其写进了语言标准，统一了用法，原生提供了Promise对象。</p>
<p>那么我们看看Promise是如何解决回调地狱问题的，仍然以上文的readFile 为例(先读取A文本内容，再根据A文本内容读取B再根据B的内容读取C)。</p>
<pre class="language-js" data-language="js"><code class="language-js"><span class="token keyword">function</span> <span class="token function">read</span><span class="token punctuation">(</span><span class="token parameter">url</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
        fs<span class="token punctuation">.</span><span class="token function">readFile</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span> <span class="token string">'utf8'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> data</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token function">reject</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">resolve</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span class="token function">read</span><span class="token punctuation">(</span><span class="token constant">A</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">data</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">return</span> <span class="token function">read</span><span class="token punctuation">(</span><span class="token constant">B</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">data</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">return</span> <span class="token function">read</span><span class="token punctuation">(</span><span class="token constant">C</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">data</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">return</span> <span class="token function">read</span><span class="token punctuation">(</span><span class="token constant">D</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token parameter">reason</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>reason<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>

<blockquote>
<p>Promise 的优点:</p>
</blockquote>
<ol>
<li>一旦状态改变，就不会再变，任何时候都可以得到这个结果</li>
<li>可以将异步操作以同步操作的流程表达出来，避免了层层嵌套的回调函数</li>
</ol>
<blockquote>
<p>缺点:</p>
</blockquote>
<ol>
<li>无法取消 Promise</li>
<li>当处于pending状态时，无法得知目前进展到哪一个阶段</li>
<li>错误不能被 <code>try catch</code></li>
</ol>
<p>假设有这样一个需求：读取A,B,C三个文件内容，都读取成功后，再输出最终的结果。在Promise之前，我们一般可以借助发布订阅模式去实现:</p>
<pre class="language-js" data-language="js"><code class="language-js"><span class="token keyword">let</span> pubsub <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
    <span class="token literal-property property">arry</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token function">emit</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>arry<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">fn</span> <span class="token operator">=></span> <span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
    <span class="token function">on</span><span class="token punctuation">(</span><span class="token parameter">fn</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>arry<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>fn<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">let</span> data <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
pubsub<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span>length <span class="token operator">===</span> <span class="token number">3</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
fs<span class="token punctuation">.</span><span class="token function">readFile</span><span class="token punctuation">(</span><span class="token constant">A</span><span class="token punctuation">,</span> <span class="token string">'utf-8'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> value</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    data<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
    pubsub<span class="token punctuation">.</span><span class="token function">emit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
fs<span class="token punctuation">.</span><span class="token function">readFile</span><span class="token punctuation">(</span><span class="token constant">B</span><span class="token punctuation">,</span> <span class="token string">'utf-8'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> value</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    data<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
    pubsub<span class="token punctuation">.</span><span class="token function">emit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
fs<span class="token punctuation">.</span><span class="token function">readFile</span><span class="token punctuation">(</span><span class="token constant">C</span><span class="token punctuation">,</span> <span class="token string">'utf-8'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> value</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    data<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
    pubsub<span class="token punctuation">.</span><span class="token function">emit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>

<p>Promise给我们提供了 <code>Promise.all</code> 的方法，对于这个需求，我们可以使用 <code>Promise.all</code> 来实现。</p>
<pre class="language-js" data-language="js"><code class="language-js"><span class="token comment">/**
 * 将 fs.readFile 包装成promise接口
 */</span>
<span class="token keyword">function</span> <span class="token function">read</span><span class="token punctuation">(</span><span class="token parameter">url</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
        fs<span class="token punctuation">.</span><span class="token function">readFile</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span> <span class="token string">'utf8'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> data</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token function">reject</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">resolve</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">/**
 * 使用 Promise
 * 
 * 通过 Promise.all 可以实现多个异步并行执行，同一时刻获取最终结果的问题
 */</span>
Promise<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
    <span class="token function">read</span><span class="token punctuation">(</span><span class="token constant">A</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function">read</span><span class="token punctuation">(</span><span class="token constant">B</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function">read</span><span class="token punctuation">(</span><span class="token constant">C</span><span class="token punctuation">)</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">data</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token parameter">err</span> <span class="token operator">=></span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>

<h3 id="3-Generator"><a href="#3-Generator" class="headerlink" title="3.Generator"></a>3.Generator</h3><p>Generator 函数是 ES6 提供的一种异步编程解决方案，整个 Generator 函数就是一个封装的异步任务，或者说是异步任务的容器。异步操作需要暂停的地方，都用 yield 语句注明。</p>
<p>Generator 函数一般配合 yield 或 Promise 使用。Generator函数返回的是迭代器。对生成器和迭代器不了解的同学，请自行补习下基础。下面我们看一下 Generator 的简单使用:</p>
<pre class="language-js" data-language="js"><code class="language-js"><span class="token keyword">function</span><span class="token operator">*</span> <span class="token function">gen</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">let</span> a <span class="token operator">=</span> <span class="token keyword">yield</span> <span class="token number">111</span><span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> b <span class="token operator">=</span> <span class="token keyword">yield</span> <span class="token number">222</span><span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> c <span class="token operator">=</span> <span class="token keyword">yield</span> <span class="token number">333</span><span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> d <span class="token operator">=</span> <span class="token keyword">yield</span> <span class="token number">444</span><span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>d<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span class="token keyword">let</span> t <span class="token operator">=</span> <span class="token function">gen</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//next方法可以带一个参数，该参数就会被当作上一个yield表达式的返回值</span>
t<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//第一次调用next函数时，传递的参数无效</span>
t<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//a输出2;</span>
t<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//b输出3; </span>
t<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//c输出4;</span>
t<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//d输出5;</span></code></pre>

<p>仍然以上文的 readFile (先读取A文本内容，再根据A文本内容读取B再根据B的内容读取C)为例，使用 Generator + co库来实现:</p>
<pre class="language-js" data-language="js"><code class="language-js"><span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> co <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'co'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> bluebird <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'bluebird'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> readFile <span class="token operator">=</span> bluebird<span class="token punctuation">.</span><span class="token function">promisify</span><span class="token punctuation">(</span>fs<span class="token punctuation">.</span>readFile<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">function</span><span class="token operator">*</span> <span class="token function">read</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">yield</span> <span class="token function">readFile</span><span class="token punctuation">(</span><span class="token constant">A</span><span class="token punctuation">,</span> <span class="token string">'utf-8'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">yield</span> <span class="token function">readFile</span><span class="token punctuation">(</span><span class="token constant">B</span><span class="token punctuation">,</span> <span class="token string">'utf-8'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">yield</span> <span class="token function">readFile</span><span class="token punctuation">(</span><span class="token constant">C</span><span class="token punctuation">,</span> <span class="token string">'utf-8'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//....</span>
<span class="token punctuation">&#125;</span>
<span class="token function">co</span><span class="token punctuation">(</span><span class="token function">read</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">data</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    <span class="token comment">//code</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token parameter">err</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    <span class="token comment">//code</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>

<p>Generator的缺点大约不用我说了，除非是找虐，不然一般不会直接使用 Generator 来解决异步的(当然也不排除是因为我不熟练)~~~</p>
<h3 id="4-async-await"><a href="#4-async-await" class="headerlink" title="4.async/await"></a>4.async/await</h3><p>ES7中引入了 async/await 概念。async 其实是一个语法糖，它的实现就是将 Generator函数和自动执行器（co），包装在一个函数中。</p>
<p>async/await 的优点是代码清晰，不用像 Promise 写很多 then 链，就可以处理回调地狱的问题。并且错误可以被try catch。</p>
<p>仍然以上文的readFile (先读取A文本内容，再根据A文本内容读取B再根据B的内容读取C) 为例，使用 async/await 来实现:</p>
<pre class="language-js" data-language="js"><code class="language-js"><span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> bluebird <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'bluebird'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> readFile <span class="token operator">=</span> bluebird<span class="token punctuation">.</span><span class="token function">promisify</span><span class="token punctuation">(</span>fs<span class="token punctuation">.</span>readFile<span class="token punctuation">)</span><span class="token punctuation">;</span>


<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">read</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">await</span> <span class="token function">readFile</span><span class="token punctuation">(</span><span class="token constant">A</span><span class="token punctuation">,</span> <span class="token string">'utf-8'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">await</span> <span class="token function">readFile</span><span class="token punctuation">(</span><span class="token constant">B</span><span class="token punctuation">,</span> <span class="token string">'utf-8'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">await</span> <span class="token function">readFile</span><span class="token punctuation">(</span><span class="token constant">C</span><span class="token punctuation">,</span> <span class="token string">'utf-8'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//code</span>
<span class="token punctuation">&#125;</span>

<span class="token function">read</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    <span class="token comment">//code</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token parameter">err</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    <span class="token comment">//code</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>

<p>使用 async/await 实现此需求：读取A,B,C三个文件内容，都读取成功后，再输出最终的结果。</p>
<pre class="language-js" data-language="js"><code class="language-js"><span class="token keyword">function</span> <span class="token function">read</span><span class="token punctuation">(</span><span class="token parameter">url</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
        fs<span class="token punctuation">.</span><span class="token function">readFile</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span> <span class="token string">'utf8'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> data</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token function">reject</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">resolve</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">readAsync</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">let</span> data <span class="token operator">=</span> <span class="token keyword">await</span> Promise<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
        <span class="token function">read</span><span class="token punctuation">(</span><span class="token constant">A</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token function">read</span><span class="token punctuation">(</span><span class="token constant">B</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token function">read</span><span class="token punctuation">(</span><span class="token constant">C</span><span class="token punctuation">)</span>
    <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> data<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token function">readAsync</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">data</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>

<h3 id="小结："><a href="#小结：" class="headerlink" title="小结："></a>小结：</h3><p>所以JS的异步发展史，可以认为是从 callback -&gt; promise -&gt; generator -&gt; async/await。async/await 使得异步代码看起来像同步代码，异步编程发展的目标就是让异步逻辑的代码看起来像同步一样。</p>
]]></content>
      <categories>
        <category>JavaScript</category>
      </categories>
      <tags>
        <tag>同步</tag>
        <tag>异步</tag>
      </tags>
  </entry>
  <entry>
    <title>学习 Vue3 基础</title>
    <url>/2021/08/21/210821.html</url>
    <content><![CDATA[<h1 id="学习-Vue3-基础"><a href="#学习-Vue3-基础" class="headerlink" title="学习 Vue3 基础"></a>学习 Vue3 基础</h1><h2 id="Vue3-基本概述"><a href="#Vue3-基本概述" class="headerlink" title="Vue3 基本概述"></a>Vue3 基本概述</h2><h3 id="介绍"><a href="#介绍" class="headerlink" title="介绍"></a><strong>介绍</strong></h3><p><img src="https://s4.ax1x.com/2022/01/24/7TyMPs.png" width="200"></img></p>
<ul>
<li><p>2020 年 9 月 18 日，Vue 发布了 3.0 版本，代号：One Piece<a href="https://github.com/vuejs/vue-next/releases/tag/v3.0.0">（海贼王）</a>，周边生态原因，当时大多数开发者还处于观望状态。</p>
</li>
<li><p>现在主流组件库都已经发布了支持 Vue3.0 的版本，例如 <a href="https://element-plus.gitee.io/zh-CN/">Element Plus</a>、<a href="https://vant-contrib.gitee.io/vant/v3/#/zh-CN">Vant</a>、<a href="https://vueuse.org/">Vue Use</a>，其他生态也在不断地完善中，所以 Vue3 是趋势。</p>
</li>
<li><p>2022 年 2 月 7 日开始，<a href="https://zhuanlan.zhihu.com/p/460055155">Vue3 也将成为新的默认版本</a>。</p>
</li>
</ul>
<h3 id="优点"><a href="#优点" class="headerlink" title="优点"></a>优点</h3><ul>
<li><p>Composition API，能够更好的组织、封装、复用代码、RFCs。</p>
</li>
<li><p>性能：打包大小减少 41% 、初次渲染快 55% 、更新渲染快 133%、内存减少 54%，主要原因在于 Proxy，VNode，<a href="https://v3.cn.vuejs.org/guide/migration/global-api-treeshaking.html#_2-x-%E8%AF%AD%E6%B3%95">Tree Shaking support</a>。</p>
</li>
<li><p>Better TS support，<a href="https://github.com/vuejs/vue-next">源码</a>。</p>
</li>
<li><p>新特性：Fragment、Teleport、Suspense。</p>
</li>
<li><p>趋势：未来肯定会有越来越多的企业使用 Vue3.0 + TS 进行大型项目的开发。</p>
</li>
<li><p>对于个人来说：适应市场需求，学习流行的技术提升竞争力，加薪！</p>
</li>
</ul>
<h3 id="Vite-基本使用"><a href="#Vite-基本使用" class="headerlink" title="Vite 基本使用"></a>Vite 基本使用</h3><p><strong>Vite是什么？</strong></p>
<ul>
<li>它是下一代前端开发与构建工具，热更新、打包构建速度更快，但目前周边生态还不如 Webpack 成熟，所以实际开发中还是建议使用 Webpack。</li>
<li>但目前就学习 Vue3 语法来说，我们可以使用更轻量的 <a href="https://vitejs.cn/guide/#scaffolding-your-first-vite-project">Vite</a>，例如要构建一个 Vite + Vue 项目，如下。</li>
</ul>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token function">npm</span> init vite-app <span class="token operator">&lt;</span>project-name<span class="token operator">></span>
<span class="token builtin class-name">cd</span> <span class="token operator">&lt;</span>project-name<span class="token operator">></span>
<span class="token function">npm</span> <span class="token function">install</span>
<span class="token function">npm</span> run dev</code></pre>

<ul>
<li><p>Webpack：将所有的模块提前编译、打包进 bundle 中，不管这个模块是否被用到，随着项目越来越大，打包启动的速度自然越来越慢。</p>
</li>
<li><p>Vite：瞬间开启一个服务，并不会先编译所有文件，当浏览器用到某个文件时，Vite 服务会收到请求然后编译后相应到客户端。</p>
</li>
</ul>
<center style="overflow:hidden">
    <img src="https://s4.ax1x.com/2022/01/24/7T6xtH.png" style="float:left" width="48%"/>
    <img src="https://s4.ax1x.com/2022/01/24/7TcGEF.png" style="float:right" width="48%"/>
</center>



<h2 id="创建-Vue3-应用"><a href="#创建-Vue3-应用" class="headerlink" title="创建 Vue3 应用"></a>创建 Vue3 应用</h2><h3 id="步骤"><a href="#步骤" class="headerlink" title="步骤"></a>步骤</h3><p>1.在 <code>main.js</code> 中按需导入 <code>createApp</code> 函数</p>
<p>2.定义<code>App.vue</code> 根组件，导入到 <code>main.js</code>。</p>
<p>3.使用 <code>createApp</code> 函数基于 <code>App.vue</code> 根组件创建应用实例。</p>
<p>4.挂载至 <code>index.html</code> 的 #app 容器</p>
<p><code>main.js</code></p>
<pre class="language-js" data-language="js"><code class="language-js"><span class="token comment">// 1. 导入 createApp 函数，不再是曾经的 Vue 了</span>
<span class="token comment">// 2. 编写一个根组件 App.vue，导入进来</span>
<span class="token comment">// 3. 基于根组件创建应用实例，类似 Vue2 的 vm，但比 vm 更轻量</span>
<span class="token comment">// 4. 挂载到 index.html 的 #app 容器</span>
<span class="token keyword">import</span> <span class="token punctuation">&#123;</span> createApp <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'vue'</span>
<span class="token keyword">import</span> App <span class="token keyword">from</span> <span class="token string">'./App.vue'</span>
<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token function">createApp</span><span class="token punctuation">(</span>App<span class="token punctuation">)</span>
app<span class="token punctuation">.</span><span class="token function">mount</span><span class="token punctuation">(</span><span class="token string">'#app'</span><span class="token punctuation">)</span></code></pre>

<p><code>App.vue</code></p>
<pre class="language-js" data-language="js"><code class="language-js"><span class="token operator">&lt;</span>template<span class="token operator">></span>
    <span class="token operator">&lt;</span>div <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"container"</span><span class="token operator">></span>我是根组件<span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span>
<span class="token operator">&lt;</span><span class="token operator">/</span>template<span class="token operator">></span>
<span class="token operator">&lt;</span>script<span class="token operator">></span>
    <span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">&#123;</span>
        <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'App'</span>
    <span class="token punctuation">&#125;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">></span></code></pre>

<h2 id="选项-组合-API"><a href="#选项-组合-API" class="headerlink" title="选项/组合 API"></a>选项/组合 API</h2><h3 id="目标"><a href="#目标" class="headerlink" title="目标"></a>目标</h3><p>理解什么是 Options API 写法，什么是 Composition API 写法。</p>
<h3 id="需求"><a href="#需求" class="headerlink" title="需求"></a>需求</h3><img src="https://s4.ax1x.com/2022/01/24/7TRGE8.png">



<h3 id="Vue2-实现"><a href="#Vue2-实现" class="headerlink" title="Vue2 实现"></a>Vue2 实现</h3><ul>
<li>优点：易于学习和使用，写代码的位置已经约定好。</li>
<li>缺点：数据和业务逻辑分散在同一个文件的 N 个地方，随着业务复杂度的上升，可能会出现动图左侧的代码组织方式，不利于管理和维护。</li>
</ul>
<pre class="language-js" data-language="js"><code class="language-js"><span class="token operator">&lt;</span>template<span class="token operator">></span>
    <span class="token operator">&lt;</span>div <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"container"</span><span class="token operator">></span>
        <span class="token operator">&lt;</span>p<span class="token operator">></span><span class="token constant">X</span> 轴：<span class="token punctuation">&#123;</span><span class="token punctuation">&#123;</span> x <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span> <span class="token constant">Y</span> 轴：<span class="token punctuation">&#123;</span><span class="token punctuation">&#123;</span> y <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">></span>
        <span class="token operator">&lt;</span>hr <span class="token operator">/</span><span class="token operator">></span>
        <span class="token operator">&lt;</span>div<span class="token operator">></span>
            <span class="token operator">&lt;</span>p<span class="token operator">></span><span class="token punctuation">&#123;</span><span class="token punctuation">&#123;</span> count <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">></span>
            <span class="token operator">&lt;</span>button @click<span class="token operator">=</span><span class="token string">"add()"</span><span class="token operator">></span>自增<span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">></span>
        <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span>
<span class="token operator">&lt;</span><span class="token operator">/</span>template<span class="token operator">></span>
<span class="token operator">&lt;</span>script<span class="token operator">></span>
    <span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">&#123;</span>
        <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'App'</span><span class="token punctuation">,</span>
        <span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">return</span> <span class="token punctuation">&#123;</span>
                <span class="token comment">// !#Fn1</span>
                <span class="token literal-property property">x</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
                <span class="token literal-property property">y</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
                <span class="token comment">// ?#Fn2</span>
                <span class="token literal-property property">count</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
            <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
        <span class="token function">mounted</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token comment">// !#Fn1</span>
            document<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'mousemove'</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>move<span class="token punctuation">)</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
        <span class="token literal-property property">methods</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
            <span class="token comment">// !#Fn1</span>
            <span class="token function">move</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                <span class="token keyword">this</span><span class="token punctuation">.</span>x <span class="token operator">=</span> e<span class="token punctuation">.</span>pageX
                <span class="token keyword">this</span><span class="token punctuation">.</span>y <span class="token operator">=</span> e<span class="token punctuation">.</span>pageY
            <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
            <span class="token comment">// ?#Fn2</span>
            <span class="token function">add</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                <span class="token keyword">this</span><span class="token punctuation">.</span>count<span class="token operator">++</span>
            <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
        <span class="token function">destroyed</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token comment">// !#Fn1</span>
            document<span class="token punctuation">.</span><span class="token function">removeEventListener</span><span class="token punctuation">(</span><span class="token string">'mousemove'</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>move<span class="token punctuation">)</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
    <span class="token punctuation">&#125;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">></span></code></pre>

<h3 id="Vue3-实现"><a href="#Vue3-实现" class="headerlink" title="Vue3 实现"></a>Vue3 实现</h3><ul>
<li><p>优点：可以把同一功能的<strong>数据</strong>和<strong>业务逻辑</strong>组织到一起，方便复用和维护。</p>
</li>
<li><p>缺点：需要有良好的代码组织和拆分能力，相对没有 Vue2 容易上手。</p>
</li>
<li><p>注意：为了能较好的过渡到 Vue3.0 版本，目前也是支持 Vue2.x 选项 API 的写法。</p>
</li>
<li><p>链接：<a href="https://v3.vuejs.org/guide/composition-api-introduction.html#why-composition-api">why-composition-api</a>、<a href="https://v3.cn.vuejs.org/api/composition-api.html">composition-api-doc</a>。</p>
</li>
</ul>
<pre class="language-js" data-language="js"><code class="language-js"><span class="token operator">&lt;</span>template<span class="token operator">></span>
    <span class="token operator">&lt;</span>div <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"container"</span><span class="token operator">></span>
        <span class="token operator">&lt;</span>p<span class="token operator">></span><span class="token constant">X</span> 轴：<span class="token punctuation">&#123;</span><span class="token punctuation">&#123;</span> x <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span> <span class="token constant">Y</span> 轴：<span class="token punctuation">&#123;</span><span class="token punctuation">&#123;</span> y <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">></span>
        <span class="token operator">&lt;</span>hr <span class="token operator">/</span><span class="token operator">></span>
        <span class="token operator">&lt;</span>div<span class="token operator">></span>
            <span class="token operator">&lt;</span>p<span class="token operator">></span><span class="token punctuation">&#123;</span><span class="token punctuation">&#123;</span> count <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">></span>
            <span class="token operator">&lt;</span>button @click<span class="token operator">=</span><span class="token string">"add()"</span><span class="token operator">></span>自增<span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">></span>
        <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span>
<span class="token operator">&lt;</span><span class="token operator">/</span>template<span class="token operator">></span>
<span class="token operator">&lt;</span>script<span class="token operator">></span>
    <span class="token keyword">import</span> <span class="token punctuation">&#123;</span> onMounted<span class="token punctuation">,</span> onUnmounted<span class="token punctuation">,</span> reactive<span class="token punctuation">,</span> ref<span class="token punctuation">,</span> toRefs <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'vue'</span>
    <span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">&#123;</span>
        <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'App'</span><span class="token punctuation">,</span>
        <span class="token function">setup</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token comment">// !#Fn1</span>
            <span class="token keyword">const</span> mouse <span class="token operator">=</span> <span class="token function">reactive</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
                <span class="token literal-property property">x</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
                <span class="token literal-property property">y</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
            <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
            <span class="token keyword">const</span> <span class="token function-variable function">move</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
                mouse<span class="token punctuation">.</span>x <span class="token operator">=</span> e<span class="token punctuation">.</span>pageX
                mouse<span class="token punctuation">.</span>y <span class="token operator">=</span> e<span class="token punctuation">.</span>pageY
            <span class="token punctuation">&#125;</span>
            <span class="token function">onMounted</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
                document<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'mousemove'</span><span class="token punctuation">,</span> move<span class="token punctuation">)</span>
            <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
            <span class="token function">onUnmounted</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
                document<span class="token punctuation">.</span><span class="token function">removeEventListener</span><span class="token punctuation">(</span><span class="token string">'mousemove'</span><span class="token punctuation">,</span> move<span class="token punctuation">)</span>
            <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>

            <span class="token comment">// ?Fn2</span>
            <span class="token keyword">const</span> count <span class="token operator">=</span> <span class="token function">ref</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
            <span class="token keyword">const</span> <span class="token function-variable function">add</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
                count<span class="token punctuation">.</span>value<span class="token operator">++</span>
            <span class="token punctuation">&#125;</span>

            <span class="token comment">// 统一返回数据供模板使用</span>
            <span class="token keyword">return</span> <span class="token punctuation">&#123;</span>
                <span class="token operator">...</span><span class="token function">toRefs</span><span class="token punctuation">(</span>mouse<span class="token punctuation">)</span><span class="token punctuation">,</span>
                count<span class="token punctuation">,</span>
                add<span class="token punctuation">,</span>
            <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
    <span class="token punctuation">&#125;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">></span></code></pre>

<h2 id="setup-入口函数"><a href="#setup-入口函数" class="headerlink" title="setup 入口函数"></a>setup 入口函数</h2><h3 id="介绍-1"><a href="#介绍-1" class="headerlink" title="介绍"></a>介绍</h3><ul>
<li>是什么：<code>setup</code> 是 Vue3 中新增的组件配置项，作为组合 API 的入口函数。</li>
<li>执行时机：实例创建前调用，甚至早于 Vue2 中的 beforeCreate。</li>
<li>注意点：由于执行 setup 的时候实例还没有 created，所以在 setup 中是不能直接使用 data 和 methods 中的数据的，所以 Vue3 干脆把 setup 中的 this 绑定了 undefined，防止乱用！</li>
<li>虽然 Vue2 中的 data 和 methods 配置项虽然在 Vue3 中也能使用，但不建议了，建议数据和方法都写在 setup 函数中，并<strong>通过 return 进行返回可在模版中直接使用</strong>（一般情况下 setup 不能为异步函数）。</li>
</ul>
<h3 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h3><pre class="language-js" data-language="js"><code class="language-js"><span class="token operator">&lt;</span>template<span class="token operator">></span>
    <span class="token operator">&lt;</span>h1 @click<span class="token operator">=</span><span class="token string">"say()"</span><span class="token operator">></span><span class="token punctuation">&#123;</span><span class="token punctuation">&#123;</span> msg <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token operator">&lt;</span><span class="token operator">/</span>h1<span class="token operator">></span>
<span class="token operator">&lt;</span><span class="token operator">/</span>template<span class="token operator">></span>
<span class="token operator">&lt;</span>script<span class="token operator">></span>
    <span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">&#123;</span>
        <span class="token function">setup</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">const</span> msg <span class="token operator">=</span> <span class="token string">'Hello Vue3'</span>
            <span class="token keyword">const</span> <span class="token function-variable function">say</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
                console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span>
            <span class="token punctuation">&#125;</span>
            <span class="token keyword">return</span> <span class="token punctuation">&#123;</span> msg<span class="token punctuation">,</span> say <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
    <span class="token punctuation">&#125;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">></span></code></pre>

<h3 id="了解："><a href="#了解：" class="headerlink" title="了解："></a><strong>了解：</strong></h3><p>setup 也可以返回一个渲染函数（setup 中的 return 并非只能返回一个对象）。</p>
<pre class="language-js" data-language="js"><code class="language-js"><span class="token operator">&lt;</span>script<span class="token operator">></span>
    <span class="token keyword">import</span> <span class="token punctuation">&#123;</span> h <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'vue'</span>
    <span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">&#123;</span>
        <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'App'</span><span class="token punctuation">,</span>
        <span class="token function">setup</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">h</span><span class="token punctuation">(</span><span class="token string">'h2'</span><span class="token punctuation">,</span> <span class="token string">'Hello Vue3'</span><span class="token punctuation">)</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
    <span class="token punctuation">&#125;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">></span></code></pre>

<h2 id="reactive-包装函数"><a href="#reactive-包装函数" class="headerlink" title="reactive 包装函数"></a>reactive 包装函数</h2><h3 id="介绍-2"><a href="#介绍-2" class="headerlink" title="介绍"></a>介绍</h3><p><a href="https://v3.cn.vuejs.org/api/basic-reactivity.html#reactive">reactive</a> 是一个函数，用来将普通对象/数组包装成响应式式数据使用（基于 Proxy），无法直接处理基本数据类型！</p>
<h2 id="Vue3-生命周期"><a href="#Vue3-生命周期" class="headerlink" title="Vue3 生命周期"></a>Vue3 生命周期</h2><h3 id="介绍-3"><a href="#介绍-3" class="headerlink" title="介绍"></a>介绍</h3><ul>
<li><a href="https://v3.cn.vuejs.org/api/composition-api.html#%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F%E9%92%A9%E5%AD%90">组合 API</a>生命周期写法，其实 <a href="https://v3.cn.vuejs.org/api/options-lifecycle-hooks.html#beforecreate">选项 API</a> 的写法在 Vue3 中也是支持。</li>
<li>Vue3（组合 API）常用的生命周期钩子有 7 个，<strong>可以多次使用同一个钩子</strong>，执行顺序和书写顺序相同。</li>
<li>setup、onBeforeMount、onMounted、onBeforeUpdate、onUpdated、onBeforeUnmount、onUnmounted。</li>
</ul>
<h2 id="toRef"><a href="#toRef" class="headerlink" title="toRef"></a>toRef</h2><h3 id="介绍-4"><a href="#介绍-4" class="headerlink" title="介绍"></a>介绍</h3><p>toRef 函数的作用：转换<strong>响应式对象</strong>中某个属性为单独响应式数据，并且转换后的值和之前是关联的（ref 函数也可以转换，但值非关联，后面详讲 ref 函数）。</p>
<h2 id="toRefs"><a href="#toRefs" class="headerlink" title="toRefs"></a>toRefs</h2><h3 id="介绍-5"><a href="#介绍-5" class="headerlink" title="介绍"></a>介绍</h3><p>toRefs 函数的作用：转换<strong>响应式对象</strong>中所有属性为单独响应式数据，并且转换后的值和之前是关联的。</p>
<h2 id="ref-函数"><a href="#ref-函数" class="headerlink" title="ref 函数"></a>ref 函数</h2><h3 id="介绍-6"><a href="#介绍-6" class="headerlink" title="介绍"></a>介绍</h3><p>ref 函数，常用于把简单数据类型包裹为响应式数据，注意 JS 中操作值的时候，需要加 <code>.value</code> 属性，模板中正常使用即可。</p>
<ul>
<li>注意：ref 其实也可以包裹复杂数据类型为响应式数据，一般对于数据类型未确定的情况下推荐使用 ref。</li>
<li>当你明确知道需要包裹的是一个对象，那么推荐使用 reactive，其他情况使用 ref 即可。</li>
<li>ref 处理基本数据类型用的是 <code>Object.defineProperty</code> 进行数据劫持，处理复杂数据类型用的是 <code>Proxy</code>（内部借助了 reactive 函数）。</li>
</ul>
<h2 id="ref-属性"><a href="#ref-属性" class="headerlink" title="ref 属性"></a>ref 属性</h2><h3 id="场景"><a href="#场景" class="headerlink" title="场景"></a>场景</h3><p>获得单个 DOM 或者组件</p>
<pre class="language-js" data-language="js"><code class="language-js"><span class="token operator">&lt;</span>template<span class="token operator">></span>
    <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> #<span class="token number">3</span> <span class="token operator">--</span><span class="token operator">></span>
    <span class="token operator">&lt;</span>div ref<span class="token operator">=</span><span class="token string">"dom"</span><span class="token operator">></span>我是box<span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span>
<span class="token operator">&lt;</span><span class="token operator">/</span>template<span class="token operator">></span>
<span class="token operator">&lt;</span>script<span class="token operator">></span>
    <span class="token keyword">import</span> <span class="token punctuation">&#123;</span> onMounted<span class="token punctuation">,</span> ref <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'vue'</span>
    <span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">&#123;</span>
        <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'App'</span><span class="token punctuation">,</span>
        <span class="token function">setup</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token comment">// #1</span>
            <span class="token keyword">const</span> dom <span class="token operator">=</span> <span class="token function">ref</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span>
            <span class="token function">onMounted</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
                <span class="token comment">// #4</span>
                console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>dom<span class="token punctuation">.</span>value<span class="token punctuation">)</span>
            <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
            <span class="token comment">// #2</span>
            <span class="token keyword">return</span> <span class="token punctuation">&#123;</span> dom <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
    <span class="token punctuation">&#125;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">></span></code></pre>

<p>配合 v-for 循环可以获取一组 DOM 或者组件。</p>
<pre class="language-js" data-language="js"><code class="language-js"><span class="token operator">&lt;</span>template<span class="token operator">></span>
    <span class="token operator">&lt;</span>ul<span class="token operator">></span>
        <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> #<span class="token number">4</span> <span class="token operator">--</span><span class="token operator">></span>
        <span class="token operator">&lt;</span>li v<span class="token operator">-</span><span class="token keyword">for</span><span class="token operator">=</span><span class="token string">"i in 4"</span> <span class="token operator">:</span>key<span class="token operator">=</span><span class="token string">"i"</span> <span class="token operator">:</span>ref<span class="token operator">=</span><span class="token string">"setDom"</span><span class="token operator">></span>第 <span class="token punctuation">&#123;</span><span class="token punctuation">&#123;</span> i <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span> li<span class="token operator">&lt;</span><span class="token operator">/</span>li<span class="token operator">></span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>ul<span class="token operator">></span>
<span class="token operator">&lt;</span><span class="token operator">/</span>template<span class="token operator">></span>
<span class="token operator">&lt;</span>script<span class="token operator">></span>
    <span class="token keyword">import</span> <span class="token punctuation">&#123;</span> onMounted <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'vue'</span>
    <span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">&#123;</span>
        <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'App'</span><span class="token punctuation">,</span>
        <span class="token function">setup</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token comment">// #1</span>
            <span class="token keyword">const</span> domList <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
            <span class="token comment">// #2</span>
            <span class="token keyword">const</span> <span class="token function-variable function">setDom</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">el</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
                domList<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>el<span class="token punctuation">)</span>
            <span class="token punctuation">&#125;</span>
            <span class="token function">onMounted</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
                <span class="token comment">// #5</span>
                console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>domList<span class="token punctuation">)</span>
            <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
            <span class="token comment">// #3</span>
            <span class="token keyword">return</span> <span class="token punctuation">&#123;</span> setDom <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
    <span class="token punctuation">&#125;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">></span></code></pre>



<h2 id="computed"><a href="#computed" class="headerlink" title="computed"></a>computed</h2><h3 id="作用"><a href="#作用" class="headerlink" title="作用"></a>作用</h3><p>computed 函数用来定义计算属性</p>
<pre class="language-js" data-language="js"><code class="language-js"><span class="token operator">&lt;</span>template<span class="token operator">></span>
    <span class="token operator">&lt;</span>p<span class="token operator">></span>firstName<span class="token operator">:</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#123;</span> person<span class="token punctuation">.</span>firstName <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">></span>
    <span class="token operator">&lt;</span>p<span class="token operator">></span>lastName<span class="token operator">:</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#123;</span> person<span class="token punctuation">.</span>lastName <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">></span>
    <span class="token operator">&lt;</span>p<span class="token operator">></span>fullName<span class="token operator">:</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#123;</span> person<span class="token punctuation">.</span>fullName <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">></span>
<span class="token operator">&lt;</span><span class="token operator">/</span>template<span class="token operator">></span>
<span class="token operator">&lt;</span>script<span class="token operator">></span>
    <span class="token keyword">import</span> <span class="token punctuation">&#123;</span> computed<span class="token punctuation">,</span> reactive <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'vue'</span>
    <span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">&#123;</span>
        <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'App'</span><span class="token punctuation">,</span>
        <span class="token function">setup</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">const</span> person <span class="token operator">=</span> <span class="token function">reactive</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
                <span class="token literal-property property">firstName</span><span class="token operator">:</span> <span class="token string">'朱'</span><span class="token punctuation">,</span>
                <span class="token literal-property property">lastName</span><span class="token operator">:</span> <span class="token string">'逸之'</span><span class="token punctuation">,</span>
            <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
            person<span class="token punctuation">.</span>fullName <span class="token operator">=</span> <span class="token function">computed</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
                <span class="token keyword">return</span> person<span class="token punctuation">.</span>firstName <span class="token operator">+</span> <span class="token string">' '</span> <span class="token operator">+</span> person<span class="token punctuation">.</span>lastName
            <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
            <span class="token comment">// 也可以传入对象，目前和上面等价</span>
            <span class="token comment">/* person.fullName = computed(&#123;
                get() &#123;
                    return person.firstName + ' ' + person.lastName
                &#125;,
            &#125;) */</span>
            <span class="token keyword">return</span> <span class="token punctuation">&#123;</span>
                person<span class="token punctuation">,</span>
            <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
    <span class="token punctuation">&#125;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">></span></code></pre>

<h3 id="高级"><a href="#高级" class="headerlink" title="高级"></a>高级</h3><pre class="language-js" data-language="js"><code class="language-js"><span class="token operator">&lt;</span>template<span class="token operator">></span>
    <span class="token operator">&lt;</span>p<span class="token operator">></span>firstName<span class="token operator">:</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#123;</span> person<span class="token punctuation">.</span>firstName <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">></span>
    <span class="token operator">&lt;</span>p<span class="token operator">></span>lastName<span class="token operator">:</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#123;</span> person<span class="token punctuation">.</span>lastName <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">></span>
    <span class="token operator">&lt;</span>input type<span class="token operator">=</span><span class="token string">"text"</span> v<span class="token operator">-</span>model<span class="token operator">=</span><span class="token string">"person.fullName"</span> <span class="token operator">/</span><span class="token operator">></span>
<span class="token operator">&lt;</span><span class="token operator">/</span>template<span class="token operator">></span>
<span class="token operator">&lt;</span>script<span class="token operator">></span>
    <span class="token keyword">import</span> <span class="token punctuation">&#123;</span> computed<span class="token punctuation">,</span> reactive <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'vue'</span>
    <span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">&#123;</span>
        <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'App'</span><span class="token punctuation">,</span>
        <span class="token function">setup</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">const</span> person <span class="token operator">=</span> <span class="token function">reactive</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
                <span class="token literal-property property">firstName</span><span class="token operator">:</span> <span class="token string">'朱'</span><span class="token punctuation">,</span>
                <span class="token literal-property property">lastName</span><span class="token operator">:</span> <span class="token string">'逸之'</span><span class="token punctuation">,</span>
            <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
            <span class="token comment">// 也可以传入对象，目前和上面等价</span>
            person<span class="token punctuation">.</span>fullName <span class="token operator">=</span> <span class="token function">computed</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
                <span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                    <span class="token keyword">return</span> person<span class="token punctuation">.</span>firstName <span class="token operator">+</span> <span class="token string">' '</span> <span class="token operator">+</span> person<span class="token punctuation">.</span>lastName
                <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
                <span class="token function">set</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                    <span class="token keyword">const</span> newArr <span class="token operator">=</span> value<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">' '</span><span class="token punctuation">)</span>
                    person<span class="token punctuation">.</span>firstName <span class="token operator">=</span> newArr<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
                    person<span class="token punctuation">.</span>lastName <span class="token operator">=</span> newArr<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>
                <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
            <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
            <span class="token keyword">return</span> <span class="token punctuation">&#123;</span>
                person<span class="token punctuation">,</span>
            <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
    <span class="token punctuation">&#125;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">></span></code></pre>

<ul>
<li><p>给 computed 传入函数，返回值就是计算属性的值。</p>
</li>
<li><p>给 computed 传入对象，get 获取计算属性的值，set 监听计算属性改变。</p>
</li>
</ul>
<h2 id="watch"><a href="#watch" class="headerlink" title="watch"></a>watch</h2><h3 id="监听一个-ref-数据"><a href="#监听一个-ref-数据" class="headerlink" title="监听一个 ref 数据"></a>监听一个 ref 数据</h3><pre class="language-js" data-language="js"><code class="language-js"><span class="token operator">&lt;</span>template<span class="token operator">></span>
    <span class="token operator">&lt;</span>p<span class="token operator">></span><span class="token punctuation">&#123;</span><span class="token punctuation">&#123;</span> age <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">></span>
    <span class="token operator">&lt;</span>button @click<span class="token operator">=</span><span class="token string">"age++"</span><span class="token operator">></span>click<span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">></span>
<span class="token operator">&lt;</span><span class="token operator">/</span>template<span class="token operator">></span>

<span class="token operator">&lt;</span>script<span class="token operator">></span>
    <span class="token keyword">import</span> <span class="token punctuation">&#123;</span> watch<span class="token punctuation">,</span> ref <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'vue'</span>
    <span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">&#123;</span>
        <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'App'</span><span class="token punctuation">,</span>
        <span class="token function">setup</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">const</span> age <span class="token operator">=</span> <span class="token function">ref</span><span class="token punctuation">(</span><span class="token number">18</span><span class="token punctuation">)</span>
            <span class="token comment">// 监听 ref 数据 age，会触发后面的回调，不需要 .value</span>
            <span class="token function">watch</span><span class="token punctuation">(</span>age<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">newValue<span class="token punctuation">,</span> oldValue</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
                console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>newValue<span class="token punctuation">,</span> oldValue<span class="token punctuation">)</span>
            <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>

            <span class="token keyword">return</span> <span class="token punctuation">&#123;</span> age <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
    <span class="token punctuation">&#125;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">></span></code></pre>

<h3 id="监听多个-ref-数据"><a href="#监听多个-ref-数据" class="headerlink" title="监听多个 ref 数据"></a>监听多个 ref 数据</h3><pre class="language-js" data-language="js"><code class="language-js"><span class="token operator">&lt;</span>template<span class="token operator">></span>
    <span class="token operator">&lt;</span>p<span class="token operator">></span>age<span class="token operator">:</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#123;</span> age <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span> num<span class="token operator">:</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#123;</span> num <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">></span>
    <span class="token operator">&lt;</span>button @click<span class="token operator">=</span><span class="token string">"handleClick"</span><span class="token operator">></span>click<span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">></span>
<span class="token operator">&lt;</span><span class="token operator">/</span>template<span class="token operator">></span>

<span class="token operator">&lt;</span>script<span class="token operator">></span>
    <span class="token keyword">import</span> <span class="token punctuation">&#123;</span> watch<span class="token punctuation">,</span> ref <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'vue'</span>
    <span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">&#123;</span>
        <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'App'</span><span class="token punctuation">,</span>
        <span class="token function">setup</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">const</span> age <span class="token operator">=</span> <span class="token function">ref</span><span class="token punctuation">(</span><span class="token number">18</span><span class="token punctuation">)</span>
            <span class="token keyword">const</span> num <span class="token operator">=</span> <span class="token function">ref</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>

            <span class="token keyword">const</span> <span class="token function-variable function">handleClick</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
                age<span class="token punctuation">.</span>value<span class="token operator">++</span>
                num<span class="token punctuation">.</span>value<span class="token operator">++</span>
            <span class="token punctuation">&#125;</span>
            <span class="token comment">// 数组里面是 ref 数据</span>
            <span class="token function">watch</span><span class="token punctuation">(</span><span class="token punctuation">[</span>age<span class="token punctuation">,</span> num<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">newValue<span class="token punctuation">,</span> oldValue</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
                console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>newValue<span class="token punctuation">,</span> oldValue<span class="token punctuation">)</span>
            <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>

            <span class="token keyword">return</span> <span class="token punctuation">&#123;</span> age<span class="token punctuation">,</span> num<span class="token punctuation">,</span> handleClick <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
    <span class="token punctuation">&#125;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">></span></code></pre>



<h3 id="立即触发监听"><a href="#立即触发监听" class="headerlink" title="立即触发监听"></a>立即触发监听</h3><pre class="language-js" data-language="js"><code class="language-js"><span class="token operator">&lt;</span>template<span class="token operator">></span>
    <span class="token operator">&lt;</span>p<span class="token operator">></span><span class="token punctuation">&#123;</span><span class="token punctuation">&#123;</span> age <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">></span>
    <span class="token operator">&lt;</span>button @click<span class="token operator">=</span><span class="token string">"handleClick"</span><span class="token operator">></span>click<span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">></span>
<span class="token operator">&lt;</span><span class="token operator">/</span>template<span class="token operator">></span>

<span class="token operator">&lt;</span>script<span class="token operator">></span>
    <span class="token keyword">import</span> <span class="token punctuation">&#123;</span> watch<span class="token punctuation">,</span> ref <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'vue'</span>
    <span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">&#123;</span>
        <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'App'</span><span class="token punctuation">,</span>
        <span class="token function">setup</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">const</span> age <span class="token operator">=</span> <span class="token function">ref</span><span class="token punctuation">(</span><span class="token number">18</span><span class="token punctuation">)</span>

            <span class="token keyword">const</span> <span class="token function-variable function">handleClick</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
                age<span class="token punctuation">.</span>value<span class="token operator">++</span>
            <span class="token punctuation">&#125;</span>

            <span class="token function">watch</span><span class="token punctuation">(</span>
                age<span class="token punctuation">,</span>
                <span class="token punctuation">(</span><span class="token parameter">newValue<span class="token punctuation">,</span> oldValue</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
                    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>newValue<span class="token punctuation">,</span> oldValue<span class="token punctuation">)</span> <span class="token comment">// 18 undefined</span>
                <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
                <span class="token punctuation">&#123;</span>
                    <span class="token literal-property property">immediate</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
                <span class="token punctuation">&#125;</span>
            <span class="token punctuation">)</span>

            <span class="token keyword">return</span> <span class="token punctuation">&#123;</span> age<span class="token punctuation">,</span> handleClick <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
    <span class="token punctuation">&#125;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">></span></code></pre>

<h3 id="开启深度监听"><a href="#开启深度监听" class="headerlink" title="开启深度监听"></a>开启深度监听</h3><p>问题：修改 ref 对象里面的数据并不会触发监听，说明 ref 并不是默认开启 deep 的。</p>
<pre class="language-js" data-language="js"><code class="language-js"><span class="token operator">&lt;</span>template<span class="token operator">></span>
    <span class="token operator">&lt;</span>p<span class="token operator">></span><span class="token punctuation">&#123;</span><span class="token punctuation">&#123;</span> obj<span class="token punctuation">.</span>hobby<span class="token punctuation">.</span>eat <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">></span>
    <span class="token operator">&lt;</span>button @click<span class="token operator">=</span><span class="token string">"obj.hobby.eat = '面条'"</span><span class="token operator">></span>修改 obj<span class="token punctuation">.</span>hobby<span class="token punctuation">.</span>eat<span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">></span>
<span class="token operator">&lt;</span><span class="token operator">/</span>template<span class="token operator">></span>

<span class="token operator">&lt;</span>script<span class="token operator">></span>
    <span class="token keyword">import</span> <span class="token punctuation">&#123;</span> watch<span class="token punctuation">,</span> ref <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'vue'</span>
    <span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">&#123;</span>
        <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'App'</span><span class="token punctuation">,</span>
        <span class="token function">setup</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">const</span> obj <span class="token operator">=</span> <span class="token function">ref</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
                <span class="token literal-property property">hobby</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
                    <span class="token literal-property property">eat</span><span class="token operator">:</span> <span class="token string">'西瓜'</span><span class="token punctuation">,</span>
                <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
            <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
            <span class="token function">watch</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">newValue<span class="token punctuation">,</span> oldValue</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
                console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>newValue <span class="token operator">===</span> oldValue<span class="token punctuation">)</span>
            <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>

            <span class="token keyword">return</span> <span class="token punctuation">&#123;</span> obj <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
    <span class="token punctuation">&#125;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">></span></code></pre>

<ol>
<li>解决：当然直接修改整个对象的话肯定是会被监听到的（注意模板中对 obj 的修改，相当于修改的是 obj.value）。</li>
</ol>
<pre class="language-js" data-language="js"><code class="language-js"><span class="token operator">&lt;</span>template<span class="token operator">></span>
    <span class="token operator">&lt;</span>p<span class="token operator">></span><span class="token punctuation">&#123;</span><span class="token punctuation">&#123;</span> obj<span class="token punctuation">.</span>hobby<span class="token punctuation">.</span>eat <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">></span>
    <span class="token operator">&lt;</span>button @click<span class="token operator">=</span><span class="token string">"obj = &#123; hobby: &#123; eat: '面条' &#125; &#125;"</span><span class="token operator">></span>修改 obj<span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">></span>
<span class="token operator">&lt;</span><span class="token operator">/</span>template<span class="token operator">></span>

<span class="token operator">&lt;</span>script<span class="token operator">></span>
    <span class="token keyword">import</span> <span class="token punctuation">&#123;</span> watch<span class="token punctuation">,</span> ref <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'vue'</span>
    <span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">&#123;</span>
        <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'App'</span><span class="token punctuation">,</span>
        <span class="token function">setup</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">const</span> obj <span class="token operator">=</span> <span class="token function">ref</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
                <span class="token literal-property property">hobby</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
                    <span class="token literal-property property">eat</span><span class="token operator">:</span> <span class="token string">'西瓜'</span><span class="token punctuation">,</span>
                <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
            <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
            <span class="token function">watch</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">newValue<span class="token punctuation">,</span> oldValue</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
                console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>newValue<span class="token punctuation">,</span> oldValue<span class="token punctuation">)</span>
                console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>newValue <span class="token operator">===</span> oldValue<span class="token punctuation">)</span>
            <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>

            <span class="token keyword">return</span> <span class="token punctuation">&#123;</span> obj <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
    <span class="token punctuation">&#125;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">></span></code></pre>

<ol start="2">
<li>解决：开启深度监听 ref 数据。</li>
</ol>
<pre class="language-js" data-language="js"><code class="language-js"><span class="token function">watch</span><span class="token punctuation">(</span>
    obj<span class="token punctuation">,</span>
    <span class="token punctuation">(</span><span class="token parameter">newValue<span class="token punctuation">,</span> oldValue</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>newValue<span class="token punctuation">,</span> oldValue<span class="token punctuation">)</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>newValue <span class="token operator">===</span> oldValue<span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
    <span class="token punctuation">&#123;</span>
        <span class="token literal-property property">deep</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">)</span></code></pre>

<h3 id="监听-reactive-数据"><a href="#监听-reactive-数据" class="headerlink" title="监听 reactive 数据"></a>监听 reactive 数据</h3><h4 id="基本操作"><a href="#基本操作" class="headerlink" title="基本操作"></a>基本操作</h4><p>注意：监听 reactive 数据时，强制开启了深度监听，配置无效；监听对象的时候 newValue 和 oldValue 是全等的。</p>
<pre class="language-js" data-language="js"><code class="language-js"><span class="token operator">&lt;</span>template<span class="token operator">></span>
    <span class="token operator">&lt;</span>p<span class="token operator">></span><span class="token punctuation">&#123;</span><span class="token punctuation">&#123;</span> obj<span class="token punctuation">.</span>hobby<span class="token punctuation">.</span>eat <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">></span>
    <span class="token operator">&lt;</span>button @click<span class="token operator">=</span><span class="token string">"obj.hobby.eat = '面条'"</span><span class="token operator">></span>click<span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">></span>
<span class="token operator">&lt;</span><span class="token operator">/</span>template<span class="token operator">></span>

<span class="token operator">&lt;</span>script<span class="token operator">></span>
    <span class="token keyword">import</span> <span class="token punctuation">&#123;</span> watch<span class="token punctuation">,</span> reactive <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'vue'</span>
    <span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">&#123;</span>
        <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'App'</span><span class="token punctuation">,</span>
        <span class="token function">setup</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">const</span> obj <span class="token operator">=</span> <span class="token function">reactive</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
                <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'ifer'</span><span class="token punctuation">,</span>
                <span class="token literal-property property">hobby</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
                    <span class="token literal-property property">eat</span><span class="token operator">:</span> <span class="token string">'西瓜'</span><span class="token punctuation">,</span>
                <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
            <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
            <span class="token function">watch</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">newValue<span class="token punctuation">,</span> oldValue</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
                <span class="token comment">// 注意1：监听对象的时候，新旧值是相等的</span>
                <span class="token comment">// 注意2：强制开启深度监听，配置无效</span>
                console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>newValue <span class="token operator">===</span> oldValue<span class="token punctuation">)</span> <span class="token comment">// true</span>
            <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>

            <span class="token keyword">return</span> <span class="token punctuation">&#123;</span> obj <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
    <span class="token punctuation">&#125;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">></span></code></pre>

<h4 id="知识补充"><a href="#知识补充" class="headerlink" title="知识补充"></a>知识补充</h4><ul>
<li>想让 ref 内部数据的修改被观测到，除了前面学习的开启深度监听，还可以通过监听 ref.value 来实现同样的效果。</li>
<li>因为 ref.value 是一个 reactive，可以通过 isReactive 方法来证明。</li>
</ul>
<pre class="language-js" data-language="js"><code class="language-js"><span class="token operator">&lt;</span>template<span class="token operator">></span>
    <span class="token operator">&lt;</span>p<span class="token operator">></span><span class="token punctuation">&#123;</span><span class="token punctuation">&#123;</span> obj<span class="token punctuation">.</span>hobby<span class="token punctuation">.</span>eat <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">></span>
    <span class="token operator">&lt;</span>button @click<span class="token operator">=</span><span class="token string">"obj.hobby.eat = '面条'"</span><span class="token operator">></span>修改 obj<span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">></span>
<span class="token operator">&lt;</span><span class="token operator">/</span>template<span class="token operator">></span>

<span class="token operator">&lt;</span>script<span class="token operator">></span>
    <span class="token keyword">import</span> <span class="token punctuation">&#123;</span> watch<span class="token punctuation">,</span> ref <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'vue'</span>
    <span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">&#123;</span>
        <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'App'</span><span class="token punctuation">,</span>
        <span class="token function">setup</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">const</span> obj <span class="token operator">=</span> <span class="token function">ref</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
                <span class="token literal-property property">hobby</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
                    <span class="token literal-property property">eat</span><span class="token operator">:</span> <span class="token string">'西瓜'</span><span class="token punctuation">,</span>
                <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
            <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
            <span class="token function">watch</span><span class="token punctuation">(</span>obj<span class="token punctuation">.</span>value<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">newValue<span class="token punctuation">,</span> oldValue</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
                console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>newValue<span class="token punctuation">,</span> oldValue<span class="token punctuation">)</span>
                console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>newValue <span class="token operator">===</span> oldValue<span class="token punctuation">)</span>
            <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>

            <span class="token keyword">return</span> <span class="token punctuation">&#123;</span> obj <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
    <span class="token punctuation">&#125;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">></span></code></pre>

<h3 id="监听普通数据"><a href="#监听普通数据" class="headerlink" title="监听普通数据"></a>监听普通数据</h3><ol>
<li>监听响应式对象中的某一个普通属性值，要通过函数返回的方式进行（如果返回的是对象/响应式对象，修改内部的数据需要开启深度监听）。</li>
</ol>
<pre class="language-js" data-language="js"><code class="language-js"><span class="token operator">&lt;</span>template<span class="token operator">></span>
    <span class="token operator">&lt;</span>p<span class="token operator">></span><span class="token punctuation">&#123;</span><span class="token punctuation">&#123;</span> obj<span class="token punctuation">.</span>hobby<span class="token punctuation">.</span>eat <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">></span>
    <span class="token operator">&lt;</span>button @click<span class="token operator">=</span><span class="token string">"obj.hobby.eat = '面条'"</span><span class="token operator">></span>修改 obj<span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">></span>
<span class="token operator">&lt;</span><span class="token operator">/</span>template<span class="token operator">></span>

<span class="token operator">&lt;</span>script<span class="token operator">></span>
    <span class="token keyword">import</span> <span class="token punctuation">&#123;</span> watch<span class="token punctuation">,</span> reactive <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'vue'</span>
    <span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">&#123;</span>
        <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'App'</span><span class="token punctuation">,</span>
        <span class="token function">setup</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">const</span> obj <span class="token operator">=</span> <span class="token function">reactive</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
                <span class="token literal-property property">hobby</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
                    <span class="token literal-property property">eat</span><span class="token operator">:</span> <span class="token string">'西瓜'</span><span class="token punctuation">,</span>
                <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
            <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
            <span class="token comment">// 不叫普通属性值，是一个 reactive</span>
            <span class="token comment">/* watch(obj.hobby, (newValue, oldValue) => &#123;
                console.log(newValue, oldValue)
                console.log(newValue === oldValue)
            &#125;) */</span>
            <span class="token comment">// 叫普通属性值</span>
            <span class="token function">watch</span><span class="token punctuation">(</span>
                <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> obj<span class="token punctuation">.</span>hobby<span class="token punctuation">.</span>eat<span class="token punctuation">,</span>
                <span class="token punctuation">(</span><span class="token parameter">newValue<span class="token punctuation">,</span> oldValue</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
                    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>newValue<span class="token punctuation">,</span> oldValue<span class="token punctuation">)</span>
                    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>newValue <span class="token operator">===</span> oldValue<span class="token punctuation">)</span>
                <span class="token punctuation">&#125;</span>
            <span class="token punctuation">)</span>

            <span class="token keyword">return</span> <span class="token punctuation">&#123;</span> obj <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
    <span class="token punctuation">&#125;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">></span></code></pre>

<ol start="2">
<li>监听 ref 数据的另一种写法。</li>
</ol>
<pre class="language-js" data-language="js"><code class="language-js"><span class="token operator">&lt;</span>template<span class="token operator">></span>
    <span class="token operator">&lt;</span>p<span class="token operator">></span><span class="token punctuation">&#123;</span><span class="token punctuation">&#123;</span> age <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">></span>
    <span class="token operator">&lt;</span>button @click<span class="token operator">=</span><span class="token string">"age++"</span><span class="token operator">></span>click<span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">></span>
<span class="token operator">&lt;</span><span class="token operator">/</span>template<span class="token operator">></span>

<span class="token operator">&lt;</span>script<span class="token operator">></span>
    <span class="token keyword">import</span> <span class="token punctuation">&#123;</span> watch<span class="token punctuation">,</span> ref <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'vue'</span>
    <span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">&#123;</span>
        <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'App'</span><span class="token punctuation">,</span>
        <span class="token function">setup</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">const</span> age <span class="token operator">=</span> <span class="token function">ref</span><span class="token punctuation">(</span><span class="token number">18</span><span class="token punctuation">)</span>
            <span class="token comment">// 监听 ref 数据 age，会触发后面的回调，不需要 .value</span>
            <span class="token comment">/* watch(age, (newValue, oldValue) => &#123;
                console.log(newValue, oldValue);
            &#125;); */</span>
            <span class="token comment">// 另一种写法，函数返回一个普通值</span>
            <span class="token function">watch</span><span class="token punctuation">(</span>
                <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> age<span class="token punctuation">.</span>value<span class="token punctuation">,</span>
                <span class="token punctuation">(</span><span class="token parameter">newValue<span class="token punctuation">,</span> oldValue</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
                    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>newValue<span class="token punctuation">,</span> oldValue<span class="token punctuation">)</span>
                <span class="token punctuation">&#125;</span>
            <span class="token punctuation">)</span>

            <span class="token keyword">return</span> <span class="token punctuation">&#123;</span> age <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
    <span class="token punctuation">&#125;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">></span></code></pre>

<h2 id="watchEffect"><a href="#watchEffect" class="headerlink" title="watchEffect"></a>watchEffect</h2><pre class="language-js" data-language="js"><code class="language-js"><span class="token operator">&lt;</span>template<span class="token operator">></span>
    <span class="token operator">&lt;</span>p<span class="token operator">></span><span class="token punctuation">&#123;</span><span class="token punctuation">&#123;</span> obj<span class="token punctuation">.</span>hobby<span class="token punctuation">.</span>eat <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">></span>
    <span class="token operator">&lt;</span>button @click<span class="token operator">=</span><span class="token string">"obj.hobby.eat = '面条'"</span><span class="token operator">></span>修改 obj<span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">></span>
<span class="token operator">&lt;</span><span class="token operator">/</span>template<span class="token operator">></span>

<span class="token operator">&lt;</span>script<span class="token operator">></span>
    <span class="token keyword">import</span> <span class="token punctuation">&#123;</span> reactive<span class="token punctuation">,</span> watchEffect <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'vue'</span>
    <span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">&#123;</span>
        <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'App'</span><span class="token punctuation">,</span>
        <span class="token function">setup</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">const</span> obj <span class="token operator">=</span> <span class="token function">reactive</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
                <span class="token literal-property property">hobby</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
                    <span class="token literal-property property">eat</span><span class="token operator">:</span> <span class="token string">'西瓜'</span><span class="token punctuation">,</span>
                <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
            <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
            <span class="token comment">// 叫普通属性值</span>
            <span class="token comment">/* watch(obj, (newValue, oldValue) => &#123;
                console.log(newValue, oldValue)
                console.log(newValue === oldValue)
            &#125;) */</span>

            <span class="token function">watchEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
                <span class="token comment">// 1. 不指定监视哪一个，这里面用到了谁就监听谁</span>
                <span class="token comment">// 2. 第一次的时候肯定会执行</span>
                <span class="token comment">// 例如对 obj.hobby.eat 的修改，由于这里用到了 obj.hobby.eat，则会执行</span>
                <span class="token comment">// !注意如果这里用的是 obj 则不会被执行</span>
                console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>obj<span class="token punctuation">.</span>hobby<span class="token punctuation">.</span>eat<span class="token punctuation">)</span>
            <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>

            <span class="token keyword">return</span> <span class="token punctuation">&#123;</span> obj <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
    <span class="token punctuation">&#125;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">></span></code></pre>

<h2 id="provide-inject"><a href="#provide-inject" class="headerlink" title="provide/inject"></a>provide/inject</h2><p>把 App.vue 中的数据传递给孙组件，Child.vue。</p>
<p><code>App.vue</code></p>
<pre class="language-js" data-language="js"><code class="language-js"><span class="token operator">&lt;</span>template<span class="token operator">></span>
    <span class="token operator">&lt;</span>div <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"container"</span><span class="token operator">></span>
        <span class="token operator">&lt;</span>h2<span class="token operator">></span>App <span class="token punctuation">&#123;</span><span class="token punctuation">&#123;</span> money <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token operator">&lt;</span><span class="token operator">/</span>h2<span class="token operator">></span>
        <span class="token operator">&lt;</span>button @click<span class="token operator">=</span><span class="token string">"money = 1000"</span><span class="token operator">></span>发钱<span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">></span>
        <span class="token operator">&lt;</span>hr <span class="token operator">/</span><span class="token operator">></span>
        <span class="token operator">&lt;</span>Parent <span class="token operator">/</span><span class="token operator">></span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span>
<span class="token operator">&lt;</span><span class="token operator">/</span>template<span class="token operator">></span>
<span class="token operator">&lt;</span>script<span class="token operator">></span>
    <span class="token keyword">import</span> <span class="token punctuation">&#123;</span> provide<span class="token punctuation">,</span> ref <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'vue'</span>
    <span class="token keyword">import</span> Parent <span class="token keyword">from</span> <span class="token string">'./Parent.vue'</span>
    <span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">&#123;</span>
        <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'App'</span><span class="token punctuation">,</span>
        <span class="token literal-property property">components</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
            Parent<span class="token punctuation">,</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
        <span class="token function">setup</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token comment">// 提供数据</span>
            <span class="token keyword">const</span> money <span class="token operator">=</span> <span class="token function">ref</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span>
            <span class="token function">provide</span><span class="token punctuation">(</span><span class="token string">'money'</span><span class="token punctuation">,</span> money<span class="token punctuation">)</span>
            <span class="token comment">// 提供修改数据的方法</span>
            <span class="token keyword">const</span> <span class="token function-variable function">changeMoney</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">m</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">(</span>money<span class="token punctuation">.</span>value <span class="token operator">-=</span> m<span class="token punctuation">)</span>
            <span class="token function">provide</span><span class="token punctuation">(</span><span class="token string">'changeMoney'</span><span class="token punctuation">,</span> changeMoney<span class="token punctuation">)</span>
            <span class="token keyword">return</span> <span class="token punctuation">&#123;</span> money <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
    <span class="token punctuation">&#125;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">></span></code></pre>

<p><code>Parent.vue</code></p>
<pre class="language-js" data-language="js"><code class="language-js"><span class="token operator">&lt;</span>template<span class="token operator">></span>
    <span class="token operator">&lt;</span>div<span class="token operator">></span>
        Parent
        <span class="token operator">&lt;</span>hr <span class="token operator">/</span><span class="token operator">></span>
        <span class="token operator">&lt;</span>Child <span class="token operator">/</span><span class="token operator">></span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span>
<span class="token operator">&lt;</span><span class="token operator">/</span>template<span class="token operator">></span>

<span class="token operator">&lt;</span>script<span class="token operator">></span>
    <span class="token keyword">import</span> Child <span class="token keyword">from</span> <span class="token string">'./Child.vue'</span>
    <span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">&#123;</span>
        <span class="token literal-property property">components</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
            Child<span class="token punctuation">,</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
    <span class="token punctuation">&#125;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">></span></code></pre>

<p><code>Child.vue</code></p>
<pre class="language-js" data-language="js"><code class="language-js"><span class="token operator">&lt;</span>template<span class="token operator">></span>
    <span class="token operator">&lt;</span>div<span class="token operator">></span>
        Child
        <span class="token operator">&lt;</span>p<span class="token operator">></span><span class="token punctuation">&#123;</span><span class="token punctuation">&#123;</span> money <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">></span>
        <span class="token operator">&lt;</span>button @click<span class="token operator">=</span><span class="token string">"changeMoney(1)"</span><span class="token operator">></span>花 <span class="token number">1</span> 块钱<span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">></span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span>
<span class="token operator">&lt;</span><span class="token operator">/</span>template<span class="token operator">></span>

<span class="token operator">&lt;</span>script<span class="token operator">></span>
    <span class="token keyword">import</span> <span class="token punctuation">&#123;</span> inject <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'vue'</span>
    <span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">&#123;</span>
        <span class="token function">setup</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">const</span> money <span class="token operator">=</span> <span class="token function">inject</span><span class="token punctuation">(</span><span class="token string">'money'</span><span class="token punctuation">)</span>
            <span class="token keyword">const</span> changeMoney <span class="token operator">=</span> <span class="token function">inject</span><span class="token punctuation">(</span><span class="token string">'changeMoney'</span><span class="token punctuation">)</span>
            <span class="token keyword">return</span> <span class="token punctuation">&#123;</span> money<span class="token punctuation">,</span> changeMoney <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
    <span class="token punctuation">&#125;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">></span></code></pre>

<h2 id="响应式数据的判断"><a href="#响应式数据的判断" class="headerlink" title="响应式数据的判断"></a>响应式数据的判断</h2><ul>
<li>isRef: 检查一个值是否为 ref 对象。</li>
<li>isReactive: 检查一个对象是否是由 reactive 创建的响应式代理。</li>
<li>isReadonly: 检查一个对象是否是由 readonly 创建的只读代理。</li>
<li>isProxy: 检查一个对象是否是由 reactive 或者 readonly 方法创建的代理。</li>
</ul>
<pre class="language-js" data-language="js"><code class="language-js"><span class="token operator">&lt;</span>template<span class="token operator">></span>
    <span class="token operator">&lt;</span>div<span class="token operator">></span>name<span class="token operator">:</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#123;</span> name <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span>
    <span class="token operator">&lt;</span>div<span class="token operator">></span>age<span class="token operator">:</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#123;</span> age <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span>
<span class="token operator">&lt;</span><span class="token operator">/</span>template<span class="token operator">></span>

<span class="token operator">&lt;</span>script<span class="token operator">></span>
    <span class="token keyword">import</span> <span class="token punctuation">&#123;</span> reactive<span class="token punctuation">,</span> readonly<span class="token punctuation">,</span> ref<span class="token punctuation">,</span> toRefs<span class="token punctuation">,</span> isRef<span class="token punctuation">,</span> isReactive<span class="token punctuation">,</span> isReadonly<span class="token punctuation">,</span> isProxy <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'vue'</span>
    <span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">&#123;</span>
        <span class="token function">setup</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">const</span> person <span class="token operator">=</span> <span class="token function">reactive</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'xxx'</span><span class="token punctuation">,</span> <span class="token literal-property property">age</span><span class="token operator">:</span> <span class="token number">18</span> <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
            <span class="token keyword">const</span> num <span class="token operator">=</span> <span class="token function">ref</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
            <span class="token keyword">const</span> readonlyPerson <span class="token operator">=</span> <span class="token function">readonly</span><span class="token punctuation">(</span>person<span class="token punctuation">)</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">isRef</span><span class="token punctuation">(</span>num<span class="token punctuation">)</span><span class="token punctuation">)</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">isReactive</span><span class="token punctuation">(</span>person<span class="token punctuation">)</span><span class="token punctuation">)</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">isReadonly</span><span class="token punctuation">(</span>readonlyPerson<span class="token punctuation">)</span><span class="token punctuation">)</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">isProxy</span><span class="token punctuation">(</span>person<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// true</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">isProxy</span><span class="token punctuation">(</span>readonlyPerson<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// true</span>
            <span class="token keyword">return</span> <span class="token punctuation">&#123;</span>
                <span class="token operator">...</span><span class="token function">toRefs</span><span class="token punctuation">(</span>person<span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
    <span class="token punctuation">&#125;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">></span></code></pre>

<h2 id="setup-函数参数"><a href="#setup-函数参数" class="headerlink" title="setup 函数参数"></a>setup 函数参数</h2><p> setup 中参数的使用。</p>
<p><strong>父传子</strong></p>
<p><code>App.vue</code></p>
<pre class="language-js" data-language="js"><code class="language-js"><span class="token operator">&lt;</span>template<span class="token operator">></span>
    <span class="token operator">&lt;</span>h1<span class="token operator">></span>父组件<span class="token operator">&lt;</span><span class="token operator">/</span>h1<span class="token operator">></span>
    <span class="token operator">&lt;</span>p<span class="token operator">></span><span class="token punctuation">&#123;</span><span class="token punctuation">&#123;</span> money <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">></span>
    <span class="token operator">&lt;</span>hr <span class="token operator">/</span><span class="token operator">></span>
    <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> <span class="token number">1.</span> 父组件通过自定义属性提供数据 <span class="token operator">--</span><span class="token operator">></span>
    <span class="token operator">&lt;</span>Son <span class="token operator">:</span>money<span class="token operator">=</span><span class="token string">"money"</span> <span class="token operator">/</span><span class="token operator">></span>
<span class="token operator">&lt;</span><span class="token operator">/</span>template<span class="token operator">></span>
<span class="token operator">&lt;</span>script<span class="token operator">></span>
    <span class="token keyword">import</span> <span class="token punctuation">&#123;</span> ref <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'vue'</span>
    <span class="token keyword">import</span> Son <span class="token keyword">from</span> <span class="token string">'./Son.vue'</span>
    <span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">&#123;</span>
        <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'App'</span><span class="token punctuation">,</span>
        <span class="token literal-property property">components</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
            Son<span class="token punctuation">,</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
        <span class="token function">setup</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">const</span> money <span class="token operator">=</span> <span class="token function">ref</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span>
            <span class="token keyword">return</span> <span class="token punctuation">&#123;</span> money <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
    <span class="token punctuation">&#125;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">></span></code></pre>

<p><code>Son.vue</code></p>
<pre class="language-js" data-language="js"><code class="language-js"><span class="token operator">&lt;</span>template<span class="token operator">></span>
    <span class="token operator">&lt;</span>h1<span class="token operator">></span>子组件<span class="token operator">&lt;</span><span class="token operator">/</span>h1<span class="token operator">></span>
    <span class="token operator">&lt;</span>p<span class="token operator">></span><span class="token punctuation">&#123;</span><span class="token punctuation">&#123;</span> money <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">></span>
<span class="token operator">&lt;</span><span class="token operator">/</span>template<span class="token operator">></span>
<span class="token operator">&lt;</span>script<span class="token operator">></span>
    <span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">&#123;</span>
        <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'Son'</span><span class="token punctuation">,</span>
        <span class="token comment">// 2. 子组件通过 props 进行接收，在模板中就可以使用啦</span>
        <span class="token literal-property property">props</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
            <span class="token literal-property property">money</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
                <span class="token literal-property property">type</span><span class="token operator">:</span> Number<span class="token punctuation">,</span>
                <span class="token keyword">default</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
            <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
        <span class="token function">setup</span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token comment">// 3. setup 中也可以通过形参 props 来获取传递的数据</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>props<span class="token punctuation">.</span>money<span class="token punctuation">)</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
    <span class="token punctuation">&#125;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">></span></code></pre>

<p><strong>子传父</strong></p>
<p><code>App.vue</code></p>
<pre class="language-js" data-language="js"><code class="language-js"><span class="token operator">&lt;</span>template<span class="token operator">></span>
    <span class="token operator">&lt;</span>h1<span class="token operator">></span>父组件<span class="token operator">&lt;</span><span class="token operator">/</span>h1<span class="token operator">></span>
    <span class="token operator">&lt;</span>p<span class="token operator">></span><span class="token punctuation">&#123;</span><span class="token punctuation">&#123;</span> money <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">></span>
    <span class="token operator">&lt;</span>hr <span class="token operator">/</span><span class="token operator">></span>
    <span class="token operator">&lt;</span>Son <span class="token operator">:</span>money<span class="token operator">=</span><span class="token string">"money"</span> @change<span class="token operator">-</span>money<span class="token operator">=</span><span class="token string">"updateMoney"</span> <span class="token operator">/</span><span class="token operator">></span>
<span class="token operator">&lt;</span><span class="token operator">/</span>template<span class="token operator">></span>
<span class="token operator">&lt;</span>script<span class="token operator">></span>
    <span class="token keyword">import</span> <span class="token punctuation">&#123;</span> ref <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'vue'</span>
    <span class="token keyword">import</span> Son <span class="token keyword">from</span> <span class="token string">'./Son.vue'</span>
    <span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">&#123;</span>
        <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'App'</span><span class="token punctuation">,</span>
        <span class="token literal-property property">components</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
            Son<span class="token punctuation">,</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
        <span class="token function">setup</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">const</span> money <span class="token operator">=</span> <span class="token function">ref</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span>
            <span class="token comment">// #1 父组件准备修改数据的方法并提供给子组件</span>
            <span class="token keyword">const</span> <span class="token function-variable function">updateMoney</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">newMoney</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
                money<span class="token punctuation">.</span>value <span class="token operator">-=</span> newMoney
            <span class="token punctuation">&#125;</span>
            <span class="token keyword">return</span> <span class="token punctuation">&#123;</span> money<span class="token punctuation">,</span> updateMoney <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
    <span class="token punctuation">&#125;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">></span></code></pre>

<p><code>Son.vue</code></p>
<pre class="language-js" data-language="js"><code class="language-js"><span class="token operator">&lt;</span>template<span class="token operator">></span>
    <span class="token operator">&lt;</span>h1<span class="token operator">></span>子组件<span class="token operator">&lt;</span><span class="token operator">/</span>h1<span class="token operator">></span>
    <span class="token operator">&lt;</span>p<span class="token operator">></span><span class="token punctuation">&#123;</span><span class="token punctuation">&#123;</span> money <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">></span>
    <span class="token operator">&lt;</span>button @click<span class="token operator">=</span><span class="token string">"changeMoney(1)"</span><span class="token operator">></span>花 <span class="token number">1</span> 元<span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">></span>
<span class="token operator">&lt;</span><span class="token operator">/</span>template<span class="token operator">></span>
<span class="token operator">&lt;</span>script<span class="token operator">></span>
    <span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">&#123;</span>
        <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'Son'</span><span class="token punctuation">,</span>
        <span class="token literal-property property">props</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
            <span class="token literal-property property">money</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
                <span class="token literal-property property">type</span><span class="token operator">:</span> Number<span class="token punctuation">,</span>
                <span class="token keyword">default</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
            <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
        <span class="token literal-property property">emits</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'change-money'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token function">setup</span><span class="token punctuation">(</span><span class="token parameter">props<span class="token punctuation">,</span> <span class="token punctuation">&#123;</span> emit <span class="token punctuation">&#125;</span></span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token comment">// attrs 捡漏、slots 插槽</span>
            <span class="token keyword">const</span> <span class="token function-variable function">changeMoney</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">m</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
                <span class="token comment">// #2 子组件通过 emit 进行触发</span>
                <span class="token function">emit</span><span class="token punctuation">(</span><span class="token string">'change-money'</span><span class="token punctuation">,</span> m<span class="token punctuation">)</span>
            <span class="token punctuation">&#125;</span>
            <span class="token keyword">return</span> <span class="token punctuation">&#123;</span> changeMoney <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
    <span class="token punctuation">&#125;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">></span></code></pre>

<h2 id="v-model"><a href="#v-model" class="headerlink" title="v-model"></a>v-model</h2><h4 id="基本操作-1"><a href="#基本操作-1" class="headerlink" title="基本操作"></a>基本操作</h4><p>在 Vue2 中 v-mode 语法糖简写的代码。</p>
<pre class="language-js" data-language="js"><code class="language-js"><span class="token operator">&lt;</span>Son <span class="token operator">:</span>value<span class="token operator">=</span><span class="token string">"msg"</span> @input<span class="token operator">=</span><span class="token string">"msg=$event"</span> <span class="token operator">/</span><span class="token operator">></span></code></pre>

<p>在 Vue3 中 v-model 语法糖有所调整。</p>
<pre class="language-js" data-language="js"><code class="language-js"><span class="token operator">&lt;</span>Son <span class="token operator">:</span>modelValue<span class="token operator">=</span><span class="token string">"msg"</span> @update<span class="token operator">:</span>modelValue<span class="token operator">=</span><span class="token string">"msg=$event"</span> <span class="token operator">/</span><span class="token operator">></span></code></pre>

<p><code>App.vue</code></p>
<pre class="language-js" data-language="js"><code class="language-js"><span class="token operator">&lt;</span>template<span class="token operator">></span>
    <span class="token operator">&lt;</span>h2<span class="token operator">></span>count<span class="token operator">:</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#123;</span> count <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token operator">&lt;</span><span class="token operator">/</span>h2<span class="token operator">></span>
    <span class="token operator">&lt;</span>hr <span class="token operator">/</span><span class="token operator">></span>
    <span class="token operator">&lt;</span>Son <span class="token operator">:</span>modelValue<span class="token operator">=</span><span class="token string">"count"</span> @update<span class="token operator">:</span>modelValue<span class="token operator">=</span><span class="token string">"count = $event"</span> <span class="token operator">/</span><span class="token operator">></span>
    <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> <span class="token operator">&lt;</span>Son v<span class="token operator">-</span>model<span class="token operator">=</span><span class="token string">"count"</span> <span class="token operator">/</span><span class="token operator">></span> <span class="token operator">--</span><span class="token operator">></span>
<span class="token operator">&lt;</span><span class="token operator">/</span>template<span class="token operator">></span>
<span class="token operator">&lt;</span>script<span class="token operator">></span>
    <span class="token keyword">import</span> <span class="token punctuation">&#123;</span> ref <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'vue'</span>
    <span class="token keyword">import</span> Son <span class="token keyword">from</span> <span class="token string">'./Son.vue'</span>
    <span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">&#123;</span>
        <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'App'</span><span class="token punctuation">,</span>
        <span class="token literal-property property">components</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
            Son<span class="token punctuation">,</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
        <span class="token function">setup</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">const</span> count <span class="token operator">=</span> <span class="token function">ref</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span>
            <span class="token keyword">return</span> <span class="token punctuation">&#123;</span> count <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
    <span class="token punctuation">&#125;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">></span></code></pre>

<p><code>Son.vue</code></p>
<pre class="language-js" data-language="js"><code class="language-js"><span class="token operator">&lt;</span>template<span class="token operator">></span>
    <span class="token operator">&lt;</span>h2<span class="token operator">></span>子组件 <span class="token punctuation">&#123;</span><span class="token punctuation">&#123;</span> modelValue <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token operator">&lt;</span><span class="token operator">/</span>h2<span class="token operator">></span>
    <span class="token operator">&lt;</span>button @click<span class="token operator">=</span><span class="token string">"$emit('update:modelValue', 100)"</span><span class="token operator">></span>改变 count<span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">></span>
<span class="token operator">&lt;</span><span class="token operator">/</span>template<span class="token operator">></span>
<span class="token operator">&lt;</span>script<span class="token operator">></span>
    <span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">&#123;</span>
        <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'Son'</span><span class="token punctuation">,</span>
        <span class="token literal-property property">props</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
            <span class="token literal-property property">modelValue</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
                <span class="token literal-property property">type</span><span class="token operator">:</span> Number<span class="token punctuation">,</span>
                <span class="token keyword">default</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
            <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
    <span class="token punctuation">&#125;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">></span></code></pre>

<h4 id="传递多个"><a href="#传递多个" class="headerlink" title="传递多个"></a>传递多个</h4><p><code>App.vue</code></p>
<pre class="language-js" data-language="js"><code class="language-js"><span class="token operator">&lt;</span>template<span class="token operator">></span>
    <span class="token operator">&lt;</span>h2<span class="token operator">></span>count<span class="token operator">:</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#123;</span> count <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span> age<span class="token operator">:</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#123;</span> age <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token operator">&lt;</span><span class="token operator">/</span>h2<span class="token operator">></span>
    <span class="token operator">&lt;</span>hr <span class="token operator">/</span><span class="token operator">></span>
    <span class="token operator">&lt;</span>Son v<span class="token operator">-</span>model<span class="token operator">=</span><span class="token string">"count"</span> v<span class="token operator">-</span>model<span class="token operator">:</span>age<span class="token operator">=</span><span class="token string">"age"</span> <span class="token operator">/</span><span class="token operator">></span>
<span class="token operator">&lt;</span><span class="token operator">/</span>template<span class="token operator">></span>
<span class="token operator">&lt;</span>script<span class="token operator">></span>
    <span class="token keyword">import</span> <span class="token punctuation">&#123;</span> ref <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'vue'</span>
    <span class="token keyword">import</span> Son <span class="token keyword">from</span> <span class="token string">'./Son.vue'</span>
    <span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">&#123;</span>
        <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'App'</span><span class="token punctuation">,</span>
        <span class="token literal-property property">components</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
            Son<span class="token punctuation">,</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
        <span class="token function">setup</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">const</span> count <span class="token operator">=</span> <span class="token function">ref</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span>
            <span class="token keyword">const</span> age <span class="token operator">=</span> <span class="token function">ref</span><span class="token punctuation">(</span><span class="token number">18</span><span class="token punctuation">)</span>
            <span class="token keyword">return</span> <span class="token punctuation">&#123;</span> count<span class="token punctuation">,</span> age <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
    <span class="token punctuation">&#125;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">></span></code></pre>

<p><code>Son.vue</code></p>
<pre class="language-js" data-language="js"><code class="language-js"><span class="token operator">&lt;</span>template<span class="token operator">></span>
    <span class="token operator">&lt;</span>h2<span class="token operator">></span>子组件 <span class="token punctuation">&#123;</span><span class="token punctuation">&#123;</span> modelValue <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#123;</span> age <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token operator">&lt;</span><span class="token operator">/</span>h2<span class="token operator">></span>
    <span class="token operator">&lt;</span>button @click<span class="token operator">=</span><span class="token string">"$emit('update:modelValue', 100)"</span><span class="token operator">></span>改变 count<span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">></span>
    <span class="token operator">&lt;</span>button @click<span class="token operator">=</span><span class="token string">"$emit('update:age', 19)"</span><span class="token operator">></span>改变 age<span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">></span>
<span class="token operator">&lt;</span><span class="token operator">/</span>template<span class="token operator">></span>
<span class="token operator">&lt;</span>script<span class="token operator">></span>
    <span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">&#123;</span>
        <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'Son'</span><span class="token punctuation">,</span>
        <span class="token literal-property property">props</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
            <span class="token literal-property property">modelValue</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
                <span class="token literal-property property">type</span><span class="token operator">:</span> Number<span class="token punctuation">,</span>
                <span class="token keyword">default</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
            <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
            <span class="token literal-property property">age</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
                <span class="token literal-property property">type</span><span class="token operator">:</span> Number<span class="token punctuation">,</span>
                <span class="token keyword">default</span><span class="token operator">:</span> <span class="token number">18</span><span class="token punctuation">,</span>
            <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
    <span class="token punctuation">&#125;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">></span></code></pre>

<h2 id="Fragment"><a href="#Fragment" class="headerlink" title="Fragment"></a>Fragment</h2><ul>
<li>Vue2 中组件必须有一个跟标签。</li>
<li>Vue3 中组件可以没有根标签，其内部会将多个标签包含在一个 Fragment 虚拟元素中。</li>
<li>好处：减少标签层级和内存占用。</li>
</ul>
<h2 id="Teleport"><a href="#Teleport" class="headerlink" title="Teleport"></a>Teleport</h2><h4 id="作用-1"><a href="#作用-1" class="headerlink" title="作用"></a>作用</h4><p>传送，能将特定的 HTML 结构（一般是嵌套很深的）移动到指定的位置，解决 HTML 结构嵌套过深造成的样式影响或不好控制的问题。</p>
<h4 id="案例"><a href="#案例" class="headerlink" title="案例"></a>案例</h4><p>在 Child 组件点击按钮进行弹框。</p>
<pre class="language-js" data-language="js"><code class="language-js"><span class="token operator">&lt;</span>template<span class="token operator">></span>
    <span class="token operator">&lt;</span>div <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"child"</span><span class="token operator">></span>
        <span class="token operator">&lt;</span>dialog v<span class="token operator">-</span><span class="token keyword">if</span><span class="token operator">=</span><span class="token string">"bBar"</span> <span class="token operator">/</span><span class="token operator">></span>
        <span class="token operator">&lt;</span>button @click<span class="token operator">=</span><span class="token string">"handleDialog"</span><span class="token operator">></span>显示弹框<span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">></span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span>
<span class="token operator">&lt;</span><span class="token operator">/</span>template<span class="token operator">></span>

<span class="token operator">&lt;</span>script<span class="token operator">></span>
    <span class="token keyword">import</span> <span class="token punctuation">&#123;</span> ref <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'vue'</span>
    <span class="token keyword">import</span> Dialog <span class="token keyword">from</span> <span class="token string">'./Dialog.vue'</span>
    <span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">&#123;</span>
        <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'Child'</span><span class="token punctuation">,</span>
        <span class="token literal-property property">components</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
            Dialog<span class="token punctuation">,</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
        <span class="token function">setup</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">const</span> bBar <span class="token operator">=</span> <span class="token function">ref</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span>
            <span class="token keyword">const</span> <span class="token function-variable function">handleDialog</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
                bBar<span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token operator">!</span>bBar<span class="token punctuation">.</span>value
            <span class="token punctuation">&#125;</span>
            <span class="token keyword">return</span> <span class="token punctuation">&#123;</span>
                bBar<span class="token punctuation">,</span>
                handleDialog<span class="token punctuation">,</span>
            <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
    <span class="token punctuation">&#125;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">></span></code></pre>

<h4 id="解决"><a href="#解决" class="headerlink" title="解决"></a>解决</h4><pre class="language-js" data-language="js"><code class="language-js"><span class="token operator">&lt;</span>template<span class="token operator">></span>
    <span class="token operator">&lt;</span>div <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"child"</span><span class="token operator">></span>
        <span class="token operator">&lt;</span>teleport to<span class="token operator">=</span><span class="token string">"body"</span><span class="token operator">></span>
            <span class="token operator">&lt;</span>dialog v<span class="token operator">-</span><span class="token keyword">if</span><span class="token operator">=</span><span class="token string">"bBar"</span> <span class="token operator">/</span><span class="token operator">></span>
        <span class="token operator">&lt;</span><span class="token operator">/</span>teleport<span class="token operator">></span>
        <span class="token operator">&lt;</span>button @click<span class="token operator">=</span><span class="token string">"handleDialog"</span><span class="token operator">></span>显示弹框<span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">></span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span>
<span class="token operator">&lt;</span><span class="token operator">/</span>template<span class="token operator">></span></code></pre>

<h2 id="Suspense"><a href="#Suspense" class="headerlink" title="Suspense"></a>Suspense</h2><p>异步组件加载期间，可以使用此组件渲染一些额外的内容，增强用户体验。</p>
<h4 id="异步组件"><a href="#异步组件" class="headerlink" title="异步组件"></a>异步组件</h4><pre class="language-js" data-language="js"><code class="language-js"><span class="token operator">&lt;</span>template<span class="token operator">></span>
    <span class="token operator">&lt;</span>div <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"app"</span><span class="token operator">></span>
        App
        <span class="token operator">&lt;</span>Test <span class="token operator">/</span><span class="token operator">></span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span>
<span class="token operator">&lt;</span><span class="token operator">/</span>template<span class="token operator">></span>

<span class="token operator">&lt;</span>script<span class="token operator">></span>
    <span class="token comment">// 静态引入 => 等待所有子组件加载完再统一渲染</span>
    <span class="token comment">// import Test from './Test.vue'</span>
    <span class="token comment">// 动态/异步引入</span>
    <span class="token keyword">import</span> <span class="token punctuation">&#123;</span> defineAsyncComponent <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'vue'</span>
    <span class="token keyword">const</span> Test <span class="token operator">=</span> <span class="token function">defineAsyncComponent</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token string">'./Test.vue'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">&#123;</span>
        <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'App'</span><span class="token punctuation">,</span>
        <span class="token literal-property property">components</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
            Test<span class="token punctuation">,</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
    <span class="token punctuation">&#125;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">></span></code></pre>

<h4 id="优化代码"><a href="#优化代码" class="headerlink" title="优化代码"></a>优化代码</h4><pre class="language-js" data-language="js"><code class="language-js"><span class="token operator">&lt;</span>template<span class="token operator">></span>
    <span class="token operator">&lt;</span>div <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"app"</span><span class="token operator">></span>
        App
        <span class="token operator">&lt;</span>Suspense<span class="token operator">></span>
            <span class="token operator">&lt;</span>template v<span class="token operator">-</span>slot<span class="token operator">:</span><span class="token keyword">default</span><span class="token operator">></span>
                <span class="token operator">&lt;</span>Test <span class="token operator">/</span><span class="token operator">></span>
            <span class="token operator">&lt;</span><span class="token operator">/</span>template<span class="token operator">></span>
            <span class="token operator">&lt;</span>template v<span class="token operator">-</span>slot<span class="token operator">:</span>fallback<span class="token operator">></span>
                <span class="token operator">&lt;</span>div<span class="token operator">></span>loading<span class="token operator">...</span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span>
            <span class="token operator">&lt;</span><span class="token operator">/</span>template<span class="token operator">></span>
        <span class="token operator">&lt;</span><span class="token operator">/</span>Suspense<span class="token operator">></span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span>
<span class="token operator">&lt;</span><span class="token operator">/</span>template<span class="token operator">></span>

<span class="token operator">&lt;</span>script<span class="token operator">></span>
    <span class="token comment">// 静态引入 => 等待所有子组件加载完再统一渲染</span>
    <span class="token comment">// import Test from './Test.vue'</span>
    <span class="token comment">// 动态/异步引入</span>
    <span class="token keyword">import</span> <span class="token punctuation">&#123;</span> defineAsyncComponent <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'vue'</span>
    <span class="token keyword">const</span> Test <span class="token operator">=</span> <span class="token function">defineAsyncComponent</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token string">'./Test.vue'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">&#123;</span>
        <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'App'</span><span class="token punctuation">,</span>
        <span class="token literal-property property">components</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
            Test<span class="token punctuation">,</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
    <span class="token punctuation">&#125;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">></span></code></pre>

<h4 id="一个细节"><a href="#一个细节" class="headerlink" title="一个细节"></a>一个细节</h4><p>setup 也可以返回一个 Promise 实例，但要异步引入此组件并配合 Suspense 使用。</p>
<pre class="language-js" data-language="js"><code class="language-js"><span class="token operator">&lt;</span>template<span class="token operator">></span>
    <span class="token operator">&lt;</span>div <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"test"</span><span class="token operator">></span>Test<span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span>
<span class="token operator">&lt;</span><span class="token operator">/</span>template<span class="token operator">></span>

<span class="token operator">&lt;</span>script<span class="token operator">></span>
    <span class="token keyword">import</span> <span class="token punctuation">&#123;</span> ref <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'vue'</span>
    <span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">&#123;</span>
        <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'Test'</span><span class="token punctuation">,</span>
        <span class="token comment">/* setup() &#123;
            const count = ref(0)
            // 也可以返回 Promise 实例，但要异步引入此组件并配合 Suspense 使用
            return new Promise((resolve, reject) => &#123;
            setTimeout(() => &#123;
                resolve(&#123; count &#125;)
            &#125;, 3000)
            &#125;)
        &#125;, */</span>
        <span class="token keyword">async</span> <span class="token function">setup</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">const</span> count <span class="token operator">=</span> <span class="token function">ref</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
            <span class="token keyword">return</span> <span class="token keyword">await</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
                <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
                    <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span> count <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
                <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token number">3000</span><span class="token punctuation">)</span>
            <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
    <span class="token punctuation">&#125;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">></span></code></pre>

<h2 id="script-setup"><a href="#script-setup" class="headerlink" title="script setup"></a>script setup</h2><p><a href="https://v3.cn.vuejs.org/api/sfc-script-setup.html#%E5%9F%BA%E6%9C%AC%E8%AF%AD%E6%B3%95">文档</a></p>
<h4 id="data"><a href="#data" class="headerlink" title="data"></a>data</h4><pre class="language-js" data-language="js"><code class="language-js"><span class="token operator">&lt;</span>script setup<span class="token operator">></span>
    <span class="token keyword">import</span> <span class="token punctuation">&#123;</span> reactive<span class="token punctuation">,</span> toRefs <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'vue'</span>
    <span class="token keyword">const</span> state <span class="token operator">=</span> <span class="token function">reactive</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
        <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'ifer'</span><span class="token punctuation">,</span>
        <span class="token literal-property property">age</span><span class="token operator">:</span> <span class="token number">18</span><span class="token punctuation">,</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
    <span class="token keyword">const</span> <span class="token punctuation">&#123;</span> name<span class="token punctuation">,</span> age <span class="token punctuation">&#125;</span> <span class="token operator">=</span> <span class="token function">toRefs</span><span class="token punctuation">(</span>state<span class="token punctuation">)</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">></span>
<span class="token operator">&lt;</span>template<span class="token operator">></span>
    <span class="token operator">&lt;</span>h1<span class="token operator">></span>name<span class="token operator">:</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#123;</span> name <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span> age<span class="token operator">:</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#123;</span> age <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token operator">&lt;</span><span class="token operator">/</span>h1<span class="token operator">></span>
<span class="token operator">&lt;</span><span class="token operator">/</span>template<span class="token operator">></span></code></pre>

<h4 id="method"><a href="#method" class="headerlink" title="method"></a>method</h4><pre class="language-js" data-language="js"><code class="language-js"><span class="token operator">&lt;</span>script setup<span class="token operator">></span>
    <span class="token keyword">import</span> <span class="token punctuation">&#123;</span> reactive<span class="token punctuation">,</span> toRefs <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'vue'</span>
    <span class="token keyword">const</span> state <span class="token operator">=</span> <span class="token function">reactive</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
        <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'ifer'</span><span class="token punctuation">,</span>
        <span class="token literal-property property">age</span><span class="token operator">:</span> <span class="token number">18</span><span class="token punctuation">,</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
    <span class="token keyword">const</span> <span class="token punctuation">&#123;</span> name<span class="token punctuation">,</span> age <span class="token punctuation">&#125;</span> <span class="token operator">=</span> <span class="token function">toRefs</span><span class="token punctuation">(</span>state<span class="token punctuation">)</span>

    <span class="token comment">// 修改名字</span>
    <span class="token keyword">const</span> <span class="token function-variable function">changeName</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
        name<span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token string">'xxx'</span>
    <span class="token punctuation">&#125;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">></span>
<span class="token operator">&lt;</span>template<span class="token operator">></span>
    <span class="token operator">&lt;</span>h1<span class="token operator">></span>name<span class="token operator">:</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#123;</span> name <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span> age<span class="token operator">:</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#123;</span> age <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token operator">&lt;</span><span class="token operator">/</span>h1<span class="token operator">></span>
    <span class="token operator">&lt;</span>button @click<span class="token operator">=</span><span class="token string">"changeName"</span><span class="token operator">></span>修改名字<span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">></span>
<span class="token operator">&lt;</span><span class="token operator">/</span>template<span class="token operator">></span></code></pre>

<h4 id="computed-1"><a href="#computed-1" class="headerlink" title="computed"></a>computed</h4><pre class="language-js" data-language="js"><code class="language-js"><span class="token operator">&lt;</span>script setup<span class="token operator">></span>
    <span class="token keyword">import</span> <span class="token punctuation">&#123;</span> reactive<span class="token punctuation">,</span> computed<span class="token punctuation">,</span> isRef <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'vue'</span>
    <span class="token keyword">const</span> state <span class="token operator">=</span> <span class="token function">reactive</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
        <span class="token literal-property property">firstName</span><span class="token operator">:</span> <span class="token string">'热'</span><span class="token punctuation">,</span>
        <span class="token literal-property property">lastName</span><span class="token operator">:</span> <span class="token string">'巴'</span><span class="token punctuation">,</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
    <span class="token keyword">const</span> fullName <span class="token operator">=</span> <span class="token function">computed</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> state<span class="token punctuation">.</span>firstName <span class="token operator">+</span> state<span class="token punctuation">.</span>lastName<span class="token punctuation">)</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">isRef</span><span class="token punctuation">(</span>fullName<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// true</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">></span>
<span class="token operator">&lt;</span>template<span class="token operator">></span>
    <span class="token operator">&lt;</span>h1<span class="token operator">></span>fullName<span class="token operator">:</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#123;</span> fullName <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token operator">&lt;</span><span class="token operator">/</span>h1<span class="token operator">></span>
<span class="token operator">&lt;</span><span class="token operator">/</span>template<span class="token operator">></span></code></pre>

<h4 id="watch-1"><a href="#watch-1" class="headerlink" title="watch"></a>watch</h4><pre class="language-js" data-language="js"><code class="language-js"><span class="token operator">&lt;</span>script setup<span class="token operator">></span>
    <span class="token keyword">import</span> <span class="token punctuation">&#123;</span> ref<span class="token punctuation">,</span> watch <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'vue'</span>
    <span class="token keyword">const</span> count <span class="token operator">=</span> <span class="token function">ref</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
    <span class="token function">watch</span><span class="token punctuation">(</span>count<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">newValue<span class="token punctuation">,</span> oldValue</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>newValue<span class="token punctuation">,</span> oldValue<span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">></span>
<span class="token operator">&lt;</span>template<span class="token operator">></span>
    <span class="token operator">&lt;</span>h1<span class="token operator">></span>count<span class="token operator">:</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#123;</span> count <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token operator">&lt;</span><span class="token operator">/</span>h1<span class="token operator">></span>
    <span class="token operator">&lt;</span>button @click<span class="token operator">=</span><span class="token string">"count++"</span><span class="token operator">></span><span class="token operator">+</span><span class="token number">1</span><span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">></span>
<span class="token operator">&lt;</span><span class="token operator">/</span>template<span class="token operator">></span></code></pre>

<h4 id="props"><a href="#props" class="headerlink" title="props"></a>props</h4><p>父组件</p>
<pre class="language-js" data-language="js"><code class="language-js"><span class="token operator">&lt;</span>script setup<span class="token operator">></span>
    <span class="token keyword">import</span> <span class="token punctuation">&#123;</span> reactive <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'vue'</span>
    <span class="token keyword">import</span> Hello <span class="token keyword">from</span> <span class="token string">'./Hello.vue'</span>
    <span class="token keyword">const</span> person <span class="token operator">=</span> <span class="token function">reactive</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
        <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'ifer'</span><span class="token punctuation">,</span>
        <span class="token literal-property property">age</span><span class="token operator">:</span> <span class="token number">18</span><span class="token punctuation">,</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">></span>
<span class="token operator">&lt;</span>template<span class="token operator">></span>
    <span class="token operator">&lt;</span>Hello v<span class="token operator">-</span>bind<span class="token operator">=</span><span class="token string">"person"</span> <span class="token operator">/</span><span class="token operator">></span>
<span class="token operator">&lt;</span><span class="token operator">/</span>template<span class="token operator">></span></code></pre>

<p>子组件</p>
<pre class="language-js" data-language="js"><code class="language-js"><span class="token operator">&lt;</span>script setup<span class="token operator">></span>
    <span class="token comment">// defineProps 无需引用，可以在 script setup 中直接使用</span>
    <span class="token keyword">const</span> props <span class="token operator">=</span> <span class="token function">defineProps</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
        <span class="token literal-property property">name</span><span class="token operator">:</span> String<span class="token punctuation">,</span>
        <span class="token literal-property property">age</span><span class="token operator">:</span> Number<span class="token punctuation">,</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">></span>
<span class="token operator">&lt;</span>template<span class="token operator">></span>
    <span class="token operator">&lt;</span>div<span class="token operator">></span>name<span class="token operator">:</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#123;</span> props<span class="token punctuation">.</span>name <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span> age<span class="token operator">:</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#123;</span> age <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span>
<span class="token operator">&lt;</span><span class="token operator">/</span>template<span class="token operator">></span></code></pre>

<h4 id="emit"><a href="#emit" class="headerlink" title="emit"></a>emit</h4><p>父组件</p>
<pre class="language-js" data-language="js"><code class="language-js"><span class="token operator">&lt;</span>script setup<span class="token operator">></span>
    <span class="token keyword">import</span> <span class="token punctuation">&#123;</span> reactive <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'vue'</span>
    <span class="token keyword">import</span> Hello <span class="token keyword">from</span> <span class="token string">'./Hello.vue'</span>
    <span class="token keyword">const</span> person <span class="token operator">=</span> <span class="token function">reactive</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
        <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'ifer'</span><span class="token punctuation">,</span>
        <span class="token literal-property property">age</span><span class="token operator">:</span> <span class="token number">18</span><span class="token punctuation">,</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
    <span class="token keyword">const</span> <span class="token function-variable function">updateAge</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
        person<span class="token punctuation">.</span>age<span class="token operator">++</span>
    <span class="token punctuation">&#125;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">></span>
<span class="token operator">&lt;</span>template<span class="token operator">></span>
    <span class="token operator">&lt;</span>Hello v<span class="token operator">-</span>bind<span class="token operator">=</span><span class="token string">"person"</span> @updateAge<span class="token operator">=</span><span class="token string">"updateAge"</span> <span class="token operator">/</span><span class="token operator">></span>
<span class="token operator">&lt;</span><span class="token operator">/</span>template<span class="token operator">></span></code></pre>

<p>子组件</p>
<pre class="language-js" data-language="js"><code class="language-js"><span class="token operator">&lt;</span>script setup<span class="token operator">></span>
    <span class="token comment">// defineProps 无需引用，可以在 script setup 中直接使用</span>
    <span class="token keyword">const</span> props <span class="token operator">=</span> <span class="token function">defineProps</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
        <span class="token literal-property property">name</span><span class="token operator">:</span> String<span class="token punctuation">,</span>
        <span class="token literal-property property">age</span><span class="token operator">:</span> Number<span class="token punctuation">,</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
    <span class="token keyword">const</span> emit <span class="token operator">=</span> <span class="token function">defineEmits</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'updateAge'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

    <span class="token keyword">const</span> <span class="token function-variable function">updateAge</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
        <span class="token function">emit</span><span class="token punctuation">(</span><span class="token string">'updateAge'</span><span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">></span>
<span class="token operator">&lt;</span>template<span class="token operator">></span>
    <span class="token operator">&lt;</span>div<span class="token operator">></span>name<span class="token operator">:</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#123;</span> props<span class="token punctuation">.</span>name <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span> age<span class="token operator">:</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#123;</span> age <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span>
    <span class="token operator">&lt;</span>button @click<span class="token operator">=</span><span class="token string">"emit('updateAge')"</span><span class="token operator">></span>update name<span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">></span>
    <span class="token operator">&lt;</span>button @click<span class="token operator">=</span><span class="token string">"$emit('updateAge')"</span><span class="token operator">></span>update name<span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">></span>
    <span class="token operator">&lt;</span>button @click<span class="token operator">=</span><span class="token string">"updateAge"</span><span class="token operator">></span>update name<span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">></span>
<span class="token operator">&lt;</span><span class="token operator">/</span>template<span class="token operator">></span></code></pre>

<h4 id="v-model-1"><a href="#v-model-1" class="headerlink" title="v-model"></a>v-model</h4><p>父组件</p>
<pre class="language-js" data-language="js"><code class="language-js"><span class="token operator">&lt;</span>script setup<span class="token operator">></span>
    <span class="token keyword">import</span> <span class="token punctuation">&#123;</span> reactive <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'vue'</span>
    <span class="token keyword">import</span> Hello <span class="token keyword">from</span> <span class="token string">'./Hello.vue'</span>
    <span class="token keyword">const</span> person <span class="token operator">=</span> <span class="token function">reactive</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
        <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'ifer'</span><span class="token punctuation">,</span>
        <span class="token literal-property property">age</span><span class="token operator">:</span> <span class="token number">18</span><span class="token punctuation">,</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">></span>
<span class="token operator">&lt;</span>template<span class="token operator">></span>
    <span class="token operator">&lt;</span>Hello v<span class="token operator">-</span>model<span class="token operator">=</span><span class="token string">"person.name"</span> v<span class="token operator">-</span>model<span class="token operator">:</span>age<span class="token operator">=</span><span class="token string">"person.age"</span> <span class="token operator">/</span><span class="token operator">></span>
<span class="token operator">&lt;</span><span class="token operator">/</span>template<span class="token operator">></span></code></pre>

<p>子组件</p>
<pre class="language-js" data-language="js"><code class="language-js"><span class="token operator">&lt;</span>script setup<span class="token operator">></span>
    <span class="token comment">// defineProps 无需引用，可以在 script setup 中直接使用</span>
    <span class="token keyword">const</span> props <span class="token operator">=</span> <span class="token function">defineProps</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
        <span class="token literal-property property">modelValue</span><span class="token operator">:</span> String<span class="token punctuation">,</span>
        <span class="token literal-property property">age</span><span class="token operator">:</span> Number<span class="token punctuation">,</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
    <span class="token keyword">const</span> emit <span class="token operator">=</span> <span class="token function">defineEmits</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'update:modelValue'</span><span class="token punctuation">,</span> <span class="token string">'update:age'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

    <span class="token keyword">const</span> <span class="token function-variable function">updateName</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
        <span class="token function">emit</span><span class="token punctuation">(</span><span class="token string">'update:modelValue'</span><span class="token punctuation">,</span> <span class="token string">'xxx'</span><span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span>
    <span class="token keyword">const</span> <span class="token function-variable function">updateAge</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
        <span class="token function">emit</span><span class="token punctuation">(</span><span class="token string">'update:age'</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">></span>
<span class="token operator">&lt;</span>template<span class="token operator">></span>
    <span class="token operator">&lt;</span>div<span class="token operator">></span>name<span class="token operator">:</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#123;</span> props<span class="token punctuation">.</span>modelValue <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span> age<span class="token operator">:</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#123;</span> age <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span>
    <span class="token operator">&lt;</span>button @click<span class="token operator">=</span><span class="token string">"updateName"</span><span class="token operator">></span>update name<span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">></span>
    <span class="token operator">&lt;</span>button @click<span class="token operator">=</span><span class="token string">"updateAge"</span><span class="token operator">></span>update age<span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">></span>
<span class="token operator">&lt;</span><span class="token operator">/</span>template<span class="token operator">></span></code></pre>

<h4 id="defineExpose"><a href="#defineExpose" class="headerlink" title="defineExpose"></a>defineExpose</h4><ul>
<li>标准组件写法中，父组件通过 ref 拿到子组件实例，并可以直接访问子组件中的 data 和 method。</li>
<li>script-setup 模式下，data 和 method 默认只能给当前组件的 template 使用，外界通过 ref 无法访问到。</li>
<li>解决：需要手动的通过 defineExpose 进行暴露。</li>
</ul>
<p>父组件</p>
<pre class="language-js" data-language="js"><code class="language-js"><span class="token operator">&lt;</span>script setup<span class="token operator">></span>
    <span class="token keyword">import</span> <span class="token punctuation">&#123;</span> ref<span class="token punctuation">,</span> nextTick <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'vue'</span>
    <span class="token keyword">import</span> Hello <span class="token keyword">from</span> <span class="token string">'./Hello.vue'</span>
    <span class="token keyword">const</span> childRef <span class="token operator">=</span> <span class="token function">ref</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span>
    <span class="token function">nextTick</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
        childRef<span class="token punctuation">.</span>value<span class="token punctuation">.</span><span class="token function">updatePerson</span><span class="token punctuation">(</span><span class="token string">'xxx'</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">></span>
<span class="token operator">&lt;</span>template<span class="token operator">></span>
    <span class="token operator">&lt;</span>Hello ref<span class="token operator">=</span><span class="token string">"childRef"</span> <span class="token operator">/</span><span class="token operator">></span>
<span class="token operator">&lt;</span><span class="token operator">/</span>template<span class="token operator">></span></code></pre>

<p>子组件</p>
<pre class="language-js" data-language="js"><code class="language-js"><span class="token operator">&lt;</span>script setup<span class="token operator">></span>
    <span class="token keyword">import</span> <span class="token punctuation">&#123;</span> reactive <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'vue'</span>
    <span class="token keyword">const</span> person <span class="token operator">=</span> <span class="token function">reactive</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
        <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'ifer'</span><span class="token punctuation">,</span>
        <span class="token literal-property property">age</span><span class="token operator">:</span> <span class="token number">18</span><span class="token punctuation">,</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
    <span class="token keyword">const</span> <span class="token function-variable function">updatePerson</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">name<span class="token punctuation">,</span> age</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
        person<span class="token punctuation">.</span>name <span class="token operator">=</span> name
        person<span class="token punctuation">.</span>age <span class="token operator">=</span> age
    <span class="token punctuation">&#125;</span>
    <span class="token comment">// 注意是 defineExpose，不要打成 defineProps 了</span>
    <span class="token function">defineExpose</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
        updatePerson<span class="token punctuation">,</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">></span>
<span class="token operator">&lt;</span>template<span class="token operator">></span>
    <span class="token operator">&lt;</span>h2<span class="token operator">></span>name<span class="token operator">:</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#123;</span> person<span class="token punctuation">.</span>name <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span> age<span class="token operator">:</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#123;</span> person<span class="token punctuation">.</span>age <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token operator">&lt;</span><span class="token operator">/</span>h2<span class="token operator">></span>
<span class="token operator">&lt;</span><span class="token operator">/</span>template<span class="token operator">></span></code></pre>

<h4 id="slot"><a href="#slot" class="headerlink" title="slot"></a>slot</h4><p>父组件</p>
<pre class="language-js" data-language="js"><code class="language-js"><span class="token operator">&lt;</span>script setup<span class="token operator">></span>
    <span class="token keyword">import</span> Hello <span class="token keyword">from</span> <span class="token string">'./Hello.vue'</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">></span>
<span class="token operator">&lt;</span>template<span class="token operator">></span>
    <span class="token operator">&lt;</span>Hello<span class="token operator">></span>
        <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 默认插槽 <span class="token operator">--</span><span class="token operator">></span>
        <span class="token operator">&lt;</span>h2<span class="token operator">></span>默认插槽<span class="token operator">&lt;</span><span class="token operator">/</span>h2<span class="token operator">></span>
        <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 具名插槽 <span class="token operator">--</span><span class="token operator">></span>
        <span class="token operator">&lt;</span>template #title<span class="token operator">></span>
            <span class="token operator">&lt;</span>h2<span class="token operator">></span>具名插槽<span class="token operator">&lt;</span><span class="token operator">/</span>h2<span class="token operator">></span>
        <span class="token operator">&lt;</span><span class="token operator">/</span>template<span class="token operator">></span>
        <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 作用域插槽 <span class="token operator">--</span><span class="token operator">></span>
        <span class="token operator">&lt;</span>template #footer<span class="token operator">=</span><span class="token string">"&#123; person &#125;"</span><span class="token operator">></span>
            <span class="token operator">&lt;</span>h2<span class="token operator">></span>通过作用域插槽获取到的数据：<span class="token punctuation">&#123;</span><span class="token punctuation">&#123;</span> person<span class="token punctuation">.</span>name <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token operator">&lt;</span><span class="token operator">/</span>h2<span class="token operator">></span>
        <span class="token operator">&lt;</span><span class="token operator">/</span>template<span class="token operator">></span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>Hello<span class="token operator">></span>
<span class="token operator">&lt;</span><span class="token operator">/</span>template<span class="token operator">></span></code></pre>

<p>子组件</p>
<pre class="language-js" data-language="js"><code class="language-js"><span class="token operator">&lt;</span>script setup<span class="token operator">></span>
    <span class="token keyword">import</span> <span class="token punctuation">&#123;</span> reactive<span class="token punctuation">,</span> useSlots <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'vue'</span>
    <span class="token keyword">const</span> slots <span class="token operator">=</span> <span class="token function">useSlots</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">const</span> person <span class="token operator">=</span> <span class="token function">reactive</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
        <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'ifer'</span><span class="token punctuation">,</span>
        <span class="token literal-property property">age</span><span class="token operator">:</span> <span class="token number">18</span><span class="token punctuation">,</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
    <span class="token comment">// 可以拿到插槽相关的信息</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>slots<span class="token punctuation">)</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">></span>
<span class="token operator">&lt;</span>template<span class="token operator">></span>
    <span class="token operator">&lt;</span>slot <span class="token operator">/</span><span class="token operator">></span>
    <span class="token operator">&lt;</span>slot name<span class="token operator">=</span><span class="token string">"title"</span> <span class="token operator">/</span><span class="token operator">></span>
    <span class="token operator">&lt;</span>slot name<span class="token operator">=</span><span class="token string">"footer"</span> <span class="token operator">:</span>person<span class="token operator">=</span><span class="token string">"person"</span> <span class="token operator">/</span><span class="token operator">></span>
<span class="token operator">&lt;</span><span class="token operator">/</span>template<span class="token operator">></span></code></pre>

<h4 id="CSS-变量注入"><a href="#CSS-变量注入" class="headerlink" title="CSS 变量注入"></a>CSS 变量注入</h4><pre class="language-js" data-language="js"><code class="language-js"><span class="token operator">&lt;</span>script setup<span class="token operator">></span>
    <span class="token keyword">import</span> <span class="token punctuation">&#123;</span> reactive <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'vue'</span>
    <span class="token keyword">const</span> state <span class="token operator">=</span> <span class="token function">reactive</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
        <span class="token literal-property property">color</span><span class="token operator">:</span> <span class="token string">'pink'</span><span class="token punctuation">,</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">></span>
<span class="token operator">&lt;</span>template<span class="token operator">></span>
    <span class="token operator">&lt;</span>h2<span class="token operator">></span>Hello Vue3<span class="token operator">&lt;</span><span class="token operator">/</span>h2<span class="token operator">></span>
<span class="token operator">&lt;</span><span class="token operator">/</span>template<span class="token operator">></span>
<span class="token operator">&lt;</span>style scoped<span class="token operator">></span>
    h2 <span class="token punctuation">&#123;</span>
        <span class="token comment">/* 可以使用 v-bind 绑定变量 */</span>
        <span class="token literal-property property">color</span><span class="token operator">:</span> v<span class="token operator">-</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token string">'state.color'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>style<span class="token operator">></span></code></pre>

<h4 id="原型绑定与组件使用"><a href="#原型绑定与组件使用" class="headerlink" title="原型绑定与组件使用"></a>原型绑定与组件使用</h4><p><code>main.js</code></p>
<pre class="language-js" data-language="js"><code class="language-js"><span class="token keyword">import</span> <span class="token punctuation">&#123;</span> createApp <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'vue'</span>
<span class="token keyword">import</span> App <span class="token keyword">from</span> <span class="token string">'./App.vue'</span>
<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token function">createApp</span><span class="token punctuation">(</span>App<span class="token punctuation">)</span>
app<span class="token punctuation">.</span>config<span class="token punctuation">.</span>globalProperties<span class="token punctuation">.</span>year <span class="token operator">=</span> <span class="token string">'再见 2021，你好 2022~~'</span>
app<span class="token punctuation">.</span><span class="token function">mount</span><span class="token punctuation">(</span><span class="token string">'#app'</span><span class="token punctuation">)</span></code></pre>

<p><code>App.vue</code></p>
<pre class="language-js" data-language="js"><code class="language-js"><span class="token operator">&lt;</span>script setup<span class="token operator">></span>
    <span class="token keyword">import</span> <span class="token punctuation">&#123;</span> getCurrentInstance <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'vue'</span>
    <span class="token keyword">const</span> <span class="token punctuation">&#123;</span> proxy <span class="token punctuation">&#125;</span> <span class="token operator">=</span> <span class="token function">getCurrentInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">></span>
<span class="token operator">&lt;</span>template<span class="token operator">></span>
    <span class="token operator">&lt;</span>h1<span class="token operator">></span><span class="token punctuation">&#123;</span><span class="token punctuation">&#123;</span> proxy<span class="token punctuation">.</span>year <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token operator">&lt;</span><span class="token operator">/</span>h1<span class="token operator">></span>
<span class="token operator">&lt;</span><span class="token operator">/</span>template<span class="token operator">></span></code></pre>

<h4 id="对-await-支持"><a href="#对-await-支持" class="headerlink" title="对 await 支持"></a>对 await 支持</h4><pre class="language-js" data-language="js"><code class="language-js"><span class="token operator">&lt;</span>script setup<span class="token operator">></span>
    <span class="token keyword">const</span> r <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">'https://autumnfish.cn/api/joke'</span><span class="token punctuation">)</span>
    <span class="token keyword">const</span> d <span class="token operator">=</span> <span class="token keyword">await</span> r<span class="token punctuation">.</span><span class="token function">text</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>d<span class="token punctuation">)</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">></span>
<span class="token operator">&lt;</span>template<span class="token operator">></span>
    <span class="token operator">&lt;</span>h1<span class="token operator">></span><span class="token punctuation">&#123;</span><span class="token punctuation">&#123;</span> proxy<span class="token punctuation">.</span>year <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token operator">&lt;</span><span class="token operator">/</span>h1<span class="token operator">></span>
<span class="token operator">&lt;</span><span class="token operator">/</span>template<span class="token operator">></span></code></pre>

<h4 id="定义组件的-name"><a href="#定义组件的-name" class="headerlink" title="定义组件的 name"></a>定义组件的 name</h4><pre class="language-js" data-language="js"><code class="language-js"><span class="token operator">&lt;</span>template<span class="token operator">></span>
    <span class="token operator">&lt;</span>div<span class="token operator">></span>Hello<span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span>
<span class="token operator">&lt;</span><span class="token operator">/</span>template<span class="token operator">></span>
<span class="token operator">&lt;</span>script setup<span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">></span>

<span class="token operator">&lt;</span>script<span class="token operator">></span>
    <span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">&#123;</span>
        <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'HelloCmp'</span><span class="token punctuation">,</span>
    <span class="token punctuation">&#125;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">></span></code></pre>

<h4 id="mixins"><a href="#mixins" class="headerlink" title="mixins"></a>mixins</h4><p>混入 (mixin) 提供了一种非常灵活的方式，来分发 Vue 组件中的可复用功能，一个混入对象可以包含任意组件选项，当组件使用混入对象时，所有混入对象的选项将被“混合”进该组件本身。</p>
<pre class="language-js" data-language="js"><code class="language-js"><span class="token comment">// Vue2 写法</span>
Vue<span class="token punctuation">.</span><span class="token function">mixin</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span></code></pre>

<pre class="language-js" data-language="js"><code class="language-js"><span class="token comment">// Vue3 写法</span>
app<span class="token punctuation">.</span><span class="token function">mixin</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span></code></pre>

<p><code>follow.js</code></p>
<pre class="language-js" data-language="js"><code class="language-js"><span class="token keyword">export</span> <span class="token keyword">const</span> follow <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
    <span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> <span class="token punctuation">&#123;</span>
            <span class="token literal-property property">loading</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
    <span class="token literal-property property">methods</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
        <span class="token function">followFn</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>loading <span class="token operator">=</span> <span class="token boolean">true</span>
            <span class="token comment">// 模拟请求</span>
            <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
                <span class="token comment">// 省略请求代码</span>
                <span class="token keyword">this</span><span class="token punctuation">.</span>loading <span class="token operator">=</span> <span class="token boolean">false</span>
            <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token number">2000</span><span class="token punctuation">)</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
<span class="token punctuation">&#125;</span></code></pre>

<p><code>App.vue</code></p>
<pre class="language-js" data-language="js"><code class="language-js"><span class="token operator">&lt;</span>template<span class="token operator">></span>
    <span class="token operator">&lt;</span>a href<span class="token operator">=</span><span class="token string">"javascript:;"</span> @click<span class="token operator">=</span><span class="token string">"followFn"</span><span class="token operator">></span><span class="token punctuation">&#123;</span><span class="token punctuation">&#123;</span> loading <span class="token operator">?</span> <span class="token string">'请求中...'</span> <span class="token operator">:</span> <span class="token string">'关注'</span> <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token operator">&lt;</span><span class="token operator">/</span>a<span class="token operator">></span>
    <span class="token operator">&lt;</span>Son <span class="token operator">/</span><span class="token operator">></span>
<span class="token operator">&lt;</span><span class="token operator">/</span>template<span class="token operator">></span>
<span class="token operator">&lt;</span>script<span class="token operator">></span>
    <span class="token keyword">import</span> Son <span class="token keyword">from</span> <span class="token string">'./Son.vue'</span>
    <span class="token keyword">import</span> <span class="token punctuation">&#123;</span> follow <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'./follow'</span>
    <span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">&#123;</span>
        <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'App'</span><span class="token punctuation">,</span>
        <span class="token literal-property property">components</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
            Son<span class="token punctuation">,</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
        <span class="token literal-property property">mixins</span><span class="token operator">:</span> <span class="token punctuation">[</span>follow<span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">&#125;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">></span></code></pre>

<p><code>Son.vue</code></p>
<pre class="language-js" data-language="js"><code class="language-js"><span class="token operator">&lt;</span>template<span class="token operator">></span>
    <span class="token operator">&lt;</span>a href<span class="token operator">=</span><span class="token string">"javascript:;"</span> @click<span class="token operator">=</span><span class="token string">"followFn"</span><span class="token operator">></span><span class="token punctuation">&#123;</span><span class="token punctuation">&#123;</span> loading <span class="token operator">?</span> <span class="token string">'请求中...'</span> <span class="token operator">:</span> <span class="token string">'关注'</span> <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token operator">&lt;</span><span class="token operator">/</span>a<span class="token operator">></span>
<span class="token operator">&lt;</span><span class="token operator">/</span>template<span class="token operator">></span>
<span class="token operator">&lt;</span>script<span class="token operator">></span>
    <span class="token keyword">import</span> <span class="token punctuation">&#123;</span> follow <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'./follow'</span>
    <span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">&#123;</span>
        <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'Son'</span><span class="token punctuation">,</span>
        <span class="token literal-property property">mixins</span><span class="token operator">:</span> <span class="token punctuation">[</span>follow<span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">&#125;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">></span></code></pre>

<h2 id="其他变更"><a href="#其他变更" class="headerlink" title="其他变更"></a>其他变更</h2><p><a href="https://v3.cn.vuejs.org/guide/migration/introduction.html#%E6%A6%82%E8%A7%88">参考 Vue3 迁移指南</a></p>
<ol>
<li>全局 API 的变更，<a href="https://v3.cn.vuejs.org/guide/migration/introduction.html#%E5%85%A8%E5%B1%80-api">链接</a>。</li>
<li>data 只能是函数，<a href="https://v3.cn.vuejs.org/guide/migration/data-option.html#%E6%A6%82%E8%A7%88">链接</a>。</li>
<li>自定义指令 API 和组件保持一致，<a href="https://v3.cn.vuejs.org/guide/migration/custom-directives.html#_2-x-%E8%AF%AD%E6%B3%95">链接</a>。</li>
<li>keyCode 作为 v-on 修饰符被移除、移除 v-on.native 修饰符、filters 被移除，<a href="https://v3.cn.vuejs.org/guide/migration/introduction.html#%E7%A7%BB%E9%99%A4-api">链接</a>。</li>
<li>$on、$off、$once 被移除，<a href="https://v3.cn.vuejs.org/guide/migration/events-api.html#%E6%A6%82%E8%A7%88">链接</a>。</li>
<li>过渡类名的更改，<a href="https://v3.cn.vuejs.org/guide/migration/transition.html#%E6%A6%82%E8%A7%88">链接</a>。</li>
<li>…</li>
</ol>
]]></content>
      <categories>
        <category>Vue.js</category>
      </categories>
      <tags>
        <tag>前端</tag>
        <tag>Vue</tag>
      </tags>
  </entry>
  <entry>
    <title>浅谈React性能优化方案</title>
    <url>/2020/08/10/200810.html</url>
    <content><![CDATA[<h1 id="浅谈React性能优化方案"><a href="#浅谈React性能优化方案" class="headerlink" title="浅谈React性能优化方案"></a>浅谈React性能优化方案</h1><blockquote>
<p> 前言: 性能优化一直是大家比较关注的问题，开发React项目中，也会遇到一些可以优化的点，结合网上学习看到的，加上自己的一个总结，谈谈React中的性能优化</p>
</blockquote>
<h2 id="React-diff算法机制"><a href="#React-diff算法机制" class="headerlink" title="React diff算法机制"></a>React diff算法机制</h2><p>React 凭借 <strong>virtual DOM</strong> 和 <strong>diff</strong> 算法拥有高效的性能，但在某些情况下，性能明显可以进一步提高</p>
<p>在类组件中通过调用 <strong>setState</strong> 方法，就会导致 render，父组件一旦发生render 渲染，子组件一定也会执行 render渲染 </p>
<p>当我们想要更新一个子组件的时候，如下图绿色部分</p>
<img src="https://s1.ax1x.com/2022/03/12/bThYse.png"/>

<p>理想状态只调用该路径下的组件 render：</p>
<img src="https://s1.ax1x.com/2022/03/12/bThJMD.png">

<p>但是react 的默认做法是调用所有组件的render，再对生成的虚拟DOM进行对比(黄色部分) ，如不变则不进行更新</p>
<img src="https://s1.ax1x.com/2022/03/12/bTh8xO.png"/>

<h2 id="怎么降低diff，提高性能"><a href="#怎么降低diff，提高性能" class="headerlink" title="怎么降低diff，提高性能"></a>怎么降低diff，提高性能</h2><p>在 React 要如何避免不必要的render，我们了解到如何避免不必要的render 来应付上面的问题，主要手段是通过 <code>shouldComponentUpdate</code>、<code>PureComponent</code>、<code>React.memo</code>，这三种形式这里就不再复述</p>
<p>除此之外，常见性能优化常见的手段有如下：</p>
<ul>
<li>避免使用内联函数</li>
<li>使用 React Fragments 避免额外标记</li>
<li>使用 Immutable</li>
<li>懒加载组件</li>
<li>事件绑定方式</li>
<li>服务端渲染</li>
</ul>
<h3 id="避免使用内联函数"><a href="#避免使用内联函数" class="headerlink" title="避免使用内联函数"></a>避免使用内联函数</h3><p>如果我们使用内联函数，则每次调用 render 函数时都会创建一个新的函数实例，如下：</p>
<pre class="language-js" data-language="js"><code class="language-js"><span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">"react"</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">InlineFunctionComponent</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span> <span class="token punctuation">&#123;</span>
    <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span><span class="token punctuation">(</span>
        <span class="token operator">&lt;</span>div<span class="token operator">></span>
         <span class="token operator">&lt;</span>h1<span class="token operator">></span>Welcome Guest<span class="token operator">&lt;</span><span class="token operator">/</span>h1<span class="token operator">></span>
         <span class="token operator">&lt;</span>input type<span class="token operator">=</span><span class="token string">"button"</span> onClick<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span><span class="token operator">=></span><span class="token punctuation">&#123;</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span><span class="token literal-property property">inputValue</span><span class="token operator">:</span>e<span class="token punctuation">.</span>target<span class="token punctuation">.</span>value<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span> value<span class="token operator">=</span><span class="token string">"Click For Inline Function"</span> <span class="token operator">/</span><span class="token operator">></span>
         <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span>
        <span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span></code></pre>

<p>我们应该在组件内部创建一个函数，并将事件绑定到该函数本身，这样每次调用 render 时就不会创建单独的函数实例，如下：</p>
<pre class="language-tsx" data-language="tsx"><code class="language-tsx"><span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">"react"</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">InlineFunctionComponent</span> <span class="token keyword">extends</span> <span class="token class-name">React</span><span class="token punctuation">.</span>Component <span class="token punctuation">&#123;</span>
    setNewStateData <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
        inputValue<span class="token operator">:</span>e<span class="token punctuation">.</span>target<span class="token punctuation">.</span>value
    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span>

<span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span><span class="token plain-text">
</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">></span></span><span class="token plain-text">Welcome Guest</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">></span></span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>button<span class="token punctuation">"</span></span> <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">&#123;</span><span class="token keyword">this</span><span class="token punctuation">.</span>setNewStateData<span class="token punctuation">&#125;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Click For Inline Function<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span><span class="token plain-text">  
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
    <span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span></code></pre>

<p>使用 React Fragments 避免额外标记</p>
<p>用户创建新组件时，每个组件应具有单个父标签。父级不能有两个标签，所以顶部要有一个公共标签，所以我们经常在组件顶部添加额外标签 <code>div</code></p>
<p>这个额外标签除了充当父标签之外，并没有其他作用，这时候则可以使用 Fragement</p>
<p>其不会向组件引入任何额外标记，但它可以作为父级标签的作用，如下所示：</p>
<pre class="language-js" data-language="js"><code class="language-js"><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">NestedRoutingComponent</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span> <span class="token punctuation">&#123;</span>
    <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> <span class="token punctuation">(</span>
        <span class="token operator">&lt;</span><span class="token operator">></span>
        <span class="token operator">&lt;</span>h1<span class="token operator">></span> This is the Header Component<span class="token operator">&lt;</span><span class="token operator">/</span>h1<span class="token operator">></span>
        <span class="token operator">&lt;</span>h2<span class="token operator">></span>Welcome To Demo Page<span class="token operator">&lt;</span><span class="token operator">/</span>h2<span class="token operator">></span>
        <span class="token operator">&lt;</span><span class="token operator">/</span><span class="token operator">></span>
        <span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span></code></pre>

<h3 id="事件绑定方式"><a href="#事件绑定方式" class="headerlink" title="事件绑定方式"></a>事件绑定方式</h3><p>在事件绑定方式中，我们了解到四种事件绑定的方式</p>
<p>从性能方面考虑，在render方法中使用bind 和 render 方法中使用箭头函数这两种形式在每次组件render 的时候都会生成新的方法实例，性能欠缺</p>
<p>而constructor中bind事件与定义阶段使用箭头函数绑定这两种形式只会生成一个方法实例，性能发方面会有所改善</p>
<h3 id="使用Immutable"><a href="#使用Immutable" class="headerlink" title="使用Immutable"></a>使用Immutable</h3><p>在理解Immutable中，我们了解到使用Immutable可以给React应用带来性能的优化，主要体现在减少渲染的次数</p>
<p>在做react性能优化的时候，为了避免重复渲染，我们会在shouldComponentUpdate()中做，当返回true执行render方法Immutable通过is方法则可以完成对比，而无需通过深度比较的方式比较</p>
<h3 id="懒加载组件"><a href="#懒加载组件" class="headerlink" title="懒加载组件"></a>懒加载组件</h3><p>从工程方面考虑，webpack存在代码拆分能力，可以为应用创建多个包，并在运行时，动态加载，减少初始包的大小</p>
<p>而在react中使用到了Suspense和lazy组件实现代码拆分功能，基本使用如下：</p>
<pre class="language-tsx" data-language="tsx"><code class="language-tsx"><span class="token keyword">const</span> johanComponent <span class="token operator">=</span> React<span class="token punctuation">.</span><span class="token function">lazy</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=></span><span class="token keyword">import</span><span class="token punctuation">(</span><span class="token string">'./myAwesome.component'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">johanAsyncComponent</span> <span class="token operator">=</span> props <span class="token operator">=></span> <span class="token punctuation">(</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">React.Suspense</span></span> <span class="token attr-name">fallback</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">&#123;</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Spinner</span></span><span class="token punctuation">/></span></span><span class="token punctuation">&#125;</span></span><span class="token punctuation">></span></span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>johanComponent</span> <span class="token spread"><span class="token punctuation">&#123;</span><span class="token operator">...</span>props<span class="token punctuation">&#125;</span></span> <span class="token punctuation">/></span></span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">React.Suspense</span></span><span class="token punctuation">></span></span>
<span class="token punctuation">)</span></code></pre>

<p>服务端渲染</p>
<p>采用服务端渲染方式，可以使用户更快的看到渲染完成的页面</p>
<p>服务端渲染，需要起一个node服务，可以使用express、koa等，调用react的renderToString方法，将根组件渲染成字符串，再输出到响应中</p>
<p>例如：</p>
<pre class="language-tsx" data-language="tsx"><code class="language-tsx"><span class="token keyword">import</span> <span class="token punctuation">&#123;</span>renderToString<span class="token punctuation">&#125;</span> form <span class="token string">'react-dom/sever'</span>
<span class="token keyword">import</span> MyPage <span class="token keyword">from</span> <span class="token string">'./MyPage'</span>
app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"/"</span><span class="token punctuation">,</span><span class="token punctuation">(</span>req<span class="token punctuation">,</span>res<span class="token punctuation">)</span><span class="token operator">=></span><span class="token punctuation">&#123;</span>
    res<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token string">"&lt;!DOCTYPE html>&lt;html>&lt;head>&lt;title>My Page&lt;/title>&lt;/head>&lt;body>"</span><span class="token punctuation">)</span>
    res<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token string">"&lt;div id='content>"</span><span class="token punctuation">)</span>
    res<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token function">renderToString</span><span class="token punctuation">(</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">MyPage</span></span><span class="token punctuation">/></span></span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    res<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token string">'&lt;div/>&lt;body>&lt;/html>'</span><span class="token punctuation">)</span>
    res<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span></code></pre>

<p>客户端使用render方法来生成HTML</p>
<pre class="language-js" data-language="js"><code class="language-js"><span class="token keyword">import</span> ReactDOM <span class="token keyword">from</span> <span class="token string">'react-dom'</span>
<span class="token keyword">import</span> MyPage <span class="token keyword">from</span> <span class="token string">'./MyPage'</span>
ReactDOM<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token operator">&lt;</span>MyPage<span class="token operator">/</span><span class="token operator">></span><span class="token punctuation">,</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'app'</span><span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre>

<h3 id="其他"><a href="#其他" class="headerlink" title="其他"></a>其他</h3><p>除此之外，还存在的优化手段有组件拆分、合理使用<code>hooks</code>等性能优化手段…</p>
<h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><p>通过上面初步学习，我们了解到<code>react</code>常见的性能优化可以分成三个层面：</p>
<ul>
<li>代码层面</li>
<li>工程层面</li>
<li>框架机制层面</li>
</ul>
<p>通过这三个层面的优化结合，能够使基于<code>react</code>项目的性能更上一层楼</p>
]]></content>
      <categories>
        <category>React</category>
      </categories>
      <tags>
        <tag>性能优化</tag>
      </tags>
  </entry>
  <entry>
    <title>了解XSS和CSRF攻击</title>
    <url>/2021/08/26/210826.html</url>
    <content><![CDATA[<h1 id="了解XSS和CSRF攻击"><a href="#了解XSS和CSRF攻击" class="headerlink" title="了解XSS和CSRF攻击"></a>了解XSS和CSRF攻击</h1><h2 id="XSS-和-CSRF-介绍"><a href="#XSS-和-CSRF-介绍" class="headerlink" title="XSS 和 CSRF 介绍"></a>XSS 和 CSRF 介绍</h2><p>在 Web 安全领域中，XSS 和 CSRF 是最常见的攻击方式。那么本文就带你认识一下 XSS 和 CSRF 的攻防问题。</p>
<h3 id="XSS"><a href="#XSS" class="headerlink" title="XSS"></a>XSS</h3><h4 id="概念："><a href="#概念：" class="headerlink" title="概念："></a>概念：</h4><p>XSS , 全称：<code>Cross Site Scripting</code> ，译为<strong>跨域脚本攻击</strong>。</p>
<h4 id="原理："><a href="#原理：" class="headerlink" title="原理："></a>原理：</h4><p>不需要你做任何的登录验证，它会通过合法的操作 (比如在<code>url</code>中输入、在评论框中输入)，向用户的页面注入脚本 (可能是 <code>js</code>、<code>html</code>代码块等)。</p>
<h4 id="防范："><a href="#防范：" class="headerlink" title="防范："></a>防范：</h4><p>1.编码：对于用户输入进行编码。</p>
<p>2.过滤：移除用户输入和事件相关的属性。(过滤 <code>script</code>、<code>style</code>、<code>iframe</code>等节点)</p>
<p>3.校正：使用<code>DOM Parse</code>转换，校正不配对的 <code>DOM</code>标签。</p>
<p>4.使用 <code>HttpOnly</code>。</p>
<h4 id="分类："><a href="#分类：" class="headerlink" title="分类："></a>分类：</h4><ul>
<li>反射性 (非持久)：点击链接，执行脚本</li>
<li>存储型 (持久)：恶意输入保存数据库，其他用户访问，执行脚本</li>
<li>基于 <code>DOM</code>：而已修改 <code>DOM</code> 结构，基于客户端</li>
</ul>
<h3 id="CSRF-攻击"><a href="#CSRF-攻击" class="headerlink" title="CSRF 攻击"></a>CSRF 攻击</h3><h4 id="概念：-1"><a href="#概念：-1" class="headerlink" title="概念："></a>概念：</h4><p>CSRF , 全称：<code>Cross-site request forgery</code> ，译为<strong>跨站请求伪造</strong>。</p>
<h4 id="原理：-1"><a href="#原理：-1" class="headerlink" title="原理："></a>原理：</h4><ol>
<li><p>登录受信任的网站 A ，并在本地生成  <code>Cookie</code>。(如果用户没有登录网站 A,那么网站 B 在诱导的时候，请求网站 A 的 <code>api</code> 接口时，会提示你登录)。</p>
</li>
<li><p>在不登出 A  的情况下，访问危险网站 B (其实是利用了 网站 A 的漏洞)。</p>
</li>
</ol>
<h4 id="防范：-1"><a href="#防范：-1" class="headerlink" title="防范："></a>防范：</h4><ol>
<li><code>token</code> 验证；</li>
<li>隐藏令牌，把 <code>token</code>隐藏在 <code>http</code> 请求的 <code>head</code> 中。</li>
<li><code>referer</code> 验证，验证页面来源。</li>
</ol>
<h3 id="两者区别"><a href="#两者区别" class="headerlink" title="两者区别"></a>两者区别</h3><ol>
<li>CSRF：需要用户先登录网站 A ，获取 <code>cookie</code>。XSS：不需要登录而是通过注入脚本等方式。</li>
<li>CSRF：是利用网站 A 本身的漏洞，去请求网站 A 的 <code>api</code>。XSS:是向网站 A 注入 <code>JS</code>代码，然后执行 <code>JS</code>里的代码，篡改网站 A 的内容。</li>
</ol>
]]></content>
      <categories>
        <category>网络攻击</category>
      </categories>
      <tags>
        <tag>浏览器</tag>
        <tag>网络安全</tag>
      </tags>
  </entry>
  <entry>
    <title>关于webpack loader</title>
    <url>/2020/07/24/468.html</url>
    <content><![CDATA[<h2 id="关于webpack-loader"><a href="#关于webpack-loader" class="headerlink" title="关于webpack loader"></a>关于webpack loader</h2><p>Loader 是支持链式执行的，如处理 sass 文件的 loader，可以由 <code>sass-loader、css-loader、style-loader</code> 组成，由 <code>compiler</code> 对其<strong>由右向左或者从下向上执行</strong>，第一个 Loader 将会拿到需处理的原内容，上一个 Loader 处理后的结果回传给下一个接着处理，最后的 Loader 将处理后的结果以 String 或 Buffer 的形式返回给 compiler。</p>
<pre class="language-js" data-language="js"><code class="language-js"><span class="token punctuation">&#123;</span>
  <span class="token literal-property property">test</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.js</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
  <span class="token literal-property property">use</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token string">'bar-loader'</span><span class="token punctuation">,</span>
    <span class="token string">'foo-loader'</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">&#125;</span></code></pre>

<h2 id="无状态-Stateless"><a href="#无状态-Stateless" class="headerlink" title="无状态(Stateless)"></a>无状态(Stateless)</h2><p>虽然<code>loader</code>支持链式调用，但是请确保 loader 在不同模块转换之间不保存状态。每次运行都应该独立于其他编译模块以及相同模块之前的编译结果。</p>
<h2 id="编写一个-loader"><a href="#编写一个-loader" class="headerlink" title="编写一个 loader"></a>编写一个 loader</h2><p>loader 是导出为一个函数的 node 模块。该函数在 loader 转换资源的时候调用。给定的函数将调用 loader API，并通过<code> this</code> 上下文访问。那我们便可以这样来定义一下最基本的loader:</p>
<pre class="language-js" data-language="js"><code class="language-js"><span class="token comment">// 当一个 loader 在资源中使用，这个 loader 只能传入一个参数 - 这个参数是一个包含包含资源文件内容的字符串</span>
module<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">source</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">return</span> source<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span></code></pre>

<p>上面使用返回 return 返回，是因为是同步类的 Loader 且返回的内容唯一，如果你希望将处理后的结果（不止一个）返回给下一个 Loader，那么就需要调用 Webpack 所提供的 API。 一般来说，构建系统都会提供一些特有的 API 供开发者使用。Webpack 也如此，提供了一套 Loader API，可以通过在<code>node module</code>中使用 this 来调用，如<code> this.callback(err, value…)</code>，这个 API 支持返回多个内容的结果给下一个 Loader 。</p>
<pre class="language-js" data-language="js"><code class="language-js">module<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">source</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">let</span> other <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">callback</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> source<span class="token punctuation">,</span> other<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span></code></pre>

<h2 id="更多"><a href="#更多" class="headerlink" title="更多"></a>更多</h2><h4 id="1-缓存"><a href="#1-缓存" class="headerlink" title="1. 缓存"></a>1. 缓存</h4><p>从提高执行效率上，如何处理利用缓存是极其重要的。 Mac OS 会让内存充分使用、尽量占满来提高交互效率。回到 Webpack，Hot-Replace 以及 React Hot Loader 也充分地利用缓存来提高编译效率。 Webpack Loader 同样可以利用缓存来提高效率，并且只需在一个可缓存的 Loader 上加一句 <code>this.cacheable();</code> 就是这么简单:</p>
<pre class="language-js" data-language="js"><code class="language-js">module<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">source</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">cacheable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> source<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span></code></pre>

<h4 id="2-异步"><a href="#2-异步" class="headerlink" title="2. 异步"></a>2. 异步</h4><p>异步并不陌生，当一个 Loader 无依赖，可异步的时候我想都应该让它不再阻塞地去异步。在一个异步的模块中，回传时需要调用 Loader API 提供的回调方法 <code>this.async()</code>，使用起来也很简单:</p>
<pre class="language-js" data-language="js"><code class="language-js">module<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">source</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">var</span> callback <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">async</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 做异步的事</span>
    <span class="token function">doSomeAsyncOperation</span><span class="token punctuation">(</span>content<span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> result</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token function">callback</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">callback</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> result<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span></code></pre>

<h4 id="3-raw-loader"><a href="#3-raw-loader" class="headerlink" title="3. raw loader"></a>3. raw loader</h4><p>默认的情况，原文件是以 UTF-8 String 的形式传入给 Loader，而在上面有提到的，module 可使用 buffer 的形式进行处理，针对这种情况，只需要设置 <code>module.exports.raw = true; </code>这样内容将会以 raw Buffer 的形式传入到 loader 中了</p>
<pre class="language-js" data-language="js"><code class="language-js">module<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">content</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
 
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
module<span class="token punctuation">.</span>exports<span class="token punctuation">.</span>raw <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span></code></pre>

<h4 id="4-loader-工具库"><a href="#4-loader-工具库" class="headerlink" title="4. loader 工具库"></a>4. loader 工具库</h4><p>充分利用<code> loader-utils</code> 包。它提供了许多有用的工具，但最常用的一种工具是获取传递给 loader 的选项。<code>schema-utils </code>包配合<code> loader-utils</code>，用于保证 loader 选项，进行与 <code>JSON Schema </code>结构一致的校验。这里有一个简单使用两者的例子：</p>
<pre class="language-js" data-language="js"><code class="language-js"><span class="token keyword">const</span> <span class="token punctuation">&#123;</span> getOptions <span class="token punctuation">&#125;</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'loader-utils'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> validateOptions <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'schema-utils'</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> schema <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
  <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'object'</span><span class="token punctuation">,</span>
  <span class="token literal-property property">properties</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
    <span class="token literal-property property">test</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
      <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'string'</span>
    <span class="token punctuation">&#125;</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">source</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">const</span> options <span class="token operator">=</span> <span class="token function">getOptions</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token function">validateOptions</span><span class="token punctuation">(</span>schema<span class="token punctuation">,</span> options<span class="token punctuation">,</span> <span class="token string">'Example Loader'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">callback</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> source<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span></code></pre>

<h2 id="一些例子"><a href="#一些例子" class="headerlink" title="一些例子"></a>一些例子</h2><p>比如编写一个处理Vue组件上的style，把px转成rem：</p>
<pre class="language-js" data-language="js"><code class="language-js"><span class="token keyword">const</span> <span class="token punctuation">&#123;</span> getOptions <span class="token punctuation">&#125;</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'loader-utils'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> validateOptions <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'schema-utils'</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> schema <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
    <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'object'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">properties</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
        <span class="token literal-property property">remUnit</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
            <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'number'</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
        <span class="token literal-property property">forcePxProperty</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
            <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'array'</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

module<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">source</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">const</span> options <span class="token operator">=</span> <span class="token function">getOptions</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">validateOptions</span><span class="token punctuation">(</span>schema<span class="token punctuation">,</span> options<span class="token punctuation">,</span> <span class="token string">'style2rem Loader'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    source <span class="token operator">=</span> source<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">&lt;template>(.|\n)*?&lt;\/template></span><span class="token regex-delimiter">/</span><span class="token regex-flags">ig</span></span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">content</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> content<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">style="(.|\n)*?"</span><span class="token regex-delimiter">/</span><span class="token regex-flags">ig</span></span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">styleStr</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">let</span> start <span class="token operator">=</span> <span class="token number">0</span>
            <span class="token keyword">return</span> styleStr<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">:(.|\n)*?px</span><span class="token regex-delimiter">/</span><span class="token regex-flags">ig</span></span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">px<span class="token punctuation">,</span> num<span class="token punctuation">,</span> end</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                <span class="token keyword">let</span> key <span class="token operator">=</span> <span class="token string">''</span>
                <span class="token keyword">let</span> need <span class="token operator">=</span> <span class="token boolean">true</span>
                <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> start<span class="token punctuation">;</span> i <span class="token operator">&lt;</span> end<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                    <span class="token keyword">if</span> <span class="token punctuation">(</span>styleStr<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">!==</span> <span class="token string">';'</span> <span class="token operator">&amp;&amp;</span> styleStr<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">!==</span><span class="token string">' '</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                        key <span class="token operator">+=</span> styleStr<span class="token punctuation">[</span>i<span class="token punctuation">]</span>
                    <span class="token punctuation">&#125;</span>
                <span class="token punctuation">&#125;</span>
                options<span class="token punctuation">.</span>forcePxProperty<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">property</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
                    <span class="token keyword">if</span><span class="token punctuation">(</span>key<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span>property<span class="token punctuation">)</span> <span class="token operator">!==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                        need <span class="token operator">=</span> <span class="token boolean">false</span>
                    <span class="token punctuation">&#125;</span>
                <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
                start <span class="token operator">=</span> end
                <span class="token keyword">return</span> px <span class="token operator">&amp;&amp;</span> need <span class="token operator">?</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span><span class="token punctuation">(</span><span class="token function">parseInt</span><span class="token punctuation">(</span>px<span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">/</span> options<span class="token punctuation">.</span>remUnit<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toFixed</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string">rem</span><span class="token template-punctuation string">`</span></span> <span class="token operator">:</span> px
            <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">cacheable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">callback</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> source<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span></code></pre>

<p>然后我们需要添加到<code>webpack loader</code>中：</p>
<pre class="language-js" data-language="js"><code class="language-js"><span class="token literal-property property">module</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
        <span class="token literal-property property">rules</span><span class="token operator">:</span> <span class="token punctuation">[</span>
            <span class="token punctuation">&#123;</span>
                <span class="token literal-property property">test</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.vue$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
                <span class="token literal-property property">use</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">&#123;</span>
                    <span class="token literal-property property">loader</span><span class="token operator">:</span> <span class="token string">"vue-loader"</span><span class="token punctuation">,</span>
                    <span class="token literal-property property">options</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
                        <span class="token literal-property property">preserveWhitespace</span><span class="token operator">:</span> <span class="token boolean">false</span>
                    <span class="token punctuation">&#125;</span>
                <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span>
                    <span class="token literal-property property">loader</span><span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'./style2rem'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                    <span class="token literal-property property">options</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
                        <span class="token literal-property property">remUnit</span><span class="token operator">:</span> <span class="token number">37.5</span><span class="token punctuation">,</span>
                        <span class="token literal-property property">forcePxProperty</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'font-size'</span><span class="token punctuation">]</span>
                    <span class="token punctuation">&#125;</span>
                <span class="token punctuation">&#125;</span><span class="token punctuation">]</span>
            <span class="token punctuation">&#125;</span>
           <span class="token operator">...</span>
        <span class="token punctuation">]</span>
     <span class="token operator">...</span>
<span class="token punctuation">&#125;</span></code></pre>]]></content>
      <categories>
        <category>Webpack</category>
      </categories>
      <tags>
        <tag>loader</tag>
        <tag>加载器</tag>
      </tags>
  </entry>
  <entry>
    <title>React 脚手架开发之Umi框架的使用</title>
    <url>/2022/03/10/220310.html</url>
    <content><![CDATA[<h1 id="React-脚手架开发之Umi框架的使用"><a href="#React-脚手架开发之Umi框架的使用" class="headerlink" title="React 脚手架开发之Umi框架的使用"></a>React 脚手架开发之Umi框架的使用</h1><blockquote>
<p> 前言：最近面试，有面试官问到我，react脚手架开发用过哪些，我心想难道不就只有官方推荐的 <code>**create-react-app**</code>吗？然后面试官就说，公司使用Umi(乌米)作为脚手架进行开发的，我当时懵了，可能确实没有用过，就马上去了解了一下，在此做个笔记，加深一下影响以免怕会用到，话不多说，go！</p>
</blockquote>
<h2 id="Umi-介绍"><a href="#Umi-介绍" class="headerlink" title="Umi 介绍"></a>Umi 介绍</h2><p>umi 以路由为基础的，支持<a href="https://links.jianshu.com/go?to=https://umijs.org/zh/guide/router.html">类 next.js 的约定式路由</a>，以及各种进阶的路由功能，并以此进行功能扩展，比如<a href="https://links.jianshu.com/go?to=https://umijs.org/zh/plugin/umi-plugin-react.html%23dynamicimport">支持路由级的按需加载</a>。然后配以完善的<a href="https://links.jianshu.com/go?to=https://umijs.org/zh/plugin/">插件体系</a>，覆盖从源码到构建产物的每个生命周期，支持各种功能扩展和业务需求，目前内外部加起来已有 50+ 的插件。</p>
<p>这是官方对 Umi 的介绍</p>
<h2 id="Umi-优势"><a href="#Umi-优势" class="headerlink" title="Umi 优势"></a>Umi 优势</h2><ul>
<li>能做到开箱即用，内置了react、react-router等</li>
<li>类 next.js 且功能完备的路由约定，同时支持配置的路由方式</li>
<li>完善的插件体系，覆盖从源码到构建产物的每个生命周期</li>
<li>高性能，通过插件支持 PWA、以路由为单元的 code splitting 等</li>
<li>支持静态页面导出，适配各种环境，比如中台业务、无线业务、<a href="https://links.jianshu.com/go?to=https://github.com/eggjs/egg">egg</a>、支付宝钱包、云凤蝶等</li>
<li><strong>开发启动快</strong>，支持一键开启 <a href="https://links.jianshu.com/go?to=https://umijs.org/zh/plugin/umi-plugin-react.html%23dll">dll</a> 等</li>
<li><strong>一键兼容到 IE9</strong>，基于 <a href="https://links.jianshu.com/go?to=https://umijs.org/zh/plugin/umi-plugin-react.html%23polyfills">umi-plugin-polyfills</a></li>
<li><strong>完善的 TypeScript 支持</strong>，包括 d.ts 定义和 umi test</li>
<li><strong>与 dva 数据流的深入融合</strong>，支持 duck directory、model 的自动加载、code splitting 等等</li>
</ul>
<h2 id="搭建流程"><a href="#搭建流程" class="headerlink" title="搭建流程"></a>搭建流程</h2><h2 id="第一步：环境检测及安装"><a href="#第一步：环境检测及安装" class="headerlink" title="第一步：环境检测及安装"></a>第一步：环境检测及安装</h2><p>首先需要node, 并确保 node 版本是 8.10 或以上。（mac 下推荐使用 <a href="https://links.jianshu.com/go?to=https://github.com/creationix/nvm">nvm</a> 来管理 node 版本）<br> 而包管理器，这里推荐使用使用 <strong>yarn</strong> 管理 npm 依赖<br> 1.安装yarn<br> 可根据官网介绍选择安装方式 <a href="https://links.jianshu.com/go?to=https://yarnpkg.com/zh-Hans/docs/install%23windows-stable">https://yarnpkg.com/zh-Hans/docs/install#windows-stable</a><br> 2.全局安装 umi，并确保版本是 2.0.0 或以上。</p>
<pre class="language-csharp" data-language="csharp"><code class="language-csharp">$ yarn <span class="token keyword">global</span> <span class="token keyword">add</span> umi</code></pre>

<h2 id="第二步：通过脚手架创建项目"><a href="#第二步：通过脚手架创建项目" class="headerlink" title="第二步：通过脚手架创建项目"></a>第二步：通过脚手架创建项目</h2><p>umi 通过 <a href="https://links.jianshu.com/go?to=https://github.com/umijs/create-umi">create-umi</a> 提供脚手架能力</p>
<ol>
<li>在需要生成项目的文件夹下，打开CMD or 终端 命令行输入 yarn create umi</li>
</ol>
<pre class="language-ruby" data-language="ruby"><code class="language-ruby">$ yarn create umi</code></pre>

<ol>
<li>选择需要生成的项目类型</li>
</ol>
<pre class="language-dart" data-language="dart"><code class="language-dart"><span class="token operator">?</span> <span class="token class-name">Select</span> the boilerplate type <span class="token punctuation">(</span><span class="token class-name">Use</span> arrow keys<span class="token punctuation">)</span>
  ant<span class="token operator">-</span>design<span class="token operator">-</span>pro  <span class="token operator">-</span> <span class="token class-name">Create</span> project <span class="token keyword">with</span> an layout<span class="token operator">-</span>only ant<span class="token operator">-</span>design<span class="token operator">-</span>pro boilerplate<span class="token punctuation">,</span> use together <span class="token keyword">with</span> umi block<span class="token punctuation">.</span>
❯ app             <span class="token operator">-</span> <span class="token class-name">Create</span> project <span class="token keyword">with</span> a simple boilerplate<span class="token punctuation">,</span> support typescript<span class="token punctuation">.</span>
  block           <span class="token operator">-</span> <span class="token class-name">Create</span> a umi block<span class="token punctuation">.</span>
  <span class="token keyword">library</span>         <span class="token operator">-</span> <span class="token class-name">Create</span> a <span class="token keyword">library</span> <span class="token keyword">with</span> umi<span class="token punctuation">.</span>
  plugin          <span class="token operator">-</span> <span class="token class-name">Create</span> a umi plugin<span class="token punctuation">.</span></code></pre>

<ul>
<li> <strong>app</strong>，通用项目脚手架，支持选择是否启用 TypeScript，以及 <a href="https://links.jianshu.com/go?to=https://umijs.org/zh/plugin/umi-plugin-react.html">umi-plugin-react</a> 包含的功能</li>
<li> <strong>ant-design-pro</strong>，仅包含 <a href="https://links.jianshu.com/go?to=https://github.com/ant-design/ant-design-pro">ant-design-pro</a> 布局的脚手架，具体页面可通过 <a href="https://links.jianshu.com/go?to=https://umijs.org/zh/guide/block.html">umi block</a> 添加</li>
<li> <strong>block</strong>，区块脚手架</li>
<li> <strong>plugin</strong>，插件脚手架</li>
<li><strong>library</strong>，依赖（组件）库脚手架，基于 <a href="https://links.jianshu.com/go?to=https://github.com/umijs/umi-plugin-library">umi-plugin-library</a><br> 在此我们 上下箭头切换到 app 并回车确定选择。</li>
</ul>
<ol>
<li>其他选项<br> 此时会出现提示是否需要支持Typescript, 可根据实际项目开发情况选择是否使用。</li>
</ol>
<pre class="language-php" data-language="php"><code class="language-php"><span class="token operator">?</span> <span class="token keyword">Do</span> you want to <span class="token keyword">use</span> <span class="token package">typescript</span><span class="token operator">?</span> <span class="token punctuation">(</span>y<span class="token operator">/</span><span class="token constant">N</span><span class="token punctuation">)</span></code></pre>

<p>选择Typescript支持后再选择你需要的功能（多选），功能介绍详见 <a href="https://links.jianshu.com/go?to=https://umijs.org/zh/plugin/umi-plugin-react.html">plugin/umi-plugin-react</a>。</p>
<pre class="language-xml" data-language="xml"><code class="language-xml">? What functionality do you want to enable? (Press <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>space</span><span class="token punctuation">></span></span> to select, <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span><span class="token punctuation">></span></span> to toggle all, <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>i</span><span class="token punctuation">></span></span> to invert selection)
❯◯ antd
 ◯ dva
 ◯ code splitting
 ◯ dll</code></pre>

<p>同样按上下箭头移动，并按 空格 键选中需要的功能。<br> antd: UI框架，启用后实现antd, antd-mobile 和 antd-pro 的按需编译，无需要手动配置。<br> dva: 基于 <a href="https://links.jianshu.com/go?to=https://github.com/reduxjs/redux">redux</a> 和 <a href="https://links.jianshu.com/go?to=https://github.com/redux-saga/redux-saga">redux-saga</a> 的数据流方案，然后为了简化开发体验，dva 还额外内置了 <a href="https://links.jianshu.com/go?to=https://github.com/ReactTraining/react-router">react-router</a> 和 <a href="https://links.jianshu.com/go?to=https://github.com/github/fetch">fetch</a>，所以也可以理解为一个轻量级的应用框架<br> code splitting: 是否代码分包<br> dll: 通过 webpack 的 dll 插件预打包一份 dll 文件来达到二次启动提速的目的<br> 注意 此处多选项未选择，后期也可以在配置文件中配置。</p>
<p>确定后，会根据你的选择自动创建好目录和文件。</p>
<h2 id="第三步：运行及编译"><a href="#第三步：运行及编译" class="headerlink" title="第三步：运行及编译"></a>第三步：运行及编译</h2><p>安装依赖</p>
<pre class="language-ruby" data-language="ruby"><code class="language-ruby">$ yarn</code></pre>

<p>启动项目</p>
<pre class="language-ruby" data-language="ruby"><code class="language-ruby">$ yarn start</code></pre>

<p>这样我们就可以愉快的开发和调试了。</p>
<p>当我们开发好要编译项目发布测试or生产时，执行：</p>
<pre class="language-ruby" data-language="ruby"><code class="language-ruby">$ yarn build</code></pre>

<h2 id="目录结构说明"><a href="#目录结构说明" class="headerlink" title="目录结构说明"></a>目录结构说明</h2><p>.<br> ├── dist/                          // 默认的 build 输出目录<br> ├── mock/                          // mock 文件所在目录，基于 express<br> ├── config/<br> ├── config.js                  // umi 配置，同 .umirc.js，二选一， 建议配置.umirc.js<br> └── src/                           // 源码目录，可选<br> ├── layouts/index.js           // 全局布局<br> ├── pages/                     // 页面目录，里面的文件即路由<br> ├── .umi/                  // dev 临时目录，需添加到 .gitignore<br> ├── .umi-production/       // build 临时目录，会自动删除<br> ├── document.ejs           // HTML 模板<br> ├── 404.js                    // 404 页面<br> ├── page1.js               // 页面 1，任意命名，导出 react 组件<br> ├── page1.test.js          // 用例文件，umi test 会匹配所有 .test.js 和 .e2e.js 结尾的文件<br> └── page2.js               // 页面 2，任意命名<br> ├── global.css                 // 约定的全局样式文件，自动引入，也可以用 global.less<br> ├── global.js                  // 可以在这里加入 polyfill<br> ├── app.js                     // 运行时配置文件<br> ├── .umirc.js                      // umi 配置，同 config/config.js，二选一<br> ├── .umirc.js                      // umi 配置，同 config/config.js，二选一<br> ├── .env                           // 环境变量<br> └── package.json</p>
<h2 id="开发提示"><a href="#开发提示" class="headerlink" title="开发提示"></a>开发提示</h2><p>.umirc.js 配置，<br> 该文件中可以配置项目基本情况，如上面安装步骤中出现是否选用antd, dva等，在此文件中都可以更改为true, 另外还可以配置 webpack 打包配置，具体的配置项详见<a href="https://links.jianshu.com/go?to=https://umijs.org/zh/config/">.umirc.js 配置</a>。</p>
<p>设置.umirc.local.js 文件<br> 由于.umirc里的配置众多而且为了优化项目必然会分包代码抽离等，而在本地运行时无需这些，便可配置.umirc.local.js 文件，注意此文件中的选项配置和.umirc.js 配置一样，不要提交到 git，所以通常需要配置到 .gitignore。本地运行时会和 .umirc.js 合并后再返回。</p>
<p>由于umi 会根据 pages 目录自动生成路由配置，所以无需要手动配置路由，会根据 src / pages 下 文件名自动生成路由，但是你也可以配置.umirc.js中的 routes 属性，此配置项存在时则不会对 src/pages 目录做约定式的解析。</p>
<p>常用路由操作</p>
<pre class="language-jsx" data-language="jsx"><code class="language-jsx"><span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">&#123;</span> PureComponent <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> Link <span class="token keyword">from</span> <span class="token string">'umi/link'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> router <span class="token keyword">from</span> <span class="token string">'umi/router'</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">Examples</span> <span class="token keyword">extends</span> <span class="token class-name">PureComponent</span> <span class="token punctuation">&#123;</span>
    <span class="token function">render</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> <span class="token punctuation">(</span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span></span><span class="token punctuation">></span></span><span class="token plain-text">
                </span><span class="token punctuation">&#123;</span><span class="token comment">/* 普通使用 */</span><span class="token punctuation">&#125;</span><span class="token plain-text">
                </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Link</span></span> <span class="token attr-name">to</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/list<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token plain-text">跳转</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">Link</span></span><span class="token punctuation">></span></span><span class="token plain-text">

                </span><span class="token punctuation">&#123;</span><span class="token comment">/* 带参数 */</span><span class="token punctuation">&#125;</span><span class="token plain-text">
                </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Link</span></span> <span class="token attr-name">to</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/list?a=b<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token plain-text">跳转</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">Link</span></span><span class="token punctuation">></span></span><span class="token plain-text">

                </span><span class="token punctuation">&#123;</span><span class="token comment">/* 包含子组件 */</span><span class="token punctuation">&#125;</span><span class="token plain-text">
                </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Link</span></span> <span class="token attr-name">to</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/list?a=b<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span><span class="token punctuation">></span></span><span class="token plain-text">跳转</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">Link</span></span><span class="token punctuation">></span></span><span class="token plain-text">

                </span><span class="token punctuation">&#123;</span><span class="token comment">/* 点击跳转 */</span><span class="token punctuation">&#125;</span><span class="token plain-text">
                </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">&#123;</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> router<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token string">'/list'</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span></span><span class="token punctuation">></span></span><span class="token plain-text">跳转</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span><span class="token plain-text">
            </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span></span><span class="token punctuation">></span></span>
        <span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> Examples<span class="token punctuation">;</span></code></pre>

<p>更多查看<a href="https://links.jianshu.com/go?to=https://umijs.org/zh/api/%23%25E8%25B7%25AF%25E7%2594%25B1">路由配置</a></p>
<h2 id="最后"><a href="#最后" class="headerlink" title="最后"></a>最后</h2><p>通过文档了解到，umi框架开发项目提升了效率，而其本身也在不断的升级完善中，在2.8.0+版本，umi 可配置ssr 服务器端渲染，相信umi还将越来越完善。<br> 更多查看官方文档<a href="https://links.jianshu.com/go?to=https://umijs.org/">https://umijs.org/</a></p>
]]></content>
      <categories>
        <category>React.js</category>
      </categories>
      <tags>
        <tag>Umi</tag>
        <tag>框架</tag>
      </tags>
  </entry>
  <entry>
    <title>理解React全家桶、Dva、Umi</title>
    <url>/2022/04/01/220401.html</url>
    <content><![CDATA[<blockquote>
<p> 前言：前两个月还只对 <code>Creat-React-App</code> 这个官方框架比较拿手，燃鹅，现在却要用 Umi 开发，经过一段时间适应于学习，我发现，Umi是真的香！</p>
</blockquote>
<h2 id="1-React-全家桶简介："><a href="#1-React-全家桶简介：" class="headerlink" title="1.React 全家桶简介："></a>1.React 全家桶简介：</h2><p><strong>React ：</strong></p>
<p>用于构建用户界面的JavaScript 库</p>
<p><strong>Redux :</strong></p>
<p>Redux 是 JavaScript 状态容器，提供可预测化的状态管理</p>
<p><strong>React-Router :</strong></p>
<p>通过管理 URL ，实现组件的切换和状态的变化</p>
<p><strong>React-Thunk 和 React-Saga :</strong></p>
<p>Redux store 仅支持同步数据流。使用 thunk 等中间件可以帮助在 Redux 应用中实现异步性</p>
<blockquote>
<p>React 通过声明式渲染和组件化很好的胜任了UI层面的工作，但没有路由功能，和状态容器(全局状态管理) ，action 中也不能执行异步操作，所以就有了 react-router 和 redux 和 thunk。</p>
</blockquote>
<h2 id="2-基于官方脚手架-Creat-React-App-创建的基础实例代码"><a href="#2-基于官方脚手架-Creat-React-App-创建的基础实例代码" class="headerlink" title="2.基于官方脚手架 Creat-React-App 创建的基础实例代码"></a>2.基于官方脚手架 Creat-React-App 创建的基础实例代码</h2><p>入口文件 src/index.jsx (整合 redux 和 thunk，其中 ConnectedRouter 是为了把 redux 中整合的 router 数据和 react 组件的router 数据联系起来，不然在action里是没办法正确跳转的)</p>
<pre class="language-tsx" data-language="tsx"><code class="language-tsx"><span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">"react"</span> 
<span class="token keyword">import</span> ReactDom <span class="token keyword">from</span> <span class="token string">"react-dom"</span>
<span class="token keyword">import</span> MyApp <span class="token keyword">from</span> <span class="token string">"./app"</span>
<span class="token keyword">import</span> <span class="token punctuation">&#123;</span>createStore<span class="token punctuation">,</span>applyMiddleware<span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">"redux"</span>
<span class="token keyword">import</span> rootReducers <span class="token keyword">from</span> <span class="token string">"./reducer/index"</span>
<span class="token keyword">import</span> <span class="token punctuation">&#123;</span>Provider<span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">"react-redux"</span>    
<span class="token keyword">import</span> reduxThunk <span class="token keyword">from</span> <span class="token string">"redux-thunk"</span>
<span class="token keyword">import</span> <span class="token punctuation">&#123;</span> ConnectedRouter<span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'connected-react-router'</span>
<span class="token keyword">import</span> history <span class="token keyword">from</span> <span class="token string">"@/actions/history"</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> store <span class="token operator">=</span> <span class="token function">createStore</span><span class="token punctuation">(</span>rootReducers<span class="token punctuation">,</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span><span class="token function">applyMiddleware</span><span class="token punctuation">(</span>logger<span class="token punctuation">,</span>reduxThunk<span class="token punctuation">)</span><span class="token punctuation">)</span>

ReactDom<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Provider</span></span> <span class="token attr-name">store</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">&#123;</span>store<span class="token punctuation">&#125;</span></span><span class="token punctuation">></span></span><span class="token plain-text">
		</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">ConnectedRouter</span></span> <span class="token attr-name">history</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">&#123;</span>history<span class="token punctuation">&#125;</span></span><span class="token punctuation">></span></span><span class="token plain-text">
			</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">MyApp</span></span><span class="token punctuation">/></span></span><span class="token plain-text">
		</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">ConnectedRouter</span></span><span class="token punctuation">></span></span><span class="token plain-text">
	</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">Provider</span></span><span class="token punctuation">></span></span><span class="token punctuation">,</span>
	document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">"app"</span><span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre>

<p>redux 入口文件 /src/redux/index.js (整合自己全部的reducer，同时整合 history 实现action里路由跳转)</p>
<pre class="language-tsx" data-language="tsx"><code class="language-tsx"><span class="token keyword">import</span> login <span class="token keyword">from</span> <span class="token string">'./login'</span>   <span class="token comment">//这里可以写自己的reducer</span>
<span class="token keyword">import</span> <span class="token punctuation">&#123;</span> combineReducers <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'redux'</span>
<span class="token keyword">import</span> <span class="token punctuation">&#123;</span> connectRouter <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'connected-react-router'</span>
<span class="token keyword">import</span> history <span class="token keyword">from</span> <span class="token string">"@/actions/history"</span><span class="token punctuation">;</span>

<span class="token comment">//history模块是为了能在action里面进行路由跳转</span>
<span class="token keyword">const</span> reducers <span class="token operator">=</span> <span class="token function">combineReducers</span> <span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
	router<span class="token operator">:</span> <span class="token function">connectRouter</span><span class="token punctuation">(</span>history<span class="token punctuation">)</span><span class="token punctuation">,</span>
	login<span class="token punctuation">,</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> reducers</code></pre>

<p>actions 文件夹下的主要文件 /src/actions/hisotry.js</p>
<pre class="language-tsx" data-language="tsx"><code class="language-tsx"><span class="token keyword">import</span> <span class="token punctuation">&#123;</span>createBrowserHistory<span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'history'</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> history <span class="token operator">=</span> <span class="token function">createBrowserHistory</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> history<span class="token punctuation">;</span></code></pre>

<p>/src/actions/login.js</p>
<pre class="language-tsx" data-language="tsx"><code class="language-tsx"><span class="token keyword">import</span> <span class="token punctuation">&#123;</span> push <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'react-router-redux'</span>

<span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">login</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">&#123;</span>payload<span class="token punctuation">&#125;</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">(</span>dispatch<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
        <span class="token comment">//模拟登陆，异步请求后执行跳转跳转</span>
	<span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
		<span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token string">'/home'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
	<span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span></code></pre>

<p>最后就是<code>app.jsx</code>文件（使用路由）</p>
<pre class="language-tsx" data-language="tsx"><code class="language-tsx"><span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">&#123;</span>Fragment<span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">"react"</span>
<span class="token keyword">import</span> <span class="token punctuation">&#123;</span>BrowserRouter <span class="token keyword">as</span> Router<span class="token punctuation">,</span> Route<span class="token punctuation">,</span> Link<span class="token punctuation">,</span> NavLink<span class="token punctuation">,</span> Switch<span class="token punctuation">,</span><span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'react-router-dom'</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token function-variable function">mapStateToProps</span> <span class="token operator">=</span> <span class="token punctuation">(</span>state<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
	login<span class="token operator">:</span> state<span class="token punctuation">.</span>login<span class="token punctuation">,</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> <span class="token function-variable function">mapDispatchToProps</span> <span class="token operator">=</span> <span class="token punctuation">(</span>dispatch<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
	<span class="token function-variable function">loginApi</span><span class="token operator">:</span> <span class="token punctuation">(</span>payload<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
		<span class="token function">login</span><span class="token punctuation">(</span>payload<span class="token punctuation">)</span><span class="token punctuation">(</span>dispatch<span class="token punctuation">)</span>
	<span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span>

<span class="token decorator"><span class="token at operator">@</span><span class="token function">withRouter</span></span>
@<span class="token function">connect</span><span class="token punctuation">(</span>mapStateToProps<span class="token punctuation">,</span> mapDispatchToProps<span class="token punctuation">)</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">MyApp</span> <span class="token keyword">extends</span> <span class="token class-name">React</span><span class="token punctuation">.</span>Component <span class="token punctuation">&#123;</span>

	<span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
		<span class="token keyword">return</span> <span class="token punctuation">(</span>
			<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Fragment</span></span><span class="token punctuation">></span></span><span class="token plain-text">
				</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Router</span></span><span class="token punctuation">></span></span><span class="token plain-text">
				    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Switch</span></span><span class="token punctuation">></span></span><span class="token plain-text">
                                        //里面可以写自己的页面
				    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">Switch</span></span><span class="token punctuation">></span></span><span class="token plain-text">
				</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">Router</span></span><span class="token punctuation">></span></span><span class="token plain-text">
			</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">Fragment</span></span><span class="token punctuation">></span></span>
		<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span></code></pre>

<p>这个就是官方推荐的全家桶配置，为了把 react，router，redux 三者完美的联系起来，需要配置的东西太多，严重的影响开发效率，所以此时 Dva 和 Umi 等 React 框架就应运而生了。</p>
<h2 id="3-Dva-介绍"><a href="#3-Dva-介绍" class="headerlink" title="3. Dva 介绍"></a>3. Dva 介绍</h2><blockquote>
<p>dva 是一个基于 redux 和 redux-sga 的数据流方案，然后为了简化开发体验，dva还额外内置了 react-router和 fetch，所以也可以理解为一个轻量级的应用框架。</p>
</blockquote>
<p><strong>建一个 dva 脚手架项目</strong></p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token function">npm</span> <span class="token function">install</span> dva-cli -g
dva new dva-quickstart
<span class="token builtin class-name">cd</span> dva-quickstart
<span class="token function">npm</span> start</code></pre>

<img src="https://blog-1309278058.cos.ap-shanghai.myqcloud.com/22-04-01_dva%E7%9B%AE%E5%BD%95.png"/>

<p>目录结构如上：</p>
<p>Dva 帮我们整合了很多东西，在 index.js里，通过几个 API 就整合了 router 和 redux</p>
<pre class="language-tsx" data-language="tsx"><code class="language-tsx"><span class="token comment">//index.js</span>
<span class="token keyword">import</span> dva <span class="token keyword">from</span> <span class="token string">'dva'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string">'./index.css'</span><span class="token punctuation">;</span>

<span class="token comment">// 1. Initialize</span>
<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token function">dva</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 2. Plugins</span>
<span class="token comment">// app.use(&#123;&#125;);</span>

<span class="token comment">// 3. Model</span>
<span class="token comment">// app.model(require('./models/example').default);</span>

<span class="token comment">// 4. Router</span>
app<span class="token punctuation">.</span><span class="token function">router</span><span class="token punctuation">(</span><span class="token keyword">require</span><span class="token punctuation">(</span><span class="token string">'./router'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>default<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 5. Start</span>
app<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token string">'#root'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>

<p>页面连接<code>redux</code></p>
<pre class="language-tsx" data-language="tsx"><code class="language-tsx"><span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">&#123;</span> connect <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'dva'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> styles <span class="token keyword">from</span> <span class="token string">'./IndexPage.css'</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">IndexPage</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">className</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">&#123;</span>styles<span class="token punctuation">.</span>normal<span class="token punctuation">&#125;</span></span><span class="token punctuation">></span></span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

IndexPage<span class="token punctuation">.</span>propTypes <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">connect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">(</span>IndexPage<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>

<p>而且还提出了极具规范性的<code>model</code></p>
<pre class="language-tsx" data-language="tsx"><code class="language-tsx"><span class="token keyword">import</span> <span class="token punctuation">&#123;</span>routerRedux<span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'dva/router'</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">&#123;</span>
  namespace<span class="token operator">:</span> <span class="token string">'example'</span><span class="token punctuation">,</span>
  state<span class="token operator">:</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
  subscriptions<span class="token operator">:</span> <span class="token punctuation">&#123;</span>
    <span class="token function">setup</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span> dispatch<span class="token punctuation">,</span> history <span class="token punctuation">&#125;</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token comment">// eslint-disable-line</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
  effects<span class="token operator">:</span> <span class="token punctuation">&#123;</span>
    <span class="token operator">*</span><span class="token function">fetch</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span> payload <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span> call<span class="token punctuation">,</span> put <span class="token punctuation">&#125;</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token comment">// eslint-disable-line</span>
      <span class="token keyword">yield</span> <span class="token function">put</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span> type<span class="token operator">:</span> <span class="token string">'save'</span> <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">yield</span><span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>routerRedux<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
  reducers<span class="token operator">:</span> <span class="token punctuation">&#123;</span>
    <span class="token function">save</span><span class="token punctuation">(</span>state<span class="token punctuation">,</span> action<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
      <span class="token keyword">return</span> <span class="token punctuation">&#123;</span> <span class="token operator">...</span>state<span class="token punctuation">,</span> <span class="token operator">...</span>action<span class="token punctuation">.</span>payload <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span></code></pre>

<p><code>model</code>其实就是把所有跟<code>redux</code>相关的一个<code>reducer</code>整合在一个<code>model</code>文件里，通过<code>namespace</code>区分<code>model</code>，通过<code>state</code>存储数据，通过<code>subsciprtions</code>实现<code>hisotry</code>等监听，通过<code>effect</code>发起异步操作，通过<code>reducer</code>执行同步操作，简直完美！</p>
<p>看来<code>Dva</code>已经帮我们规划好了一切，我们只要按着官网的<code>API</code>文档，一部一部搭建自己的应用就好了。 但是牛逼的前人们不安于现状，<code>Umi</code>横空出世</p>
<hr/>

<h2 id="4-Umi-介绍"><a href="#4-Umi-介绍" class="headerlink" title="4. Umi 介绍"></a>4. Umi 介绍</h2><blockquote>
<p> Umi : 中文发音为 乌米，是可扩展的企业级前端应用框架。Umi以路由为基础的，同时支持配置式路由，保证路由功能的完备，并以此进行功能扩展，然后配以生命周期完善插件体系，覆盖从源码到构建产物的每个生命周期，支持各种功能的扩展和业务的需求。</p>
</blockquote>
<image src="https://blog-1309278058.cos.ap-shanghai.myqcloud.com/22-04-01_Umi%E6%BC%AB%E7%94%BB.png"/>



<p>简单来说，Umi就是一个支持约定式路由和配置路由的大杂烩，它整合了所有React生态的东西，Antd、Dva 等。把它们都当成了Umi的插件，我们想使用的时候，直接通过配置就能使用</p>
<p><strong>搭建 Umi框架</strong></p>
<p>Umi 官网推荐使用 yarn 代替 npm</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token function">npm</span> i <span class="token function">yarn</span> tyarn -g
<span class="token function">mkdir</span> myapp <span class="token operator">&amp;&amp;</span> <span class="token builtin class-name">cd</span> myapp
<span class="token function">yarn</span> create @umijs/umi-app
<span class="token function">yarn</span> <span class="token function">install</span>
<span class="token function">yarn</span> start</code></pre>

<image src="https://blog-1309278058.cos.ap-shanghai.myqcloud.com/22-04-01_Umi%E7%9B%AE%E5%BD%95.png"/>

<p>(目录结构)</p>
<p>可以看到Umi实际上就只有src下的一个pages文件夹 ，Umi文件不用管，是项目启动之后动态构建的，内置了 Dva（@umijs/plugin-dva），antd（@umijs/plugin-antd）等功能。我们只需要写页面组件就好了</p>
<p>Dva 和 Umi 功能虽然很强大，但是为了能在项目中使用它们，还是得在官方文档上多下功夫</p>
]]></content>
      <categories>
        <category>React.js</category>
      </categories>
      <tags>
        <tag>Umi</tag>
        <tag>框架</tag>
        <tag>Dva</tag>
      </tags>
  </entry>
  <entry>
    <title>前端常用的20+ 字符串方法</title>
    <url>/2022/05/01/220501.html</url>
    <content><![CDATA[<blockquote>
<p> 前言：孔子曰：温故而知新，可以为师矣；学前端亦是如此，在不断学习新知识，接收新知识的同时也要告诫自己，仰望天空的同时，也要脚踏实地，不论前端框架再怎么变，不变的永远是 JS 基础，纵观各种大厂面试最考验面试者的就是算法；所以今天想写一篇关于字符串的常用方法作为温习巩固；JS 千变万化，基础打牢，吃嘛嘛香。</p>
</blockquote>
<h2 id="一、charAt-方法"><a href="#一、charAt-方法" class="headerlink" title="一、charAt() 方法"></a>一、charAt() 方法</h2><p><strong>定义和用法</strong></p>
<p>charAt() 方法可返回指定位置的字符。</p>
<p>注意：JavaScript 并没有一种有别于字符串类型的字符数据类型，所以返回的字符是长度为1的字符串。</p>
<p><strong>实例</strong></p>
<p>在字符串 “Hello world !” 中，我们将返回位置 1 的字符：</p>
<pre class="language-js" data-language="js"><code class="language-js"><span class="token operator">&lt;</span>script type<span class="token operator">=</span><span class="token string">"text/javascript"</span><span class="token operator">></span>
<span class="token keyword">var</span> str<span class="token operator">=</span><span class="token string">"Hello world!"</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>str<span class="token punctuation">.</span><span class="token function">charAt</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">></span>
<span class="token comment">// 打印结果 e</span></code></pre>

<h2 id="二：charCodeAt-方法"><a href="#二：charCodeAt-方法" class="headerlink" title="二：charCodeAt() 方法"></a>二：charCodeAt() 方法</h2><p><strong>定义和用法</strong></p>
<p>charCodeAt() 方法可返回指定位置的字符的 Unicode 编码。这个返回值是 0 - 65535之间的整数。</p>
<p>方法 charCodeAt() 与 charAt() 方法执行的操作相似，只不过前者返回的是位于指定位置的字符的编码，而后者返回的是字符子串。</p>
<p><strong>实例</strong></p>
<p>在字符串 “Hello world” 中，我们将返回位置 1 的字符串的 Unicode 编码：</p>
<pre class="language-js" data-language="js"><code class="language-js"><span class="token operator">&lt;</span>script type<span class="token operator">=</span><span class="token string">"text/javascript"</span><span class="token operator">></span>
<span class="token keyword">var</span> str<span class="token operator">=</span><span class="token string">"Hello world!"</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>str<span class="token punctuation">.</span><span class="token function">charCodeAt</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">></span>
<span class="token comment">// 打印结果 101</span></code></pre>

<h2 id="三、concat-方法"><a href="#三、concat-方法" class="headerlink" title="三、concat() 方法"></a>三、concat() 方法</h2><p>concat() 方法用于连接两个或多个数组。</p>
<p>该方法不会改变现有的数组，而仅仅会返回被连接数组的一个副本。</p>
<p><strong>实例</strong></p>
<p>例子 1 </p>
<p>在本例中，将concat() 中的参数连接到数组 a 中：</p>
<pre class="language-js" data-language="js"><code class="language-js"><span class="token operator">&lt;</span>script type<span class="token operator">=</span><span class="token string">"text/javascript"</span><span class="token operator">></span>
<span class="token keyword">var</span> a<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">]</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a<span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">></span>
<span class="token comment">// 打印结果 1,2,3,4,5</span></code></pre>

<p>例子 2</p>
<p>在本例中，我们创建两个数组，然后使用 concat() 把它们连接起来：</p>
<pre class="language-js" data-language="js"><code class="language-js"><span class="token operator">&lt;</span>script type<span class="token operator">=</span><span class="token string">"text/javascript"</span><span class="token operator">></span>

<span class="token keyword">var</span> arr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Array</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span>
arr<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">"Jerry"</span>
arr<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">"Robin"</span>
arr<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">"Feico"</span>

<span class="token keyword">var</span> arr2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Array</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span>
arr2<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">"Ken"</span>
arr2<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">"Eden"</span>
arr2<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">"Alice"</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>arr<span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span>arr2<span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">></span>
<span class="token comment">//输出：Jerry,Robin,Feico,Ken,Eden,Alice</span></code></pre>

<p>例子 3</p>
<p>在本例中，我们创建了三个数组，然后使用 concat() 把它们连接起来：</p>
<pre class="language-js" data-language="js"><code class="language-js"><span class="token operator">&lt;</span>script type<span class="token operator">=</span><span class="token string">"text/javascript"</span><span class="token operator">></span>

<span class="token keyword">var</span> arr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Array</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span>
arr<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">"Jerry"</span>
arr<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">"Robin"</span>
arr<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">"Feico"</span>

<span class="token keyword">var</span> arr2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Array</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span>
arr2<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">"Ken"</span>
arr2<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">"Eden"</span>
arr2<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">"Alice"</span>

<span class="token keyword">var</span> arr3 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Array</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>
arr3<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">"Moon"</span>
arr3<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">"Tom"</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>arr<span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span>arr2<span class="token punctuation">,</span>arr3<span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">></span>
<span class="token comment">//输出：Jerry,Robin,Feico,Ken,Eden,Alice,Moon,Tom</span></code></pre>

<h2 id="四：fromCharCode"><a href="#四：fromCharCode" class="headerlink" title="四：fromCharCode()"></a>四：fromCharCode()</h2><p><strong>定义和用法</strong></p>
<p>fromCharCode() 可接受一个指定的 Unicode 值，然后返回一个字符串。</p>
<p><strong>实例</strong></p>
<p>在本例中，我们将根据 Unicode 来输出 “HELLO” 和 “ABC”：</p>
<pre class="language-js" data-language="js"><code class="language-js"><span class="token operator">&lt;</span>script type<span class="token operator">=</span><span class="token string">"text/javascript"</span><span class="token operator">></span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>String<span class="token punctuation">.</span><span class="token function">fromCharCode</span><span class="token punctuation">(</span><span class="token number">72</span><span class="token punctuation">,</span><span class="token number">69</span><span class="token punctuation">,</span><span class="token number">76</span><span class="token punctuation">,</span><span class="token number">76</span><span class="token punctuation">,</span><span class="token number">79</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>String<span class="token punctuation">.</span><span class="token function">fromCharCode</span><span class="token punctuation">(</span><span class="token number">65</span><span class="token punctuation">,</span><span class="token number">66</span><span class="token punctuation">,</span><span class="token number">67</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">></span>
<span class="token comment">//以上代码的输出：HELLO  ABC</span></code></pre>

<h2 id="五：indexOf"><a href="#五：indexOf" class="headerlink" title="五：indexOf()"></a>五：indexOf()</h2><p><strong>定义和用法</strong></p>
<p>indexOf() 方法可返回某个指定的字符串值在字符串中首次出现的位置。</p>
<p><strong>实例</strong></p>
<p>在本例中，我们将在 “Hello world!” 字符串内进行不同的检索：</p>
<pre class="language-js" data-language="js"><code class="language-js"><span class="token operator">&lt;</span>script type<span class="token operator">=</span><span class="token string">"text/javascript"</span><span class="token operator">></span>

<span class="token keyword">var</span> str<span class="token operator">=</span><span class="token string">"Hello world!"</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>str<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span><span class="token string">"Hello"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>str<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span><span class="token string">"World"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>str<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span><span class="token string">"world"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">></span></code></pre>

<p>以上代码的输出：</p>
<pre class="language-js" data-language="js"><code class="language-js"><span class="token number">0</span>
<span class="token operator">-</span><span class="token number">1</span>
<span class="token number">6</span></code></pre>

<h2 id="六：lastIndexOf"><a href="#六：lastIndexOf" class="headerlink" title="六：lastIndexOf()"></a>六：lastIndexOf()</h2><p><strong>定义和用法</strong></p>
<p>lastIndexOf() 方法可返回一个指定的字符串值最后出现的位置，在一个字符串中的指定位置从后向前搜索。</p>
<p><strong>实例</strong></p>
<p>在本例中，我们将在 “Hello world!” 字符串内进行不同的检索：</p>
<pre class="language-js" data-language="js"><code class="language-js"><span class="token operator">&lt;</span>script type<span class="token operator">=</span><span class="token string">"text/javascript"</span><span class="token operator">></span>

<span class="token keyword">var</span> str<span class="token operator">=</span><span class="token string">"Hello world!"</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>str<span class="token punctuation">.</span><span class="token function">lastIndexOf</span><span class="token punctuation">(</span><span class="token string">"Hello"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>str<span class="token punctuation">.</span><span class="token function">lastIndexOf</span><span class="token punctuation">(</span><span class="token string">"World"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>str<span class="token punctuation">.</span><span class="token function">lastIndexOf</span><span class="token punctuation">(</span><span class="token string">"world"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">></span></code></pre>

<p>以上代码的输出：</p>
<pre class="language-js" data-language="js"><code class="language-js"><span class="token number">0</span>
<span class="token operator">-</span><span class="token number">1</span>
<span class="token number">6</span></code></pre>

<h2 id="七：localeCompare"><a href="#七：localeCompare" class="headerlink" title="七：localeCompare()"></a>七：localeCompare()</h2><p><strong>定义和用法</strong></p>
<p>用本地特定的顺序来比较两个字符串。</p>
<p><strong>实例</strong></p>
<p>在本例中，我们将用本地特定排序规则对字符串数组进行排序：</p>
<pre class="language-js" data-language="js"><code class="language-js"><span class="token keyword">var</span> str<span class="token punctuation">;</span>
str<span class="token punctuation">.</span><span class="token function">sort</span> <span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span>b</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token keyword">return</span> a<span class="token punctuation">.</span><span class="token function">localeCompare</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span></code></pre>

<h2 id="八：match"><a href="#八：match" class="headerlink" title="八：match()"></a>八：match()</h2><p><strong>定义和用法</strong></p>
<p>match() 方法可在字符串内检索指定的值，或找到一个或多个正则表达式的匹配。</p>
<p>该方法类似 indexOf() 和 lastIndexOf()，但是它返回指定的值，而不是字符串的位置。</p>
<p><strong>实例</strong></p>
<p>例子 1</p>
<p>在本例中，我们将在 “Hello world!” 中进行不同的检索：</p>
<pre class="language-js" data-language="js"><code class="language-js"><span class="token operator">&lt;</span>script type<span class="token operator">=</span><span class="token string">"text/javascript"</span><span class="token operator">></span>

<span class="token keyword">var</span> str<span class="token operator">=</span><span class="token string">"Hello world!"</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>str<span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span><span class="token string">"world"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>str<span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span><span class="token string">"World"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>str<span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span><span class="token string">"worlld"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>str<span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span><span class="token string">"world!"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">></span></code></pre>

<p>输出：</p>
<pre class="language-js" data-language="js"><code class="language-js">world
<span class="token keyword">null</span>
<span class="token keyword">null</span>
world<span class="token operator">!</span></code></pre>

<p>例子 2</p>
<p>在本例中，我们将使用全局匹配的正则表达式来检索字符串中的所有数字：</p>
<pre class="language-js" data-language="js"><code class="language-js"><span class="token operator">&lt;</span>script type<span class="token operator">=</span><span class="token string">"text/javascript"</span><span class="token operator">></span>

<span class="token keyword">var</span> str<span class="token operator">=</span><span class="token string">"1 plus 2 equal 3"</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>str<span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\d+</span><span class="token regex-delimiter">/</span><span class="token regex-flags">g</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">></span></code></pre>

<p>输出：</p>
<pre class="language-js" data-language="js"><code class="language-js"><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span></code></pre>

<h2 id="九：replace"><a href="#九：replace" class="headerlink" title="九：replace()"></a>九：replace()</h2><p><strong>定义和用法</strong></p>
<p>replace() 方法用于在字符串中用一些字符替换另一些字符，或替换一个与正则表达式匹配的子串。</p>
<p><strong>实例</strong></p>
<p>例子 1</p>
<p>在本例中，我们将使用 “W3School” 替换字符串中的 “Microsoft”：</p>
<pre class="language-js" data-language="js"><code class="language-js"><span class="token operator">&lt;</span>script type<span class="token operator">=</span><span class="token string">"text/javascript"</span><span class="token operator">></span>

<span class="token keyword">var</span> str<span class="token operator">=</span><span class="token string">"Visit Microsoft!"</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>str<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">Microsoft</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span> <span class="token string">"W3School"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">></span></code></pre>

<p>输出：</p>
<pre class="language-js" data-language="js"><code class="language-js">Visit W3School<span class="token operator">!</span></code></pre>

<p>例子 2</p>
<p>在本例中，我们将执行一次全局替换，每当 “Microsoft” 被找到，它就被替换为 “W3School”：</p>
<pre class="language-js" data-language="js"><code class="language-js"><span class="token operator">&lt;</span>script type<span class="token operator">=</span><span class="token string">"text/javascript"</span><span class="token operator">></span>

<span class="token keyword">var</span> str<span class="token operator">=</span><span class="token string">"Welcome to Microsoft! "</span>
str<span class="token operator">=</span>str <span class="token operator">+</span> <span class="token string">"We are proud to announce that Microsoft has "</span>
str<span class="token operator">=</span>str <span class="token operator">+</span> <span class="token string">"one of the largest Web Developers sites in the world."</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>str<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">Microsoft</span><span class="token regex-delimiter">/</span><span class="token regex-flags">g</span></span><span class="token punctuation">,</span> <span class="token string">"W3School"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">></span></code></pre>

<p>输出：</p>
<pre class="language-js" data-language="js"><code class="language-js">Welcome to W3School<span class="token operator">!</span> We are proud to announce that W3School
has one <span class="token keyword">of</span> the largest Web Developers sites <span class="token keyword">in</span> the world<span class="token punctuation">.</span></code></pre>

<p>例子 3</p>
<p>您可以使用本例提供的代码来确保匹配字符串大写字符的正确：</p>
<pre class="language-js" data-language="js"><code class="language-js">text <span class="token operator">=</span> <span class="token string">"javascript Tutorial"</span><span class="token punctuation">;</span>
text<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">javascript</span><span class="token regex-delimiter">/</span><span class="token regex-flags">i</span></span><span class="token punctuation">,</span> <span class="token string">"JavaScript"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>

<p>例子 4</p>
<p>在本例中，我们将把 “Doe, Robin” 转换为 “Robin Doe” 的形式：</p>
<pre class="language-js" data-language="js"><code class="language-js">name <span class="token operator">=</span> <span class="token string">"Doe, Robin"</span><span class="token punctuation">;</span>
name<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">(\w+)\s*, \s*(\w+)</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span> <span class="token string">"$2 $1"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>

<p>例子 5</p>
<p>在本例中，我们将把所有的花引号替换为直引号：</p>
<pre class="language-js" data-language="js"><code class="language-js">name <span class="token operator">=</span> <span class="token string">'"a", "b"'</span><span class="token punctuation">;</span>
name<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">"([^"]*)"</span><span class="token regex-delimiter">/</span><span class="token regex-flags">g</span></span><span class="token punctuation">,</span> <span class="token string">"'$1'"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>

<p>例子 6</p>
<p>在本例中，我们将把字符串中所有单词的首字母都转换为大写：</p>
<pre class="language-js" data-language="js"><code class="language-js">name <span class="token operator">=</span> <span class="token string">'aaa bbb ccc'</span><span class="token punctuation">;</span>
uw<span class="token operator">=</span>name<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\b\w+\b</span><span class="token regex-delimiter">/</span><span class="token regex-flags">g</span></span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">word</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
  <span class="token keyword">return</span> word<span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toUpperCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span>word<span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>

<h2 id="十：search"><a href="#十：search" class="headerlink" title="十：search()"></a>十：search()</h2><p><strong>定义和用法</strong></p>
<p>search() 方法用于检索字符串中指定的子字符串，或检索与正则表达式相匹配的子字符串。</p>
<p><strong>实例</strong></p>
<p>例子 1</p>
<p>在本例中，我们将检索 “W3School”：</p>
<pre class="language-js" data-language="js"><code class="language-js"><span class="token operator">&lt;</span>script type<span class="token operator">=</span><span class="token string">"text/javascript"</span><span class="token operator">></span>

<span class="token keyword">var</span> str<span class="token operator">=</span><span class="token string">"Visit W3School!"</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>str<span class="token punctuation">.</span><span class="token function">search</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">W3School</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">></span></code></pre>

<p>输出：</p>
<pre class="language-js" data-language="js"><code class="language-js"><span class="token number">6</span></code></pre>

<p>在下面的例子中，无法检索到 w3school（因为 search() 对大小写敏感）。</p>
<pre class="language-js" data-language="js"><code class="language-js"><span class="token operator">&lt;</span>script type<span class="token operator">=</span><span class="token string">"text/javascript"</span><span class="token operator">></span>

<span class="token keyword">var</span> str<span class="token operator">=</span><span class="token string">"Visit W3School!"</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>str<span class="token punctuation">.</span><span class="token function">search</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">w3school</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">></span></code></pre>

<p>输出：</p>
<pre class="language-js" data-language="js"><code class="language-js"><span class="token operator">-</span><span class="token number">1</span></code></pre>

<p>例子 2</p>
<p>在本例中，我们将执行一次忽略大小写的检索：</p>
<pre class="language-js" data-language="js"><code class="language-js"><span class="token operator">&lt;</span>script type<span class="token operator">=</span><span class="token string">"text/javascript"</span><span class="token operator">></span>

<span class="token keyword">var</span> str<span class="token operator">=</span><span class="token string">"Visit W3School!"</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>str<span class="token punctuation">.</span><span class="token function">search</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">w3school</span><span class="token regex-delimiter">/</span><span class="token regex-flags">i</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">></span></code></pre>

<p>输出：</p>
<pre class="language-js" data-language="js"><code class="language-js"><span class="token number">6</span></code></pre>

<h2 id="十一：slice-方法"><a href="#十一：slice-方法" class="headerlink" title="十一：slice()方法"></a>十一：slice()方法</h2><p><strong>定义和用法</strong></p>
<p>slice() 方法可从已有的数组中返回选定的元素。</p>
<p><strong>实例</strong></p>
<p>例子 1</p>
<p>在本例中，我们将创建一个新数组，然后显示从其中选取的元素：</p>
<pre class="language-js" data-language="js"><code class="language-js"><span class="token operator">&lt;</span>script type<span class="token operator">=</span><span class="token string">"text/javascript"</span><span class="token operator">></span>

<span class="token keyword">var</span> arr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Array</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span>
arr<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">"Jerry"</span>
arr<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">"Robin"</span>
arr<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">"Feico"</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>arr<span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>arr<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>arr<span class="token punctuation">)</span>

<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">></span></code></pre>

<p>输出：</p>
<pre class="language-js" data-language="js"><code class="language-js">Jerry<span class="token punctuation">,</span>Robin<span class="token punctuation">,</span>Feico
Robin<span class="token punctuation">,</span>Feico
Jerry<span class="token punctuation">,</span>Robin<span class="token punctuation">,</span>Feico</code></pre>

<p>例子 2</p>
<p>在本例中，我们将创建一个新数组，然后显示从其中选取的元素：</p>
<pre class="language-js" data-language="js"><code class="language-js"><span class="token operator">&lt;</span>script type<span class="token operator">=</span><span class="token string">"text/javascript"</span><span class="token operator">></span>

<span class="token keyword">var</span> arr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Array</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span>
arr<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">"Jerry"</span>
arr<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">"Robin"</span>
arr<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">"Feico"</span>
arr<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">"Ken"</span>
arr<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">"Eden"</span>
arr<span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">"Alice"</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>arr<span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>arr<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>arr<span class="token punctuation">)</span>

<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">></span></code></pre>

<p>输出：</p>
<pre class="language-js" data-language="js"><code class="language-js">Jerry<span class="token punctuation">,</span>Robin<span class="token punctuation">,</span>Feico<span class="token punctuation">,</span>Ken<span class="token punctuation">,</span>Eden<span class="token punctuation">,</span>Alice
Feico<span class="token punctuation">,</span>Ken
Jerry<span class="token punctuation">,</span>Robin<span class="token punctuation">,</span>Feico<span class="token punctuation">,</span>Ken<span class="token punctuation">,</span>Eden<span class="token punctuation">,</span>Alice</code></pre>

<h2 id="十二：split-方法"><a href="#十二：split-方法" class="headerlink" title="十二：split()方法"></a>十二：split()方法</h2><p><strong>定义和用法</strong></p>
<p>split() 方法用于把一个字符串分割成字符串数组。</p>
<p><strong>实例</strong></p>
<p>例子 1</p>
<p>在本例中，我们将按照不同的方式来分割字符串：</p>
<pre class="language-js" data-language="js"><code class="language-js"><span class="token operator">&lt;</span>script type<span class="token operator">=</span><span class="token string">"text/javascript"</span><span class="token operator">></span>

<span class="token keyword">var</span> str<span class="token operator">=</span><span class="token string">"How are you doing today?"</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>str<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">" "</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>str<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>str<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">" "</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">></span></code></pre>

<p>输出：</p>
<pre class="language-js" data-language="js"><code class="language-js">How<span class="token punctuation">,</span>are<span class="token punctuation">,</span>you<span class="token punctuation">,</span>doing<span class="token punctuation">,</span>today<span class="token operator">?</span>
<span class="token constant">H</span><span class="token punctuation">,</span>o<span class="token punctuation">,</span>w<span class="token punctuation">,</span> <span class="token punctuation">,</span>a<span class="token punctuation">,</span>r<span class="token punctuation">,</span>e<span class="token punctuation">,</span> <span class="token punctuation">,</span>y<span class="token punctuation">,</span>o<span class="token punctuation">,</span>u<span class="token punctuation">,</span> <span class="token punctuation">,</span>d<span class="token punctuation">,</span>o<span class="token punctuation">,</span>i<span class="token punctuation">,</span>n<span class="token punctuation">,</span>g<span class="token punctuation">,</span> <span class="token punctuation">,</span>t<span class="token punctuation">,</span>o<span class="token punctuation">,</span>d<span class="token punctuation">,</span>a<span class="token punctuation">,</span>y<span class="token punctuation">,</span><span class="token operator">?</span>
How<span class="token punctuation">,</span>are<span class="token punctuation">,</span>you</code></pre>

<p>例子 2</p>
<p>在本例中，我们将分割结构更为复杂的字符串：</p>
<pre class="language-js" data-language="js"><code class="language-js"><span class="token string">"2:3:4:5"</span><span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">":"</span><span class="token punctuation">)</span>    <span class="token comment">//将返回["2", "3", "4", "5"]</span>
<span class="token string">"|a|b|c"</span><span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">"|"</span><span class="token punctuation">)</span>    <span class="token comment">//将返回["", "a", "b", "c"]</span></code></pre>

<p>例子 3</p>
<p>使用下面的代码，可以把句子分割成单词：</p>
<pre class="language-js" data-language="js"><code class="language-js"><span class="token keyword">var</span> words <span class="token operator">=</span> sentence<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">' '</span><span class="token punctuation">)</span>

或者使用正则表达式作为 separator：

<span class="token keyword">var</span> words <span class="token operator">=</span> sentence<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\s+</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">)</span></code></pre>

<p>例子 4</p>
<p>如果您希望把单词分割为字母，或者把字符串分割为字符，可使用下面的代码：</p>
<pre class="language-js" data-language="js"><code class="language-js"><span class="token string">"hello"</span><span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">""</span><span class="token punctuation">)</span>    <span class="token comment">//可返回 ["h", "e", "l", "l", "o"]</span>

若只需要返回一部分字符，请使用 howmany 参数：

<span class="token string">"hello"</span><span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">""</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span>    <span class="token comment">//可返回 ["h", "e", "l"]</span></code></pre>

<h2 id="十三：substr-方法"><a href="#十三：substr-方法" class="headerlink" title="十三：substr()方法"></a>十三：substr()方法</h2><p><strong>定义和用法</strong></p>
<p>substr() 方法可在字符串中抽取从 start 下标开始的指定数目的字符。</p>
<p><strong>实例</strong></p>
<p>例子 1</p>
<p>在本例中，我们将使用 substr() 从字符串中提取一些字符：</p>
<pre class="language-js" data-language="js"><code class="language-js"><span class="token operator">&lt;</span>script type<span class="token operator">=</span><span class="token string">"text/javascript"</span><span class="token operator">></span>

<span class="token keyword">var</span> str<span class="token operator">=</span><span class="token string">"Hello world!"</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>str<span class="token punctuation">.</span><span class="token function">substr</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">></span></code></pre>

<p>输出：</p>
<pre class="language-js" data-language="js"><code class="language-js">lo world<span class="token operator">!</span></code></pre>

<p>例子 2</p>
<p>在本例中，我们将使用 substr() 从字符串中提取一些字符：</p>
<pre class="language-js" data-language="js"><code class="language-js"><span class="token operator">&lt;</span>script type<span class="token operator">=</span><span class="token string">"text/javascript"</span><span class="token operator">></span>

<span class="token keyword">var</span> str<span class="token operator">=</span><span class="token string">"Hello world!"</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>str<span class="token punctuation">.</span><span class="token function">substr</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">></span></code></pre>

<p>输出：</p>
<pre class="language-js" data-language="js"><code class="language-js">lo worl</code></pre>

<h2 id="十四：substring"><a href="#十四：substring" class="headerlink" title="十四：substring()"></a>十四：substring()</h2><p><strong>定义和用法</strong></p>
<p>substring() 方法用于提取字符串中介于两个指定下标之间的字符。</p>
<p><strong>实例</strong></p>
<p>例子 1</p>
<p>在本例中，我们将使用 substring() 从字符串中提取一些字符：</p>
<pre class="language-js" data-language="js"><code class="language-js"><span class="token operator">&lt;</span>script type<span class="token operator">=</span><span class="token string">"text/javascript"</span><span class="token operator">></span>

<span class="token keyword">var</span> str<span class="token operator">=</span><span class="token string">"Hello world!"</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">str.substring(3)</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>

<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">></span></code></pre>

<p>输出：</p>
<pre class="language-js" data-language="js"><code class="language-js">lo world<span class="token operator">!</span></code></pre>

<p>例子 2</p>
<p>在本例中，我们将使用 substring() 从字符串中提取一些字符：</p>
<pre class="language-js" data-language="js"><code class="language-js"><span class="token operator">&lt;</span>script type<span class="token operator">=</span><span class="token string">"text/javascript"</span><span class="token operator">></span>

<span class="token keyword">var</span> str<span class="token operator">=</span><span class="token string">"Hello world!"</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">str.substring(3,7)</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>

<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">></span></code></pre>

<p>输出：</p>
<pre class="language-js" data-language="js"><code class="language-js">lo w</code></pre>

<h2 id="十五：toLocaleLowerCase"><a href="#十五：toLocaleLowerCase" class="headerlink" title="十五：toLocaleLowerCase()"></a>十五：toLocaleLowerCase()</h2><p><strong>定义和用法</strong></p>
<p>toLocaleLowerCase() 方法用于把字符串转换为小写。</p>
<p><strong>实例</strong></p>
<p>在本例中，”Hello world!” 将以小写字母来显示：</p>
<pre class="language-js" data-language="js"><code class="language-js"><span class="token operator">&lt;</span>script type<span class="token operator">=</span><span class="token string">"text/javascript"</span><span class="token operator">></span>

<span class="token keyword">var</span> str<span class="token operator">=</span><span class="token string">"Hello World!"</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>str<span class="token punctuation">.</span><span class="token function">toLocaleLowerCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">></span></code></pre>

<h2 id="十六：toLocaleUpperCase"><a href="#十六：toLocaleUpperCase" class="headerlink" title="十六：toLocaleUpperCase()"></a>十六：toLocaleUpperCase()</h2><p><strong>定义和用法</strong></p>
<p>toLocaleUpperCase() 方法用于把字符串转换为大写。</p>
<p><strong>实例</strong></p>
<p>在本例中，”Hello world!” 将以大写字母来显示：</p>
<pre class="language-js" data-language="js"><code class="language-js"><span class="token operator">&lt;</span>script type<span class="token operator">=</span><span class="token string">"text/javascript"</span><span class="token operator">></span>

<span class="token keyword">var</span> str<span class="token operator">=</span><span class="token string">"Hello World!"</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>str<span class="token punctuation">.</span><span class="token function">toLocaleUpperCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">></span></code></pre>

<h2 id="十七：toLowerCase"><a href="#十七：toLowerCase" class="headerlink" title="十七：toLowerCase()"></a>十七：toLowerCase()</h2><p><strong>定义和用法</strong></p>
<p>toLowerCase() 方法用于把字符串转换为小写。</p>
<p><strong>实例</strong></p>
<p>在本例中，”Hello world!” 将以小写字母来显示：</p>
<pre class="language-js" data-language="js"><code class="language-js"><span class="token operator">&lt;</span>script type<span class="token operator">=</span><span class="token string">"text/javascript"</span><span class="token operator">></span>

<span class="token keyword">var</span> str<span class="token operator">=</span><span class="token string">"Hello World!"</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>str<span class="token punctuation">.</span><span class="token function">toLowerCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">></span></code></pre>

<h2 id="十八：toString"><a href="#十八：toString" class="headerlink" title="十八：toString()"></a>十八：toString()</h2><p><strong>定义和用法</strong></p>
<p>toString() 方法可把一个 Number 对象转换为一个字符串，并返回结果。</p>
<p><strong>实例</strong></p>
<p>在本例中，我们将把一个数字转换为字符串：</p>
<pre class="language-js" data-language="js"><code class="language-js"><span class="token operator">&lt;</span>script type<span class="token operator">=</span><span class="token string">"text/javascript"</span><span class="token operator">></span>

<span class="token keyword">var</span> number <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Number</span><span class="token punctuation">(</span><span class="token number">1337</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
document<span class="token punctuation">.</span><span class="token function">write</span> <span class="token punctuation">(</span>number<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">></span></code></pre>

<p>输出：</p>
<pre class="language-js" data-language="js"><code class="language-js"><span class="token number">1337</span></code></pre>

<h2 id="十九：toUpperCase"><a href="#十九：toUpperCase" class="headerlink" title="十九：toUpperCase()"></a>十九：toUpperCase()</h2><p><strong>定义和用法</strong></p>
<p>toUpperCase() 方法用于把字符串转换为大写。</p>
<p><strong>实例</strong></p>
<p>在本例中，”Hello world!” 将以大写字母来显示：</p>
<pre class="language-js" data-language="js"><code class="language-js"><span class="token operator">&lt;</span>script type<span class="token operator">=</span><span class="token string">"text/javascript"</span><span class="token operator">></span>

<span class="token keyword">var</span> str<span class="token operator">=</span><span class="token string">"Hello World!"</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>str<span class="token punctuation">.</span><span class="token function">toUpperCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">></span></code></pre>

<h5 id="二十：trim"><a href="#二十：trim" class="headerlink" title="二十：trim()"></a>二十：trim()</h5><p><strong>定义和用法</strong></p>
<p>trim() 方法用于删除字符串的头尾空白符，空白符包括：空格、制表符 tab、换行符等其他空白符等。</p>
<p>trim() 方法不会改变原始字符串。</p>
<p>trim() 方法不适用于 null, undefined, Number 类型。</p>
<p><strong>实例</strong></p>
<pre class="language-js" data-language="js"><code class="language-js"><span class="token keyword">function</span> <span class="token function">myTrim</span><span class="token punctuation">(</span><span class="token parameter">x</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">return</span> x<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">^\s+|\s+$</span><span class="token regex-delimiter">/</span><span class="token regex-flags">gm</span></span><span class="token punctuation">,</span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">function</span> <span class="token function">myFunction</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">var</span> str <span class="token operator">=</span> <span class="token function">myTrim</span><span class="token punctuation">(</span><span class="token string">"        Runoob        "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">alert</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span></code></pre>

<p>输出结果</p>
<pre class="language-js" data-language="js"><code class="language-js">Runoob </code></pre>

<h2 id="二十一：valueOf"><a href="#二十一：valueOf" class="headerlink" title="二十一：valueOf()"></a>二十一：valueOf()</h2><p><strong>定义和用法</strong></p>
<p>valueOf() 方法可返回 String 对象的原始值。</p>
<p>注意：valueOf() 方法通常由 JavaScript 在后台自动进行调用，而不是显式地处于代码中。</p>
<p><strong>实例</strong></p>
<p>返回 String 对象的原始值:</p>
<pre class="language-js" data-language="js"><code class="language-js"><span class="token operator">&lt;</span>script<span class="token operator">></span>

<span class="token keyword">var</span> str<span class="token operator">=</span><span class="token string">"Hello world!"</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>str<span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">></span></code></pre>

<p>以上实例输出结果:</p>
<pre class="language-js" data-language="js"><code class="language-js">Hello world<span class="token operator">!</span></code></pre>



<p>End…</p>
]]></content>
      <categories>
        <category>JavaScript</category>
      </categories>
      <tags>
        <tag>字符串</tag>
        <tag>JS</tag>
      </tags>
  </entry>
  <entry>
    <title>echarts-wordcloud 词云的用法</title>
    <url>/2022/06/01/220601.html</url>
    <content><![CDATA[<blockquote>
<p> 最近有用到echarts的一个插件：echarts-wordcloud；中文名是词云。它的作用是用一组热词生成的一个用canvas绘制的echarts散点图，支持彩色、旋转、图片形状内定制词云排布，非常的银杏，那就让我们一起来学习学习吧！</p>
</blockquote>
<img src="https://blog-1309278058.cos.ap-shanghai.myqcloud.com/22-06-01_%E8%AF%8D%E4%BA%91.png"/>

<h2 id="一、安装依赖"><a href="#一、安装依赖" class="headerlink" title="一、安装依赖"></a>一、安装依赖</h2><p>在 react 项目中安装 echarts 和 echarts-wordcloud</p>
<pre class="language-js" data-language="js"><code class="language-js">npm install echarts
<span class="token comment">/*注意版本号，echarts5.0.0对应的echarts-woedcloud2.0.0版本*/</span>
npm install echarts<span class="token operator">-</span>wordcloud@<span class="token number">2.0</span><span class="token number">.0</span></code></pre>

<h2 id="二、引用词云"><a href="#二、引用词云" class="headerlink" title="二、引用词云"></a>二、引用词云</h2><p>导入echarts和echarts-wordcloud</p>
<pre class="language-js" data-language="js"><code class="language-js"><span class="token keyword">import</span> <span class="token operator">*</span> <span class="token keyword">as</span> echarts <span class="token keyword">from</span> <span class="token string">'echarts'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string">'echarts-wordcloud'</span><span class="token punctuation">;</span></code></pre>

<h2 id="三、使用"><a href="#三、使用" class="headerlink" title="三、使用"></a>三、使用</h2><h3 id="1-官方echartsReact组件"><a href="#1-官方echartsReact组件" class="headerlink" title="1.官方echartsReact组件"></a>1.官方echartsReact组件</h3><p><strong>使用react自带的echartsReact组件使用 只需配置option即可使用</strong></p>
<pre class="language-js" data-language="js"><code class="language-js"><span class="token number">1.1</span> 安装依赖
npm install echarts<span class="token operator">-</span><span class="token keyword">for</span><span class="token operator">-</span>react

<span class="token number">1.2</span> 引用插件
<span class="token keyword">import</span> EChartsReact <span class="token keyword">from</span> <span class="token string">'echarts-for-react'</span><span class="token punctuation">;</span>

<span class="token number">1.3</span> 组件中使用
<span class="token operator">&lt;</span>EChartsReact option<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token function">wordOption</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token operator">/</span><span class="token operator">></span> 
                      
<span class="token number">1.4</span> wordOption配置项函数的配置
  <span class="token keyword">const</span> <span class="token function-variable function">wordOption</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">let</span> option <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
      <span class="token literal-property property">backgroundColor</span><span class="token operator">:</span> <span class="token string">'#fff'</span><span class="token punctuation">,</span> <span class="token comment">// canvas背景颜色</span>
      <span class="token comment">// canvas标题配置项</span>
      <span class="token comment">//   title: &#123;</span>
      <span class="token comment">//     text: '我是标题',</span>
      <span class="token comment">//     top: '0%',</span>
      <span class="token comment">//     left: '-1%',</span>
      <span class="token comment">//     textStyle: &#123;</span>
      <span class="token comment">//       fontSize: 14,</span>
      <span class="token comment">//       color: '#3B3E41',</span>
      <span class="token comment">//       fontWeight: 'normal',</span>
      <span class="token comment">//     &#125;,</span>
      <span class="token comment">//   &#125;,</span>
      <span class="token literal-property property">series</span><span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">&#123;</span>
          <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'wordCloud'</span><span class="token punctuation">,</span>
          <span class="token literal-property property">left</span><span class="token operator">:</span> <span class="token string">'center'</span><span class="token punctuation">,</span> <span class="token comment">// X轴偏移量</span>
          <span class="token literal-property property">top</span><span class="token operator">:</span> <span class="token string">'center'</span><span class="token punctuation">,</span> <span class="token comment">// Y轴偏移量</span>
          <span class="token literal-property property">width</span><span class="token operator">:</span> <span class="token string">'100%'</span><span class="token punctuation">,</span> <span class="token comment">// canvas宽度大小</span>
          <span class="token literal-property property">height</span><span class="token operator">:</span> <span class="token string">'100%'</span><span class="token punctuation">,</span> <span class="token comment">// canvas高度大小</span>
          <span class="token literal-property property">sizeRange</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token comment">//  词典字体大小范围配置</span>
          <span class="token literal-property property">rotationRange</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token comment">// 词典字体旋转角度配置，默认不旋转</span>
          <span class="token literal-property property">gridSize</span><span class="token operator">:</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token comment">// 词典字体间距配置</span>
          <span class="token literal-property property">layoutAnimation</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">// 为false词典过度会阻塞</span>
          <span class="token literal-property property">textStyle</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
            <span class="token comment">// 词典样式配置</span>
            <span class="token function-variable function">color</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
              <span class="token keyword">let</span> colors <span class="token operator">=</span> <span class="token punctuation">[</span>
                <span class="token string">'#31a398'</span><span class="token punctuation">,</span>
                <span class="token string">'#d7797d'</span><span class="token punctuation">,</span>
                <span class="token string">'#798368'</span><span class="token punctuation">,</span>
                <span class="token string">'#66d184'</span><span class="token punctuation">,</span>
                <span class="token string">'#8990bb'</span><span class="token punctuation">,</span>
                <span class="token string">'#66e264'</span><span class="token punctuation">,</span>
                <span class="token string">'#e8d277'</span><span class="token punctuation">,</span>
                <span class="token string">'#e684a5'</span><span class="token punctuation">,</span>
                <span class="token string">'#b39d8e'</span><span class="token punctuation">,</span>
                <span class="token string">'#d8c5de'</span><span class="token punctuation">,</span>
                <span class="token string">'#96c6c6'</span><span class="token punctuation">,</span>
              <span class="token punctuation">]</span><span class="token punctuation">;</span>
              <span class="token keyword">return</span> colors<span class="token punctuation">[</span><span class="token function">parseInt</span><span class="token punctuation">(</span>Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
          <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
          <span class="token comment">// 渲染词典数据</span>
          <span class="token literal-property property">data</span><span class="token operator">:</span> <span class="token punctuation">[</span>
            <span class="token punctuation">&#123;</span>
              <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token string">'6'</span><span class="token punctuation">,</span> <span class="token comment">// 词典大小配置</span>
              <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'墙裂推荐'</span><span class="token punctuation">,</span> <span class="token comment">// 词典名称配置</span>
            <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
            <span class="token punctuation">&#123;</span> <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token string">'40'</span><span class="token punctuation">,</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'实用'</span> <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
            <span class="token punctuation">&#123;</span> <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token string">'29'</span><span class="token punctuation">,</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'专业'</span> <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
            <span class="token punctuation">&#123;</span> <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token string">'28'</span><span class="token punctuation">,</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'非常好'</span> <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
            <span class="token punctuation">&#123;</span> <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token string">'57'</span><span class="token punctuation">,</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'受益匪浅'</span> <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
            <span class="token punctuation">&#123;</span> <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token string">'26'</span><span class="token punctuation">,</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'高大上'</span> <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
            <span class="token punctuation">&#123;</span> <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token string">'25'</span><span class="token punctuation">,</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'值得推荐'</span> <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
            <span class="token punctuation">&#123;</span> <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token string">'24'</span><span class="token punctuation">,</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'超值'</span> <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
            <span class="token punctuation">&#123;</span> <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token string">'23'</span><span class="token punctuation">,</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'很棒'</span> <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
            <span class="token punctuation">&#123;</span> <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token string">'22'</span><span class="token punctuation">,</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'技巧 '</span> <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
            <span class="token punctuation">&#123;</span> <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token string">'21'</span><span class="token punctuation">,</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'必须五星'</span> <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
            <span class="token punctuation">&#123;</span> <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token string">'20'</span><span class="token punctuation">,</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'节约时间'</span> <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
            <span class="token punctuation">&#123;</span> <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token string">'16'</span><span class="token punctuation">,</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'细致'</span> <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
            <span class="token punctuation">&#123;</span> <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token string">'14'</span><span class="token punctuation">,</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'五星好评'</span> <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
            <span class="token punctuation">&#123;</span> <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token string">'13'</span><span class="token punctuation">,</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'良心产品'</span> <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
            <span class="token punctuation">&#123;</span> <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token string">'12'</span><span class="token punctuation">,</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'内容丰富'</span> <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
            <span class="token punctuation">&#123;</span> <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token string">'10'</span><span class="token punctuation">,</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'可操作性强'</span> <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
            <span class="token punctuation">&#123;</span> <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token string">'29'</span><span class="token punctuation">,</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'理念'</span> <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
            <span class="token punctuation">&#123;</span> <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token string">'48'</span><span class="token punctuation">,</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'耐心'</span> <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
            <span class="token punctuation">&#123;</span> <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token string">'5'</span><span class="token punctuation">,</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'太专业'</span> <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
            <span class="token punctuation">&#123;</span> <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token string">'16'</span><span class="token punctuation">,</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'经典实用'</span> <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
            <span class="token punctuation">&#123;</span> <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token string">'5'</span><span class="token punctuation">,</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'现学现卖'</span> <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
            <span class="token punctuation">&#123;</span> <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token string">'5'</span><span class="token punctuation">,</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'帮助很大'</span> <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
            <span class="token punctuation">&#123;</span> <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token string">'5'</span><span class="token punctuation">,</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'职业人'</span> <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
            <span class="token punctuation">&#123;</span> <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token string">'4'</span><span class="token punctuation">,</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'一直追随 '</span> <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
            <span class="token punctuation">&#123;</span> <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token string">'21'</span><span class="token punctuation">,</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'很不错'</span> <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
            <span class="token punctuation">&#123;</span> <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token string">'5'</span><span class="token punctuation">,</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'好好学习'</span> <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
            <span class="token punctuation">&#123;</span> <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token string">'8'</span><span class="token punctuation">,</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'太直'</span> <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
            <span class="token punctuation">&#123;</span> <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token string">'7'</span><span class="token punctuation">,</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'良心卖家'</span> <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
            <span class="token punctuation">&#123;</span> <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token string">'13'</span><span class="token punctuation">,</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'打开了视野'</span> <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
            <span class="token punctuation">&#123;</span> <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token string">'12'</span><span class="token punctuation">,</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'很喜欢'</span> <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
            <span class="token punctuation">&#123;</span> <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token string">'9'</span><span class="token punctuation">,</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'通俗易懂'</span> <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
            <span class="token punctuation">&#123;</span> <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token string">'9'</span><span class="token punctuation">,</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'思想开启'</span> <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
            <span class="token punctuation">&#123;</span> <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token string">'8'</span><span class="token punctuation">,</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'帮助巨大'</span> <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
            <span class="token punctuation">&#123;</span> <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token string">'7'</span><span class="token punctuation">,</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'一如既往地好用'</span> <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
            <span class="token punctuation">&#123;</span> <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token string">'7'</span><span class="token punctuation">,</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'升值必备'</span> <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
            <span class="token punctuation">&#123;</span> <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token string">'6'</span><span class="token punctuation">,</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'大大赞一个'</span> <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
            <span class="token punctuation">&#123;</span> <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token string">'6'</span><span class="token punctuation">,</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'不能错过'</span> <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
            <span class="token punctuation">&#123;</span> <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token string">'5'</span><span class="token punctuation">,</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'深入浅出'</span> <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
            <span class="token punctuation">&#123;</span> <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token string">'5'</span><span class="token punctuation">,</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'朴实 '</span> <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
            <span class="token punctuation">&#123;</span> <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token string">'5'</span><span class="token punctuation">,</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'加分'</span> <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
            <span class="token punctuation">&#123;</span> <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token string">'5'</span><span class="token punctuation">,</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'大气'</span> <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
            <span class="token punctuation">&#123;</span> <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token string">'5'</span><span class="token punctuation">,</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'死忠粉'</span> <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
            <span class="token punctuation">&#123;</span> <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token string">'9'</span><span class="token punctuation">,</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'看的进'</span> <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
            <span class="token punctuation">&#123;</span> <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token string">'8'</span><span class="token punctuation">,</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'优秀'</span> <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
            <span class="token punctuation">&#123;</span> <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token string">'7'</span><span class="token punctuation">,</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'高级'</span> <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
            <span class="token punctuation">&#123;</span> <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token string">'6'</span><span class="token punctuation">,</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'收货满满'</span> <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
          <span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
      <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> option<span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">;</span></code></pre>

<h3 id="2-DOM使用"><a href="#2-DOM使用" class="headerlink" title="2.DOM使用"></a>2.DOM使用</h3><p><strong>直接用盒子来包裹词云，不想装依赖，用这种方法也不错噢</strong></p>
<pre class="language-js" data-language="js"><code class="language-js"><span class="token number">2.1</span> 引用一下useRef或createRef，这里用useRef演示
<span class="token keyword">import</span> <span class="token punctuation">&#123;</span> useRef <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>

<span class="token number">2.2</span> 创建一个ref对象
<span class="token keyword">const</span> wordCloudRef <span class="token operator">=</span> <span class="token function">useRef</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token number">2.3</span> 将 ref对象绑定到dom元素上
  <span class="token literal-property property">tip</span><span class="token operator">:</span> 页面方法中会通过 echarts<span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span>wordCloudRef<span class="token punctuation">.</span>current<span class="token punctuation">)</span>方法获取到ref绑定为wordCloudRef的<span class="token constant">DOM</span>节点，然后通过echarts的内部机制将echarts视图以canvas的形式展现在页面上
      
<span class="token operator">&lt;</span>div ref<span class="token operator">=</span><span class="token string">"wordCloudRef"</span> <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"block-up-login"</span><span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span>

<span class="token number">2.4</span> 调用方法触发绘制
  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=></span><span class="token punctuation">&#123;</span>
    <span class="token function">wordInit</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

  <span class="token keyword">const</span> <span class="token function-variable function">wordInit</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    <span class="token comment">// 获取到ref绑定为wordCloudRef的DOM节点，以canvas的形式展现在视图层</span>
    <span class="token keyword">let</span> myChart <span class="token operator">=</span> echarts<span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span>wordCloudRef<span class="token punctuation">.</span>current<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// echarts参数设置</span>
    myChart<span class="token punctuation">.</span><span class="token function">setOption</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
      <span class="token literal-property property">backgroundColor</span><span class="token operator">:</span> <span class="token string">'#fff'</span><span class="token punctuation">,</span> <span class="token comment">// canvas背景颜色</span>
      <span class="token comment">// canvas标题配置项</span>
      <span class="token literal-property property">title</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
        <span class="token literal-property property">text</span><span class="token operator">:</span> <span class="token string">'我是标题'</span><span class="token punctuation">,</span>
        <span class="token literal-property property">top</span><span class="token operator">:</span> <span class="token string">'0%'</span><span class="token punctuation">,</span>
        <span class="token literal-property property">left</span><span class="token operator">:</span> <span class="token string">'-1%'</span><span class="token punctuation">,</span>
        <span class="token literal-property property">textStyle</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
          <span class="token literal-property property">fontSize</span><span class="token operator">:</span> <span class="token number">14</span><span class="token punctuation">,</span>
          <span class="token literal-property property">color</span><span class="token operator">:</span> <span class="token string">'#3B3E41'</span><span class="token punctuation">,</span>
          <span class="token literal-property property">fontWeight</span><span class="token operator">:</span> <span class="token string">'normal'</span><span class="token punctuation">,</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
      <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
      <span class="token literal-property property">series</span><span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">&#123;</span>
          <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'wordCloud'</span><span class="token punctuation">,</span>
          <span class="token literal-property property">left</span><span class="token operator">:</span> <span class="token string">'-5%'</span><span class="token punctuation">,</span> <span class="token comment">// X轴偏移量</span>
          <span class="token literal-property property">top</span><span class="token operator">:</span> <span class="token string">'20%'</span><span class="token punctuation">,</span> <span class="token comment">// Y轴偏移量</span>
          <span class="token literal-property property">width</span><span class="token operator">:</span> <span class="token string">'100%'</span><span class="token punctuation">,</span> <span class="token comment">// canvas宽度大小</span>
          <span class="token literal-property property">height</span><span class="token operator">:</span> <span class="token string">'100%'</span><span class="token punctuation">,</span> <span class="token comment">// canvas高度大小</span>
          <span class="token literal-property property">sizeRange</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">12</span><span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token comment">//  词典字体大小范围配置</span>
          <span class="token literal-property property">rotationRange</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token comment">// 词典字体旋转角度配置，默认不旋转</span>
          <span class="token literal-property property">gridSize</span><span class="token operator">:</span> <span class="token number">25</span><span class="token punctuation">,</span> <span class="token comment">// 词典字体间距配置</span>
          <span class="token literal-property property">layoutAnimation</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">// 为false词典过度会阻塞</span>
          <span class="token literal-property property">textStyle</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
            <span class="token comment">// 词典样式配置</span>
            <span class="token literal-property property">normal</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
              <span class="token function-variable function">color</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                <span class="token comment">// Random color</span>
                <span class="token keyword">return</span> <span class="token punctuation">(</span>
                  <span class="token string">'rgb('</span> <span class="token operator">+</span>
                  <span class="token punctuation">[</span>
                    Math<span class="token punctuation">.</span><span class="token function">round</span><span class="token punctuation">(</span>Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">160</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                    Math<span class="token punctuation">.</span><span class="token function">round</span><span class="token punctuation">(</span>Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">160</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                    Math<span class="token punctuation">.</span><span class="token function">round</span><span class="token punctuation">(</span>Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">160</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                  <span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">','</span><span class="token punctuation">)</span> <span class="token operator">+</span>
                  <span class="token string">')'</span>
                <span class="token punctuation">)</span><span class="token punctuation">;</span>
              <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
            <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
          <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
          <span class="token comment">// 渲染词典数据</span>
          <span class="token literal-property property">data</span><span class="token operator">:</span> <span class="token punctuation">[</span>
            <span class="token punctuation">&#123;</span> <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token string">'40'</span><span class="token punctuation">,</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'实用'</span> <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
            <span class="token punctuation">&#123;</span> <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token string">'29'</span><span class="token punctuation">,</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'专业'</span> <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
            <span class="token punctuation">&#123;</span> <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token string">'28'</span><span class="token punctuation">,</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'非常好'</span> <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
            <span class="token punctuation">&#123;</span> <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token string">'57'</span><span class="token punctuation">,</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'受益匪浅'</span> <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
            <span class="token punctuation">&#123;</span> <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token string">'26'</span><span class="token punctuation">,</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'高大上'</span> <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
            <span class="token punctuation">&#123;</span> <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token string">'25'</span><span class="token punctuation">,</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'值得推荐'</span> <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
            <span class="token punctuation">&#123;</span> <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token string">'24'</span><span class="token punctuation">,</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'超值'</span> <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
            <span class="token punctuation">&#123;</span> <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token string">'23'</span><span class="token punctuation">,</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'很棒'</span> <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
            <span class="token punctuation">&#123;</span> <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token string">'22'</span><span class="token punctuation">,</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'技巧 '</span> <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
            <span class="token punctuation">&#123;</span> <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token string">'21'</span><span class="token punctuation">,</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'必须五星'</span> <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
            <span class="token punctuation">&#123;</span> <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token string">'20'</span><span class="token punctuation">,</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'节约时间'</span> <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
            <span class="token punctuation">&#123;</span> <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token string">'16'</span><span class="token punctuation">,</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'细致'</span> <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
            <span class="token punctuation">&#123;</span> <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token string">'14'</span><span class="token punctuation">,</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'五星好评'</span> <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
            <span class="token punctuation">&#123;</span> <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token string">'13'</span><span class="token punctuation">,</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'良心产品'</span> <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
            <span class="token punctuation">&#123;</span> <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token string">'12'</span><span class="token punctuation">,</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'内容丰富'</span> <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
            <span class="token punctuation">&#123;</span> <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token string">'10'</span><span class="token punctuation">,</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'可操作性强'</span> <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
            <span class="token punctuation">&#123;</span> <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token string">'29'</span><span class="token punctuation">,</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'理念'</span> <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
            <span class="token punctuation">&#123;</span> <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token string">'48'</span><span class="token punctuation">,</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'耐心'</span> <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
            <span class="token punctuation">&#123;</span> <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token string">'5'</span><span class="token punctuation">,</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'太专业'</span> <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
            <span class="token punctuation">&#123;</span> <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token string">'16'</span><span class="token punctuation">,</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'经典实用'</span> <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
            <span class="token punctuation">&#123;</span> <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token string">'5'</span><span class="token punctuation">,</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'现学现卖'</span> <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
            <span class="token punctuation">&#123;</span> <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token string">'5'</span><span class="token punctuation">,</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'帮助很大'</span> <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
            <span class="token punctuation">&#123;</span> <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token string">'5'</span><span class="token punctuation">,</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'职业人'</span> <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
            <span class="token punctuation">&#123;</span> <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token string">'4'</span><span class="token punctuation">,</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'一直追随 '</span> <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
            <span class="token punctuation">&#123;</span> <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token string">'21'</span><span class="token punctuation">,</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'很不错'</span> <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
            <span class="token punctuation">&#123;</span> <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token string">'5'</span><span class="token punctuation">,</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'好好学习'</span> <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
            <span class="token punctuation">&#123;</span> <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token string">'8'</span><span class="token punctuation">,</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'太直'</span> <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
            <span class="token punctuation">&#123;</span> <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token string">'7'</span><span class="token punctuation">,</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'良心卖家'</span> <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
            <span class="token punctuation">&#123;</span> <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token string">'13'</span><span class="token punctuation">,</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'打开了视野'</span> <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
            <span class="token punctuation">&#123;</span> <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token string">'12'</span><span class="token punctuation">,</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'很喜欢'</span> <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
            <span class="token punctuation">&#123;</span> <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token string">'9'</span><span class="token punctuation">,</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'通俗易懂'</span> <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
            <span class="token punctuation">&#123;</span> <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token string">'9'</span><span class="token punctuation">,</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'思想开启'</span> <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
            <span class="token punctuation">&#123;</span> <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token string">'8'</span><span class="token punctuation">,</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'帮助巨大'</span> <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
            <span class="token punctuation">&#123;</span> <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token string">'7'</span><span class="token punctuation">,</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'一如既往地好用'</span> <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
            <span class="token punctuation">&#123;</span> <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token string">'7'</span><span class="token punctuation">,</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'升值必备'</span> <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
            <span class="token punctuation">&#123;</span> <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token string">'6'</span><span class="token punctuation">,</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'大大赞一个'</span> <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
            <span class="token punctuation">&#123;</span> <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token string">'6'</span><span class="token punctuation">,</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'不能错过'</span> <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
            <span class="token punctuation">&#123;</span> <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token string">'5'</span><span class="token punctuation">,</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'深入浅出'</span> <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
            <span class="token punctuation">&#123;</span> <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token string">'5'</span><span class="token punctuation">,</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'朴实 '</span> <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
            <span class="token punctuation">&#123;</span> <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token string">'5'</span><span class="token punctuation">,</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'加分'</span> <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
            <span class="token punctuation">&#123;</span> <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token string">'5'</span><span class="token punctuation">,</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'大气'</span> <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
            <span class="token punctuation">&#123;</span> <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token string">'5'</span><span class="token punctuation">,</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'死忠粉'</span> <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
            <span class="token punctuation">&#123;</span> <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token string">'9'</span><span class="token punctuation">,</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'看的进'</span> <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
            <span class="token punctuation">&#123;</span> <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token string">'8'</span><span class="token punctuation">,</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'优秀'</span> <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
            <span class="token punctuation">&#123;</span> <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token string">'7'</span><span class="token punctuation">,</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'高级'</span> <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
            <span class="token punctuation">&#123;</span> <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token string">'6'</span><span class="token punctuation">,</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'收货满满'</span> <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
          <span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
      <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">;</span></code></pre>

<h2 id="四、配置项详解"><a href="#四、配置项详解" class="headerlink" title="四、配置项详解"></a>四、配置项详解</h2><p><strong>left top right bottom ：</strong>词云的位置，默认是 center；<br><strong>shape ：</strong>词云的形状，默认是 circle(圆形)，可选的参数有cardioid（心形） 、 diamond（菱形 正方形） 、 triangle-forward 、 triangle（三角形）、 star（星形）、pentagon （五边形）；<br><strong>width height ：</strong>词云的宽高，默认是 75% 80%。<br><strong>sizeRange ：</strong>词云的文字字号范围，默认是[12, 60] ，词云会根据提供原始数据的 value 对文字的字号进行渲染。以默认值为例， value 最小的渲染为 12px ，最大的渲染为 60px ，中间的值按比例计算相应的数值。<br><strong>rotationRange rotationStep ：</strong>词云中文字的角度，词云中的文字会随机的在 rotationRange 范围内旋转角度，渲染的梯度就是 rotationStep ，这个值越小，词云里出现的角度种类就越多。以上面参数为例，可能旋转的角度就是 -90 -45 0 45 90 。<br><strong>gridSize ：</strong>词云中每个词的间距。<br><strong>drawOutOfBound ：</strong>是否允许词云在边界外渲染，直接使用默认参数 false 就可以，否则容易造成词重叠。<br><strong>textStyle ：</strong>词云中文字的样式， normal 是初始的样式， emphasis 是鼠标移到文字上的样式。<br><strong>maskImage：</strong> 词云轮廓图，白色区域将被排除在绘图文本之外,形状选项将继续应用为云的形状，如下图所示。<br>        目前有两种方式(时间问题未尝试，亲们自己动手哈)</p>
<p>（1）  可以在iconfont中下载（最好是填充的）图案，转为base64，就可以用来生成有图案的词云了。</p>
<pre class="language-js" data-language="js"><code class="language-js"><span class="token comment">// 小鸟图片</span>
image：<span class="token string">"data:image/png;base64,iVBORW0SDFAFASDFSAGASIWFW1J1I12I12I1I2NR1OI2R12R"</span>
<span class="token keyword">let</span> myChart <span class="token operator">=</span> echarts<span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span>document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'echartWordcolud'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment">// tip:image 不宜过大；否则firefox会不兼容 iconfont上面的图标大小就可以</span>

<span class="token keyword">let</span> maskImage <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Image</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
maskImage<span class="token punctuation">.</span>src <span class="token operator">=</span> data<span class="token punctuation">.</span>iamge</code></pre>

<p>(2) </p>
<pre class="language-js" data-language="js"><code class="language-js">
<span class="token keyword">let</span> maskImage <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Image</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
<span class="token keyword">let</span> world_option <span class="token operator">=</span> <span class="token function">world_cloud</span><span class="token punctuation">(</span>data<span class="token punctuation">,</span>maskImage<span class="token punctuation">)</span><span class="token punctuation">;</span>  
maskImage<span class="token punctuation">.</span><span class="token function-variable function">onload</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  
        world_option<span class="token punctuation">.</span>series<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>maskImage  
        worldChart<span class="token punctuation">.</span><span class="token function">setOption</span><span class="token punctuation">(</span>world_option<span class="token punctuation">)</span><span class="token punctuation">;</span>  
 <span class="token punctuation">&#125;</span>  
maskImage<span class="token punctuation">.</span>src <span class="token operator">=</span> <span class="token string">'img/ren1.png'</span><span class="token punctuation">;</span></code></pre>

<h2 id="五、踩过的坑"><a href="#五、踩过的坑" class="headerlink" title="五、踩过的坑"></a>五、踩过的坑</h2><h3 id="1-颜色不生效"><a href="#1-颜色不生效" class="headerlink" title="1.颜色不生效"></a>1.颜色不生效</h3><p><strong>在配置不同的颜色时，可以看到网上有很多都是这样配置的</strong></p>
<pre class="language-js" data-language="js"><code class="language-js"><span class="token literal-property property">textStyle</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
  <span class="token literal-property property">normal</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
    <span class="token function-variable function">color</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token string">"rgb("</span> <span class="token operator">+</span> Math<span class="token punctuation">.</span><span class="token function">round</span><span class="token punctuation">(</span>Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">255</span><span class="token punctuation">)</span>
      <span class="token operator">+</span> <span class="token string">", "</span> <span class="token operator">+</span> Math<span class="token punctuation">.</span><span class="token function">round</span><span class="token punctuation">(</span>Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">255</span><span class="token punctuation">)</span> 
      <span class="token operator">+</span><span class="token string">", "</span> <span class="token operator">+</span>Math<span class="token punctuation">.</span><span class="token function">round</span><span class="token punctuation">(</span>Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">255</span><span class="token punctuation">)</span> <span class="token operator">+</span><span class="token string">")"</span>
   <span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span></code></pre>

<blockquote>
<p>这样配置导致随机颜色不会生效，问题在于把color配置在了normal中，现在官方推荐不使用normal了，所以如果有随机颜色没有生效的，就要注意是不是配置在了normal中</p>
</blockquote>
<p><strong>正确写法：</strong></p>
<pre class="language-js" data-language="js"><code class="language-js"><span class="token literal-property property">textStyle</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
    <span class="token function-variable function">color</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token string">"rgb("</span> <span class="token operator">+</span> Math<span class="token punctuation">.</span><span class="token function">round</span><span class="token punctuation">(</span>Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">255</span><span class="token punctuation">)</span>
      <span class="token operator">+</span> <span class="token string">", "</span> <span class="token operator">+</span> Math<span class="token punctuation">.</span><span class="token function">round</span><span class="token punctuation">(</span>Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">255</span><span class="token punctuation">)</span> 
      <span class="token operator">+</span><span class="token string">", "</span> <span class="token operator">+</span>Math<span class="token punctuation">.</span><span class="token function">round</span><span class="token punctuation">(</span>Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">255</span><span class="token punctuation">)</span> <span class="token operator">+</span><span class="token string">")"</span>
   <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span></code></pre>

<h3 id="2-使用词云报错"><a href="#2-使用词云报错" class="headerlink" title="2.使用词云报错"></a>2.使用词云报错</h3><p><strong>如果页面报错 Component series.wordCloud not exists. Load it first.</strong></p>
<p><strong>原因：</strong>echarts插件中没有wordCloud依赖包，这是一个坑，虽然官网有阐述，但是位置不醒目，一般根本不知道</p>
<p>tip: 此时如果你百度，会出现很多让你引用第三方js库，也就是echarts-wordcloud.min.js文件，既然项目都安装了echaert，还去引用外部wordclou.js文件，不仅增加了项目的打包体积，更是多此一举，最后报错依旧不能解决，所以一下解决方案重中之重！</p>
<p><strong>解决办法：</strong></p>
<pre class="language-js" data-language="js"><code class="language-js"><span class="token number">1.</span> 安装 wordCloud <span class="token number">1.0</span> 依赖包
   npm install echarts<span class="token operator">-</span>wordcloud@<span class="token number">1</span>
<span class="token number">2.</span> 组件注入
   <span class="token keyword">import</span> <span class="token string">'echarts-wordcloud'</span>

<span class="token literal-property property">tip</span><span class="token operator">:</span>  必须安装这个版本，不能执行官网npm install echarts<span class="token operator">-</span>wordcloud，因为echarts5<span class="token punctuation">.</span><span class="token number">0</span>以下的版本使用<span class="token number">1.0</span>的词云  默认安装是<span class="token number">2.0</span>，否则会报错：
<span class="token literal-property property">TypeError</span><span class="token operator">:</span> <span class="token function">babel_runtime_helpers_defineProperty_WEBPACK_IMPORTED_MODULE_0__default</span><span class="token punctuation">(</span><span class="token operator">...</span><span class="token punctuation">)</span> is not a <span class="token keyword">function</span></code></pre>



<h3 id="六、总结"><a href="#六、总结" class="headerlink" title="六、总结"></a>六、总结</h3><p>在使用词云时，会有些配置项或者安装依赖的问题踩过一次的坑，下次就知道怎么解决啦~</p>
<p>综上就是关于Echarts词云图使用方法，以及关于如何配置Echarts词云图。希望可以能帮助到大家，也欢迎大家与我交流，咱们共同学习0.0!</p>
]]></content>
      <categories>
        <category>React.js</category>
      </categories>
      <tags>
        <tag>echarts</tag>
        <tag>wordcloud</tag>
      </tags>
  </entry>
  <entry>
    <title>夏日炎炎来个西瓜解解暑</title>
    <url>/2022/07/30/220730.html</url>
    <content><![CDATA[<blockquote>
<p>最近我也是再回顾之前很多遗忘的CSS3特性，看到有个很有意思的创意，就是用一个div画出一个西瓜，在这炎炎夏日，那就一起画个西瓜给自己解解暑吧！！</p>
</blockquote>
<img src="https://blog-1309278058.cos.ap-shanghai.myqcloud.com/22-07-30_%E8%A5%BF%E7%93%9C.png"/>

<h2 id="一、前置知识点"><a href="#一、前置知识点" class="headerlink" title="一、前置知识点"></a>一、前置知识点</h2><p>如果小伙伴们对径向渐变与阴影效果非常了解可以跳过前置知识点直接看最后如果实现，但是如果跟我一样有所遗忘的那就一起来回顾一下吧。</p>
<p><strong>径向渐变</strong></p>
<p><strong>主要语法</strong></p>
<pre class="language-css" data-language="css"><code class="language-css"><span class="token property">background-image</span><span class="token punctuation">:</span> <span class="token function">radial-gradient</span><span class="token punctuation">(</span>shape size at position<span class="token punctuation">,</span> start-color<span class="token punctuation">,</span> ...<span class="token punctuation">,</span> last-color<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>

<img src="https://blog-1309278058.cos.ap-shanghai.myqcloud.com/22-07-30_%E8%AF%AD%E6%B3%95.png"/>

<p><strong>demo举例</strong></p>
<pre class="language-css" data-language="css"><code class="language-css"><span class="token selector">.demo</span> <span class="token punctuation">&#123;</span>
    <span class="token property">width</span><span class="token punctuation">:</span> 300px<span class="token punctuation">;</span>
    <span class="token property">height</span><span class="token punctuation">:</span> 300px<span class="token punctuation">;</span>
    <span class="token property">background-image</span><span class="token punctuation">:</span> <span class="token function">radial-gradient</span><span class="token punctuation">(</span>red<span class="token punctuation">,</span> yellow<span class="token punctuation">,</span> green<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span></code></pre>

<img src="https://blog-1309278058.cos.ap-shanghai.myqcloud.com/22-07-30_demo1.png"/>

<p>可能有小伙伴会想 shape 不是椭圆的吗？怎么效果是个圆呢？那是因为我们的<code>div</code>元素是个方形的，导致它呈现了圆形的形态。如果换成一个长方形的话：</p>
<pre class="language-css" data-language="css"><code class="language-css"><span class="token selector">.demo</span> <span class="token punctuation">&#123;</span>
    <span class="token property">width</span><span class="token punctuation">:</span> 500px<span class="token punctuation">;</span>
    <span class="token property">height</span><span class="token punctuation">:</span> 300px<span class="token punctuation">;</span>
    <span class="token property">background-image</span><span class="token punctuation">:</span> <span class="token function">radial-gradient</span><span class="token punctuation">(</span>red<span class="token punctuation">,</span> yellow<span class="token punctuation">,</span> green<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span></code></pre>

<img src="https://blog-1309278058.cos.ap-shanghai.myqcloud.com/22-07-30_demo2.png"/>

<p>我们再来看看<code>size</code>这个参数，默认是<code>farthest-corner</code>，即以最远的角来渐变，为了测试这个参数，我们必须和<code>position</code>这个参数一起使用：</p>
<pre class="language-css" data-language="css"><code class="language-css"><span class="token selector">.demo</span> <span class="token punctuation">&#123;</span>
    <span class="token property">width</span><span class="token punctuation">:</span> 500px<span class="token punctuation">;</span>
    <span class="token property">height</span><span class="token punctuation">:</span> 300px<span class="token punctuation">;</span>
    <span class="token property">background-image</span><span class="token punctuation">:</span> <span class="token function">radial-gradient</span><span class="token punctuation">(</span>farthest-corner at left top<span class="token punctuation">,</span> red<span class="token punctuation">,</span> yellow<span class="token punctuation">,</span> green<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span></code></pre>

<img src="https://blog-1309278058.cos.ap-shanghai.myqcloud.com/22-07-30_demo3.png"/>

<p>可以看到我们把圆心置于左上角，那么它是向距离圆心最远的角渐变，我们试试最近的角以及最远的边最近的边看看都是啥效果：</p>
<img src="https://blog-1309278058.cos.ap-shanghai.myqcloud.com/22-07-30_demo4.png"/>

<p>我们把圆心置于<code>100，100</code>这个位置，这个点离左上角的角最近，可以看到左上角颜色终点是绿色。</p>
<pre class="language-css" data-language="css"><code class="language-css"><span class="token selector">.demo</span> <span class="token punctuation">&#123;</span>
    <span class="token property">width</span><span class="token punctuation">:</span> 500px<span class="token punctuation">;</span>
    <span class="token property">height</span><span class="token punctuation">:</span> 300px<span class="token punctuation">;</span>
    <span class="token property">background-image</span><span class="token punctuation">:</span> <span class="token function">radial-gradient</span><span class="token punctuation">(</span>circle closest-side at 120px 100px<span class="token punctuation">,</span> red<span class="token punctuation">,</span> yellow<span class="token punctuation">,</span> green<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span></code></pre>

<img src="https://blog-1309278058.cos.ap-shanghai.myqcloud.com/22-07-30_demo5.png"/>

<p>我们将点置于<code>120，100</code>位置，设置了形状圆形，<code>size</code>为距离最近的边。很显然距离顶边最近，在顶边处颜色终点是绿色。</p>
<pre class="language-css" data-language="css"><code class="language-css"><span class="token selector">.demo</span> <span class="token punctuation">&#123;</span>
    <span class="token property">width</span><span class="token punctuation">:</span> 500px<span class="token punctuation">;</span>
    <span class="token property">height</span><span class="token punctuation">:</span> 300px<span class="token punctuation">;</span>
   <span class="token property">background-image</span><span class="token punctuation">:</span> <span class="token function">radial-gradient</span><span class="token punctuation">(</span>circle farthest-side at 120px 100px<span class="token punctuation">,</span> red<span class="token punctuation">,</span> yellow<span class="token punctuation">,</span> green<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span></code></pre>

<img src="https://blog-1309278058.cos.ap-shanghai.myqcloud.com/22-07-30_demo6.png"/>

<p>另外，我们还可以设置颜色的占比，请看下面的例子：</p>
<pre class="language-css" data-language="css"><code class="language-css"><span class="token selector">.demo</span> <span class="token punctuation">&#123;</span>
    <span class="token property">width</span><span class="token punctuation">:</span> 300px<span class="token punctuation">;</span>
    <span class="token property">height</span><span class="token punctuation">:</span> 300px<span class="token punctuation">;</span>
    <span class="token property">background-image</span><span class="token punctuation">:</span> <span class="token function">radial-gradient</span><span class="token punctuation">(</span>red 10%<span class="token punctuation">,</span> yellow 20%<span class="token punctuation">,</span> green 30%<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span></code></pre>

<img src="https://blog-1309278058.cos.ap-shanghai.myqcloud.com/22-07-30_demo7.png"/>

<p>稍微改改应该有西瓜的样子了：</p>
<pre class="language-css" data-language="css"><code class="language-css"><span class="token selector">.demo</span> <span class="token punctuation">&#123;</span>
    <span class="token property">width</span><span class="token punctuation">:</span> 300px<span class="token punctuation">;</span>
    <span class="token property">height</span><span class="token punctuation">:</span> 300px<span class="token punctuation">;</span>
    <span class="token property">border-radius</span><span class="token punctuation">:</span> 150px<span class="token punctuation">;</span>
    <span class="token property">background-image</span><span class="token punctuation">:</span> <span class="token function">radial-gradient</span><span class="token punctuation">(</span>red 50%<span class="token punctuation">,</span> yellow 60%<span class="token punctuation">,</span> green 70%<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span></code></pre>

<img src="https://blog-1309278058.cos.ap-shanghai.myqcloud.com/22-07-30_demo8.png"/>

<h2 id="二、阴影知识点"><a href="#二、阴影知识点" class="headerlink" title="二、阴影知识点"></a>二、阴影知识点</h2><p>阴影还不太懂的可以去<a href="https://www.runoob.com/cssref/css3-pr-box-shadow.html">菜鸟教程</a>学一下</p>
<p><strong>语法</strong></p>
<pre class="language-css" data-language="css"><code class="language-css"><span class="token property">box-shadow</span><span class="token punctuation">:</span> h-shadow v-shadow blur spread color inset<span class="token punctuation">;</span></code></pre>

<p>box-shadow属性可以设置一个或<code>多个</code>下拉阴影的框。接下来我们用到的知识就是box-shadow画多个阴影的知识。</p>
<img src="https://blog-1309278058.cos.ap-shanghai.myqcloud.com/22-07-30_demo9.png"/>

<p><strong>例子</strong></p>
<pre class="language-css" data-language="css"><code class="language-css"><span class="token selector">.demo</span> <span class="token punctuation">&#123;</span>
    <span class="token property">width</span><span class="token punctuation">:</span> 100px<span class="token punctuation">;</span>
    <span class="token property">height</span><span class="token punctuation">:</span> 100px<span class="token punctuation">;</span>
    <span class="token property">background-color</span><span class="token punctuation">:</span> red<span class="token punctuation">;</span>
    <span class="token property">box-shadow</span><span class="token punctuation">:</span> 100px 100px 0 green<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span></code></pre>

<img src="https://blog-1309278058.cos.ap-shanghai.myqcloud.com/22-07-30_demo10.png"/>

<p>多来几个方形：</p>
<pre class="language-css" data-language="css"><code class="language-css"><span class="token selector">.demo</span> <span class="token punctuation">&#123;</span>
    <span class="token property">width</span><span class="token punctuation">:</span> 100px<span class="token punctuation">;</span>
    <span class="token property">height</span><span class="token punctuation">:</span> 100px<span class="token punctuation">;</span>
    <span class="token property">background-color</span><span class="token punctuation">:</span> red<span class="token punctuation">;</span>
    <span class="token property">box-shadow</span><span class="token punctuation">:</span> 100px 100px 0 green<span class="token punctuation">,</span> 100px 0 0 blue<span class="token punctuation">,</span> 0 100px 0 yellow<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span></code></pre>

<img src="https://blog-1309278058.cos.ap-shanghai.myqcloud.com/22-07-30_demo11.png"/>

<p>有了这些前置知识点的铺垫相信大家也可以很容易的画出一个大西瓜啦！</p>
<h2 id="三、平面西瓜"><a href="#三、平面西瓜" class="headerlink" title="三、平面西瓜"></a>三、平面西瓜</h2><p><strong>方法一</strong></p>
<pre class="language-css" data-language="css"><code class="language-css"><span class="token selector">.demo</span> <span class="token punctuation">&#123;</span>
    <span class="token property">width</span><span class="token punctuation">:</span> 300px<span class="token punctuation">;</span>
    <span class="token property">height</span><span class="token punctuation">:</span> 300px<span class="token punctuation">;</span>
    <span class="token property">border-radius</span><span class="token punctuation">:</span> 150px<span class="token punctuation">;</span>
    <span class="token property">background-image</span><span class="token punctuation">:</span> <span class="token function">radial-gradient</span><span class="token punctuation">(</span><span class="token function">rgb</span><span class="token punctuation">(</span>227<span class="token punctuation">,</span> 108<span class="token punctuation">,</span> 99<span class="token punctuation">)</span> 50%<span class="token punctuation">,</span> <span class="token function">rgb</span><span class="token punctuation">(</span>219<span class="token punctuation">,</span> 220<span class="token punctuation">,</span> 193<span class="token punctuation">)</span> 60%<span class="token punctuation">,</span> <span class="token function">rgb</span><span class="token punctuation">(</span>96<span class="token punctuation">,</span> 148<span class="token punctuation">,</span> 91<span class="token punctuation">)</span> 70%<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span></code></pre>

<p>缺点：需要计算下根号<code>2</code>除以<code>2</code>约等于<code>70%</code></p>
<p><strong>方法二</strong></p>
<pre class="language-css" data-language="css"><code class="language-css"><span class="token selector">.demo</span> <span class="token punctuation">&#123;</span>
    <span class="token property">width</span><span class="token punctuation">:</span> 300px<span class="token punctuation">;</span>
    <span class="token property">height</span><span class="token punctuation">:</span> 300px<span class="token punctuation">;</span>
    <span class="token property">border-radius</span><span class="token punctuation">:</span> 150px<span class="token punctuation">;</span>
    <span class="token property">background-image</span><span class="token punctuation">:</span> <span class="token function">radial-gradient</span><span class="token punctuation">(</span>closest-side <span class="token punctuation">,</span> <span class="token function">rgb</span><span class="token punctuation">(</span>227<span class="token punctuation">,</span> 108<span class="token punctuation">,</span> 99<span class="token punctuation">)</span> 80%<span class="token punctuation">,</span> <span class="token function">rgb</span><span class="token punctuation">(</span>219<span class="token punctuation">,</span> 220<span class="token punctuation">,</span> 193<span class="token punctuation">)</span> 90%<span class="token punctuation">,</span> <span class="token function">rgb</span><span class="token punctuation">(</span>96<span class="token punctuation">,</span> 148<span class="token punctuation">,</span> 91<span class="token punctuation">)</span> 100%<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span></code></pre>

<p>缺点：需要多传一个参数</p>
<p>但是出来的效果是一样的：</p>
<img src="https://blog-1309278058.cos.ap-shanghai.myqcloud.com/22-07-30_demo12.png"/>

<h2 id="四、画瓜子"><a href="#四、画瓜子" class="headerlink" title="四、画瓜子"></a>四、画瓜子</h2><p>画瓜子仁就是利用伪元素before结合阴影box-shadow完成</p>
<pre class="language-css" data-language="css"><code class="language-css"><span class="token selector">.demo</span> <span class="token punctuation">&#123;</span>
    <span class="token property">position</span><span class="token punctuation">:</span> relative<span class="token punctuation">;</span>
    <span class="token property">width</span><span class="token punctuation">:</span> 300px<span class="token punctuation">;</span>
    <span class="token property">height</span><span class="token punctuation">:</span> 300px<span class="token punctuation">;</span>
    <span class="token property">border-radius</span><span class="token punctuation">:</span> 150px<span class="token punctuation">;</span>
    <span class="token property">background-image</span><span class="token punctuation">:</span> <span class="token function">radial-gradient</span><span class="token punctuation">(</span><span class="token function">rgb</span><span class="token punctuation">(</span>227<span class="token punctuation">,</span> 108<span class="token punctuation">,</span> 99<span class="token punctuation">)</span> 50%<span class="token punctuation">,</span> <span class="token function">rgb</span><span class="token punctuation">(</span>219<span class="token punctuation">,</span> 220<span class="token punctuation">,</span> 193<span class="token punctuation">)</span> 60%<span class="token punctuation">,</span> <span class="token function">rgb</span><span class="token punctuation">(</span>96<span class="token punctuation">,</span> 148<span class="token punctuation">,</span> 91<span class="token punctuation">)</span> 70%<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token selector">.demo::before</span> <span class="token punctuation">&#123;</span>
    <span class="token property">content</span><span class="token punctuation">:</span> <span class="token string">''</span><span class="token punctuation">;</span>
    <span class="token property">width</span><span class="token punctuation">:</span> 10px<span class="token punctuation">;</span>
    <span class="token property">height</span><span class="token punctuation">:</span> 8px<span class="token punctuation">;</span>
    <span class="token property">border-radius</span><span class="token punctuation">:</span> 4px<span class="token punctuation">;</span>
    <span class="token property">background-color</span><span class="token punctuation">:</span> #333<span class="token punctuation">;</span>
    <span class="token property">position</span><span class="token punctuation">:</span> absolute<span class="token punctuation">;</span>
    <span class="token property">top</span><span class="token punctuation">:</span> 146px<span class="token punctuation">;</span>
    <span class="token property">left</span><span class="token punctuation">:</span> 145px<span class="token punctuation">;</span>
    <span class="token property">box-shadow</span><span class="token punctuation">:</span>
        0 80px 1px #333<span class="token punctuation">,</span>
        80px 0 1px #333<span class="token punctuation">,</span>
        -80px 0 1px #333<span class="token punctuation">,</span>
        0 -80px 1px #333<span class="token punctuation">,</span>
        57px 57px 1px #333<span class="token punctuation">,</span>
        -57px -57px 1px #333<span class="token punctuation">,</span>
        -57px 57px 1px #333<span class="token punctuation">,</span>
        57px -57px 1px #333<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span></code></pre>

<img src="https://blog-1309278058.cos.ap-shanghai.myqcloud.com/22-07-30_demo13.png"/>

<h2 id="五、总结"><a href="#五、总结" class="headerlink" title="五、总结"></a>五、总结</h2><p>大家可以看到css3中阴影运用到位可以画出很多神奇的特效、像什么八卦、彩云都是不在话下，等待大家去发掘！</p>
]]></content>
      <categories>
        <category>HTML</category>
      </categories>
      <tags>
        <tag>CSS</tag>
      </tags>
  </entry>
  <entry>
    <title>Umi 4 诞生啦，快来看看吧</title>
    <url>/2022/07/01/220701.html</url>
    <content><![CDATA[<blockquote>
<p>最近看React生态发现 Umi在两个月前发布了Umi4 ，目前是RC.24版本，蚂蚁内网框架的主体功能已非常稳定，目前上线近100应用，并且可以在npm上使用了，一起来看看有哪些好东西吧！</p>
</blockquote>
<img src="https://blog-1309278058.cos.ap-shanghai.myqcloud.com/22-07-01_umi4.png"/>

<h2 id="一、新增功能"><a href="#一、新增功能" class="headerlink" title="一、新增功能"></a>一、新增功能</h2><p>相比 Umi 2 到 Umi 3，Umi 4 有着更宏大的目标，更版时间也长了很多，同时带来的变化是巨大的。</p>
<h5 id="多构建引擎"><a href="#多构建引擎" class="headerlink" title="多构建引擎"></a><strong>多构建引擎</strong></h5><p> Umi 4 同时支持 Vite 和 Webpack 两种构建方式，并尽量确保他们之间功能的一致性，让开发者可以通过一行配置进行切换。可能有些同学会喜欢 dev 用 vite，build 用 webpack 这样的组合。</p>
<pre class="language-js" data-language="js"><code class="language-js"><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">&#123;</span>
  <span class="token literal-property property">vite</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span></code></pre>

<h5 id="默认快"><a href="#默认快" class="headerlink" title="默认快"></a><strong>默认快</strong></h5><p> 默认快是多维度的，通过 MFSU V3 + Webpack 5 缓存解 Dev 时编译慢的问题；内网还有通过 Webpack 5 物理缓存和 CD 平台结合解 Build 时编译慢的问题；有使用 esbuild 做 js 和 css 的压缩器、配置和 MOCK 文件的读取、jest 的 transformer，让除构建之外的其他环节也飞快；此外还有运行时速度也有考虑。</p>
<h5 id="MFSU-V3"><a href="#MFSU-V3" class="headerlink" title="MFSU V3"></a><strong>MFSU V3</strong></h5><p> Umi 3 的 MFSU 大家可能多少有接触过，虽然有用，但 DX 不够好。用的时候会遇到一些坑，以至于很多同学都掌握了一项特殊技能，遇到问题时 rm -rf src/.umi。大家可能会遇到 monorepo 不支持、热更新导致 Tab 卡死、请求多导致页面打开慢、一些语法不支持的问题。以上问题在 MFSU V3 中全解！基于此在 Umi 4 中默认开启 MFSU 功能。当然，如果你不喜欢，会保留手动配置 mfsu: false 关闭的口子。同时，MFSU V3 还可脱离 Umi 独立使用。</p>
<img src="https://blog-1309278058.cos.ap-shanghai.myqcloud.com/22-07-01_mfsu%E5%8E%9F%E7%90%86.png"/>

<h5 id="Umi-Max"><a href="#Umi-Max" class="headerlink" title="Umi Max"></a><strong>Umi Max</strong></h5><p> 这是内部 Bigfish 框架的对外版本，同时也给社区另一个集中化框架的选择，定位是中后台框架，包含了中后台相关的大量最佳实践的插件。如果有定制需求，大家可以参考他来实现内网框架的定制，比如快手团队就有基于 Umi 4 的框架定制，还有 Alita 也是基于 Umi 定制的面向移动端的框架。</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">$ <span class="token function">npm</span> i @umijs/max -D</code></pre>

<h5 id="React-Router-6"><a href="#React-Router-6" class="headerlink" title="React Router 6"></a><strong>React Router 6</strong></h5><p> 升级了路由方案到 React Router 6，喜忧参半。好消息是，React Router 6 是 Remix 的基础库，面向框架层做了很多优化，路由实现层更优雅，Umi 得以删除大量路由渲染的代码；坏消息是，带来不少 Break Change，比如之前父路由渲染子路由用 children，得换成 。</p>
<pre class="language-diff" data-language="diff"><code class="language-diff"><span class="token deleted-sign deleted"><span class="token prefix deleted">-</span><span class="token line"> &#123; props.children &#125;
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line"> &lt;Outlet /></span></span></code></pre>

<h5 id="支持-Vue"><a href="#支持-Vue" class="headerlink" title="支持 Vue"></a><strong>支持 Vue</strong></h5><p> Umi 4 中提供了 Vue 支持，记得在 Umi 2 有一张架构图，其中就有 Vue 的一环，Umi 3 时也有过尝试，但那会 Vue 3 还不太成熟，接入时遇到不少坑，这个坑今天总算是补上了。此功能由社区同学操刀，只需装载一个 preset 即可切换到 Vue。</p>
<pre class="language-js" data-language="js"><code class="language-js"><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">&#123;</span>
  <span class="token literal-property property">presets</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'@umijs/preset-vue'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span></code></pre>

<h5 id="默认最快的-CSR-请求"><a href="#默认最快的-CSR-请求" class="headerlink" title="默认最快的 CSR 请求"></a><strong>默认最快的 CSR 请求</strong></h5><p> 项目构建快解的是 DX 问题，但同时也应该关注 UX。Client Loader 的目的是让应用加载默认快，避免 React 项目经典的 Render-Then-Fetch 的加载瀑布流问题。示例项目的从 9s 降到 6s，这 6s 还是之前截的图，上了 Preload 功能之后其实已更快。</p>
<pre class="language-js" data-language="js"><code class="language-js"><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token comment">// 使用请求数据</span>
  <span class="token function">useClientLoaderData</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span>
<span class="token comment">// 声明请求</span>
<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">clientLoader</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span></code></pre>

<h5 id="白盒文档的-Lint"><a href="#白盒文档的-Lint" class="headerlink" title="白盒文档的 Lint"></a><strong>白盒文档的 Lint</strong></h5><p> Umi 4 里内置了 lint 规则，只有质量类不开可能会导致项目问题的规则，不包含风格类的规则，不包含 TypeScript 中 type-aware 类的规则，这类规则需要跑整个项目，会导致性能问题；同时通过 @rushstack/eslint-pach 的方式锁定了 config 里找 plugin 的规则，确保规则是长期稳定的。</p>
<h5 id="SSR"><a href="#SSR" class="headerlink" title="SSR"></a><strong>SSR</strong></h5><p>Umi 4 重写了 SSR 功能，目前此功能还在 beta 阶段，请勿将其用于生产环境。Umi 4 的 SSR 有以下特点，1）server 代码的构建基于 esbuild，所以极快，2）请求的处理类似 next.js 的 getServerSideProps 和 remix 的 loader，只在服务端跑，3）基于 react 18 的 suspense 和 renderToPipeableStream。实现原因，部署层目前仅实现了 vercel 的 adapter。这里有个简单的 Todos 示例：<a href="https://link.juejin.cn/?target=https://test-vercel-chencheng.vercel.app/">test-vercel-chencheng.vercel.app/</a></p>
<pre class="language-js" data-language="js"><code class="language-js"><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">&#123;</span>
  <span class="token literal-property property">ssr</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span> <span class="token literal-property property">platform</span><span class="token operator">:</span> <span class="token string">'vercel'</span> <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span></code></pre>

<h5 id="API-路由"><a href="#API-路由" class="headerlink" title="API 路由"></a><strong>API 路由</strong></h5><p> Umi 4 约定 src/api 目录下存放的 Serverless Function 格式的文件即为 API 路由。这部分路由会打包成不同平台支持的 Serverless Function 产物。场景比如带 token 的 API 调用、动态数据源、基于 Notion API 的 Blog、Hackernews Clone 等等。基于此，Umi 能做的事的边界就大了很多。不再只是写写中后台，实现静态页面。</p>
<pre class="language-js" data-language="js"><code class="language-js"><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">&#123;</span>
  <span class="token literal-property property">apiRoute</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
<span class="token punctuation">&#125;</span></code></pre>

<h5 id="微生成器"><a href="#微生成器" class="headerlink" title="微生成器"></a><strong>微生成器</strong></h5><p> 此概念来自 Modern.js。Modern.js 引入很多新概念，其中「微生成器」还是非常贴切的。他包含两个功能，1）小型脚手架，2）功能的开启与关闭。Umi 3 虽然也有 generate 命令，但只包含功能 1。Umi 4 拓展了下 generate（alias 为 g）命令。除了支持更多类型的小型脚手架生成，还支持功能的开启与关闭，以及比如 Monorepo、react 和 antd 版本等的功能切换。</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">$ npx umi g
? Pick generator <span class="token builtin class-name">type</span> › - Use arrow-keys. Return to submit.
❯   创建页面 -- Create a umi page by page name
    创建组件 -- <span class="token builtin class-name">.</span>
    创建 mock 代码 -- <span class="token builtin class-name">.</span>
    创建 model 代码 -- <span class="token builtin class-name">.</span>
    启用 Prettier -- Setup Prettier Configurations
    启用 Jest -- Setup Jest Configuration
    启用 E2E 测试 -- <span class="token builtin class-name">.</span>
    启用 Tailwind CSS -- Setup Tailwind CSS configuration
    启用 SSR -- <span class="token builtin class-name">.</span>
    启用 Low Import 研发模式 -- <span class="token builtin class-name">.</span>
    启用权限方案 -- <span class="token builtin class-name">.</span>
    启用 Monaco 编辑器 -- <span class="token builtin class-name">.</span>
    关闭 Dva 数据流 -- Configuration, Dependencies, and Model Files <span class="token keyword">for</span> Dva
    关闭 MFSU -- <span class="token builtin class-name">.</span>
    切换为 Monorepo 项目 -- <span class="token builtin class-name">.</span>
    切换 React 为 <span class="token number">18</span> -- <span class="token builtin class-name">.</span>
    切换 Antd 为 <span class="token number">5</span> -- <span class="token builtin class-name">.</span></code></pre>

<p>除此之外，还有非常多小而美的 DX 改进。</p>
<h5 id="自动-https"><a href="#自动-https" class="headerlink" title="自动 https"></a><strong>自动 https</strong></h5><p> Umi 4 的 https dev server 的实现基于 mkcert，启动过程中会基于 hosts 自动生成对应的 key 和 cert。开发者除了安装前置的 mkcert，其他无需关心。</p>
<h5 id="浏览器里的构建进度条"><a href="#浏览器里的构建进度条" class="headerlink" title="浏览器里的构建进度条"></a><strong>浏览器里的构建进度条</strong></h5><p> 如果首次构建没有完成就在浏览器里打开，你会看到一个构建进度条，支持 webpack 多实例，支持 MFSU，完成初始构建后会自动跳转到项目页。</p>
<h5 id="项目级插件：plugin-ts"><a href="#项目级插件：plugin-ts" class="headerlink" title="项目级插件：plugin.ts"></a><strong>项目级插件：plugin.ts</strong></h5><p> 为进一步降低项目中使用插件的门槛，Umi 4 中约定项目根目录下的 plugin.ts 为插件，开发者可在此直接调用插件 API，无需注册，支持 TypeScript。有了这个文件，我们可以在项目级做很多事。比如，</p>
<pre class="language-js" data-language="js"><code class="language-js"><span class="token keyword">import</span> <span class="token punctuation">&#123;</span> IApi <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'umi'</span><span class="token punctuation">;</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">api</span><span class="token operator">:</span> IApi</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
  <span class="token comment">// 比如修改 HTML</span>
  api<span class="token punctuation">.</span><span class="token function">modifyHTML</span><span class="token punctuation">(</span><span class="token parameter">$</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">return</span> $<span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// 比如在入口的 umi.ts 中添加代码</span>
  api<span class="token punctuation">.</span><span class="token function">addEntryCodeAhead</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">[</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">console.log('entry code ahead')</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  api<span class="token punctuation">.</span><span class="token function">addEntryCode</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">[</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">console.log('entry code')</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// 比如在构建完成时做额外的事</span>
  api<span class="token punctuation">.</span><span class="token function">onBuildComplete</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">opts</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// 比如在启动阶段做额外的事</span>
  api<span class="token punctuation">.</span><span class="token function">onStart</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">opts</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// 比如校验每个 JavaScript/TypeScript 代码</span>
  api<span class="token punctuation">.</span><span class="token function">onCheckCode</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">args</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// 比如动态修改路由</span>
  api<span class="token punctuation">.</span><span class="token function">modifyRoutes</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">routes</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span></code></pre>

<h5 id="deadCode-检测"><a href="#deadCode-检测" class="headerlink" title="deadCode 检测"></a><strong>deadCode 检测</strong></h5><p> 项目中通常会有未使用的文件或导出，Umi 4 中通过配置 deadCode: {} 即可在 build 阶段做检测。如有发现，会有类似信息抛出。</p>
<pre class="language-none"><code class="language-none">Warning: There are 3 unused files:
 1. &#x2F;mock&#x2F;a.ts
 2. &#x2F;mock&#x2F;b.ts
 3. &#x2F;pages&#x2F;index.module.less
 Please be careful if you want to remove them (¬º-°)¬.</code></pre>

<h5 id="Umi-UI-卷土重来？"><a href="#Umi-UI-卷土重来？" class="headerlink" title="Umi UI 卷土重来？"></a><strong>Umi UI 卷土重来？</strong></h5><p> 日常排查问题时，很多 Umi 框架的内部状态是看不到的，比如插件启用情况、appData 元数据、修改过的最终配置、修改过的最终 webpack 配置、修改过的最终路由、MFSU 的 module graph 信息等。Umi 4 提供了 /__umi/ 路由，dev 阶段可用，定位是开发辅助，大家也可以理解为是「丐版 Umi UI」。</p>
<h2 id="二、如此多的更新该做点什么？"><a href="#二、如此多的更新该做点什么？" class="headerlink" title="二、如此多的更新该做点什么？"></a>二、如此多的更新该做点什么？</h2><h5 id="升级项目到-Umi-4"><a href="#升级项目到-Umi-4" class="headerlink" title="升级项目到 Umi 4"></a>升级项目到 Umi 4</h5><p>如果项目用的Umi并且有以上功能可以解决项目的难题何不试试换到Umi呢</p>
<h5 id="使用-Umi-4-开启新项目"><a href="#使用-Umi-4-开启新项目" class="headerlink" title="使用 Umi 4 开启新项目"></a>使用 Umi 4 开启新项目</h5><p>使用Vue项目集成Umi，想想也很刺激呢</p>
<p>**tip: ** Ant Design Pro 已完成到 Umi 4 的升级，不日将发布新版本。</p>
<h2 id="三、想说的话"><a href="#三、想说的话" class="headerlink" title="三、想说的话"></a>三、想说的话</h2><p>技术方向有迭代才会更有生命力</p>
]]></content>
      <categories>
        <category>React.js</category>
      </categories>
      <tags>
        <tag>umi</tag>
      </tags>
  </entry>
  <entry>
    <title>前端基于&#39;RBAC&#39;鉴权方案</title>
    <url>/2022/09/01/220901.html</url>
    <content><![CDATA[<blockquote>
<p>和同事朋友聊天有了解到涉及了<code>RBAC</code>或是其他鉴权方案，在做中后台管理系统时，权限是一个非常重要的功能，权限的方案非常之多，在众多方案中最常用的辨识<code>RBAC</code>，那我也是基于网上资料结合我之前做过的一些<code>RBAC</code>的思想简单聊一下<code>RBAC</code>的一些简单实现方案，一起来学习一下吧！</p>
</blockquote>
<img src="https://blog-1309278058.cos.ap-shanghai.myqcloud.com/22-09-01_rbac.png"/>

<h2 id="一、相关术语"><a href="#一、相关术语" class="headerlink" title="一、相关术语"></a>一、相关术语</h2><p>用户：操作的账号，为权限的载体</p>
<p>资源：将页面(路由)、页面内容、数据，接口等可以进行权限控制的都称为资源。</p>
<p>角色：权限的载体，通常是指具有某些共同特征的一组人，比如财务、运维、研发等角色；角色和权限（资源）绑定，通过不同的角色关联不同的权限</p>
<h2 id="二、常见的权限模型"><a href="#二、常见的权限模型" class="headerlink" title="二、常见的权限模型"></a>二、常见的权限模型</h2><p>ACL（Access Control List）：访问控制列表，直接将权限与用户绑定，当用户数量很多的时候，操作一次权限就需要对每个用户都进行授权，工作量很大。</p>
<p>RBAC（Role-Based Access List）: 基于角色的权限控制，通过 <code>用户 -&gt; 角色 -&gt; 权限</code> 的模型，增加了一层角色来间接的赋予用户权限，从而让用户与权限解耦。</p>
<p>ABAC（Attribute-Based Access Control）: 基于属性的访问控制，通过定义一系列属性（用户属性、环境属性、资源属性），通过动态计算来确定用户是否有权限访问。对于资源的管控力度更细，比如运营(角色)在杭州(环境)能查询杭州订单(资源)。这种在前端并不常见，有兴趣自行了解。</p>
<h2 id="三、前端的权限控制"><a href="#三、前端的权限控制" class="headerlink" title="三、前端的权限控制"></a>三、前端的权限控制</h2><p>前端对权限控制粒度的不同，可以分为：</p>
<ul>
<li>页面权限：包括登录权限、路由、菜单这类，本质上就是对路由进行控制。</li>
<li>页面内容权限：比如没有编辑权限，则隐藏掉相关的UI组件，或者不同权限则展示不同数据，通常和后台接口挂钩。</li>
</ul>
<h3 id="角色固定且较少的方案"><a href="#角色固定且较少的方案" class="headerlink" title="角色固定且较少的方案"></a>角色固定且较少的方案</h3><img src="https://blog-1309278058.cos.ap-shanghai.myqcloud.com/22-09-01_%E8%A7%92%E8%89%B2%E5%9B%BA%E5%AE%9A%E8%BE%83%E5%B0%91%E6%96%B9%E6%A1%88%E5%9B%BE.png"/>

<p>这种应该是目前比较常见的一种，角色以及对应的权限由后台维护，前端通常会维护一份菜单（路由）与角色的 map 配置，例如：</p>
<pre class="language-js" data-language="js"><code class="language-js"><span class="token keyword">const</span> menusConfig <span class="token operator">=</span> <span class="token punctuation">[</span>
    <span class="token punctuation">&#123;</span>
        <span class="token literal-property property">path</span><span class="token operator">:</span> <span class="token string">'/path1'</span><span class="token punctuation">,</span>
        <span class="token literal-property property">meta</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
            <span class="token literal-property property">title</span><span class="token operator">:</span> <span class="token string">'path1'</span><span class="token punctuation">,</span>
            <span class="token literal-property property">roles</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'role1'</span><span class="token punctuation">,</span> <span class="token string">'role2'</span><span class="token punctuation">,</span> <span class="token string">'role3'</span><span class="token punctuation">]</span> <span class="token comment">// 该条路由那些角色可以访问</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
     <span class="token punctuation">&#123;</span>
        <span class="token literal-property property">path</span><span class="token operator">:</span> <span class="token string">'/path2'</span><span class="token punctuation">,</span>
        <span class="token literal-property property">meta</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
            <span class="token literal-property property">title</span><span class="token operator">:</span> <span class="token string">'path2'</span><span class="token punctuation">,</span>
            <span class="token literal-property property">roles</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'role1'</span><span class="token punctuation">,</span> <span class="token string">'role2'</span><span class="token punctuation">]</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
    <span class="token punctuation">&#123;</span>
        <span class="token literal-property property">path</span><span class="token operator">:</span> <span class="token string">'/path3'</span><span class="token punctuation">,</span>
        <span class="token literal-property property">meta</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
            <span class="token literal-property property">title</span><span class="token operator">:</span> <span class="token string">'path3'</span><span class="token punctuation">,</span>
            <span class="token literal-property property">roles</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'role3'</span><span class="token punctuation">]</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">]</span>
</code></pre>

<p>这份配置一般维护在前端，流程通常是：</p>
<ol>
<li>打开站点，登录</li>
<li>从后台获取到当前用户的角色</li>
<li>根据该角色，生成有权限的路由和菜单，进行页面初始化</li>
</ol>
<p>用户的 <code>角色</code> 属性，需要在创建的时候绑定，可以提供一个 <strong>用户管理</strong> 的模块进行配置。</p>
<h2 id="四、页面权限"><a href="#四、页面权限" class="headerlink" title="四、页面权限"></a>四、页面权限</h2><p>虽然流程在第三步生成的菜单后，页面上不存在入口让用户点击进入，但如果用户记住某条路由（比如保存到书签），直接用过url进入，那么还是会打开的。所以还需要在路由层面做权限判断，如果没有权限，则跳转403页面。</p>
<p>vue 和 react 的路由拦截都有各自的实现，这里不列出来，只给出主要逻辑伪代码</p>
<pre class="language-js" data-language="js"><code class="language-js"><span class="token keyword">const</span> <span class="token punctuation">&#123;</span>enableView<span class="token punctuation">&#125;</span> <span class="token operator">=</span> <span class="token function">usePermisesion</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>enableView<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token comment">// 定向到 403 页面</span>
<span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
    <span class="token comment">// 正常逻辑</span>
<span class="token punctuation">&#125;</span></code></pre>

<p>这里的 <code>usePermisesion</code> 通过 <code>menusConfig</code> 和 用户角色 来判断是当前路由是否权限进入，用户角色 建议通过全局状态、context之类的注入。</p>
<p>当然这里简化了操作，例如应该先进行 404 的判断，否则随便输入的 url 都会跳转到 403</p>
<h2 id="五、内容权限控制"><a href="#五、内容权限控制" class="headerlink" title="五、内容权限控制"></a>五、内容权限控制</h2><p>内容权限是比较难处理的，不像页面权限可以通过全局的拦截器进行统一的拦截，需要通过侵入业务代码中。</p>
<p>一些实现方案是将权限需要的角色写到业务中处理：</p>
<pre class="language-jsx" data-language="jsx"><code class="language-jsx"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">PermissionControl</span></span> <span class="token attr-name">permisstion</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">&#123;</span><span class="token punctuation">[</span><span class="token string">"role1"</span><span class="token punctuation">,</span> <span class="token string">"role2"</span><span class="token punctuation">]</span><span class="token punctuation">&#125;</span></span><span class="token punctuation">></span></span><span class="token plain-text">
  </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Button</span></span> <span class="token punctuation">/></span></span><span class="token plain-text">
</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">PermissionControl</span></span><span class="token punctuation">></span></span>

<span class="token comment">// or</span>
<span class="token operator">&lt;</span>Button v<span class="token operator">-</span>permission<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">"role1"</span><span class="token punctuation">,</span> <span class="token string">"role2"</span><span class="token punctuation">]</span> <span class="token operator">/</span><span class="token operator">></span></code></pre>

<p>这种方式适合角色比较少的情况，但维护比较麻烦，一旦要增加一个角色，或者删除一个角色，需要到处找代码。还是可以通过 <code>usePermisesion</code> 来获取当前页面的其他权限。只需扩展下 <code>menusConfig</code>：</p>
<pre class="language-js" data-language="js"><code class="language-js"><span class="token keyword">const</span> menusConfig <span class="token operator">=</span> <span class="token punctuation">[</span>
    <span class="token punctuation">&#123;</span>
        <span class="token literal-property property">path</span><span class="token operator">:</span> <span class="token string">'/path1'</span><span class="token punctuation">,</span>
        <span class="token literal-property property">meta</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
            <span class="token literal-property property">title</span><span class="token operator">:</span> <span class="token string">'path1'</span><span class="token punctuation">,</span>
            <span class="token literal-property property">permission</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span> <span class="token comment">// 对应的操作权限需要的角色</span>
                <span class="token literal-property property">view</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'role1'</span><span class="token punctuation">,</span> <span class="token string">'role2'</span><span class="token punctuation">,</span> <span class="token string">'role3'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                <span class="token literal-property property">edit</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'role1'</span><span class="token punctuation">,</span> <span class="token string">'role2'</span><span class="token punctuation">]</span>
            <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
     <span class="token punctuation">&#123;</span>
        <span class="token literal-property property">path</span><span class="token operator">:</span> <span class="token string">'/path2'</span><span class="token punctuation">,</span>
        <span class="token literal-property property">meta</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
            <span class="token literal-property property">title</span><span class="token operator">:</span> <span class="token string">'path2'</span><span class="token punctuation">,</span>
            <span class="token literal-property property">permission</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
                <span class="token literal-property property">view</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'role1'</span><span class="token punctuation">,</span> <span class="token string">'role2'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                <span class="token literal-property property">edit</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'role2'</span><span class="token punctuation">]</span>
            <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
    <span class="token punctuation">&#123;</span>
        <span class="token literal-property property">path</span><span class="token operator">:</span> <span class="token string">'/path3'</span><span class="token punctuation">,</span>
        <span class="token literal-property property">meta</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
            <span class="token literal-property property">title</span><span class="token operator">:</span> <span class="token string">'path3'</span><span class="token punctuation">,</span>
            <span class="token literal-property property">permission</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
                <span class="token literal-property property">view</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'role3'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                <span class="token literal-property property">edit</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'role3'</span><span class="token punctuation">]</span>
            <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">]</span></code></pre>

<p>然后封装通用的 权限组件 或者 vue指令，来获取当前页面需要对权限</p>
<pre class="language-js" data-language="js"><code class="language-js"><span class="token keyword">const</span> <span class="token function-variable function">PermissionControl</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">&#123;</span>permissionkey<span class="token punctuation">,</span> children<span class="token punctuation">&#125;</span></span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
     <span class="token comment">// 通过获取当前路由来找到对应的配置</span>
    <span class="token keyword">const</span> <span class="token punctuation">&#123;</span>enableEdit<span class="token punctuation">&#125;</span> <span class="token operator">=</span> <span class="token function">usePermisesion</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>enableEdit<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> <span class="token keyword">null</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">return</span> children
<span class="token punctuation">&#125;</span>

<span class="token comment">// 使用</span>

<span class="token operator">&lt;</span>PermissionControl<span class="token operator">></span><span class="token operator">&lt;</span>Button <span class="token operator">/</span><span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>PermissionControl<span class="token operator">></span>
<span class="token comment">// or</span>
<span class="token operator">&lt;</span>Button v<span class="token operator">-</span>permission <span class="token operator">/</span><span class="token operator">></span></code></pre>

<h2 id="六、内容权限控制"><a href="#六、内容权限控制" class="headerlink" title="六、内容权限控制"></a>六、内容权限控制</h2><p>上面的 <code>edit</code> 权限还是针对整个页面级别，如果希望只是页面某个按钮需要更加特殊的权限，比如 【文档发布】 按钮，需要更高的管理权限，依然可以通过上面的 <code>menusConfig</code> 来处理：</p>
<pre class="language-js" data-language="js"><code class="language-js"><span class="token keyword">const</span> menusConfig <span class="token operator">=</span> <span class="token punctuation">[</span>
    <span class="token punctuation">&#123;</span>
        <span class="token literal-property property">path</span><span class="token operator">:</span> <span class="token string">'/path1'</span><span class="token punctuation">,</span>
        <span class="token literal-property property">meta</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
            <span class="token literal-property property">title</span><span class="token operator">:</span> <span class="token string">'path1'</span><span class="token punctuation">,</span>
            <span class="token literal-property property">permission</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span> <span class="token comment">// 对应的操作权限需要的角色</span>
                <span class="token literal-property property">view</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'role1'</span><span class="token punctuation">,</span> <span class="token string">'role2'</span><span class="token punctuation">,</span> <span class="token string">'role3'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                <span class="token literal-property property">edit</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'role1'</span><span class="token punctuation">,</span> <span class="token string">'role2'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                <span class="token literal-property property">xxxButton</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'administrator'</span><span class="token punctuation">]</span> <span class="token comment">// 具体页面控件的key</span>
            <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">]</span>

<span class="token keyword">const</span> <span class="token function-variable function">PermissionControl</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">&#123;</span>permissionkey<span class="token punctuation">,</span> children<span class="token punctuation">&#125;</span></span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">const</span> <span class="token punctuation">&#123;</span>enableEdit<span class="token punctuation">&#125;</span> <span class="token operator">=</span> <span class="token function">usePermisesion</span><span class="token punctuation">(</span>permissionkey<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 可以传入 key 来获取指定特定对资源权限</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>enableEdit<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> <span class="token keyword">null</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">return</span> children
<span class="token punctuation">&#125;</span>

<span class="token comment">// 使用</span>

<span class="token operator">&lt;</span>PermissionControl permissionkey<span class="token operator">=</span><span class="token string">"administrator"</span><span class="token operator">></span><span class="token operator">&lt;</span>Button <span class="token operator">/</span><span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>PermissionControl<span class="token operator">></span>
<span class="token comment">// or</span>
<span class="token operator">&lt;</span>Button v<span class="token operator">-</span>permission<span class="token operator">=</span><span class="token string">"administrator"</span> <span class="token operator">/</span><span class="token operator">></span></code></pre>

<h2 id="总结："><a href="#总结：" class="headerlink" title="总结："></a>总结：</h2><p>今天所列的是基本上就能够覆盖权限验证在前端需要的几个场景，这种方式适合于小型系统，角色有限的情况。通过 <code>menusConfig</code> 来维护权限与页面资源的映射，也比较清晰简单。但也有明显的不足：</p>
<ul>
<li>对于大型项目，权限管理往往是复杂的，比如一个系统有几十个不同类别的应用，用户量都比较大，不能简单的抽象成几个简单的角色来控制。</li>
</ul>
<p>为了能够更加方便，更灵活的进行管理权限，往往会采用角色动态创建的方案，通过自定义不同类型的角色，以支持更加细粒度的权限管理。这里就不详细说明，可移步下面文章学习更多：</p>
<ul>
<li><a href="https://zhuanlan.zhihu.com/p/107054677">前后端分离架构设计(权限模型)</a></li>
<li><a href="https://www.uisdc.com/100-solutions-for-character-permission-design">角色权限设计的100种解法</a></li>
<li><a href="https://juejin.cn/post/6844904032197148679">基于RBAC的前端权限控制</a></li>
</ul>
<p>回见！！</p>
]]></content>
      <categories>
        <category>React</category>
        <category>Vue</category>
      </categories>
      <tags>
        <tag>RBAC</tag>
      </tags>
  </entry>
  <entry>
    <title>前端主题切换方案简易版</title>
    <url>/2022/10/05/221005.html</url>
    <content><![CDATA[<blockquote>
<p>日常逛网站，尤其是一些大厂官网可以看到有暗黑白天模式的主题切换功能，在一些中后台项目中也会涉及到这种功能的需求，在学习了之后我会总结一些主题切换方案在本期的文章中，有兴趣的小伙伴一起来学习一下吧！</p>
</blockquote>
<p><img src="https://blog-1309278058.cos.ap-shanghai.myqcloud.com/22-10-05_umi.gif"></p>
<h2 id="一、link标签动态引入"><a href="#一、link标签动态引入" class="headerlink" title="一、link标签动态引入"></a>一、link标签动态引入</h2><p>这个的做法就是准备几套CSS主题样式文件，在需要的时候，创建link标签动态的加载到head标签中，或是动态改变link标签的href属性</p>
<p><img src="https://blog-1309278058.cos.ap-shanghai.myqcloud.com/22-10-05_01.png"></p>
<p>效果如下：</p>
<p><img src="https://blog-1309278058.cos.ap-shanghai.myqcloud.com/22-10-05_02.gif"></p>
<p>网络请求效果如下：</p>
<p><img src="https://blog-1309278058.cos.ap-shanghai.myqcloud.com/22-10-05_03.gif"></p>
<h4 id="优点："><a href="#优点：" class="headerlink" title="优点："></a>优点：</h4><ul>
<li>实现了按需加载，提高了首屏加载时的性能</li>
</ul>
<h4 id="缺点："><a href="#缺点：" class="headerlink" title="缺点："></a>缺点：</h4><ul>
<li>动态加载样式文件，如果文件过大网络情况不佳的情况下可能会有加载延迟导致样式卡顿的情况</li>
<li>如果主题样式表内定义不当，发生优先级问题，导致样式不是预想效果</li>
<li>各个主题样式是固定写死，后续针对某一主题样式表修改或者新增主题会很麻烦</li>
</ul>
<h2 id="二、提前引入主题样式做类名间切换"><a href="#二、提前引入主题样式做类名间切换" class="headerlink" title="二、提前引入主题样式做类名间切换"></a>二、提前引入主题样式做类名间切换</h2><p>这种方案与第一种比较类似，为了解决反复加载样式文件问题提前将样式全部引入，在需要切换主题的时候将指定的根元素名更换，相当于直接做了样式覆盖，在该类名下的各个样式就统一地更换了，基本实现如下：</p>
<pre class="language-css" data-language="css"><code class="language-css"><span class="token comment">/* day样式主题 */</span>
<span class="token selector">body.day .box</span> <span class="token punctuation">&#123;</span>
  <span class="token property">color</span><span class="token punctuation">:</span> #f90<span class="token punctuation">;</span>
  <span class="token property">background</span><span class="token punctuation">:</span> #fff<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span class="token comment">/* dark样式主题 */</span>
<span class="token selector">body.dark .box</span> <span class="token punctuation">&#123;</span>
  <span class="token property">color</span><span class="token punctuation">:</span> #eee<span class="token punctuation">;</span>
  <span class="token property">background</span><span class="token punctuation">:</span> #333<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token selector">.box</span> <span class="token punctuation">&#123;</span>
  <span class="token property">width</span><span class="token punctuation">:</span> 100px<span class="token punctuation">;</span>
  <span class="token property">height</span><span class="token punctuation">:</span> 100px<span class="token punctuation">;</span>
  <span class="token property">border</span><span class="token punctuation">:</span> 1px solid #000<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span></code></pre>

<pre class="language-html" data-language="html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>box<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span>hello<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span>
  选择样式：
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token special-attr"><span class="token attr-name">onclick</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token value javascript language-javascript"><span class="token function">change</span><span class="token punctuation">(</span><span class="token string">'day'</span><span class="token punctuation">)</span></span><span class="token punctuation">"</span></span></span><span class="token punctuation">></span></span>day<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token special-attr"><span class="token attr-name">onclick</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token value javascript language-javascript"><span class="token function">change</span><span class="token punctuation">(</span><span class="token string">'dark'</span><span class="token punctuation">)</span></span><span class="token punctuation">"</span></span></span><span class="token punctuation">></span></span>dark<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span></code></pre>

<pre class="language-js" data-language="js"><code class="language-js"><span class="token keyword">function</span> <span class="token function">change</span><span class="token punctuation">(</span><span class="token parameter">theme</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  document<span class="token punctuation">.</span>body<span class="token punctuation">.</span>className <span class="token operator">=</span> theme<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span></code></pre>

<p>效果如下：</p>
<p><img src="https://blog-1309278058.cos.ap-shanghai.myqcloud.com/22-10-05_04.gif"></p>
<h4 id="优点：-1"><a href="#优点：-1" class="headerlink" title="优点："></a>优点：</h4><ul>
<li>不用重新加载样式文件，所以切换时不会有卡顿现象</li>
</ul>
<h4 id="缺点：-1"><a href="#缺点：-1" class="headerlink" title="缺点："></a>缺点：</h4><ul>
<li>首屏加载时会牺牲一些加载样式资源</li>
<li>如果主题样式表内定义不当，也会有优先级问题</li>
<li>各个主题样式写死，后续不方便个性化</li>
</ul>
<h2 id="三、CSS变量-类名切换"><a href="#三、CSS变量-类名切换" class="headerlink" title="三、CSS变量 + 类名切换"></a>三、CSS变量 + 类名切换</h2><p>参考：Vue3官网</p>
<p>在<code>Vue3</code>官网有一个暗黑模式切换按钮，点击之后就会平滑地过渡，虽然<code>Vue3</code>中也有一个<code>v-bind</code>特性可以实现动态样式绑定，但经过观察以后<code>Vue</code>官网并没有采取这个方案，针对<code>Vue3</code>的<code>v-bind</code>特性在接下来的方案中会细说。<br> 大体思路跟方案2相似，依然是提前将样式文件载入，切换时将指定的根元素类名更换。不过这里相对灵活的是，默认在根作用域下定义好CSS变量，只需要在不同的主题下更改CSS变量对应的取值即可。<br> 顺带提一下，在Vue3官网还使用了<code>color-scheme: dark;</code>将系统的滚动条设置为了黑色模式，使样式更加统一。</p>
<pre class="language-css" data-language="css"><code class="language-css"><span class="token selector">html.dark</span> <span class="token punctuation">&#123;</span>
  <span class="token property">color-scheme</span><span class="token punctuation">:</span> dark<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span></code></pre>

<p>方案如下：</p>
<pre class="language-css" data-language="css"><code class="language-css"><span class="token comment">/* 定义根作用域下的变量 */</span>
<span class="token selector">:root</span> <span class="token punctuation">&#123;</span>
  <span class="token property">--theme-color</span><span class="token punctuation">:</span> #333<span class="token punctuation">;</span>
  <span class="token property">--theme-background</span><span class="token punctuation">:</span> #eee<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span class="token comment">/* 更改dark类名下变量的取值 */</span>
<span class="token selector">.dark</span><span class="token punctuation">&#123;</span>
  <span class="token property">--theme-color</span><span class="token punctuation">:</span> #eee<span class="token punctuation">;</span>
  <span class="token property">--theme-background</span><span class="token punctuation">:</span> #333<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span class="token comment">/* 更改pink类名下变量的取值 */</span>
<span class="token selector">.pink</span><span class="token punctuation">&#123;</span>
  <span class="token property">--theme-color</span><span class="token punctuation">:</span> #fff<span class="token punctuation">;</span>
  <span class="token property">--theme-background</span><span class="token punctuation">:</span> pink<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token selector">.box</span> <span class="token punctuation">&#123;</span>
  <span class="token property">transition</span><span class="token punctuation">:</span> all .2s<span class="token punctuation">;</span>
  <span class="token property">width</span><span class="token punctuation">:</span> 100px<span class="token punctuation">;</span>
  <span class="token property">height</span><span class="token punctuation">:</span> 100px<span class="token punctuation">;</span>
  <span class="token property">border</span><span class="token punctuation">:</span> 1px solid #000<span class="token punctuation">;</span>
  <span class="token comment">/* 使用变量 */</span>
  <span class="token property">color</span><span class="token punctuation">:</span> <span class="token function">var</span><span class="token punctuation">(</span>--theme-color<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token property">background</span><span class="token punctuation">:</span> <span class="token function">var</span><span class="token punctuation">(</span>--theme-background<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
</code></pre>

<p>效果如下：</p>
<p><img src="https://blog-1309278058.cos.ap-shanghai.myqcloud.com/22-10-05_05.gif"></p>
<h4 id="优点：-2"><a href="#优点：-2" class="headerlink" title="优点："></a>优点：</h4><ul>
<li>不用重新加载样式文件，切换时也不会卡顿</li>
<li>在需要切换主题的地方利用var()绑定变量即可，不存在优先级问题</li>
<li>新增或修改主题方便灵活，仅需新增或修改CSS变量即可，在var()绑定样式变量的地方就会自动更换</li>
</ul>
<h4 id="缺点：-2"><a href="#缺点：-2" class="headerlink" title="缺点："></a>缺点：</h4><ul>
<li>兼容性(目前大多不考虑)</li>
<li>首屏加载会牺牲一些时间加载样式资源</li>
</ul>
<h2 id="四、SCSS-mixin-类名切换"><a href="#四、SCSS-mixin-类名切换" class="headerlink" title="四、SCSS + mixin  + 类名切换"></a>四、SCSS + mixin  + 类名切换</h2><p>主要运用SCSS的混合+CSS类名切换，其原理主要是将使用到mixin混合的地方编辑为固定的CSS以后，再通过类名切换去做样式的覆盖，实现如下：</p>
<h4 id="定义SCSS变量："><a href="#定义SCSS变量：" class="headerlink" title="定义SCSS变量："></a>定义SCSS变量：</h4><pre class="language-css" data-language="css"><code class="language-css"><span class="token comment">/* 字体定义规范 */</span>
$<span class="token property">font_samll</span><span class="token punctuation">:</span>12Px<span class="token punctuation">;</span>
$<span class="token property">font_medium_s</span><span class="token punctuation">:</span>14Px<span class="token punctuation">;</span>
$<span class="token property">font_medium</span><span class="token punctuation">:</span>16Px<span class="token punctuation">;</span>
$<span class="token property">font_large</span><span class="token punctuation">:</span>18Px<span class="token punctuation">;</span>

<span class="token comment">/* 背景颜色规范(主要) */</span>
$<span class="token property">background-color-theme</span><span class="token punctuation">:</span> #d43c33<span class="token punctuation">;</span>//背景主题颜色默认<span class="token punctuation">(</span>网易红<span class="token punctuation">)</span>
$<span class="token property">background-color-theme1</span><span class="token punctuation">:</span> #42b983<span class="token punctuation">;</span>//背景主题颜色<span class="token function">1</span><span class="token punctuation">(</span>QQ绿<span class="token punctuation">)</span>
$<span class="token property">background-color-theme2</span><span class="token punctuation">:</span> #333<span class="token punctuation">;</span>//背景主题颜色<span class="token function">2</span><span class="token punctuation">(</span>夜间模式<span class="token punctuation">)</span>

<span class="token comment">/* 背景颜色规范(次要) */</span> 
$<span class="token property">background-color-sub-theme</span><span class="token punctuation">:</span> #f5f5f5<span class="token punctuation">;</span>//背景主题颜色默认<span class="token punctuation">(</span>网易红<span class="token punctuation">)</span>
$<span class="token property">background-color-sub-theme1</span><span class="token punctuation">:</span> #f5f5f5<span class="token punctuation">;</span>//背景主题颜色<span class="token function">1</span><span class="token punctuation">(</span>QQ绿<span class="token punctuation">)</span>
$<span class="token property">background-color-sub-theme2</span><span class="token punctuation">:</span> #444<span class="token punctuation">;</span>//背景主题颜色<span class="token function">2</span><span class="token punctuation">(</span>夜间模式<span class="token punctuation">)</span>

<span class="token comment">/* 字体颜色规范(默认) */</span>
$<span class="token property">font-color-theme</span> <span class="token punctuation">:</span> #666<span class="token punctuation">;</span>//字体主题颜色默认<span class="token punctuation">(</span>网易<span class="token punctuation">)</span>
$<span class="token property">font-color-theme1</span> <span class="token punctuation">:</span> #666<span class="token punctuation">;</span>//字体主题颜色<span class="token function">1</span><span class="token punctuation">(</span>QQ<span class="token punctuation">)</span>
$<span class="token property">font-color-theme2</span> <span class="token punctuation">:</span> #ddd<span class="token punctuation">;</span>//字体主题颜色<span class="token function">2</span><span class="token punctuation">(</span>夜间模式<span class="token punctuation">)</span>

<span class="token comment">/* 字体颜色规范(激活) */</span>
$<span class="token property">font-active-color-theme</span> <span class="token punctuation">:</span> #d43c33<span class="token punctuation">;</span>//字体主题颜色默认<span class="token punctuation">(</span>网易红<span class="token punctuation">)</span>
$<span class="token property">font-active-color-theme1</span> <span class="token punctuation">:</span> #42b983<span class="token punctuation">;</span>//字体主题颜色<span class="token function">1</span><span class="token punctuation">(</span>QQ绿<span class="token punctuation">)</span>
$<span class="token property">font-active-color-theme2</span> <span class="token punctuation">:</span> #ffcc33<span class="token punctuation">;</span>//字体主题颜色<span class="token function">2</span><span class="token punctuation">(</span>夜间模式<span class="token punctuation">)</span>

<span class="token comment">/* 边框颜色 */</span>
$<span class="token property">border-color-theme</span> <span class="token punctuation">:</span> #d43c33<span class="token punctuation">;</span>//边框主题颜色默认<span class="token punctuation">(</span>网易<span class="token punctuation">)</span>
$<span class="token property">border-color-theme1</span> <span class="token punctuation">:</span> #42b983<span class="token punctuation">;</span>//边框主题颜色<span class="token function">1</span><span class="token punctuation">(</span>QQ<span class="token punctuation">)</span>
$<span class="token property">border-color-theme2</span> <span class="token punctuation">:</span> #ffcc33<span class="token punctuation">;</span>//边框主题颜色<span class="token function">2</span><span class="token punctuation">(</span>夜间模式<span class="token punctuation">)</span>

<span class="token comment">/* 字体图标颜色 */</span>
$<span class="token property">icon-color-theme</span> <span class="token punctuation">:</span> #ffffff<span class="token punctuation">;</span>//边框主题颜色默认<span class="token punctuation">(</span>网易<span class="token punctuation">)</span>
$<span class="token property">icon-color-theme1</span> <span class="token punctuation">:</span> #ffffff<span class="token punctuation">;</span>//边框主题颜色<span class="token function">1</span><span class="token punctuation">(</span>QQ<span class="token punctuation">)</span>
$<span class="token property">icon-color-theme2</span> <span class="token punctuation">:</span> #ffcc2f<span class="token punctuation">;</span>//边框主题颜色<span class="token function">2</span><span class="token punctuation">(</span>夜间模式<span class="token punctuation">)</span>
$<span class="token property">icon-theme</span> <span class="token punctuation">:</span> #d43c33<span class="token punctuation">;</span>//边框主题颜色默认<span class="token punctuation">(</span>网易<span class="token punctuation">)</span>
$<span class="token property">icon-theme1</span> <span class="token punctuation">:</span> #42b983<span class="token punctuation">;</span>//边框主题颜色<span class="token function">1</span><span class="token punctuation">(</span>QQ<span class="token punctuation">)</span>
$<span class="token property">icon-theme2</span> <span class="token punctuation">:</span> #ffcc2f<span class="token punctuation">;</span>//边框主题颜色<span class="token function">2</span><span class="token punctuation">(</span>夜间模式<span class="token punctuation">)</span></code></pre>

<h4 id="定义混合mixin："><a href="#定义混合mixin：" class="headerlink" title="定义混合mixin："></a>定义混合mixin：</h4><pre class="language-css" data-language="css"><code class="language-css"><span class="token atrule"><span class="token rule">@import</span> <span class="token string">"./variable.scss"</span><span class="token punctuation">;</span></span>

<span class="token atrule"><span class="token rule">@mixin</span> bg_<span class="token function">color</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span><span class="token punctuation">&#123;</span>
  <span class="token property">background</span><span class="token punctuation">:</span> $background-color-theme<span class="token punctuation">;</span>
  <span class="token selector">[data-theme=theme1] &amp;</span> <span class="token punctuation">&#123;</span>
    <span class="token property">background</span><span class="token punctuation">:</span> $background-color-theme1<span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
  <span class="token selector">[data-theme=theme2] &amp;</span> <span class="token punctuation">&#123;</span>
    <span class="token property">background</span><span class="token punctuation">:</span> $background-color-theme2<span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>
<span class="token atrule"><span class="token rule">@mixin</span> bg_sub_<span class="token function">color</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span><span class="token punctuation">&#123;</span>
  <span class="token property">background</span><span class="token punctuation">:</span> $background-color-sub-theme<span class="token punctuation">;</span>
  <span class="token selector">[data-theme=theme1] &amp;</span> <span class="token punctuation">&#123;</span>
    <span class="token property">background</span><span class="token punctuation">:</span> $background-color-sub-theme1<span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
  <span class="token selector">[data-theme=theme2] &amp;</span> <span class="token punctuation">&#123;</span>
    <span class="token property">background</span><span class="token punctuation">:</span> $background-color-sub-theme2<span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token atrule"><span class="token rule">@mixin</span> font_<span class="token function">color</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span><span class="token punctuation">&#123;</span>
  <span class="token property">color</span><span class="token punctuation">:</span> $font-color-theme<span class="token punctuation">;</span>
  <span class="token selector">[data-theme=theme1] &amp;</span> <span class="token punctuation">&#123;</span>
    <span class="token property">color</span><span class="token punctuation">:</span> $font-color-theme1<span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
  <span class="token selector">[data-theme=theme2] &amp;</span> <span class="token punctuation">&#123;</span>
    <span class="token property">color</span><span class="token punctuation">:</span> $font-color-theme2<span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>
<span class="token atrule"><span class="token rule">@mixin</span> font_active_<span class="token function">color</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span><span class="token punctuation">&#123;</span>
  <span class="token property">color</span><span class="token punctuation">:</span> $font-active-color-theme<span class="token punctuation">;</span>
  <span class="token selector">[data-theme=theme1] &amp;</span> <span class="token punctuation">&#123;</span>
    <span class="token property">color</span><span class="token punctuation">:</span> $font-active-color-theme1<span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
  <span class="token selector">[data-theme=theme2] &amp;</span> <span class="token punctuation">&#123;</span>
    <span class="token property">color</span><span class="token punctuation">:</span> $font-active-color-theme2<span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token atrule"><span class="token rule">@mixin</span> icon_<span class="token function">color</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span><span class="token punctuation">&#123;</span>
    <span class="token property">color</span><span class="token punctuation">:</span> $icon-color-theme<span class="token punctuation">;</span>
    <span class="token selector">[data-theme=theme1] &amp;</span> <span class="token punctuation">&#123;</span>
        <span class="token property">color</span><span class="token punctuation">:</span> $icon-color-theme1<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token selector">[data-theme=theme2] &amp;</span> <span class="token punctuation">&#123;</span>
        <span class="token property">color</span><span class="token punctuation">:</span> $icon-color-theme2<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token atrule"><span class="token rule">@mixin</span> border_<span class="token function">color</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span><span class="token punctuation">&#123;</span>
  <span class="token property">border-color</span><span class="token punctuation">:</span> $border-color-theme<span class="token punctuation">;</span>
  <span class="token selector">[data-theme=theme1] &amp;</span> <span class="token punctuation">&#123;</span>
    <span class="token property">border-color</span><span class="token punctuation">:</span> $border-color-theme1<span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
  <span class="token selector">[data-theme=theme2] &amp;</span> <span class="token punctuation">&#123;</span>
    <span class="token property">border-color</span><span class="token punctuation">:</span> $border-color-theme2<span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span></code></pre>

<pre class="language-xml" data-language="xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>header<span class="token punctuation">"</span></span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>changeTheme<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>header-left<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>slot</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>left<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>左边<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>slot</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>slot</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>center<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token punctuation">"</span></span><span class="token punctuation">></span></span>中间<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>slot</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>header-right<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>slot</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>right<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>右边<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>slot</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">></span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span>
  export default &#123;
    name: 'Header',
    methods: &#123;
      changeTheme () &#123;
        document.documentElement.setAttribute('data-theme', 'theme1')
      &#125;
    &#125;
  &#125;
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span> <span class="token attr-name">scoped</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>scss<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
@import "../assets/css/variable";
@import "../assets/css/mixin";
.header&#123;
  width: 100%;
  height: 100px;
  font-size: $font_medium;
  @include bg_color();
&#125;
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">></span></span></code></pre>

<p>效果如下：</p>
<p><img src="https://blog-1309278058.cos.ap-shanghai.myqcloud.com/22-10-05_06.gif"></p>
<p>使用mixin混合在SCSS编译后同样也是将所有包含的样式全部加载</p>
<p><img src="https://blog-1309278058.cos.ap-shanghai.myqcloud.com/22-10-05_07.png"></p>
<p>这种方案最后得到的结果与方案2类似，只是在定义主题时由于是直接操作SCSS变量，会更加灵活</p>
<h4 id="优点：-3"><a href="#优点：-3" class="headerlink" title="优点："></a>优点：</h4><ul>
<li>不需要重新加载样式文件，在样式切换时不会有卡顿</li>
<li>在需要切换主题的地方利用mixin混合绑定变量即可，不存在优先级问题</li>
<li>新增或修改主题方便灵活，仅需新增或修改SCSS变量即可，经过编译后将所有主题全部编译出来</li>
</ul>
<h4 id="缺点：-3"><a href="#缺点：-3" class="headerlink" title="缺点："></a>缺点：</h4><ul>
<li>首屏加载会牺牲一些时间加载资源</li>
</ul>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><blockquote>
<p>link 标签动态引入文件过大切换延时不太推荐；方案二提前引入所有主题做类名切换可以推荐；方案三CSS变量+类名切换是利大于弊可以推荐；方案四：SCSS+mixin+类名切换极力推荐，最终呈现与二类似、定义和使用更加灵活</p>
</blockquote>
<p>回见！</p>
]]></content>
      <categories>
        <category>SCSS</category>
        <category>CSS</category>
        <category>mixin</category>
      </categories>
      <tags>
        <tag>HTML主题</tag>
        <tag>Vue.js</tag>
      </tags>
  </entry>
</search>
